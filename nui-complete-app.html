<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Urban Influence | Detroit's Premier Digital Agency</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Detroit-based creative agency specializing in brand identity, web design, and digital marketing. Transform your business with bold, strategic branding. Unapologetically Detroit.">
    <meta name="keywords" content="branding agency detroit, logo design, web design, digital marketing, brand identity, graphic design, detroit creative agency, michigan branding">
    <meta name="author" content="New Urban Influence">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <link rel="canonical" href="https://newurbaninfluence.com">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://newurbaninfluence.com">
    <meta property="og:title" content="New Urban Influence | Detroit's Premier Digital Agency">
    <meta property="og:description" content="Detroit-based creative agency specializing in brand identity, web design, and digital marketing. Transform your business with bold, strategic branding.">
    <meta property="og:image" content="https://newurbaninfluence.com/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="New Urban Influence">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@newurbaninfluence">
    <meta name="twitter:creator" content="@newurbaninfluence">
    <meta name="twitter:title" content="New Urban Influence | Detroit's Premier Digital Agency">
    <meta name="twitter:description" content="Detroit-based creative agency specializing in brand identity, web design, and digital marketing.">
    <meta name="twitter:image" content="https://newurbaninfluence.com/twitter-card.jpg">

    <!-- Local Business Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "New Urban Influence",
        "description": "Detroit-based creative agency specializing in brand identity, web design, and digital marketing.",
        "url": "https://newurbaninfluence.com",
        "telephone": "(313) 555-0100",
        "email": "hello@newurbaninfluence.com",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "123 Woodward Ave",
            "addressLocality": "Detroit",
            "addressRegion": "MI",
            "postalCode": "48226",
            "addressCountry": "US"
        },
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": "42.3314",
            "longitude": "-83.0458"
        },
        "openingHours": "Mo-Fr 09:00-18:00",
        "priceRange": "$$",
        "image": "https://newurbaninfluence.com/logo.png",
        "sameAs": [
            "https://instagram.com/newurbaninfluence",
            "https://twitter.com/newurbaninfluence",
            "https://linkedin.com/company/newurbaninfluence"
        ],
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.9",
            "reviewCount": "28"
        }
    }
    </script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

    <!-- Google Identity Services API -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --black: #000000;
            --dark: #0a0a0a;
            --white: #ffffff;
            --gray: #888888;
            --gray-light: #f5f5f5;
            --gray-200: #e5e5e5;
            --gray-400: #a3a3a3;
            --gray-600: #525252;
            --red: #ff0000;
            --red-hover: #cc0000;
            --green: #10b981;
            --yellow: #f59e0b;
            --blue: #3b82f6;
        }
        body { font-family: 'Inter', sans-serif; background: var(--black); color: var(--white); overflow-x: hidden; }
        .view { display: none; }
        .view.active { display: block; }

        /* NAV */
        .nav { position: fixed; top: 0; left: 0; right: 0; display: flex; justify-content: space-between; align-items: center; padding: 20px 48px; z-index: 1000; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); }
        .logo { font-weight: 800; font-size: 18px; color: var(--red); text-decoration: none; cursor: pointer; }
        .logo img { height: 45px; width: auto; }
        .nav-links { display: flex; gap: 32px; align-items: center; }
        .nav-links a { color: var(--white); text-decoration: none; font-size: 14px; font-weight: 500; cursor: pointer; transition: color 0.2s; }
        .nav-links a:hover, .nav-links a.active { color: var(--red); }

        /* Mobile Menu */
        .hamburger { display: none; flex-direction: column; gap: 5px; cursor: pointer; padding: 10px; z-index: 1002; }
        .hamburger span { width: 24px; height: 2px; background: var(--white); transition: all 0.3s; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }
        .mobile-menu { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.98); z-index: 1001; flex-direction: column; align-items: center; justify-content: center; gap: 32px; }
        .mobile-menu.active { display: flex; }
        .mobile-menu a { color: var(--white); text-decoration: none; font-size: 24px; font-weight: 600; transition: color 0.2s; }
        .mobile-menu a:hover { color: var(--red); }
        .btn-cta { background: var(--red); color: var(--white); padding: 14px 24px; border: none; font-weight: 600; font-size: 14px; cursor: pointer; transition: background 0.2s; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; }
        .btn-cta:hover { background: var(--red-hover); }
        .btn-outline { background: transparent; color: var(--white); padding: 14px 24px; border: 2px solid var(--white); font-weight: 500; font-size: 14px; cursor: pointer; text-decoration: none; transition: all 0.2s; }
        .btn-outline:hover { background: var(--white); color: var(--black); }
        .btn-white { background: var(--white); color: var(--black); padding: 18px 40px; border: none; font-weight: 700; font-size: 14px; cursor: pointer; transition: all 0.3s; text-decoration: none; }
        .btn-white:hover { transform: scale(1.05); }
        .btn-sm { padding: 10px 16px; font-size: 13px; }

        /* HERO */
        .hero { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 120px 48px 80px; position: relative; overflow: hidden; }
        .hero-media { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        .hero-media-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; }
        .hero-media-container video { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; }
        .hero-media-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.8) 100%); z-index: 2; }
        .hero-content { position: relative; z-index: 3; }
        .badge { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; border: 1px solid rgba(255,255,255,0.2); border-radius: 50px; font-size: 12px; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 32px; }
        .badge::before { content: ''; width: 8px; height: 8px; background: var(--red); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .hero h1 { font-size: clamp(48px, 12vw, 140px); font-weight: 900; line-height: 0.95; letter-spacing: -2px; margin-bottom: 32px; text-transform: uppercase; }
        .hero p { font-size: 18px; color: var(--gray); max-width: 600px; margin-bottom: 40px; line-height: 1.6; }
        .hero p span { color: var(--red); }
        .hero-buttons { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; justify-content: center; }
        .scroll-indicator { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; gap: 8px; color: var(--gray); font-size: 12px; font-weight: 500; letter-spacing: 2px; text-transform: uppercase; animation: bounce 2s infinite; z-index: 3; }
        @keyframes bounce { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(10px); } }

        /* TICKER */
        .stats-ticker { background: #000; padding: 28px 0; overflow: hidden; border-top: 3px solid var(--red); border-bottom: 3px solid var(--red); }
        .ticker-text { font-size: clamp(32px, 7vw, 64px); font-weight: 900; white-space: nowrap; animation: ticker 15s linear infinite; color: var(--red); text-transform: uppercase; letter-spacing: 6px; }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        @keyframes industriesScroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        @keyframes logoScroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* SECTIONS */
        .section { padding: 100px 48px; }
        .section.light { background: var(--white); color: var(--black); }
        .section.dark { background: var(--black); color: var(--white); }
        .section.gray { background: var(--gray-light); color: var(--black); }
        .section-header { text-align: center; margin-bottom: 60px; }
        .section-title { font-size: clamp(36px, 6vw, 72px); font-weight: 900; text-transform: uppercase; margin-bottom: 16px; }
        .section-title .red { color: var(--red); }
        .section-subtitle { color: var(--gray); font-size: 18px; max-width: 600px; margin: 0 auto; }
        .label { font-size: 12px; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; color: var(--gray); display: flex; align-items: center; gap: 12px; margin-bottom: 24px; }
        .label::before { content: ''; width: 40px; height: 2px; background: var(--red); }

        /* STRUGGLE */
        .struggle-section { display: grid; grid-template-columns: 1fr 1fr; gap: 60px; align-items: start; max-width: 1400px; margin: 0 auto; }
        .struggle-left h2 { font-size: clamp(36px, 6vw, 72px); font-weight: 900; line-height: 1; text-transform: uppercase; margin-bottom: 24px; }
        .struggle-left h2 .red { color: var(--red); }
        .struggle-left p { color: var(--gray); font-size: 16px; line-height: 1.7; margin-bottom: 32px; }
        .problem-cards { display: flex; flex-direction: column; gap: 24px; }
        .problem-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 32px; border-radius: 4px; }
        .problem-card .number { display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border: 2px solid var(--red); border-radius: 50%; font-size: 14px; font-weight: 700; color: var(--red); flex-shrink: 0; }
        .problem-card h3 { font-size: 20px; font-weight: 700; line-height: 1.3; }

        /* SERVICES */
        .services-layout { display: grid; grid-template-columns: 1fr 2fr; gap: 60px; max-width: 1400px; margin: 0 auto; }
        .services-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
        .service-card { background: rgba(0,0,0,0.8); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); padding: 0; border: 1px solid rgba(255,59,48,0.2); border-radius: 16px; transition: all 0.4s ease; cursor: pointer; display: flex; flex-direction: column; min-height: 380px; overflow: hidden; position: relative; }
        .service-card::before { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, rgba(255,59,48,0.1) 0%, transparent 50%, rgba(255,59,48,0.05) 100%); opacity: 0; transition: opacity 0.4s ease; z-index: 0; }
        .service-card:hover { transform: translateY(-8px) scale(1.02); border-color: rgba(255,59,48,0.6); box-shadow: 0 20px 60px rgba(255,59,48,0.3), 0 0 40px rgba(255,59,48,0.1); }
        .service-card:hover::before { opacity: 1; }
        .service-card-image { width: 100%; height: 140px; background-size: cover; background-position: center; position: relative; }
        .service-card-image::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.9) 100%); }
        .service-card-content { padding: 28px; position: relative; z-index: 1; flex-grow: 1; display: flex; flex-direction: column; }
        .service-card h3 { font-size: 22px; font-weight: 800; margin-bottom: 8px; color: #fff; text-transform: uppercase; letter-spacing: 1px; }
        .service-card .tagline { color: var(--red); font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 12px; }
        .service-card p { color: rgba(255,255,255,0.7); font-size: 14px; line-height: 1.6; flex-grow: 1; }
        .service-card .includes { margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1); }
        .service-card .includes span { display: inline-block; background: rgba(255,59,48,0.15); color: var(--red); font-size: 11px; font-weight: 600; padding: 4px 10px; border-radius: 20px; margin: 3px 4px 3px 0; }

        /* SIMPLE SERVICE CARDS (Home Page) */
        .service-card-simple { background: #111; padding: 40px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; cursor: pointer; display: flex; flex-direction: column; min-height: 280px; }
        .service-card-simple:hover { background: #1a1a1a; transform: translateY(-4px); }
        .service-card-simple .arrow { width: 48px; height: 48px; border: 1px solid rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; margin-bottom: 24px; transition: all 0.3s; }
        .service-card-simple:hover .arrow { border-color: var(--red); color: var(--red); }
        .service-card-simple h3 { font-size: 24px; font-weight: 700; margin-bottom: 12px; }
        .service-card-simple p { color: var(--gray); font-size: 14px; line-height: 1.5; flex-grow: 1; }

        /* SERVICE PAGE */
        .service-item { display: grid; grid-template-columns: 1fr 1fr; min-height: 500px; }
        .service-item.image-right { direction: rtl; }
        .service-item.image-right > * { direction: ltr; }
        .service-image { background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%); position: relative; }
        .service-image::before { content: ''; position: absolute; inset: 0; background: linear-gradient(45deg, rgba(255,0,0,0.1), transparent); }
        .service-content { padding: 80px 60px; display: flex; flex-direction: column; justify-content: center; background: var(--white); color: var(--black); }
        .service-number { font-size: 12px; font-weight: 700; color: var(--gray); letter-spacing: 2px; margin-bottom: 16px; }
        .service-title { font-size: clamp(32px, 4vw, 48px); font-weight: 900; margin-bottom: 16px; line-height: 1.1; }
        .service-tagline { font-size: 18px; color: var(--gray); margin-bottom: 24px; }
        .service-description { font-size: 15px; color: #555; line-height: 1.7; margin-bottom: 24px; }
        .service-benefits { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 32px; }
        .service-benefits .arrow-icon { color: var(--red); font-size: 18px; margin-top: 2px; }
        .service-benefits p { font-size: 14px; color: #666; }
        .btn-service { background: var(--red); color: var(--white); padding: 16px 32px; border: none; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s; text-decoration: none; display: inline-flex; align-items: center; gap: 10px; width: fit-content; }
        .btn-service:hover { background: #fff; color: #000; transform: translateX(4px); }
        .service-item:nth-child(even) .service-content { background: var(--gray-light); }

        /* PORTFOLIO */
        .portfolio-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 60px; max-width: 1400px; margin-left: auto; margin-right: auto; }
        .portfolio-header h2 { font-size: clamp(48px, 8vw, 100px); font-weight: 900; text-transform: uppercase; }
        .portfolio-header h2 .red { color: var(--red); }
        .portfolio-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; max-width: 1400px; margin: 0 auto; }
        .portfolio-card { position: relative; aspect-ratio: 16/10; background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%); overflow: hidden; cursor: pointer; }
        .portfolio-card::before { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 50%); z-index: 1; transition: opacity 0.3s; }
        .portfolio-card:hover::before { opacity: 0.7; }
        .portfolio-card .content { position: absolute; bottom: 0; left: 0; right: 0; padding: 32px; z-index: 2; transform: translateY(20px); opacity: 0; transition: all 0.3s; }
        .portfolio-card:hover .content { transform: translateY(0); opacity: 1; }
        .portfolio-card .tag { font-size: 11px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; color: var(--red); margin-bottom: 12px; }
        .portfolio-card h3 { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
        .portfolio-card p { color: var(--gray); font-size: 14px; }

        /* ABOUT */
        .about-hero { min-height: 70vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 120px 48px 80px; position: relative; background: url('https://images.unsplash.com/photo-1534430480872-3498386e7856?w=1920&q=80') center/cover no-repeat; }
        .about-hero::before { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(0,0,0,0.75) 0%, rgba(0,0,0,0.85) 50%, rgba(0,0,0,0.95) 100%); z-index: 1; }
        .about-hero .hero-content { position: relative; z-index: 2; }
        .about-hero h1 { font-size: clamp(48px, 10vw, 120px); font-weight: 900; text-transform: uppercase; text-shadow: 0 4px 40px rgba(0,0,0,0.5); }
        .about-hero h1 span { color: var(--red); text-shadow: 0 0 60px rgba(255,59,48,0.4); }
        .about-hero p { font-size: 20px; color: rgba(255,255,255,0.85); max-width: 600px; margin-top: 24px; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .story-section { display: grid; grid-template-columns: 1fr 1fr; gap: 80px; align-items: center; max-width: 1400px; margin: 0 auto; }
        .story-content h2 { font-size: clamp(36px, 5vw, 56px); font-weight: 900; line-height: 1.1; text-transform: uppercase; margin-bottom: 24px; }
        .story-content h2 .red { color: var(--red); }
        .story-content p { color: var(--gray); font-size: 16px; line-height: 1.8; margin-bottom: 16px; }
        .story-image { aspect-ratio: 4/5; background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%); }
        .values-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; max-width: 1200px; margin: 0 auto; }
        .value-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 40px 32px; text-align: center; transition: all 0.3s; }
        .value-card:hover { border-color: var(--red); transform: translateY(-8px); }
        .value-card .number { font-size: 48px; font-weight: 900; color: var(--red); opacity: 0.3; margin-bottom: 16px; }
        .value-card h3 { font-size: 20px; font-weight: 700; margin-bottom: 12px; }
        .value-card p { color: var(--gray); font-size: 14px; line-height: 1.6; }

        /* TEAM SECTION */
        .team-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 48px; max-width: 1000px; margin: 0 auto; }
        .team-card { text-align: center; }
        .team-photo { width: 100%; aspect-ratio: 3/4; background: linear-gradient(145deg, #0a0a0a, #151515); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; margin-bottom: 24px; overflow: hidden; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.2); font-size: 14px; position: relative; }
        .team-photo::before { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, transparent 60%, rgba(255,59,48,0.15) 100%); pointer-events: none; }
        .team-photo img { width: 100%; height: 100%; object-fit: cover; }
        .team-name { font-size: 24px; font-weight: 800; margin-bottom: 8px; }
        .team-title { color: var(--red); font-size: 12px; text-transform: uppercase; letter-spacing: 3px; font-weight: 700; margin-bottom: 16px; }
        .team-bio { color: var(--gray); font-size: 14px; line-height: 1.7; }

        /* WHY */
        .why-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 32px; max-width: 1200px; margin: 0 auto; }
        .why-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 40px; text-align: center; transition: all 0.3s; }
        .why-card:hover { border-color: var(--red); }
        .why-card .icon { width: 64px; height: 64px; background: var(--red); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; font-size: 24px; }
        .why-card h3 { font-size: 20px; font-weight: 700; margin-bottom: 12px; }
        .why-card p { color: var(--gray); font-size: 14px; line-height: 1.6; }

        /* ROOTS */
        .roots-section { display: grid; grid-template-columns: 1fr 1fr; gap: 60px; align-items: center; max-width: 1400px; margin: 0 auto; }
        .roots-left h2 { font-size: clamp(48px, 8vw, 96px); font-weight: 900; line-height: 0.95; text-transform: uppercase; margin-bottom: 24px; }
        .roots-left h2 .red { color: var(--red); }
        .roots-left p { color: var(--gray); font-size: 18px; line-height: 1.7; }
        .roots-right { position: relative; border-radius: 16px; overflow: hidden; min-height: 350px; display: flex; align-items: center; justify-content: center; }
        .roots-right::before { content: ''; position: absolute; inset: 0; background: url('https://images.unsplash.com/photo-1534430480872-3498386e7856?w=800') center/cover no-repeat; filter: brightness(0.4); }
        .roots-right::after { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, rgba(255,59,48,0.2) 0%, transparent 50%, rgba(0,0,0,0.8) 100%); }
        .area-code { font-size: clamp(120px, 20vw, 250px); font-weight: 900; color: transparent; -webkit-text-stroke: 3px var(--red); text-align: center; position: relative; z-index: 1; text-shadow: 0 0 60px rgba(255,59,48,0.5); }

        /* TESTIMONIALS */
        .testimonials-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; max-width: 1200px; margin: 0 auto; padding: 0 24px; }
        .testimonial-card { background: linear-gradient(145deg, #1a1a1a 0%, #0d0d0d 100%); border: 1px solid rgba(255,255,255,0.08); padding: 32px; border-radius: 16px; transition: all 0.3s ease; }
        .testimonial-card:hover { transform: translateY(-4px); border-color: rgba(255,59,48,0.3); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .testimonial-card .stars { display: flex; gap: 4px; margin-bottom: 20px; color: var(--red); font-size: 16px; }
        .testimonial-card p { font-size: 15px; line-height: 1.8; font-style: italic; margin-bottom: 24px; color: rgba(255,255,255,0.85); }
        .testimonial-card .author { display: flex; align-items: center; gap: 14px; border-top: 1px solid rgba(255,255,255,0.08); padding-top: 20px; }
        .testimonial-card .avatar { width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, var(--red), #ff6b5b); }
        .testimonial-card .author-name { font-weight: 700; margin-bottom: 4px; color: #fff; }
        .testimonial-card .author-title { font-size: 12px; color: rgba(255,255,255,0.5); }

        /* CTA */
        .cta-section { background: var(--red); padding: 100px 48px; text-align: center; }
        .cta-section h2 { font-size: clamp(36px, 6vw, 72px); font-weight: 900; text-transform: uppercase; margin-bottom: 24px; }
        .cta-section p { font-size: 18px; margin-bottom: 40px; opacity: 0.9; }

        /* STATS */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 32px; max-width: 1200px; margin: 0 auto; text-align: center; }
        .stat-item .value { font-size: clamp(48px, 8vw, 72px); font-weight: 900; line-height: 1; margin-bottom: 8px; }
        .stat-item .stat-label { font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; opacity: 0.9; }

        /* CASE STUDY GRID */
        .brands-elevated-section { padding: 80px 48px; }
        .case-study-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 32px; max-width: 1400px; margin: 0 auto; }
        .case-study-grid > a { cursor: pointer; position: relative; aspect-ratio: 16/9; border-radius: 16px; overflow: hidden; display: flex; align-items: flex-end; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; box-shadow: 0 20px 60px rgba(0,0,0,0.4); }

        /* RESULTS/STATS BOXES */
        .results-section { padding: 80px 48px; }
        .stats-boxes { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; max-width: 1200px; margin: 0 auto; text-align: center; }
        .stat-box { padding: 40px 24px; background: linear-gradient(145deg, rgba(255,59,48,0.08) 0%, rgba(255,59,48,0.02) 100%); border: 1px solid rgba(255,59,48,0.2); border-radius: 20px; transition: all 0.3s ease; }
        .stat-box:hover { transform: translateY(-6px); border-color: rgba(255,59,48,0.4); box-shadow: 0 20px 40px rgba(255,59,48,0.15); }
        .stat-number { font-size: clamp(40px, 10vw, 72px); font-weight: 900; color: var(--red); line-height: 1; }
        .stat-box .stat-label { font-size: 13px; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 2px; margin-top: 12px; font-weight: 600; }

        /* FOOTER */
        .footer { background: var(--black); padding: 60px 48px; border-top: 1px solid rgba(255,255,255,0.1); }
        .footer-content { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; }
        .footer-logo { font-weight: 800; font-size: 20px; color: var(--red); text-decoration: none; cursor: pointer; }
        .footer-links { display: flex; gap: 32px; }
        .footer-links a { color: var(--gray); text-decoration: none; font-size: 14px; cursor: pointer; }
        .footer-links a:hover { color: var(--white); }

        /* RESPONSIVE - TABLET */
        @media (max-width: 968px) {
            .nav { padding: 16px 24px; }
            .nav-links { display: none; }
            .hamburger { display: flex; }
            .btn-cta-desktop { display: none; }
            .service-card { min-height: 320px; }
            .service-card-image { height: 120px; }
            .service-card-content { padding: 20px; }
            .service-card h3 { font-size: 18px; }
            .service-card .tagline { font-size: 11px; }
            .service-card p { font-size: 13px; }
            .hero { padding: 100px 24px 60px; }
            .section { padding: 60px 24px; }
            .struggle-section { grid-template-columns: 1fr; }
            .services-layout { grid-template-columns: 1fr; gap: 48px; }
            .services-grid { grid-template-columns: 1fr; }
            .service-item { grid-template-columns: 1fr; min-height: auto; }
            .service-item.image-right { direction: ltr; }
            .service-image { min-height: 250px; }
            .service-content { padding: 48px 24px; }
            .roots-section { grid-template-columns: 1fr; text-align: center; }
            .story-section { grid-template-columns: 1fr; gap: 48px; }
            .why-grid { grid-template-columns: 1fr; }
            .values-grid { grid-template-columns: repeat(2, 1fr); }
            .team-grid { grid-template-columns: 1fr; gap: 48px; max-width: 400px; padding: 0 24px; }
            .team-photo { aspect-ratio: 1/1; border-radius: 12px; max-width: 280px; margin: 0 auto 20px; }
            .team-name { font-size: 22px; }
            .team-title { font-size: 11px; letter-spacing: 2px; }
            .team-bio { font-size: 13px; padding: 0 8px; }
            .testimonials-grid { grid-template-columns: repeat(2, 1fr) !important; gap: 20px !important; }
            .testimonial-card { padding: 28px; }
            .portfolio-grid { grid-template-columns: 1fr; }
            .portfolio-header { flex-direction: column; align-items: flex-start; gap: 24px; }
            .stats-grid, .results-grid { grid-template-columns: repeat(2, 1fr); }
            .results-section { padding: 60px 24px; }
            .stats-boxes { grid-template-columns: repeat(2, 1fr); gap: 16px; }
            .stat-box { padding: 32px 16px; border-radius: 16px; }
            .stat-number { font-size: clamp(36px, 8vw, 56px); }
            .brands-elevated-section { padding: 60px 24px; }
            .case-study-grid { gap: 24px; }
            .cta-section { padding: 60px 24px; }
            .results-grid { gap: 16px; }
            .footer { padding: 40px 24px; }
            .footer-content { flex-direction: column; gap: 24px; text-align: center; }
            .case-header { padding: 24px; }
            .case-header-left { gap: 16px; }
            .case-logo { width: 56px; height: 56px; }
            .case-info h3 { font-size: 20px; }
            .case-tabs { padding: 0 16px; flex-wrap: wrap; }
            .case-tab { padding: 12px 16px; font-size: 11px; }
            .logo-grid { grid-template-columns: 1fr; gap: 20px; }
            .color-grid { grid-template-columns: repeat(2, 1fr); }
            .font-grid { grid-template-columns: 1fr; }
            .mockup-row.split { grid-template-columns: 1fr 1fr; }
            .brand-hero { aspect-ratio: 16/9 !important; min-height: 280px !important; }
            .brand-hero h2 { font-size: 32px !important; }
        }
        /* RESPONSIVE - MOBILE */
        @media (max-width: 580px) {
            .nav { padding: 12px 16px; }
            .nav .logo img { height: 32px; }
            .hamburger { padding: 8px; }
            .hero { padding: 80px 16px 40px; }
            .hero h1 { font-size: 36px; }
            .hero p { font-size: 14px; }
            .hero-buttons { flex-direction: column; width: 100%; }
            .hero-buttons a { width: 100%; text-align: center; }
            .section { padding: 48px 16px; }
            .section-title { font-size: 28px; }
            .stats-ticker { padding: 16px 0; }
            .ticker-text { font-size: 20px !important; letter-spacing: 2px !important; }
            .problem-card { padding: 20px; }
            .problem-card h3 { font-size: 16px; }
            .service-card { min-height: auto; }
            .service-card-image { height: 100px; }
            .service-card-content { padding: 16px; }
            .service-card h3 { font-size: 16px; }
            .service-card .tagline { font-size: 10px; margin-bottom: 8px; }
            .service-card p { font-size: 12px; }
            .service-card .includes { margin-top: 12px; padding-top: 12px; }
            .service-card .includes span { font-size: 9px; padding: 3px 8px; }
            .service-card-simple { padding: 24px; min-height: 200px; }
            .service-card-simple h3 { font-size: 18px; }
            .roots-right { min-height: 200px !important; }
            .area-code { font-size: 80px !important; }
            .why-card { padding: 24px; }
            .testimonials-grid { grid-template-columns: 1fr !important; gap: 16px !important; padding: 0 16px; }
            .testimonial-card { padding: 24px; background: linear-gradient(135deg, #1a1a1a 0%, #111 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; }
            .testimonial-card .stars { margin-bottom: 16px; font-size: 14px; }
            .testimonial-card p { font-size: 14px; line-height: 1.7; margin-bottom: 20px; }
            .testimonial-card .author { padding-top: 16px; gap: 12px; }
            .testimonial-card .avatar { width: 40px; height: 40px; }
            .testimonial-card .author-name { font-size: 14px; }
            .testimonial-card .author-title { font-size: 11px; }
            .cta-section h2 { font-size: 28px; }
            .case-study { border-radius: 16px; margin-bottom: 16px; }
            .case-header { padding: 20px 16px; flex-wrap: wrap; gap: 16px; }
            .case-header-left { width: 100%; }
            .case-logo { width: 48px; height: 48px; border-radius: 12px; }
            .case-info h3 { font-size: 18px; }
            .case-info .tag { font-size: 9px; padding: 4px 10px; }
            .case-toggle { width: 40px; height: 40px; font-size: 14px; }
            .case-tabs { padding: 0 12px; gap: 0; }
            .case-tab { padding: 10px 12px; font-size: 10px; letter-spacing: 1px; }
            .case-panels { padding: 0 !important; }
            .case-panel { padding: 24px 16px !important; }
            .brand-hero { aspect-ratio: 4/3 !important; }
            .brand-hero h2 { font-size: 24px !important; letter-spacing: 0 !important; }
            .brand-hero p { font-size: 14px !important; display: none; }
            .brand-section { margin-bottom: 32px; }
            .brand-section-title { font-size: 10px; letter-spacing: 2px; }
            .logo-grid { gap: 16px; }
            .logo-box { border-radius: 16px; }
            .logo-box-label { font-size: 10px; padding: 14px 16px; }
            .logo-box-img { padding: 20px; }
            .logo-placeholder { width: 60px; height: 60px; font-size: 10px; }
            .color-grid { gap: 12px; }
            .color-box { border-radius: 12px; padding: 12px; }
            .color-hex { font-size: 10px; }
            .font-box { padding: 20px; border-radius: 12px; }
            .font-name { font-size: 24px; }
            .font-sample { font-size: 12px; }
            .mockup-box { border-radius: 12px; }
            .results-grid { grid-template-columns: 1fr !important; gap: 12px; }
            .result-card { padding: 24px; border-radius: 16px; }
            .result-number { font-size: 40px; }
            .result-label { font-size: 10px; }
            .results-section { padding: 48px 16px; }
            .stats-boxes { grid-template-columns: 1fr !important; gap: 12px; padding: 0; }
            .stat-box { padding: 24px 20px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; text-align: left; background: var(--red); border: none; width: 100%; }
            .stat-box .stat-number { font-size: 42px; color: #fff !important; }
            .stat-box .stat-label { font-size: 14px; letter-spacing: 1px; margin-top: 0; text-align: right; max-width: 140px; line-height: 1.3; color: rgba(255,255,255,0.9) !important; font-weight: 600; }
            /* CASE STUDY GRID MOBILE */
            .brands-elevated-section { padding: 48px 16px; }
            .case-study-grid { grid-template-columns: 1fr !important; gap: 20px; }
            .case-study-grid > a { aspect-ratio: 4/3; border-radius: 12px; }
            .case-study-grid > a > div:last-child { padding: 20px !important; }
            .case-study-grid > a h4 { font-size: 22px !important; }
            .case-study-grid > a p { font-size: 13px !important; margin-top: 8px !important; }
            /* PACKAGE IMAGES MOBILE */
            .package-image { height: 200px; margin-bottom: 40px; }
            .package-header { margin-bottom: 40px; }
            .package-title { font-size: 32px !important; }
            .package-price { font-size: 36px !important; }
            .website-preview { border-radius: 12px; }
            .website-preview img { height: 250px; }
            .testimonial-box { padding: 24px; }
            .testimonial-box p { font-size: 16px; }
            .footer { padding: 32px 16px; }
            .footer-links { flex-wrap: wrap; justify-content: center; gap: 16px; }

            /* INTAKE WIZARD MOBILE */
            .intake-wizard { padding: 16px; }
            .wizard-content { padding: 28px 20px; border-radius: 16px; }
            .wizard-progress { margin-bottom: 32px; }
            .wizard-step-number { width: 36px; height: 36px; font-size: 13px; }
            .wizard-step-label { font-size: 9px; letter-spacing: 1px; display: none; }
            .wizard-step.active .wizard-step-label { display: block; }
            .wizard-title { font-size: 24px; }
            .wizard-subtitle { font-size: 14px; margin-bottom: 24px; }
            .wizard-input, .wizard-select, .wizard-textarea { padding: 14px 16px; font-size: 15px; }
            .wizard-radio { padding: 14px 16px; }
            .wizard-radio-content h4 { font-size: 15px; }
            .wizard-radio-content p { font-size: 13px; }
            .wizard-buttons { flex-direction: column; }
            .wizard-btn { width: 100%; text-align: center; padding: 16px; }
            .wizard-btn-next, .wizard-btn-submit { margin-left: 0; }
            .file-upload-zone { padding: 32px 20px; }
            .intake-service-header { padding: 40px 20px; }
            .intake-service-name { font-size: 32px; }
            .intake-service-price { font-size: 22px; }
        }

        /* ==================== MULTI-STEP INTAKE WIZARD - NIKE DARK THEME ==================== */
        .intake-wizard { max-width: 800px; margin: 0 auto; padding: 40px; }
        .wizard-progress { display: flex; justify-content: space-between; margin-bottom: 48px; position: relative; }
        .wizard-progress::before { content: ''; position: absolute; top: 20px; left: 0; right: 0; height: 3px; background: rgba(255,255,255,0.15); z-index: 0; border-radius: 2px; }
        .wizard-progress-fill { position: absolute; top: 20px; left: 0; height: 3px; background: linear-gradient(90deg, var(--red), #ff6b6b); z-index: 1; transition: width 0.4s ease; border-radius: 2px; box-shadow: 0 0 20px rgba(255,59,48,0.4); }
        .wizard-step { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 2; }
        .wizard-step-number { width: 44px; height: 44px; border-radius: 50%; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.5); border: 2px solid rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 15px; transition: all 0.3s; backdrop-filter: blur(10px); }
        .wizard-step.active .wizard-step-number { background: var(--red); color: white; border-color: var(--red); transform: scale(1.15); box-shadow: 0 0 30px rgba(255,59,48,0.5); }
        .wizard-step.completed .wizard-step-number { background: var(--green); color: white; border-color: var(--green); }
        .wizard-step-label { margin-top: 12px; font-size: 11px; font-weight: 600; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 2px; }
        .wizard-step.active .wizard-step-label { color: #fff; }
        .wizard-step.completed .wizard-step-label { color: var(--green); }
        .wizard-content { background: linear-gradient(145deg, #1a1a1a 0%, #0d0d0d 100%); border-radius: 20px; padding: 56px; box-shadow: 0 25px 80px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); }
        .wizard-panel { display: none; animation: fadeIn 0.4s ease; }
        .wizard-panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .wizard-title { font-size: 32px; font-weight: 800; color: #fff; margin-bottom: 12px; letter-spacing: -0.5px; }
        .wizard-subtitle { font-size: 16px; color: rgba(255,255,255,0.6); margin-bottom: 40px; line-height: 1.6; }
        .wizard-field { margin-bottom: 28px; }
        .wizard-label { display: block; font-size: 13px; font-weight: 700; color: rgba(255,255,255,0.9); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1.5px; }
        .wizard-input { width: 100%; padding: 18px 20px; border: 2px solid rgba(255,255,255,0.15); border-radius: 12px; font-size: 16px; transition: all 0.3s; background: rgba(255,255,255,0.05); color: #fff; backdrop-filter: blur(10px); }
        .wizard-input::placeholder { color: rgba(255,255,255,0.35); }
        .wizard-input:focus { outline: none; border-color: var(--red); background: rgba(255,255,255,0.08); box-shadow: 0 0 30px rgba(255,59,48,0.15); }
        .wizard-select { width: 100%; padding: 18px 20px; border: 2px solid rgba(255,255,255,0.15); border-radius: 12px; font-size: 16px; background: rgba(255,255,255,0.05); color: #fff; cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 16px center; }
        .wizard-select option { background: #1a1a1a; color: #fff; }
        .wizard-textarea { width: 100%; padding: 18px 20px; border: 2px solid rgba(255,255,255,0.15); border-radius: 12px; font-size: 16px; resize: vertical; min-height: 140px; background: rgba(255,255,255,0.05); color: #fff; }
        .wizard-textarea::placeholder { color: rgba(255,255,255,0.35); }
        .wizard-textarea:focus { outline: none; border-color: var(--red); background: rgba(255,255,255,0.08); }
        .wizard-radio-group { display: flex; flex-direction: column; gap: 14px; }
        .wizard-radio { display: flex; align-items: center; padding: 20px 24px; border: 2px solid rgba(255,255,255,0.12); border-radius: 14px; cursor: pointer; transition: all 0.3s; background: rgba(255,255,255,0.03); }
        .wizard-radio:hover { border-color: rgba(255,255,255,0.25); background: rgba(255,255,255,0.06); transform: translateX(4px); }
        .wizard-radio.selected { border-color: var(--red); background: rgba(255,59,48,0.1); box-shadow: 0 0 30px rgba(255,59,48,0.15); }
        .wizard-radio input { display: none; }
        .wizard-radio-check { width: 26px; height: 26px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; margin-right: 18px; display: flex; align-items: center; justify-content: center; transition: all 0.3s; flex-shrink: 0; }
        .wizard-radio.selected .wizard-radio-check { border-color: var(--red); background: var(--red); box-shadow: 0 0 15px rgba(255,59,48,0.4); }
        .wizard-radio.selected .wizard-radio-check::after { content: 'âœ“'; color: white; font-size: 14px; font-weight: 700; }
        .wizard-radio-content h4 { font-size: 17px; font-weight: 700; color: #fff; margin-bottom: 6px; }
        .wizard-radio-content p { font-size: 14px; color: rgba(255,255,255,0.5); line-height: 1.5; }

        /* FILE UPLOAD - DARK THEME */
        .file-upload-zone { border: 2px dashed rgba(255,255,255,0.2); border-radius: 16px; padding: 56px; text-align: center; cursor: pointer; transition: all 0.3s; background: rgba(255,255,255,0.03); }
        .file-upload-zone:hover, .file-upload-zone.dragover { border-color: var(--red); background: rgba(255,59,48,0.08); }
        .file-upload-icon { font-size: 52px; margin-bottom: 20px; filter: grayscale(0); }
        .file-upload-text { font-size: 17px; color: #fff; margin-bottom: 10px; font-weight: 600; }
        .file-upload-hint { font-size: 14px; color: rgba(255,255,255,0.4); }
        .file-upload-input { display: none; }
        .uploaded-files { margin-top: 20px; display: flex; flex-wrap: wrap; gap: 12px; }
        .uploaded-file { display: flex; align-items: center; gap: 10px; padding: 12px 18px; background: rgba(255,255,255,0.1); border-radius: 10px; font-size: 14px; color: #fff; border: 1px solid rgba(255,255,255,0.15); }
        .uploaded-file-remove { color: var(--red); cursor: pointer; font-weight: 700; font-size: 18px; }

        /* WIZARD BUTTONS - DARK THEME */
        .wizard-buttons { display: flex; gap: 16px; margin-top: 40px; padding-top: 32px; border-top: 1px solid rgba(255,255,255,0.1); }
        .wizard-btn { padding: 18px 36px; border-radius: 12px; font-size: 15px; font-weight: 700; cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 1px; }
        .wizard-btn-back { background: transparent; border: 2px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.7); }
        .wizard-btn-back:hover { border-color: #fff; color: #fff; background: rgba(255,255,255,0.05); }
        .wizard-btn-next { background: linear-gradient(135deg, var(--red) 0%, #ff6b6b 100%); border: none; color: white; margin-left: auto; box-shadow: 0 8px 30px rgba(255,59,48,0.35); }
        .wizard-btn-next:hover { transform: translateY(-2px) translateX(4px); box-shadow: 0 12px 40px rgba(255,59,48,0.5); }
        .wizard-btn-submit { background: linear-gradient(135deg, var(--green) 0%, #34d399 100%); border: none; color: white; margin-left: auto; box-shadow: 0 8px 30px rgba(16,185,129,0.35); }
        .wizard-btn-submit:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(16,185,129,0.5); }

        /* SALES COPY STYLING */
        .wizard-sales-copy { background: linear-gradient(135deg, rgba(255,59,48,0.1) 0%, rgba(255,59,48,0.05) 100%); border-radius: 16px; padding: 28px; margin-bottom: 36px; border-left: 4px solid var(--red); }
        .wizard-sales-copy .hook { font-size: 20px; font-weight: 800; color: #fff; margin-bottom: 16px; line-height: 1.4; }
        .wizard-sales-copy .problem { font-size: 15px; color: rgba(255,255,255,0.7); margin-bottom: 12px; line-height: 1.6; }
        .wizard-sales-copy .solution { font-size: 15px; color: rgba(255,255,255,0.85); margin-bottom: 12px; line-height: 1.6; }
        .wizard-sales-copy .proof { font-size: 14px; color: var(--green); font-weight: 600; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1); }

        /* ==================== ENHANCED BRAND PORTAL ==================== */
        .brand-portal-header { padding: 60px; background: linear-gradient(135deg, var(--client-primary, #000) 0%, var(--client-secondary, #333) 100%); color: white; text-align: center; }
        .brand-portal-logo { max-height: 80px; margin-bottom: 24px; }
        .brand-portal-title { font-size: 36px; font-weight: 800; margin-bottom: 8px; }
        .brand-portal-subtitle { font-size: 16px; opacity: 0.8; }
        .brand-section { padding: 60px; border-bottom: 1px solid #e5e5e5; }
        .brand-section:nth-child(even) { background: #fafafa; }
        .brand-section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; }
        .brand-section-title { font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 12px; }
        .brand-section-title::before { content: ''; width: 4px; height: 24px; background: var(--client-primary, var(--red)); border-radius: 2px; }
        .brand-download-all { padding: 12px 24px; background: #000; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .brand-download-all:hover { background: #333; }

        /* LOGO SECTION */
        .logo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 24px; }
        .logo-card { background: white; border: 1px solid #e5e5e5; border-radius: 12px; overflow: hidden; transition: all 0.3s; }
        .logo-card:hover { box-shadow: 0 8px 32px rgba(0,0,0,0.1); transform: translateY(-4px); }
        .logo-preview { height: 160px; display: flex; align-items: center; justify-content: center; padding: 24px; }
        .logo-preview.dark-bg { background: #1a1a1a; }
        .logo-preview.light-bg { background: #f5f5f5; }
        .logo-preview.color-bg { background: var(--client-primary, var(--red)); }
        .logo-preview img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .logo-info { padding: 16px; border-top: 1px solid #e5e5e5; display: flex; justify-content: space-between; align-items: center; }
        .logo-name { font-size: 14px; font-weight: 600; }
        .logo-format { font-size: 12px; color: #888; }
        .logo-download { padding: 8px 16px; background: var(--client-primary, var(--red)); color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; }

        /* COLOR PALETTE */
        .color-palette { display: flex; gap: 0; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 16px rgba(0,0,0,0.1); }
        .color-swatch { flex: 1; min-height: 180px; display: flex; flex-direction: column; justify-content: flex-end; padding: 20px; cursor: pointer; transition: transform 0.2s; position: relative; }
        .color-swatch:hover { transform: scale(1.02); z-index: 1; }
        .color-info { background: rgba(255,255,255,0.95); padding: 12px; border-radius: 8px; }
        .color-name { font-size: 14px; font-weight: 600; color: #000; margin-bottom: 4px; }
        .color-hex { font-size: 13px; color: #666; font-family: monospace; }
        .color-copy { position: absolute; top: 16px; right: 16px; background: rgba(255,255,255,0.9); border: none; padding: 8px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; opacity: 0; transition: opacity 0.2s; }
        .color-swatch:hover .color-copy { opacity: 1; }

        /* TYPOGRAPHY */
        .typography-showcase { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; }
        .typography-card { background: white; border: 1px solid #e5e5e5; border-radius: 12px; padding: 32px; }
        .typography-label { font-size: 12px; font-weight: 600; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px; }
        .typography-preview { margin-bottom: 24px; }
        .typography-preview h2 { font-size: 48px; font-weight: 800; color: #000; line-height: 1.1; }
        .typography-preview p { font-size: 18px; color: #666; line-height: 1.6; }
        .typography-specimen { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .typography-specimen span { background: #f5f5f5; padding: 8px 12px; border-radius: 4px; font-size: 14px; }
        .typography-download { display: flex; align-items: center; gap: 12px; padding: 16px; background: #f5f5f5; border-radius: 8px; }
        .typography-download-btn { padding: 8px 16px; background: #000; color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; }

        /* BRAND ELEMENTS */
        .elements-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .element-card { background: white; border: 1px solid #e5e5e5; border-radius: 12px; overflow: hidden; transition: all 0.3s; }
        .element-card:hover { box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
        .element-preview { height: 140px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .element-preview img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .element-info { padding: 16px; }
        .element-name { font-size: 14px; font-weight: 600; margin-bottom: 8px; }
        .element-actions { display: flex; gap: 8px; }
        .element-btn { flex: 1; padding: 8px; border: 1px solid #e5e5e5; background: white; border-radius: 6px; font-size: 12px; cursor: pointer; }
        .element-btn:hover { background: #f5f5f5; }

        /* MOCKUPS */
        .mockups-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 24px; }
        .mockup-card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 16px rgba(0,0,0,0.08); transition: all 0.3s; }
        .mockup-card:hover { box-shadow: 0 12px 40px rgba(0,0,0,0.15); transform: translateY(-8px); }
        .mockup-image { width: 100%; height: 240px; object-fit: cover; }
        .mockup-info { padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .mockup-name { font-size: 16px; font-weight: 600; }
        .mockup-download { padding: 10px 20px; background: var(--client-primary, var(--red)); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }

        /* INTAKE VIEW - NIKE DARK THEME */
        .intake-view { background: linear-gradient(180deg, #0a0a0a 0%, #111 50%, #0d0d0d 100%); min-height: 100vh; padding-top: 100px; }
        .intake-service-header { text-align: center; padding: 60px 40px; margin-bottom: 20px; }
        .intake-service-badge { display: inline-block; padding: 10px 24px; background: linear-gradient(135deg, var(--red) 0%, #ff6b6b 100%); color: white; border-radius: 25px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; box-shadow: 0 8px 30px rgba(255,59,48,0.3); }
        .intake-service-name { font-size: 48px; font-weight: 900; color: #fff; margin-bottom: 12px; letter-spacing: -1px; text-shadow: 0 4px 30px rgba(0,0,0,0.3); }
        .intake-service-price { font-size: 28px; color: var(--red); font-weight: 800; text-shadow: 0 0 40px rgba(255,59,48,0.3); }

        /* SUCCESS SCREEN - NIKE DARK THEME */
        .success-screen { text-align: center; padding: 80px 40px; }
        .success-icon { font-size: 90px; margin-bottom: 28px; filter: drop-shadow(0 0 40px rgba(16,185,129,0.4)); }
        .success-title { font-size: 40px; font-weight: 900; color: #fff; margin-bottom: 20px; letter-spacing: -0.5px; }
        .success-message { font-size: 18px; color: rgba(255,255,255,0.7); max-width: 520px; margin: 0 auto 40px; line-height: 1.7; }
        .success-details { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 28px; max-width: 420px; margin: 0 auto 40px; text-align: left; backdrop-filter: blur(10px); }
        .success-detail { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.08); }
        .success-detail:last-child { border: none; }
        .success-detail-label { color: rgba(255,255,255,0.5); font-size: 14px; }
        .success-detail-value { font-weight: 700; color: #fff; font-size: 14px; }
    </style>
</head>
<body>
    <nav class="nav">
        <a class="logo" onclick="showView('home')"><img src="NUI.avif" alt="New Urban Influence"></a>
        <div class="nav-links">
            <a onclick="showView('home')" class="active" data-view="home">Home</a>
            <a onclick="showView('about')" data-view="about">About</a>
            <a onclick="showView('services')" data-view="services">Services</a>
            <a onclick="showView('portfolio')" data-view="portfolio">Portfolio</a>
            <a onclick="showView('blog')" data-view="blog">Blog</a>
            <a onclick="showView('portal')" data-view="portal">Client Portal</a>
        </div>
        <a onclick="scrollToContact()" class="btn-cta btn-cta-desktop">Book a Strategy Call</a>
        <div class="hamburger" onclick="toggleMobileMenu()">
            <span></span><span></span><span></span>
        </div>
    </nav>
    <div class="mobile-menu" id="mobileMenu">
        <a onclick="showView('home'); toggleMobileMenu()">Home</a>
        <a onclick="showView('about'); toggleMobileMenu()">About</a>
        <a onclick="showView('services'); toggleMobileMenu()">Services</a>
        <a onclick="showView('portfolio'); toggleMobileMenu()">Portfolio</a>
        <a onclick="showView('blog'); toggleMobileMenu()">Blog</a>
        <a onclick="showView('portal'); toggleMobileMenu()">Client Portal</a>
        <a onclick="scrollToContact(); toggleMobileMenu()" class="btn-cta" style="margin-top: 24px;">Book a Strategy Call</a>
    </div>

    <div class="view active" id="homeView"></div>
    <div class="view" id="aboutView"></div>
    <div class="view" id="servicesView"></div>
    <div class="view" id="portfolioView"></div>
    <div class="view" id="intakeView"></div>
    <div class="view" id="blogView"></div>
    <div class="view" id="portalView"></div>

<script>
window.onerror = function(m,u,l,c,e){alert('JS Error at line '+l+': '+m);return false;};
console.log('Script loading...');
// ==================== STATE ====================
let currentUser = null;
let loginType = 'client';
let currentAdminClient = null;
let assetCategory = 'logos';

// Clear any old corrupted data and ensure demo client exists
let storedClients = [];
try {
    storedClients = JSON.parse(localStorage.getItem('nui_clients')) || [];
} catch(e) { storedClients = []; }

let clients = storedClients.length > 0 ? storedClients : [{
    id: 1, name: 'Demo Brand', email: 'client@test.com', password: 'client123',
    industry: 'Technology', website: 'https://demobrand.com',
    colors: ['#ff0000', '#000000', '#ffffff'],
    fonts: { heading: 'Inter', body: 'Inter' },
    assets: { logos: [], mockups: [], social: [], video: [], banner: [], fonts: [], patterns: [], package: [] }
}];
// Ensure at least demo client exists
if (!clients.find(c => c.email === 'client@test.com')) {
    clients.push({ id: 1, name: 'Demo Brand', email: 'client@test.com', password: 'client123', industry: 'Technology', website: 'https://demobrand.com', colors: ['#ff0000', '#000000', '#ffffff'], fonts: { heading: 'Inter', body: 'Inter' }, assets: { logos: [], mockups: [], social: [], video: [], banner: [], fonts: [], patterns: [], package: [] } });
}
localStorage.setItem('nui_clients', JSON.stringify(clients));

let orders = JSON.parse(localStorage.getItem('nui_orders')) || [{
    id: 1, clientId: 1, projectName: 'Brand Identity Package', description: 'Complete brand refresh including logo, colors, and guidelines',
    estimate: 2500, status: 'in_progress', turnaround: '14 days',
    createdAt: new Date(Date.now() - 7*24*60*60*1000).toISOString(),
    dueDate: new Date(Date.now() + 7*24*60*60*1000).toISOString(),
    deliveredAt: null, deliverables: []
}];

let leads = JSON.parse(localStorage.getItem('nui_leads')) || [
    { id: 1, name: 'John Smith', email: 'john@example.com', phone: '313-555-0123', business: 'Smith Co', service: 'Brand Identity Package', budget: '$3000-5000', message: 'Looking to rebrand my business', status: 'new', createdAt: new Date().toISOString() }
];

function saveClients() { localStorage.setItem('nui_clients', JSON.stringify(clients)); }
function saveOrders() { localStorage.setItem('nui_orders', JSON.stringify(orders)); }
function saveLeads() { localStorage.setItem('nui_leads', JSON.stringify(leads)); }

// ==================== NEW SYSTEMS DATA ====================
// SEO/AEO/GEO Management
let seoData = JSON.parse(localStorage.getItem('nui_seo')) || {
    siteMeta: {
        title: 'New Urban Influence | Detroit\'s Premier Digital Agency',
        description: 'Detroit-based creative agency specializing in brand identity, web design, and digital marketing. Transform your business with bold, strategic branding.',
        keywords: 'branding agency detroit, logo design, web design, digital marketing, brand identity, graphic design, detroit creative agency',
        ogImage: '',
        twitterHandle: '@newurbaninfluence',
        canonicalUrl: 'https://newurbaninfluence.com'
    },
    localSeo: {
        businessName: 'New Urban Influence',
        address: '123 Woodward Ave, Detroit, MI 48226',
        phone: '(313) 555-0100',
        email: 'hello@newurbaninfluence.com',
        hours: 'Mon-Fri: 9AM-6PM',
        serviceAreas: ['Detroit', 'Ann Arbor', 'Troy', 'Southfield', 'Royal Oak', 'Dearborn'],
        categories: ['Branding Agency', 'Graphic Design', 'Web Design', 'Marketing Agency']
    },
    googleMyBusiness: {
        connected: false,
        placeId: '',
        reviewLink: '',
        mapEmbed: ''
    },
    schema: {
        type: 'LocalBusiness',
        priceRange: '$$',
        rating: '5.0',
        reviewCount: '47'
    },
    aeoContent: {
        faqs: [
            { question: 'How much does branding cost?', answer: 'Our branding packages start at $1,500 for a basic brand kit and range up to $6,000+ for comprehensive brand identity systems.' },
            { question: 'How long does a branding project take?', answer: 'Most branding projects take 2-4 weeks depending on complexity. Rush delivery is available for an additional fee.' },
            { question: 'Do you work with small businesses?', answer: 'Yes! We specialize in helping small businesses and startups build professional brand identities that compete with larger companies.' }
        ],
        snippets: []
    }
};
function saveSeo() { localStorage.setItem('nui_seo', JSON.stringify(seoData)); }

// Projects/Tracker System
let projects = JSON.parse(localStorage.getItem('nui_projects')) || [];
function saveProjects() { localStorage.setItem('nui_projects', JSON.stringify(projects)); }

// ==================== PAYMENTS & INVOICES ====================
let payments = JSON.parse(localStorage.getItem('nui_payments')) || [];
let invoices = JSON.parse(localStorage.getItem('nui_invoices')) || [];
function savePayments() { localStorage.setItem('nui_payments', JSON.stringify(payments)); }
function saveInvoices() { localStorage.setItem('nui_invoices', JSON.stringify(invoices)); }

// Service Packages with Pricing
const servicePackages = [
    { id: 'brand-kit', name: 'Brand Kit', price: 1500, category: 'Branding', turnaround: '7-10 days', desc: 'Logo, colors, basic guidelines' },
    { id: 'product-brand', name: 'Product Brand Identity', price: 3500, category: 'Branding', turnaround: '14-21 days', desc: 'Full branding for product businesses' },
    { id: 'service-brand', name: 'Service Brand Identity', price: 3000, category: 'Branding', turnaround: '10-14 days', desc: 'Full branding for service businesses' },
    { id: 'landing-page', name: 'Landing Page', price: 800, category: 'Web', turnaround: '5-7 days', desc: 'Single page conversion-focused site' },
    { id: 'business-website', name: 'Business Website', price: 2500, category: 'Web', turnaround: '14-21 days', desc: '5-page professional website' },
    { id: 'ecommerce', name: 'E-Commerce Website', price: 4500, category: 'Web', turnaround: '21-30 days', desc: 'Full online store' },
    { id: 'web-app', name: 'Custom Web App', price: 7500, category: 'Web', turnaround: '30-45 days', desc: 'Custom web application' },
    { id: 'mobile-app', name: 'Mobile App', price: 12000, category: 'Mobile', turnaround: '45-60 days', desc: 'iOS/Android mobile application' },
    { id: 'lead-funnel', name: 'Lead Funnel', price: 1200, category: 'Funnels', turnaround: '7-10 days', desc: 'Lead generation funnel' },
    { id: 'sales-funnel', name: 'Sales Funnel', price: 2500, category: 'Funnels', turnaround: '14-21 days', desc: 'Complete sales funnel system' }
];

// Individual Services with Pricing
const individualServices = [
    { id: 'logo-design', name: 'Logo Design', price: 500, category: 'Design' },
    { id: 'logo-variations', name: 'Logo Variations', price: 200, category: 'Design' },
    { id: 'brand-colors', name: 'Brand Color Palette', price: 150, category: 'Design' },
    { id: 'typography', name: 'Typography Selection', price: 100, category: 'Design' },
    { id: 'brand-guidelines', name: 'Brand Guidelines Doc', price: 400, category: 'Design' },
    { id: 'business-card', name: 'Business Card Design', price: 150, category: 'Print' },
    { id: 'letterhead', name: 'Letterhead Design', price: 100, category: 'Print' },
    { id: 'social-templates', name: 'Social Media Templates', price: 300, category: 'Social' },
    { id: 'social-banners', name: 'Social Media Banners', price: 200, category: 'Social' },
    { id: 'email-signature', name: 'Email Signature', price: 75, category: 'Digital' },
    { id: 'favicon', name: 'Favicon/App Icon', price: 50, category: 'Digital' },
    { id: 'presentation', name: 'Presentation Template', price: 350, category: 'Digital' },
    { id: 'vehicle-wrap', name: 'Vehicle Wrap Design', price: 800, category: 'Print' },
    { id: 'signage', name: 'Signage Design', price: 400, category: 'Print' },
    { id: 'packaging', name: 'Packaging Design', price: 600, category: 'Product' },
    { id: 'label-design', name: 'Label Design', price: 300, category: 'Product' }
];

// Payment Plan Options
const paymentPlans = {
    full: { name: 'Pay in Full', discount: 5, installments: 1, schedule: [100] },
    standard: { name: 'Standard (50/25/25)', discount: 0, installments: 3, schedule: [50, 25, 25], triggers: ['deposit', 'approval', 'delivery'] },
    monthly: { name: 'Monthly (3 payments)', discount: 0, installments: 3, schedule: [34, 33, 33], triggers: ['deposit', '30days', '60days'] }
};

// Proof/Revision System
let proofs = JSON.parse(localStorage.getItem('nui_proofs')) || [];

function saveProofs() {
    try {
        localStorage.setItem('nui_proofs', JSON.stringify(proofs));
    } catch (e) {
        if (e.name === 'QuotaExceededError') {
            console.warn('Storage quota exceeded. Attempting cleanup...');
            cleanupProofStorage();
            try {
                localStorage.setItem('nui_proofs', JSON.stringify(proofs));
            } catch (e2) {
                alert('Storage full! Some proof images may not be saved. Consider exporting and clearing old proofs.');
            }
        }
    }
}

// Cleanup old/large proof data to free storage
function cleanupProofStorage() {
    // Remove image data from old approved proofs (keep metadata only)
    const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
    proofs.forEach(p => {
        if (p.status === 'approved' && new Date(p.approvedAt).getTime() < thirtyDaysAgo) {
            p.image = p.image ? '[archived]' : null;
            p.videoUrl = p.videoUrl ? '[archived]' : null;
        }
    });
    // Also try clearing other caches
    try { localStorage.removeItem('nui_proof_cache'); } catch(e) {}
}

// Compress image before storage
function compressImage(dataUrl, maxWidth = 800, quality = 0.7) {
    return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;

            // Scale down if too large
            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }

            canvas.width = width;
            canvas.height = height;

            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);

            // Compress to JPEG
            const compressed = canvas.toDataURL('image/jpeg', quality);
            resolve(compressed);
        };
        img.onerror = () => resolve(dataUrl); // Return original if error
        img.src = dataUrl;
    });
}

// Get storage usage info
function getStorageUsage() {
    let total = 0;
    for (let key in localStorage) {
        if (localStorage.hasOwnProperty(key)) {
            total += localStorage[key].length * 2; // UTF-16 = 2 bytes per char
        }
    }
    return {
        used: (total / 1024 / 1024).toFixed(2) + ' MB',
        usedBytes: total,
        limit: '~5 MB'
    };
}

// CRM System
let crmData = JSON.parse(localStorage.getItem('nui_crm')) || {
    clients: [],
    contacts: [],
    communications: [],
    tasks: [],
    pipelines: [
        { id: 1, name: 'Lead', color: '#3b82f6' },
        { id: 2, name: 'Qualified', color: '#8b5cf6' },
        { id: 3, name: 'Proposal Sent', color: '#f59e0b' },
        { id: 4, name: 'Negotiation', color: '#ef4444' },
        { id: 5, name: 'Won', color: '#10b981' },
        { id: 6, name: 'Lost', color: '#6b7280' }
    ]
};
function saveCrm() { localStorage.setItem('nui_crm', JSON.stringify(crmData)); }

// Designer System
let designers = JSON.parse(localStorage.getItem('nui_designers')) || [];
// Ensure default designer exists
if (!designers.find(d => d.email === 'faren@nui.com')) {
    designers.push({ id: 1, name: 'Faren Young', email: 'faren@nui.com', password: 'designer123', role: 'Lead Designer', avatar: '', permissions: ['projects', 'proofs', 'assets'] });
}
localStorage.setItem('nui_designers', JSON.stringify(designers));
function saveDesigners() { localStorage.setItem('nui_designers', JSON.stringify(designers)); }

// ==================== LOYALTY PROGRAM SYSTEM ====================
let loyaltyProgram = JSON.parse(localStorage.getItem('nui_loyalty')) || {
    enabled: true,
    pointsPerDollar: 1,
    rewardTiers: [
        { name: 'Bronze', minPoints: 0, discount: 5, perks: ['Priority support'] },
        { name: 'Silver', minPoints: 500, discount: 10, perks: ['Priority support', 'Free revisions'] },
        { name: 'Gold', minPoints: 1500, discount: 15, perks: ['Priority support', 'Free revisions', 'Rush delivery'] },
        { name: 'Platinum', minPoints: 5000, discount: 20, perks: ['All perks', 'Dedicated account manager', 'Exclusive pricing'] }
    ],
    members: []
};
function saveLoyalty() { localStorage.setItem('nui_loyalty', JSON.stringify(loyaltyProgram)); }

// ==================== EMAIL MARKETING SYSTEM ====================
let emailMarketing = JSON.parse(localStorage.getItem('nui_email_marketing')) || {
    settings: {
        senderName: 'New Urban Influence',
        senderEmail: 'hello@newurbaninfluence.com',
        replyTo: 'hello@newurbaninfluence.com',
        automatedSending: true,
        sendDay: 'monday',
        sendTime: '09:00'
    },
    templates: [
        { id: 1, name: 'Weekly Newsletter', subject: 'Your Weekly Design Inspiration', type: 'newsletter', content: '' },
        { id: 2, name: 'Promotion', subject: 'Special Offer Inside!', type: 'promo', content: '' },
        { id: 3, name: 'New Service Announcement', subject: 'Introducing Our New Service', type: 'announcement', content: '' }
    ],
    campaigns: [],
    subscribers: [],
    analytics: { sent: 0, opened: 0, clicked: 0, unsubscribed: 0 }
};
function saveEmailMarketing() { localStorage.setItem('nui_email_marketing', JSON.stringify(emailMarketing)); }

// ==================== SOCIAL MEDIA DM SYSTEM ====================
let socialMediaDM = JSON.parse(localStorage.getItem('nui_social_dm')) || {
    connected: {
        facebook: { connected: false, pageId: '', accessToken: '', pageName: '' },
        instagram: { connected: false, accountId: '', accessToken: '', username: '' },
        twitter: { connected: false, accountId: '', accessToken: '', username: '' }
    },
    conversations: [],
    autoResponses: [
        { id: 1, trigger: 'pricing', platform: 'all', message: 'Thanks for your interest! Our branding packages start at $1,500. Would you like to schedule a free consultation to discuss your needs?' },
        { id: 2, trigger: 'hello', platform: 'all', message: 'Hey there! Thanks for reaching out to New Urban Influence. How can we help you today?' },
        { id: 3, trigger: 'hours', platform: 'all', message: 'We are open Monday-Friday, 9AM-6PM EST. Feel free to leave a message and we will get back to you!' }
    ],
    settings: {
        autoReplyEnabled: true,
        autoReplyDelay: 5,
        notifyOnNewMessage: true
    }
};
function saveSocialDM() { localStorage.setItem('nui_social_dm', JSON.stringify(socialMediaDM)); }

// ==================== SMS / OPENPHONE SYSTEM ====================
let smsSystem = JSON.parse(localStorage.getItem('nui_sms')) || {
    openPhone: {
        connected: false,
        apiKey: '',
        phoneNumber: '',
        userId: ''
    },
    conversations: [],
    templates: [
        { id: 1, name: 'Appointment Reminder', message: 'Hi {name}! This is a reminder about your consultation with New Urban Influence tomorrow at {time}. Reply to confirm!' },
        { id: 2, name: 'Project Update', message: 'Hi {name}! Your project is ready for review. Check your email for the proof link or reply with any questions!' },
        { id: 3, name: 'Payment Reminder', message: 'Hi {name}! Friendly reminder that your invoice #{invoice} is due soon. Questions? Reply to this text!' }
    ],
    autoResponses: [
        { trigger: 'stop', response: 'You have been unsubscribed. Reply START to resubscribe.' },
        { trigger: 'help', response: 'For support, visit newurbaninfluence.com or call us at your convenience!' }
    ],
    settings: {
        autoReplyEnabled: true,
        businessHoursOnly: true,
        businessHours: { start: '09:00', end: '18:00' }
    }
};
function saveSms() { localStorage.setItem('nui_sms', JSON.stringify(smsSystem)); }

// ==================== UNIFIED COMMUNICATIONS HUB ====================
let communicationsHub = JSON.parse(localStorage.getItem('nui_comm_hub')) || {
    inbox: [],
    filters: { unread: false, platform: 'all', client: '' },
    settings: { unifiedView: true, notifications: true }
};
function saveCommHub() { localStorage.setItem('nui_comm_hub', JSON.stringify(communicationsHub)); }

// Reset all data function (call from console if needed: resetAllData())
function resetAllData() {
    if (confirm('This will reset ALL data to defaults. Are you sure?')) {
        localStorage.removeItem('nui_clients');
        localStorage.removeItem('nui_orders');
        localStorage.removeItem('nui_designers');
        localStorage.removeItem('nui_leads');
        localStorage.removeItem('nui_projects');
        localStorage.removeItem('nui_payments');
        localStorage.removeItem('nui_invoices');
        localStorage.removeItem('nui_proofs');
        localStorage.removeItem('nui_analytics');
        localStorage.removeItem('nui_reviews');
        localStorage.removeItem('nui_payouts');
        localStorage.removeItem('nui_stripe');
        localStorage.removeItem('nui_loyalty');
        localStorage.removeItem('nui_email_marketing');
        localStorage.removeItem('nui_social_dm');
        localStorage.removeItem('nui_sms');
        localStorage.removeItem('nui_comm_hub');
        localStorage.removeItem('nui_crm');
        alert('Data reset! Refreshing page...');
        location.reload();
    }
}

// ==================== COMPREHENSIVE DEMO DATA INITIALIZATION ====================
function initializeDemoData() {
    const now = new Date();
    const dayMs = 24 * 60 * 60 * 1000;

    // ===== DEMO CLIENTS =====
    const demoClients = [
        {
            id: 1, name: 'Detroit Coffee Co.', email: 'hello@detroitcoffee.com', password: 'client123',
            phone: '313-555-0101', contact: 'Marcus Johnson', industry: 'Food & Beverage',
            website: 'https://detroitcoffee.com', status: 'active',
            colors: ['#8B4513', '#D2691E', '#F5DEB3', '#2F1810'],
            fonts: { heading: 'Playfair Display', body: 'Lato' },
            slogan: 'Brewed with Detroit Grit',
            mission: 'Bringing premium, locally-roasted coffee to the heart of Detroit while supporting local communities.',
            assets: { logos: [], mockups: [], social: [], video: [], banner: [], fonts: [], patterns: [], package: [] },
            brandGuide: { status: 'approved', proofComments: [{ type: 'Approved', comment: 'Love the branding!', date: new Date(now - 3*dayMs).toISOString() }], approvedAt: new Date(now - 3*dayMs).toISOString() },
            results: { revenue: '+65%', traffic: '+180%', engagement: '+95%' },
            testimonial: { text: 'NUI completely transformed our brand. Our sales are up and customers love the new look!', author: 'Marcus Johnson', title: 'Owner' },
            createdAt: new Date(now - 60*dayMs).toISOString()
        },
        {
            id: 2, name: 'TechFlow Solutions', email: 'info@techflow.io', password: 'client123',
            phone: '313-555-0202', contact: 'Sarah Chen', industry: 'Technology',
            website: 'https://techflow.io', status: 'active',
            colors: ['#6366F1', '#8B5CF6', '#EC4899', '#1E1B4B'],
            fonts: { heading: 'Space Grotesk', body: 'Inter' },
            slogan: 'Flow Forward',
            mission: 'Empowering businesses with cutting-edge software solutions that drive growth.',
            assets: { logos: [], mockups: [], social: [], video: [], banner: [], fonts: [], patterns: [], package: [] },
            brandGuide: { status: 'pending', proofComments: [], approvedAt: null },
            results: { revenue: '+120%', traffic: '+250%', engagement: '+150%' },
            testimonial: { text: 'The team at NUI understood our vision perfectly. Our rebrand has positioned us as an industry leader.', author: 'Sarah Chen', title: 'CEO' },
            createdAt: new Date(now - 45*dayMs).toISOString()
        },
        {
            id: 3, name: 'Urban Fitness Club', email: 'contact@urbanfitness.com', password: 'client123',
            phone: '313-555-0303', contact: 'Dwayne Mitchell', industry: 'Health & Fitness',
            website: 'https://urbanfitnessclub.com', status: 'active',
            colors: ['#EF4444', '#F97316', '#FBBF24', '#1F2937'],
            fonts: { heading: 'Bebas Neue', body: 'Roboto' },
            slogan: 'Unleash Your Potential',
            mission: 'Making fitness accessible to everyone in our community through affordable memberships and expert training.',
            assets: { logos: [], mockups: [], social: [], video: [], banner: [], fonts: [], patterns: [], package: [] },
            brandGuide: { status: 'revision_requested', proofComments: [{ type: 'Revision Requested', comment: 'Can we make the red a bit more vibrant?', date: new Date(now - 2*dayMs).toISOString() }], approvedAt: null },
            results: { revenue: '+45%', traffic: '+90%', engagement: '+200%' },
            testimonial: { text: 'Our membership signups doubled after the rebrand. NUI delivered exactly what we needed!', author: 'Dwayne Mitchell', title: 'Founder' },
            createdAt: new Date(now - 30*dayMs).toISOString()
        },
        {
            id: 4, name: 'Luxe Hair Studio', email: 'book@luxehairstudio.com', password: 'client123',
            phone: '313-555-0404', contact: 'Jasmine Williams', industry: 'Beauty & Wellness',
            website: 'https://luxehairstudio.com', status: 'active',
            colors: ['#D4AF37', '#1C1C1C', '#F5F5F5', '#8B6914'],
            fonts: { heading: 'Cormorant Garamond', body: 'Montserrat' },
            slogan: 'Where Style Meets Soul',
            mission: 'Creating personalized hair experiences that celebrate individuality and beauty in every client.',
            assets: { logos: [], mockups: [], social: [], video: [], banner: [], fonts: [], patterns: [], package: [] },
            brandGuide: { status: 'draft', proofComments: [], approvedAt: null },
            results: { revenue: '+85%', traffic: '+140%', engagement: '+175%' },
            testimonial: { text: 'The branding elevated our entire salon experience. Clients constantly compliment our new look!', author: 'Jasmine Williams', title: 'Owner' },
            createdAt: new Date(now - 15*dayMs).toISOString()
        },
        {
            id: 5, name: 'Motor City Logistics', email: 'operations@mclogistics.com', password: 'client123',
            phone: '313-555-0505', contact: 'Robert Taylor', industry: 'Transportation & Logistics',
            website: 'https://motorcitylogistics.com', status: 'active',
            colors: ['#059669', '#0D9488', '#64748B', '#0F172A'],
            fonts: { heading: 'Oswald', body: 'Source Sans Pro' },
            slogan: 'Detroit Speed, Nationwide Reach',
            mission: 'Providing reliable, efficient logistics solutions with the dedication Detroit is known for.',
            assets: { logos: [], mockups: [], social: [], video: [], banner: [], fonts: [], patterns: [], package: [] },
            brandGuide: { status: 'approved', proofComments: [{ type: 'Approved', comment: 'Perfect for our fleet branding!', date: new Date(now - 10*dayMs).toISOString() }], approvedAt: new Date(now - 10*dayMs).toISOString() },
            results: { revenue: '+55%', traffic: '+95%', engagement: '+80%' },
            testimonial: { text: 'Our trucks look incredible and clients take us more seriously. Great investment!', author: 'Robert Taylor', title: 'Operations Manager' },
            createdAt: new Date(now - 90*dayMs).toISOString()
        }
    ];

    // ===== DEMO ORDERS =====
    const demoOrders = [
        { id: 1, clientId: 1, projectName: 'Brand Identity Package', description: 'Complete brand refresh including logo, colors, typography, and brand guidelines', estimate: 3500, status: 'delivered', turnaround: '14 days', createdAt: new Date(now - 60*dayMs).toISOString(), dueDate: new Date(now - 46*dayMs).toISOString(), deliveredAt: new Date(now - 45*dayMs).toISOString(), assignedDesigner: 1, deliverables: ['Logo Package', 'Brand Guidelines', 'Social Templates'] },
        { id: 2, clientId: 1, projectName: 'E-Commerce Website', description: 'Full online store with coffee subscription system', estimate: 4500, status: 'delivered', turnaround: '21 days', createdAt: new Date(now - 45*dayMs).toISOString(), dueDate: new Date(now - 24*dayMs).toISOString(), deliveredAt: new Date(now - 20*dayMs).toISOString(), assignedDesigner: 1, deliverables: ['Website', 'E-commerce Setup', 'Payment Integration'] },
        { id: 3, clientId: 2, projectName: 'Tech Brand Identity', description: 'Modern tech brand with futuristic aesthetic', estimate: 3500, status: 'in_progress', turnaround: '14 days', createdAt: new Date(now - 10*dayMs).toISOString(), dueDate: new Date(now + 4*dayMs).toISOString(), deliveredAt: null, assignedDesigner: 1, deliverables: [] },
        { id: 4, clientId: 2, projectName: 'SaaS Web Application', description: 'Custom dashboard and client portal', estimate: 7500, status: 'pending', turnaround: '30 days', createdAt: new Date(now - 5*dayMs).toISOString(), dueDate: new Date(now + 25*dayMs).toISOString(), deliveredAt: null, assignedDesigner: null, deliverables: [] },
        { id: 5, clientId: 3, projectName: 'Fitness Brand Refresh', description: 'Energetic brand identity for gym chain', estimate: 3000, status: 'in_progress', turnaround: '10 days', createdAt: new Date(now - 8*dayMs).toISOString(), dueDate: new Date(now + 2*dayMs).toISOString(), deliveredAt: null, assignedDesigner: 1, deliverables: [] },
        { id: 6, clientId: 3, projectName: 'Gym Website Redesign', description: 'Modern responsive website with class booking', estimate: 2500, status: 'pending', turnaround: '14 days', createdAt: new Date(now - 3*dayMs).toISOString(), dueDate: new Date(now + 11*dayMs).toISOString(), deliveredAt: null, assignedDesigner: null, deliverables: [] },
        { id: 7, clientId: 4, projectName: 'Luxury Salon Branding', description: 'Elegant premium brand identity', estimate: 3500, status: 'in_progress', turnaround: '14 days', createdAt: new Date(now - 7*dayMs).toISOString(), dueDate: new Date(now + 7*dayMs).toISOString(), deliveredAt: null, assignedDesigner: 1, deliverables: [] },
        { id: 8, clientId: 5, projectName: 'Fleet Branding Package', description: 'Vehicle wraps and signage design', estimate: 2800, status: 'delivered', turnaround: '10 days', createdAt: new Date(now - 30*dayMs).toISOString(), dueDate: new Date(now - 20*dayMs).toISOString(), deliveredAt: new Date(now - 18*dayMs).toISOString(), assignedDesigner: 1, deliverables: ['Vehicle Wrap Designs', 'Signage', 'Business Cards'] },
        { id: 9, clientId: 5, projectName: 'Business Website', description: '5-page corporate website', estimate: 2500, status: 'delivered', turnaround: '14 days', createdAt: new Date(now - 50*dayMs).toISOString(), dueDate: new Date(now - 36*dayMs).toISOString(), deliveredAt: new Date(now - 35*dayMs).toISOString(), assignedDesigner: 1, deliverables: ['Website', 'Contact Forms', 'Quote Calculator'] }
    ];

    // ===== DEMO INVOICES =====
    const demoInvoices = [
        { id: 1, invoiceNumber: 'INV-2026-001', clientId: 1, orderId: 1, items: [{ description: 'Brand Identity Package', amount: 3500 }], subtotal: 3500, discount: 175, discountType: 'percent', discountValue: 5, tax: 0, total: 3325, status: 'paid', dueDate: new Date(now - 50*dayMs).toISOString(), paidAt: new Date(now - 52*dayMs).toISOString(), createdAt: new Date(now - 60*dayMs).toISOString() },
        { id: 2, invoiceNumber: 'INV-2026-002', clientId: 1, orderId: 2, items: [{ description: 'E-Commerce Website', amount: 4500 }], subtotal: 4500, discount: 0, discountType: 'none', discountValue: 0, tax: 0, total: 4500, status: 'paid', dueDate: new Date(now - 30*dayMs).toISOString(), paidAt: new Date(now - 28*dayMs).toISOString(), createdAt: new Date(now - 45*dayMs).toISOString() },
        { id: 3, invoiceNumber: 'INV-2026-003', clientId: 2, orderId: 3, items: [{ description: 'Tech Brand Identity - Deposit (50%)', amount: 1750 }], subtotal: 1750, discount: 0, discountType: 'none', discountValue: 0, tax: 0, total: 1750, status: 'paid', dueDate: new Date(now - 5*dayMs).toISOString(), paidAt: new Date(now - 8*dayMs).toISOString(), createdAt: new Date(now - 10*dayMs).toISOString() },
        { id: 4, invoiceNumber: 'INV-2026-004', clientId: 2, orderId: 4, items: [{ description: 'SaaS Web Application - Deposit (50%)', amount: 3750 }], subtotal: 3750, discount: 0, discountType: 'none', discountValue: 0, tax: 0, total: 3750, status: 'pending', dueDate: new Date(now + 7*dayMs).toISOString(), paidAt: null, createdAt: new Date(now - 5*dayMs).toISOString() },
        { id: 5, invoiceNumber: 'INV-2026-005', clientId: 3, orderId: 5, items: [{ description: 'Fitness Brand Refresh - Full Payment', amount: 3000 }], subtotal: 3000, discount: 150, discountType: 'loyalty', discountValue: 5, tax: 0, total: 2850, status: 'pending', dueDate: new Date(now + 3*dayMs).toISOString(), paidAt: null, createdAt: new Date(now - 8*dayMs).toISOString() },
        { id: 6, invoiceNumber: 'INV-2026-006', clientId: 4, orderId: 7, items: [{ description: 'Luxury Salon Branding - Deposit', amount: 1750 }], subtotal: 1750, discount: 0, discountType: 'none', discountValue: 0, tax: 0, total: 1750, status: 'overdue', dueDate: new Date(now - 2*dayMs).toISOString(), paidAt: null, createdAt: new Date(now - 7*dayMs).toISOString() },
        { id: 7, invoiceNumber: 'INV-2026-007', clientId: 5, orderId: 8, items: [{ description: 'Fleet Branding Package', amount: 2800 }], subtotal: 2800, discount: 280, discountType: 'percent', discountValue: 10, tax: 0, total: 2520, status: 'paid', dueDate: new Date(now - 25*dayMs).toISOString(), paidAt: new Date(now - 26*dayMs).toISOString(), createdAt: new Date(now - 30*dayMs).toISOString() },
        { id: 8, invoiceNumber: 'INV-2026-008', clientId: 5, orderId: 9, items: [{ description: 'Business Website', amount: 2500 }], subtotal: 2500, discount: 0, discountType: 'none', discountValue: 0, tax: 0, total: 2500, status: 'paid', dueDate: new Date(now - 40*dayMs).toISOString(), paidAt: new Date(now - 42*dayMs).toISOString(), createdAt: new Date(now - 50*dayMs).toISOString() }
    ];

    // ===== DEMO PAYMENTS =====
    const demoPayments = [
        { id: 1, invoiceId: 1, clientId: 1, amount: 3325, method: 'stripe', status: 'completed', transactionId: 'pi_demo_001', createdAt: new Date(now - 52*dayMs).toISOString() },
        { id: 2, invoiceId: 2, clientId: 1, amount: 4500, method: 'stripe', status: 'completed', transactionId: 'pi_demo_002', createdAt: new Date(now - 28*dayMs).toISOString() },
        { id: 3, invoiceId: 3, clientId: 2, amount: 1750, method: 'stripe', status: 'completed', transactionId: 'pi_demo_003', createdAt: new Date(now - 8*dayMs).toISOString() },
        { id: 4, invoiceId: 7, clientId: 5, amount: 2520, method: 'stripe', status: 'completed', transactionId: 'pi_demo_004', createdAt: new Date(now - 26*dayMs).toISOString() },
        { id: 5, invoiceId: 8, clientId: 5, amount: 2500, method: 'stripe', status: 'completed', transactionId: 'pi_demo_005', createdAt: new Date(now - 42*dayMs).toISOString() }
    ];

    // ===== DEMO PROOFS =====
    const demoProofs = [
        { id: 1, title: 'Detroit Coffee Co. - Brand Guide', clientId: 1, orderId: 1, type: 'brand_guide', status: 'approved', version: 2, assets: [], comments: [{ author: 'Client', text: 'Love it!', createdAt: new Date(now - 45*dayMs).toISOString() }], createdAt: new Date(now - 50*dayMs).toISOString(), approvedAt: new Date(now - 45*dayMs).toISOString() },
        { id: 2, title: 'TechFlow - Logo Concepts', clientId: 2, orderId: 3, type: 'logo', status: 'pending', version: 1, assets: [], comments: [], createdAt: new Date(now - 5*dayMs).toISOString(), approvedAt: null },
        { id: 3, title: 'Urban Fitness - Brand Colors', clientId: 3, orderId: 5, type: 'brand_guide', status: 'revision', version: 1, assets: [], comments: [{ author: 'Client', text: 'Can we try a brighter red?', createdAt: new Date(now - 2*dayMs).toISOString() }], createdAt: new Date(now - 4*dayMs).toISOString(), approvedAt: null },
        { id: 4, title: 'Luxe Hair - Initial Concepts', clientId: 4, orderId: 7, type: 'logo', status: 'pending', version: 1, assets: [], comments: [], createdAt: new Date(now - 3*dayMs).toISOString(), approvedAt: null },
        { id: 5, title: 'Motor City Logistics - Fleet Design', clientId: 5, orderId: 8, type: 'mockup', status: 'approved', version: 3, assets: [], comments: [{ author: 'Client', text: 'Perfect for our trucks!', createdAt: new Date(now - 20*dayMs).toISOString() }], createdAt: new Date(now - 25*dayMs).toISOString(), approvedAt: new Date(now - 20*dayMs).toISOString() }
    ];

    // ===== DEMO LEADS =====
    const demoLeads = [
        { id: 1, name: 'Amanda Foster', email: 'amanda@fosterdesigns.com', phone: '313-555-1001', business: 'Foster Interior Designs', service: 'Brand Identity Package', budget: '$3000-5000', message: 'Looking to rebrand my interior design business', status: 'new', source: 'website', createdAt: new Date(now - 1*dayMs).toISOString() },
        { id: 2, name: 'Michael Brown', email: 'mbrown@detroitauto.com', phone: '313-555-1002', business: 'Detroit Auto Repair', service: 'Website Design', budget: '$2000-3000', message: 'Need a professional website for our auto shop', status: 'contacted', source: 'google', createdAt: new Date(now - 3*dayMs).toISOString() },
        { id: 3, name: 'Lisa Park', email: 'lisa@parkbakery.com', phone: '313-555-1003', business: 'Park Street Bakery', service: 'Brand Kit', budget: '$1000-2000', message: 'Starting a new bakery and need branding', status: 'qualified', source: 'referral', createdAt: new Date(now - 5*dayMs).toISOString() },
        { id: 4, name: 'James Wilson', email: 'james@wilsonlaw.com', phone: '313-555-1004', business: 'Wilson Law Firm', service: 'Brand Identity + Website', budget: '$5000-7500', message: 'Complete rebrand for our law practice', status: 'proposal_sent', source: 'linkedin', createdAt: new Date(now - 7*dayMs).toISOString() },
        { id: 5, name: 'Nicole Harris', email: 'nicole@harrisevents.com', phone: '313-555-1005', business: 'Harris Events Co.', service: 'Brand Identity Package', budget: '$3000-5000', message: 'Event planning company needs modern branding', status: 'new', source: 'instagram', createdAt: new Date(now - 0.5*dayMs).toISOString() }
    ];

    // ===== DEMO CRM DATA =====
    const demoCrmData = {
        clients: demoClients.map(c => ({ id: c.id, name: c.name, email: c.email, phone: c.phone, stage: 5, value: 0 })),
        contacts: [
            { id: 1, clientId: 1, name: 'Marcus Johnson', email: 'marcus@detroitcoffee.com', phone: '313-555-0101', role: 'Owner', primary: true },
            { id: 2, clientId: 2, name: 'Sarah Chen', email: 'sarah@techflow.io', phone: '313-555-0202', role: 'CEO', primary: true },
            { id: 3, clientId: 2, name: 'David Kim', email: 'david@techflow.io', phone: '313-555-0203', role: 'CTO', primary: false },
            { id: 4, clientId: 3, name: 'Dwayne Mitchell', email: 'dwayne@urbanfitness.com', phone: '313-555-0303', role: 'Founder', primary: true },
            { id: 5, clientId: 4, name: 'Jasmine Williams', email: 'jasmine@luxehairstudio.com', phone: '313-555-0404', role: 'Owner', primary: true },
            { id: 6, clientId: 5, name: 'Robert Taylor', email: 'robert@mclogistics.com', phone: '313-555-0505', role: 'Operations Manager', primary: true }
        ],
        communications: [
            { id: 1, clientId: 1, type: 'email', subject: 'Brand Guide Delivered', message: 'Your brand guide is ready for download!', direction: 'outbound', createdAt: new Date(now - 45*dayMs).toISOString() },
            { id: 2, clientId: 2, type: 'call', subject: 'Discovery Call', message: 'Discussed project requirements and timeline', direction: 'outbound', duration: 45, createdAt: new Date(now - 12*dayMs).toISOString() },
            { id: 3, clientId: 3, type: 'email', subject: 'Revision Request', message: 'Client requested color adjustment', direction: 'inbound', createdAt: new Date(now - 2*dayMs).toISOString() },
            { id: 4, clientId: 4, type: 'meeting', subject: 'Kickoff Meeting', message: 'Project kickoff and brand discovery', direction: 'outbound', duration: 60, createdAt: new Date(now - 7*dayMs).toISOString() },
            { id: 5, clientId: 5, type: 'email', subject: 'Thank You', message: 'Client thanked us for the fleet designs', direction: 'inbound', createdAt: new Date(now - 18*dayMs).toISOString() }
        ],
        tasks: [
            { id: 1, clientId: 2, title: 'Send logo concepts', description: 'Prepare and send 3 logo concepts', dueDate: new Date(now + 2*dayMs).toISOString(), status: 'pending', priority: 'high', assignedTo: 1 },
            { id: 2, clientId: 3, title: 'Revise brand colors', description: 'Adjust red to be more vibrant per client feedback', dueDate: new Date(now + 1*dayMs).toISOString(), status: 'in_progress', priority: 'high', assignedTo: 1 },
            { id: 3, clientId: 4, title: 'Follow up on invoice', description: 'Reminder about overdue payment', dueDate: new Date(now).toISOString(), status: 'pending', priority: 'urgent', assignedTo: 1 },
            { id: 4, clientId: 2, title: 'Schedule project kickoff', description: 'Set up meeting for web app project', dueDate: new Date(now + 5*dayMs).toISOString(), status: 'pending', priority: 'medium', assignedTo: 1 }
        ],
        pipelines: [
            { id: 1, name: 'Lead', color: '#3b82f6' },
            { id: 2, name: 'Qualified', color: '#8b5cf6' },
            { id: 3, name: 'Proposal Sent', color: '#f59e0b' },
            { id: 4, name: 'Negotiation', color: '#ef4444' },
            { id: 5, name: 'Won', color: '#10b981' },
            { id: 6, name: 'Lost', color: '#6b7280' }
        ],
        deals: [
            { id: 1, leadId: 1, name: 'Foster Interior Designs - Branding', value: 3500, stage: 1, probability: 20, expectedClose: new Date(now + 14*dayMs).toISOString(), createdAt: new Date(now - 1*dayMs).toISOString() },
            { id: 2, leadId: 2, name: 'Detroit Auto Repair - Website', value: 2500, stage: 2, probability: 40, expectedClose: new Date(now + 21*dayMs).toISOString(), createdAt: new Date(now - 3*dayMs).toISOString() },
            { id: 3, leadId: 3, name: 'Park Street Bakery - Brand Kit', value: 1500, stage: 2, probability: 60, expectedClose: new Date(now + 10*dayMs).toISOString(), createdAt: new Date(now - 5*dayMs).toISOString() },
            { id: 4, leadId: 4, name: 'Wilson Law Firm - Full Rebrand', value: 6500, stage: 3, probability: 70, expectedClose: new Date(now + 7*dayMs).toISOString(), createdAt: new Date(now - 7*dayMs).toISOString() },
            { id: 5, leadId: 5, name: 'Harris Events - Branding', value: 3500, stage: 1, probability: 15, expectedClose: new Date(now + 30*dayMs).toISOString(), createdAt: new Date(now - 0.5*dayMs).toISOString() }
        ]
    };

    // ===== DEMO LOYALTY MEMBERS =====
    const demoLoyalty = {
        enabled: true,
        pointsPerDollar: 1,
        rewardTiers: [
            { name: 'Bronze', minPoints: 0, discount: 5, perks: ['Priority support'] },
            { name: 'Silver', minPoints: 500, discount: 10, perks: ['Priority support', 'Free revisions'] },
            { name: 'Gold', minPoints: 1500, discount: 15, perks: ['Priority support', 'Free revisions', 'Rush delivery'] },
            { name: 'Platinum', minPoints: 5000, discount: 20, perks: ['All perks', 'Dedicated account manager', 'Exclusive pricing'] }
        ],
        members: [
            { id: 1, clientId: 1, name: 'Detroit Coffee Co.', email: 'hello@detroitcoffee.com', points: 7825, tier: 'Platinum', joinedAt: new Date(now - 60*dayMs).toISOString(), lastActivity: new Date(now - 20*dayMs).toISOString() },
            { id: 2, clientId: 5, name: 'Motor City Logistics', email: 'operations@mclogistics.com', points: 5020, tier: 'Platinum', joinedAt: new Date(now - 90*dayMs).toISOString(), lastActivity: new Date(now - 18*dayMs).toISOString() },
            { id: 3, clientId: 2, name: 'TechFlow Solutions', email: 'info@techflow.io', points: 1750, tier: 'Gold', joinedAt: new Date(now - 45*dayMs).toISOString(), lastActivity: new Date(now - 8*dayMs).toISOString() },
            { id: 4, clientId: 3, name: 'Urban Fitness Club', email: 'contact@urbanfitness.com', points: 850, tier: 'Silver', joinedAt: new Date(now - 30*dayMs).toISOString(), lastActivity: new Date(now - 8*dayMs).toISOString() },
            { id: 5, clientId: 4, name: 'Luxe Hair Studio', email: 'book@luxehairstudio.com', points: 0, tier: 'Bronze', joinedAt: new Date(now - 15*dayMs).toISOString(), lastActivity: new Date(now - 7*dayMs).toISOString() }
        ]
    };

    // ===== DEMO EMAIL MARKETING =====
    const demoEmailMarketing = {
        settings: {
            senderName: 'New Urban Influence',
            senderEmail: 'hello@newurbaninfluence.com',
            replyTo: 'hello@newurbaninfluence.com',
            automatedSending: true,
            sendDay: 'monday',
            sendTime: '09:00'
        },
        templates: [
            { id: 1, name: 'Weekly Newsletter', subject: 'Your Weekly Design Inspiration from NUI', type: 'newsletter', content: 'Check out this weeks design trends and tips...' },
            { id: 2, name: 'Promotion', subject: 'ðŸ”¥ Special Offer: 20% Off All Branding Packages', type: 'promo', content: 'Limited time offer...' },
            { id: 3, name: 'New Service Announcement', subject: 'Introducing Our New Mobile App Development Service', type: 'announcement', content: 'We are excited to announce...' },
            { id: 4, name: 'Project Milestone', subject: 'Your Project Update from NUI', type: 'update', content: 'Here is the latest on your project...' }
        ],
        campaigns: [
            { id: 1, name: 'January Newsletter', templateId: 1, status: 'sent', sentAt: new Date(now - 7*dayMs).toISOString(), recipients: 156, opened: 89, clicked: 34, createdAt: new Date(now - 8*dayMs).toISOString() },
            { id: 2, name: 'Winter Sale', templateId: 2, status: 'sent', sentAt: new Date(now - 14*dayMs).toISOString(), recipients: 156, opened: 102, clicked: 47, createdAt: new Date(now - 15*dayMs).toISOString() },
            { id: 3, name: 'February Newsletter', templateId: 1, status: 'scheduled', scheduledFor: new Date(now + 2*dayMs).toISOString(), recipients: 162, opened: 0, clicked: 0, createdAt: new Date(now - 1*dayMs).toISOString() },
            { id: 4, name: 'Mobile App Launch', templateId: 3, status: 'draft', sentAt: null, recipients: 0, opened: 0, clicked: 0, createdAt: new Date(now - 0.5*dayMs).toISOString() }
        ],
        subscribers: [
            { id: 1, email: 'hello@detroitcoffee.com', name: 'Detroit Coffee Co.', status: 'active', source: 'client', subscribedAt: new Date(now - 60*dayMs).toISOString() },
            { id: 2, email: 'info@techflow.io', name: 'TechFlow Solutions', status: 'active', source: 'client', subscribedAt: new Date(now - 45*dayMs).toISOString() },
            { id: 3, email: 'contact@urbanfitness.com', name: 'Urban Fitness Club', status: 'active', source: 'client', subscribedAt: new Date(now - 30*dayMs).toISOString() },
            { id: 4, email: 'book@luxehairstudio.com', name: 'Luxe Hair Studio', status: 'active', source: 'client', subscribedAt: new Date(now - 15*dayMs).toISOString() },
            { id: 5, email: 'operations@mclogistics.com', name: 'Motor City Logistics', status: 'active', source: 'client', subscribedAt: new Date(now - 90*dayMs).toISOString() },
            { id: 6, email: 'amanda@fosterdesigns.com', name: 'Amanda Foster', status: 'active', source: 'lead', subscribedAt: new Date(now - 1*dayMs).toISOString() },
            { id: 7, email: 'mbrown@detroitauto.com', name: 'Michael Brown', status: 'active', source: 'lead', subscribedAt: new Date(now - 3*dayMs).toISOString() },
            { id: 8, email: 'lisa@parkbakery.com', name: 'Lisa Park', status: 'active', source: 'lead', subscribedAt: new Date(now - 5*dayMs).toISOString() }
        ],
        analytics: { sent: 312, opened: 191, clicked: 81, unsubscribed: 3 }
    };

    // ===== DEMO SMS CONVERSATIONS =====
    const demoSmsSystem = {
        openPhone: { connected: true, apiKey: 'demo_api_key_xxx', phoneNumber: '+13135550100', userId: 'demo_user' },
        conversations: [
            { id: 1, clientId: 1, clientName: 'Marcus Johnson', phone: '+13135550101', messages: [
                { id: 1, direction: 'outbound', text: 'Hi Marcus! Your brand guide is ready for review. Check your email!', timestamp: new Date(now - 45*dayMs).toISOString(), status: 'delivered' },
                { id: 2, direction: 'inbound', text: 'Thanks! Just saw it, looks amazing!', timestamp: new Date(now - 45*dayMs + 3600000).toISOString(), status: 'received' }
            ], lastMessage: new Date(now - 45*dayMs + 3600000).toISOString(), unread: 0 },
            { id: 2, clientId: 2, clientName: 'Sarah Chen', phone: '+13135550202', messages: [
                { id: 1, direction: 'outbound', text: 'Hi Sarah! Reminder about our call tomorrow at 2pm.', timestamp: new Date(now - 1*dayMs).toISOString(), status: 'delivered' },
                { id: 2, direction: 'inbound', text: 'Perfect, see you then!', timestamp: new Date(now - 1*dayMs + 1800000).toISOString(), status: 'received' }
            ], lastMessage: new Date(now - 1*dayMs + 1800000).toISOString(), unread: 0 },
            { id: 3, clientId: 3, clientName: 'Dwayne Mitchell', phone: '+13135550303', messages: [
                { id: 1, direction: 'outbound', text: 'Hi Dwayne! We have updated the colors as requested. Please review!', timestamp: new Date(now - 0.5*dayMs).toISOString(), status: 'delivered' }
            ], lastMessage: new Date(now - 0.5*dayMs).toISOString(), unread: 0 },
            { id: 4, clientId: 4, clientName: 'Jasmine Williams', phone: '+13135550404', messages: [
                { id: 1, direction: 'inbound', text: 'Hi, when can I expect the first concepts?', timestamp: new Date(now - 2*dayMs).toISOString(), status: 'received' },
                { id: 2, direction: 'outbound', text: 'Hi Jasmine! We are working on them now. Expect to see concepts by Friday!', timestamp: new Date(now - 2*dayMs + 7200000).toISOString(), status: 'delivered' }
            ], lastMessage: new Date(now - 2*dayMs + 7200000).toISOString(), unread: 0 }
        ],
        templates: [
            { id: 1, name: 'Appointment Reminder', message: 'Hi {name}! Reminder about your consultation with NUI tomorrow at {time}. Reply to confirm!' },
            { id: 2, name: 'Project Update', message: 'Hi {name}! Your project is ready for review. Check your email or reply with questions!' },
            { id: 3, name: 'Payment Reminder', message: 'Hi {name}! Friendly reminder that invoice #{invoice} is due soon. Questions? Reply to this text!' }
        ],
        autoResponses: [
            { trigger: 'stop', response: 'You have been unsubscribed. Reply START to resubscribe.' },
            { trigger: 'help', response: 'For support, visit newurbaninfluence.com or call us!' }
        ],
        settings: { autoReplyEnabled: true, businessHoursOnly: true, businessHours: { start: '09:00', end: '18:00' } }
    };

    // ===== DEMO SOCIAL DM =====
    const demoSocialDM = {
        connected: {
            facebook: { connected: true, pageId: 'demo_page_123', accessToken: 'demo_token', pageName: 'New Urban Influence' },
            instagram: { connected: true, accountId: 'demo_ig_123', accessToken: 'demo_token', username: '@newurbaninfluence' },
            twitter: { connected: false, accountId: '', accessToken: '', username: '' }
        },
        conversations: [
            { id: 1, platform: 'instagram', userId: 'ig_user_001', userName: 'detroitfoodie', userAvatar: '', messages: [
                { id: 1, direction: 'inbound', text: 'Love your work! How much for a logo?', timestamp: new Date(now - 2*dayMs).toISOString() },
                { id: 2, direction: 'outbound', text: 'Thanks! Our logo packages start at $500. Would you like to schedule a free consultation?', timestamp: new Date(now - 2*dayMs + 1800000).toISOString() },
                { id: 3, direction: 'inbound', text: 'Yes please!', timestamp: new Date(now - 2*dayMs + 3600000).toISOString() }
            ], lastMessage: new Date(now - 2*dayMs + 3600000).toISOString(), unread: 1 },
            { id: 2, platform: 'facebook', userId: 'fb_user_002', userName: 'Mike Thompson', userAvatar: '', messages: [
                { id: 1, direction: 'inbound', text: 'Do you do vehicle wraps?', timestamp: new Date(now - 5*dayMs).toISOString() },
                { id: 2, direction: 'outbound', text: 'Yes! We design vehicle wraps. Check out our portfolio for examples. Would you like a quote?', timestamp: new Date(now - 5*dayMs + 3600000).toISOString() },
                { id: 3, direction: 'inbound', text: 'Yes, I have a food truck', timestamp: new Date(now - 5*dayMs + 7200000).toISOString() },
                { id: 4, direction: 'outbound', text: 'Perfect! Food truck wraps are our specialty. Can you email us photos of your truck to hello@newurbaninfluence.com?', timestamp: new Date(now - 5*dayMs + 10800000).toISOString() }
            ], lastMessage: new Date(now - 5*dayMs + 10800000).toISOString(), unread: 0 },
            { id: 3, platform: 'instagram', userId: 'ig_user_003', userName: 'startuplife313', userAvatar: '', messages: [
                { id: 1, direction: 'inbound', text: 'What are your hours?', timestamp: new Date(now - 0.5*dayMs).toISOString() },
                { id: 2, direction: 'outbound', text: 'We are open Monday-Friday, 9AM-6PM EST. Feel free to leave a message and we will get back to you!', timestamp: new Date(now - 0.5*dayMs + 300000).toISOString() }
            ], lastMessage: new Date(now - 0.5*dayMs + 300000).toISOString(), unread: 0 }
        ],
        autoResponses: [
            { id: 1, trigger: 'pricing', platform: 'all', message: 'Thanks for your interest! Our branding packages start at $1,500. Would you like to schedule a free consultation?' },
            { id: 2, trigger: 'hello', platform: 'all', message: 'Hey there! Thanks for reaching out to New Urban Influence. How can we help you today?' },
            { id: 3, trigger: 'hours', platform: 'all', message: 'We are open Monday-Friday, 9AM-6PM EST. Feel free to leave a message and we will get back to you!' }
        ],
        settings: { autoReplyEnabled: true, autoReplyDelay: 5, notifyOnNewMessage: true }
    };

    // ===== DEMO COMMUNICATIONS HUB =====
    const demoCommHub = {
        inbox: [
            { id: 1, platform: 'sms', clientId: 3, clientName: 'Dwayne Mitchell', preview: 'We have updated the colors...', timestamp: new Date(now - 0.5*dayMs).toISOString(), unread: false },
            { id: 2, platform: 'instagram', clientName: 'detroitfoodie', preview: 'Yes please!', timestamp: new Date(now - 2*dayMs + 3600000).toISOString(), unread: true },
            { id: 3, platform: 'sms', clientId: 2, clientName: 'Sarah Chen', preview: 'Perfect, see you then!', timestamp: new Date(now - 1*dayMs + 1800000).toISOString(), unread: false },
            { id: 4, platform: 'facebook', clientName: 'Mike Thompson', preview: 'Can you email us photos...', timestamp: new Date(now - 5*dayMs + 10800000).toISOString(), unread: false },
            { id: 5, platform: 'email', clientId: 1, clientName: 'Marcus Johnson', preview: 'Thanks! Just saw it, looks amazing!', timestamp: new Date(now - 45*dayMs).toISOString(), unread: false }
        ],
        filters: { unread: false, platform: 'all', client: '' },
        settings: { unifiedView: true, notifications: true }
    };

    // ===== SAVE ALL DEMO DATA =====
    clients = demoClients;
    orders = demoOrders;
    invoices = demoInvoices;
    payments = demoPayments;
    proofs = demoProofs;
    leads = demoLeads;
    crmData = demoCrmData;
    loyaltyProgram = demoLoyalty;
    emailMarketing = demoEmailMarketing;
    smsSystem = demoSmsSystem;
    socialMediaDM = demoSocialDM;
    communicationsHub = demoCommHub;

    saveClients();
    saveOrders();
    saveInvoices();
    savePayments();
    saveProofs();
    saveLeads();
    saveCrm();
    saveLoyalty();
    saveEmailMarketing();
    saveSms();
    saveSocialDM();
    saveCommHub();

    console.log('âœ… Demo data initialized successfully!');
    console.log('ðŸ“Š Created:');
    console.log('   - 5 Demo Clients with brand assets');
    console.log('   - 9 Demo Orders (various statuses)');
    console.log('   - 8 Demo Invoices (paid/pending/overdue)');
    console.log('   - 5 Demo Payments');
    console.log('   - 5 Demo Proofs (various statuses)');
    console.log('   - 5 Demo Leads in pipeline');
    console.log('   - 5 Demo Loyalty Members');
    console.log('   - 4 Email Campaigns');
    console.log('   - 8 Email Subscribers');
    console.log('   - SMS & Social DM conversations');

    return true;
}

// Auto-initialize demo data on first load (check if needed)
function checkAndInitializeDemoData() {
    const hasInitialized = localStorage.getItem('nui_demo_initialized');
    if (!hasInitialized || clients.length < 3 || orders.length < 5) {
        initializeDemoData();
        localStorage.setItem('nui_demo_initialized', 'true');
    }
}

// Run demo data check on page load
checkAndInitializeDemoData();

// ==================== WORKFLOW TRIGGERS & VALIDATION ====================
// Trigger: When invoice is paid, update loyalty points
function triggerInvoicePaid(invoiceId) {
    const invoice = invoices.find(i => i.id === invoiceId);
    if (!invoice) return;

    // Find loyalty member and add points
    const member = loyaltyProgram.members.find(m => m.clientId === invoice.clientId);
    if (member) {
        const points = Math.floor(invoice.total * loyaltyProgram.pointsPerDollar);
        member.points += points;
        member.lastActivity = new Date().toISOString();
        // Update tier
        const tiers = loyaltyProgram.rewardTiers.sort((a, b) => b.minPoints - a.minPoints);
        for (const tier of tiers) {
            if (member.points >= tier.minPoints) {
                member.tier = tier.name;
                break;
            }
        }
        saveLoyalty();
        console.log('âœ… Trigger: Loyalty points added - ' + points + ' points to ' + member.name);
    }

    // Update order status if linked
    if (invoice.orderId) {
        const order = orders.find(o => o.id === invoice.orderId);
        if (order && order.status === 'pending') {
            order.status = 'in_progress';
            saveOrders();
            console.log('âœ… Trigger: Order status updated to in_progress');
        }
    }
}

// Trigger: When order is delivered, send notification
function triggerOrderDelivered(orderId) {
    const order = orders.find(o => o.id === orderId);
    if (!order) return;

    const client = clients.find(c => c.id === order.clientId);
    if (!client) return;

    // Add to communications hub
    communicationsHub.inbox.unshift({
        id: Date.now(),
        platform: 'system',
        clientId: client.id,
        clientName: client.name,
        preview: 'Order delivered: ' + order.projectName,
        timestamp: new Date().toISOString(),
        unread: true
    });
    saveCommHub();

    console.log('âœ… Trigger: Delivery notification sent for ' + order.projectName);
}

// Trigger: When proof is approved, check payment and enable downloads
function triggerProofApproved(proofId) {
    const proof = proofs.find(p => p.id === proofId);
    if (!proof) return;

    const client = clients.find(c => c.id === proof.clientId);
    if (!client) return;

    // Update client brand guide status
    if (!client.brandGuide) client.brandGuide = { status: 'draft', proofComments: [] };
    client.brandGuide.status = 'approved';
    client.brandGuide.approvedAt = new Date().toISOString();
    saveClients();

    // Check payment status
    const isPaid = checkClientPaymentStatus(proof.clientId);
    if (isPaid) {
        console.log('âœ… Trigger: Proof approved + Paid - Downloads enabled for ' + client.name);
        // Simulate email notification
        simulateEmailNotification(client.email, 'Your Brand Assets are Ready!', 'Download your approved brand assets from your portal.');
    } else {
        console.log('âš ï¸ Trigger: Proof approved but payment pending for ' + client.name);
    }
}

// Trigger: New lead added to pipeline
function triggerNewLead(leadId) {
    const lead = leads.find(l => l.id === leadId);
    if (!lead) return;

    // Add to CRM deals
    if (!crmData.deals) crmData.deals = [];
    const existingDeal = crmData.deals.find(d => d.leadId === leadId);
    if (!existingDeal) {
        crmData.deals.push({
            id: Date.now(),
            leadId: leadId,
            name: lead.business + ' - ' + lead.service,
            value: parseInt(lead.budget?.match(/\d+/)?.[0] || '0') * 1000,
            stage: 1,
            probability: 20,
            expectedClose: new Date(Date.now() + 14*24*60*60*1000).toISOString(),
            createdAt: new Date().toISOString()
        });
        saveCrm();
        console.log('âœ… Trigger: New deal created in pipeline for ' + lead.name);
    }

    // Add to email subscribers
    const existingSub = emailMarketing.subscribers.find(s => s.email === lead.email);
    if (!existingSub) {
        emailMarketing.subscribers.push({
            id: Date.now(),
            email: lead.email,
            name: lead.name,
            status: 'active',
            source: 'lead',
            subscribedAt: new Date().toISOString()
        });
        saveEmailMarketing();
        console.log('âœ… Trigger: Lead added to email subscribers');
    }
}

// Trigger: Auto-response for social media DM
function triggerSocialAutoResponse(platform, message) {
    if (!socialMediaDM.settings.autoReplyEnabled) return null;

    const msgLower = message.toLowerCase();
    for (const response of socialMediaDM.autoResponses) {
        if (response.platform === 'all' || response.platform === platform) {
            if (msgLower.includes(response.trigger)) {
                console.log('âœ… Trigger: Auto-response matched for "' + response.trigger + '"');
                return response.message;
            }
        }
    }
    return null;
}

// Trigger: Weekly newsletter automation
function triggerWeeklyNewsletter() {
    if (!emailMarketing.settings.automatedSending) {
        console.log('âš ï¸ Automated sending is disabled');
        return;
    }

    const today = new Date().toLocaleDateString('en-US', { weekday: 'lowercase' });
    if (today !== emailMarketing.settings.sendDay) {
        console.log('âš ï¸ Today is not the scheduled send day (' + emailMarketing.settings.sendDay + ')');
        return;
    }

    const newsletterTemplate = emailMarketing.templates.find(t => t.type === 'newsletter');
    if (!newsletterTemplate) return;

    const campaign = {
        id: Date.now(),
        name: 'Auto Newsletter - ' + new Date().toLocaleDateString(),
        templateId: newsletterTemplate.id,
        status: 'sent',
        sentAt: new Date().toISOString(),
        recipients: emailMarketing.subscribers.filter(s => s.status === 'active').length,
        opened: 0,
        clicked: 0,
        createdAt: new Date().toISOString()
    };
    emailMarketing.campaigns.push(campaign);
    saveEmailMarketing();

    console.log('âœ… Trigger: Weekly newsletter sent to ' + campaign.recipients + ' subscribers');
}

// Simulate email notification (for demo purposes)
function simulateEmailNotification(to, subject, body) {
    console.log('ðŸ“§ Email Simulated:');
    console.log('   To: ' + to);
    console.log('   Subject: ' + subject);
    console.log('   Body: ' + body);
}

// ==================== WORKFLOW VALIDATION ====================
function validateAllWorkflows() {
    console.log('ðŸ” Validating all workflows and triggers...\n');
    let passed = 0;
    let failed = 0;

    // Test 1: Client-Order relationship
    console.log('Test 1: Client-Order Relationships');
    for (const order of orders) {
        const client = clients.find(c => c.id === order.clientId);
        if (client) {
            passed++;
        } else {
            console.log('   âŒ Order #' + order.id + ' has no matching client');
            failed++;
        }
    }
    console.log('   âœ… ' + passed + ' orders have valid client references\n');

    // Test 2: Invoice-Order relationship
    passed = 0;
    console.log('Test 2: Invoice-Order Relationships');
    for (const invoice of invoices) {
        const order = orders.find(o => o.id === invoice.orderId);
        if (order || !invoice.orderId) {
            passed++;
        } else {
            console.log('   âŒ Invoice #' + invoice.id + ' has no matching order');
            failed++;
        }
    }
    console.log('   âœ… ' + passed + ' invoices have valid order references\n');

    // Test 3: Payment triggers loyalty
    console.log('Test 3: Payment-Loyalty Integration');
    const paidInvoices = invoices.filter(i => i.status === 'paid');
    const loyaltyMembers = loyaltyProgram.members;
    console.log('   - Paid invoices: ' + paidInvoices.length);
    console.log('   - Loyalty members: ' + loyaltyMembers.length);
    console.log('   âœ… Loyalty system ready\n');

    // Test 4: Proof-Client relationship
    passed = 0;
    console.log('Test 4: Proof-Client Relationships');
    for (const proof of proofs) {
        const client = clients.find(c => c.id === proof.clientId);
        if (client) {
            passed++;
        } else {
            console.log('   âŒ Proof #' + proof.id + ' has no matching client');
            failed++;
        }
    }
    console.log('   âœ… ' + passed + ' proofs have valid client references\n');

    // Test 5: Lead-Deal pipeline
    console.log('Test 5: Lead-Deal Pipeline');
    const dealsWithLeads = (crmData.deals || []).filter(d => leads.find(l => l.id === d.leadId));
    console.log('   - Total leads: ' + leads.length);
    console.log('   - Total deals: ' + (crmData.deals || []).length);
    console.log('   - Deals with valid leads: ' + dealsWithLeads.length);
    console.log('   âœ… Pipeline system ready\n');

    // Test 6: Communication channels
    console.log('Test 6: Communication Channels');
    console.log('   - SMS connected: ' + (smsSystem.openPhone.connected ? 'âœ…' : 'âŒ'));
    console.log('   - Facebook connected: ' + (socialMediaDM.connected.facebook.connected ? 'âœ…' : 'âŒ'));
    console.log('   - Instagram connected: ' + (socialMediaDM.connected.instagram.connected ? 'âœ…' : 'âŒ'));
    console.log('   - Email automation: ' + (emailMarketing.settings.automatedSending ? 'âœ…' : 'âŒ') + '\n');

    // Test 7: Auto-response triggers
    console.log('Test 7: Auto-Response Triggers');
    const pricingResponse = triggerSocialAutoResponse('instagram', 'What is your pricing?');
    const hoursResponse = triggerSocialAutoResponse('facebook', 'What are your hours?');
    console.log('   - Pricing trigger: ' + (pricingResponse ? 'âœ…' : 'âŒ'));
    console.log('   - Hours trigger: ' + (hoursResponse ? 'âœ…' : 'âŒ') + '\n');

    // Summary
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('WORKFLOW VALIDATION COMPLETE');
    console.log('Total tests: 7');
    console.log('Failed: ' + failed);
    console.log('Status: ' + (failed === 0 ? 'âœ… ALL SYSTEMS OPERATIONAL' : 'âš ï¸ SOME ISSUES DETECTED'));
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

    return failed === 0;
}

// Run validation on admin dashboard load
// validateAllWorkflows(); // Uncomment to auto-run

// Site Images System
let siteImages = JSON.parse(localStorage.getItem('nui_site_images')) || {
    hero: { url: '', alt: 'Hero Background' },
    heroVideo: { url: '', alt: 'Hero Video' },
    about: { url: '', alt: 'About Section' },
    aboutStory: { url: '', alt: 'Our Story' },
    services: [
        { id: 'brand-kit', url: 'https://images.unsplash.com/photo-1558655146-9f40138edfeb?w=1920&q=80', alt: 'Brand Kit' },
        { id: 'product-brand', url: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=1920&q=80', alt: 'Product Brand' },
        { id: 'service-brand', url: 'https://images.unsplash.com/photo-1556761175-5973dc0f32e7?w=1920&q=80', alt: 'Service Brand' },
        { id: 'website', url: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=1920&q=80', alt: 'Website' },
        { id: 'mobile-app', url: 'https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=1920&q=80', alt: 'Mobile App' },
        { id: 'sales-funnel', url: 'https://images.unsplash.com/photo-1553729459-efe14ef6055d?w=1920&q=80', alt: 'Sales Funnel' },
        { id: 'custom', url: 'https://images.unsplash.com/photo-1542744094-3a31f272c490?w=1920&q=80', alt: 'Custom Package' }
    ],
    team: [],
    portfolio: [],
    blog: []
};
function saveSiteImages() { localStorage.setItem('nui_site_images', JSON.stringify(siteImages)); }

// ==================== VIEW MANAGEMENT ====================
function showView(viewName, skipTracking = false) {
    // Track navigation for back button functionality
    if (!skipTracking && typeof trackNavigation === 'function') {
        const currentView = document.querySelector('.view.active');
        if (currentView) {
            trackNavigation(currentView.id.replace('View', ''));
        }
    }
    document.querySelectorAll('.nav-links a').forEach(link => link.classList.toggle('active', link.dataset.view === viewName));
    document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
    document.getElementById(viewName + 'View').classList.add('active');
    window.scrollTo(0, 0);
    loadViewContent(viewName);
}

function scrollToContact() {
    showView('home');
    setTimeout(() => document.getElementById('contact').scrollIntoView({ behavior: 'smooth' }), 100);
}

function toggleMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    const hamburger = document.querySelector('.hamburger');
    menu.classList.toggle('active');
    hamburger.classList.toggle('active');
    document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
}

function loadViewContent(viewName) {
    const viewEl = document.getElementById(viewName + 'View');
    if (!viewEl.innerHTML.trim()) {
        if (viewName === 'home') loadHomeView();
        if (viewName === 'about') loadAboutView();
        if (viewName === 'services') loadServicesView();
        if (viewName === 'portfolio') loadPortfolioView();
        if (viewName === 'blog') loadBlogView();
        if (viewName === 'portal') loadPortalView();
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => { loadHomeView(); });

// ==================== HOME VIEW ====================
function loadHomeView() {
    document.getElementById('homeView').innerHTML = `
        <section class="hero">
            <div class="hero-media">
                <div class="hero-media-container">
                    <video id="heroVideo" muted loop playsinline autoplay preload="auto">
                        <source src="https://cdn.pixabay.com/video/2020/05/25/40130-424930032_large.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="hero-media-overlay"></div>
            </div>
            <div class="hero-content">
                <div class="badge">Detroit's Premier Digital Agency</div>
                <h1>NEW URBAN<br>INFLUENCE</h1>
                <p>We craft bold branding and digital experiences for visionaries who refuse to blend in. <span>Unapologetically Detroit.</span></p>
                <div class="hero-buttons">
                    <a onclick="scrollToContact()" class="btn-cta">Book Strategy Call</a>
                    <a onclick="showView('portfolio')" class="btn-outline">View Our Work</a>
                </div>
            </div>
            <div class="scroll-indicator">Scroll</div>
        </section>
        <section class="stats-ticker">
            <div class="ticker-text">50+ BRANDS ELEVATED &bull; $2M+ REVENUE GENERATED &bull; DETROIT BORN & RAISED &bull; 50+ BRANDS ELEVATED &bull; $2M+ REVENUE GENERATED &bull; DETROIT BORN & RAISED &bull;</div>
        </section>
        <section class="section dark">
            <div class="struggle-section">
                <div class="struggle-left">
                    <h2>THE<br><span class="red">STRUGGLE</span><br>IS REAL.</h2>
                    <p>Most brands fade into the background noise. In a city that never sleeps and a digital world that never stops, being "good enough" is a death sentence.</p>
                </div>
                <div class="problem-cards">
                    <div class="problem-card"><div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;"><div class="number">01</div><span style="color: var(--gray); font-size: 12px; text-transform: uppercase; letter-spacing: 2px;">Problem Detected</span></div><h3>Your brand looks generic and forgettable</h3></div>
                    <div class="problem-card"><div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;"><div class="number">02</div><span style="color: var(--gray); font-size: 12px; text-transform: uppercase; letter-spacing: 2px;">Problem Detected</span></div><h3>Your website doesn't convert visitors into customers</h3></div>
                    <div class="problem-card"><div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;"><div class="number">03</div><span style="color: var(--gray); font-size: 12px; text-transform: uppercase; letter-spacing: 2px;">Problem Detected</span></div><h3>Your social media feels disconnected from your brand</h3></div>
                    <div class="problem-card"><div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;"><div class="number">04</div><span style="color: var(--gray); font-size: 12px; text-transform: uppercase; letter-spacing: 2px;">Problem Detected</span></div><h3>You're not standing out in a crowded market</h3></div>
                </div>
            </div>
        </section>
        <section class="section dark">
            <div class="services-layout">
                <div class="services-header">
                    <div class="label">Our Expertise</div>
                    <h2 class="section-title">WHAT WE<br><span class="red">CREATE</span></h2>
                    <p style="color: var(--gray); margin-top: 24px;">We don't just make things look pretty. We build systems, brands, and experiences that print money and build legacy.</p>
                    <button class="btn-cta" style="margin-top: 32px;" onclick="showView('services')">Explore All Services</button>
                </div>
                <div class="services-grid home-services">
                    <div class="service-card-simple" onclick="showView('services')"><div class="arrow">â†—</div><h3>Brand Identity Design</h3><p>Forge Your Legacy. Define Your Empire.</p></div>
                    <div class="service-card-simple" onclick="showView('services')"><div class="arrow">â†—</div><h3>Website Design & Dev</h3><p>Your Digital Headquarters. Built for Conversion.</p></div>
                    <div class="service-card-simple" onclick="showView('services')"><div class="arrow">â†—</div><h3>Social Media & Ads</h3><p>Command Attention. Drive Engagement.</p></div>
                    <div class="service-card-simple" onclick="showView('services')"><div class="arrow">â†—</div><h3>Motion & Video</h3><p>Bring Your Story to Life. Dynamically.</p></div>
                </div>
            </div>
        </section>
        <section class="section dark" style="border-top: 1px solid rgba(255,255,255,0.1);">
            <div class="roots-section">
                <div class="roots-left">
                    <div class="label">Our Roots</div>
                    <h2>BUILT IN<br><span class="red">DETROIT.</span></h2>
                    <p>We don't just work here. We are part of the fabric of this city. The grit, the hustle, the innovationâ€”it's in our DNA and in every pixel we push.</p>
                </div>
                <div class="roots-right"><div class="area-code">313</div></div>
            </div>
        </section>
        <section class="section dark results-section">
            <div class="label" style="text-align: center; justify-content: center; margin-bottom: 40px;">The Results Speak</div>
            <div class="stats-boxes">
                <div class="stat-box">
                    <div class="stat-number">50+</div>
                    <div class="stat-label">Brands Elevated</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">$2M+</div>
                    <div class="stat-label">Revenue Generated</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">100%</div>
                    <div class="stat-label">Client Satisfaction</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">48hr</div>
                    <div class="stat-label">Avg Response Time</div>
                </div>
            </div>
        </section>
        <section style="padding: 60px 0; background: #080808; border-top: 1px solid rgba(255,255,255,0.06); border-bottom: 1px solid rgba(255,255,255,0.06);">
            <div class="label" style="justify-content: center; margin-bottom: 32px;">Industries We Serve</div>
            <div style="overflow: hidden; position: relative;">
                <div style="display: flex; gap: 48px; animation: industriesScroll 25s linear infinite; white-space: nowrap;">
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">RESTAURANTS</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">REAL ESTATE</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">FITNESS & WELLNESS</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">E-COMMERCE</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">PROFESSIONAL SERVICES</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">COACHES & CONSULTANTS</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">HEALTHCARE</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">BEAUTY & SALONS</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">RESTAURANTS</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">REAL ESTATE</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">FITNESS & WELLNESS</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">E-COMMERCE</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">PROFESSIONAL SERVICES</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">COACHES & CONSULTANTS</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">HEALTHCARE</span>
                    <span style="color: var(--red);">â—†</span>
                    <span style="font-size: 18px; font-weight: 600; color: rgba(255,255,255,0.5);">BEAUTY & SALONS</span>
                    <span style="color: var(--red);">â—†</span>
                </div>
            </div>
        </section>
        <section class="section dark brands-elevated-section">
            <div class="section-header">
                <div class="label" style="justify-content: center;">Case Studies</div>
                <h2 class="section-title">BRANDS WE'VE <span class="red">ELEVATED</span></h2>
                <p class="section-subtitle">Real results for real businesses. Click to explore each success story.</p>
            </div>
            <div class="case-study-grid">
                <a onclick="showView('portfolio')" style="cursor: pointer; position: relative; aspect-ratio: 16/9; border-radius: 16px; overflow: hidden; display: flex; align-items: flex-end; background: url('https://images.unsplash.com/photo-1558961363-fa8fdf82db35?w=800') center/cover; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; box-shadow: 0 20px 60px rgba(0,0,0,0.4);" onmouseover="this.style.transform='translateY(-8px)'; this.style.borderColor='var(--red)'" onmouseout="this.style.transform='none'; this.style.borderColor='rgba(255,255,255,0.1)'">
                    <div style="position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.5) 50%, transparent 100%);"></div>
                    <div style="position: relative; padding: 32px; width: 100%;"><span style="background: var(--red); color: #fff; font-size: 10px; padding: 4px 12px; border-radius: 4px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Brand + Web</span><h4 style="font-size: 28px; font-weight: 800; margin-top: 16px; line-height: 1.2;">Good Cakes & Bakes</h4><p style="color: rgba(255,255,255,0.7); font-size: 14px; margin-top: 12px; line-height: 1.6;">Complete brand identity overhaul and e-commerce platform for Detroit's premier artisan bakery.</p></div>
                </a>
                <a onclick="showView('portfolio')" style="cursor: pointer; position: relative; aspect-ratio: 16/9; border-radius: 16px; overflow: hidden; display: flex; align-items: flex-end; background: url('https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800') center/cover; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; box-shadow: 0 20px 60px rgba(0,0,0,0.4);" onmouseover="this.style.transform='translateY(-8px)'; this.style.borderColor='var(--red)'" onmouseout="this.style.transform='none'; this.style.borderColor='rgba(255,255,255,0.1)'">
                    <div style="position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.5) 50%, transparent 100%);"></div>
                    <div style="position: relative; padding: 32px; width: 100%;"><span style="background: var(--red); color: #fff; font-size: 10px; padding: 4px 12px; border-radius: 4px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Web + Marketing</span><h4 style="font-size: 28px; font-weight: 800; margin-top: 16px; line-height: 1.2;">Motor City Bistro</h4><p style="color: rgba(255,255,255,0.7); font-size: 14px; margin-top: 12px; line-height: 1.6;">High-converting website and digital marketing strategy that doubled online reservations.</p></div>
                </a>
                <a onclick="showView('portfolio')" style="cursor: pointer; position: relative; aspect-ratio: 16/9; border-radius: 16px; overflow: hidden; display: flex; align-items: flex-end; background: url('https://images.unsplash.com/photo-1513364776144-60967b0f800f?w=800') center/cover; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; box-shadow: 0 20px 60px rgba(0,0,0,0.4);" onmouseover="this.style.transform='translateY(-8px)'; this.style.borderColor='var(--red)'" onmouseout="this.style.transform='none'; this.style.borderColor='rgba(255,255,255,0.1)'">
                    <div style="position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.5) 50%, transparent 100%);"></div>
                    <div style="position: relative; padding: 32px; width: 100%;"><span style="background: var(--red); color: #fff; font-size: 10px; padding: 4px 12px; border-radius: 4px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Social + Video</span><h4 style="font-size: 28px; font-weight: 800; margin-top: 16px; line-height: 1.2;">Detroit Canvas Co.</h4><p style="color: rgba(255,255,255,0.7); font-size: 14px; margin-top: 12px; line-height: 1.6;">Social media transformation and video content that increased engagement by 340%.</p></div>
                </a>
                <a onclick="showView('portfolio')" style="cursor: pointer; position: relative; aspect-ratio: 16/9; border-radius: 16px; overflow: hidden; display: flex; align-items: flex-end; background: url('https://images.unsplash.com/photo-1571902943202-507ec2618e8f?w=800') center/cover; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; box-shadow: 0 20px 60px rgba(0,0,0,0.4);" onmouseover="this.style.transform='translateY(-8px)'; this.style.borderColor='var(--red)'" onmouseout="this.style.transform='none'; this.style.borderColor='rgba(255,255,255,0.1)'">
                    <div style="position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.5) 50%, transparent 100%);"></div>
                    <div style="position: relative; padding: 32px; width: 100%;"><span style="background: var(--red); color: #fff; font-size: 10px; padding: 4px 12px; border-radius: 4px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Funnels</span><h4 style="font-size: 28px; font-weight: 800; margin-top: 16px; line-height: 1.2;">Ascend Coaching</h4><p style="color: rgba(255,255,255,0.7); font-size: 14px; margin-top: 12px; line-height: 1.6;">Sales funnel system and automation that generated $500K+ in coaching program sales.</p></div>
                </a>
            </div>
            <div style="text-align: center; margin-top: 48px;">
                <button class="btn-cta" onclick="showView('portfolio')">View All Case Studies â†’</button>
            </div>
        </section>
        <section class="section dark">
            <div class="section-header">
                <h2 class="section-title">WHY <span class="red">US?</span></h2>
                <p class="section-subtitle">We're not for everyone. We're for the ones who want to win.</p>
            </div>
            <div class="why-grid">
                <div class="why-card"><div class="icon">â˜…</div><h3>Detroit-Rooted Creativity</h3><p>We bring the bold, unapologetic energy of Detroit to every project.</p></div>
                <div class="why-card"><div class="icon">$</div><h3>Revenue-Focused Design</h3><p>Beautiful brands that actually drive business results and conversions.</p></div>
                <div class="why-card"><div class="icon">â™¥</div><h3>Elite but Approachable</h3><p>Premium quality without the corporate stuffiness or agency BS.</p></div>
            </div>
        </section>
        <section class="section dark">
            <div class="section-header">
                <div style="display: inline-block; background: var(--red); padding: 16px 48px; border-radius: 4px; margin-bottom: 16px;">
                    <h2 class="section-title" style="color: #fff; margin: 0; font-size: clamp(32px, 6vw, 56px);">STREET CRED</h2>
                </div>
            </div>
            <div class="testimonials-grid" style="grid-template-columns: repeat(4, 1fr);">
                <div class="testimonial-card"><div class="stars">â˜…â˜…â˜…â˜…â˜…</div><p>"I would recommend working with New Urban Influence. My experience with Faren was great...even when I was being a difficult customer. The care and attention that was put into making sure they understood my vision for my brand was amazing."</p><div class="author"><div class="avatar" style="background: linear-gradient(135deg, var(--red), #ff6b5b);"></div><div><div class="author-name">Miss B</div><div class="author-title">Local Guide â€¢ Google Review</div></div></div></div>
                <div class="testimonial-card"><div class="stars">â˜…â˜…â˜…â˜…â˜…</div><p>"Farren did a great job on a few flyers for me. Prices were reasonable and the quality was superb. My go to company for all my promotional needs. The best at what he does!"</p><div class="author"><div class="avatar" style="background: linear-gradient(135deg, var(--red), #ff6b5b);"></div><div><div class="author-name">Chevelles Bar</div><div class="author-title">Local Guide â€¢ Google Review</div></div></div></div>
                <div class="testimonial-card"><div class="stars">â˜…â˜…â˜…â˜…â˜…</div><p>"The best graphic designing company in the world! I've been a customer for over 10 years and every time they exceed my expectations! Faren and his team has always been very professional and prompt with all my services! I highly recommend this company!"</p><div class="author"><div class="avatar" style="background: linear-gradient(135deg, var(--red), #ff6b5b);"></div><div><div class="author-name">Sierra Meriwether</div><div class="author-title">10+ Year Client â€¢ Google Review</div></div></div></div>
                <div class="testimonial-card"><div class="stars">â˜…â˜…â˜…â˜…â˜…</div><p>"Great experience. Urban Influence gives you personal/detailed attention (making you feel like you are their most important customer). Love not only the services they offer but the personal touch they provide."</p><div class="author"><div class="avatar" style="background: linear-gradient(135deg, var(--red), #ff6b5b);"></div><div><div class="author-name">Larry Castleberry</div><div class="author-title">Google Review</div></div></div></div>
            </div>
        </section>
        <section style="padding: 60px 0; background: #000; border-top: 1px solid rgba(255,255,255,0.06); border-bottom: 1px solid rgba(255,255,255,0.06); overflow: hidden;">
            <div style="text-align: center; margin-bottom: 40px;">
                <h3 style="font-size: 14px; text-transform: uppercase; letter-spacing: 3px; color: rgba(255,255,255,0.4); font-weight: 600;">TRUSTED & FEATURED ON</h3>
            </div>
            <div style="display: flex; animation: logoScroll 30s linear infinite; width: max-content;">
                <div style="display: flex; align-items: center; gap: 64px; padding: 0 32px;">
                    <a href="https://business.google.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'"><svg height="28" viewBox="0 0 272 92" fill="white"><path d="M115.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18C71.25 34.32 81.24 25 93.5 25s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44S80.99 39.2 80.99 47.18c0 7.9 5.79 13.44 12.51 13.44s12.51-5.55 12.51-13.44z"/><path d="M163.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18c0-12.85 9.99-22.18 22.25-22.18s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44s-12.51 5.46-12.51 13.44c0 7.9 5.79 13.44 12.51 13.44s12.51-5.55 12.51-13.44z"/><path d="M209.75 26.34v39.82c0 16.38-9.66 23.07-21.08 23.07-10.75 0-17.22-7.19-19.66-13.07l8.48-3.53c1.51 3.61 5.21 7.87 11.17 7.87 7.31 0 11.84-4.51 11.84-13v-3.19h-.34c-2.18 2.69-6.38 5.04-11.68 5.04-11.09 0-21.25-9.66-21.25-22.09 0-12.52 10.16-22.26 21.25-22.26 5.29 0 9.49 2.35 11.68 4.96h.34v-3.61h9.25zm-8.56 20.92c0-7.81-5.21-13.52-11.84-13.52-6.72 0-12.35 5.71-12.35 13.52 0 7.73 5.63 13.36 12.35 13.36 6.63 0 11.84-5.63 11.84-13.36z"/><path d="M225 3v65h-9.5V3h9.5z"/><path d="M262.02 54.48l7.56 5.04c-2.44 3.61-8.32 9.83-18.48 9.83-12.6 0-22.01-9.74-22.01-22.18 0-13.19 9.49-22.18 20.92-22.18 11.51 0 17.14 9.16 18.98 14.11l1.01 2.52-29.65 12.28c2.27 4.45 5.8 6.72 10.75 6.72 4.96 0 8.4-2.44 10.92-6.14zm-23.27-7.98l19.82-8.23c-1.09-2.77-4.37-4.7-8.23-4.7-4.95 0-11.84 4.37-11.59 12.93z"/><path d="M35.29 41.41V32H67c.31 1.64.47 3.58.47 5.68 0 7.06-1.93 15.79-8.15 22.01-6.05 6.3-13.78 9.66-24.02 9.66C16.32 69.35.36 53.89.36 34.91.36 15.93 16.32.47 35.3.47c10.5 0 17.98 4.12 23.6 9.49l-6.64 6.64c-4.03-3.78-9.49-6.72-16.97-6.72-13.86 0-24.7 11.17-24.7 25.03 0 13.86 10.84 25.03 24.7 25.03 8.99 0 14.11-3.61 17.39-6.89 2.66-2.66 4.41-6.46 5.1-11.65l-22.49.01z"/></svg></a>
                    <a href="https://www.trustpilot.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 22px; font-weight: 800; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Trustpilot</a>
                    <a href="https://www.designrush.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 20px; font-weight: 800; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">DesignRush</a>
                    <a href="https://clutch.co" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 22px; font-weight: 800; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Clutch</a>
                    <a href="https://businessconnect.apple.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 18px; font-weight: 700; color: white; text-decoration: none; display: flex; align-items: center; gap: 8px;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'"><svg height="20" viewBox="0 0 814 1000" fill="white"><path d="M788.1 340.9c-5.8 4.5-108.2 62.2-108.2 190.5 0 148.4 130.3 200.9 134.2 202.2-.6 3.2-20.7 71.9-68.7 141.9-42.8 61.6-87.5 123.1-155.5 123.1s-85.5-39.5-164-39.5c-76.5 0-103.7 40.8-165.9 40.8s-105.6-57-155.5-127C46.7 781.5 0 643.9 0 453.8c0-243.2 158.1-372.2 313.9-372.2 62.9 0 115.3 41.3 154.9 41.3 37.7 0 96.5-43.9 168.3-43.9 27.1 0 124.5 2.5 188.9 95.9zm-237.5-173c31.3-37.5 53.9-89.6 53.9-141.9 0-7.2-.6-14.5-1.9-20.4-51.4 1.9-112.2 34.3-148.9 77.4-28.9 33-57 85.2-57 138.1 0 7.9 1.3 15.8 1.9 18.3 3.2.6 8.4 1.3 13.5 1.3 46.1 0 103.7-30.8 138.5-72.8z"/></svg>Business Connect</a>
                    <a href="https://www.facebook.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 20px; font-weight: 700; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Facebook</a>
                    <a href="https://www.bingplaces.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 18px; font-weight: 700; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Bing Places</a>
                    <a href="https://www.manta.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 20px; font-weight: 800; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Manta</a>
                    <a href="https://detroitdesignfestival.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 16px; font-weight: 700; color: white; text-decoration: none; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Detroit Design Festival</a>
                    <a href="https://techtowndetroit.org" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 18px; font-weight: 800; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">TechTown Detroit</a>
                    <a href="https://autorama.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 16px; font-weight: 700; color: white; text-decoration: none; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Detroit Autorama</a>
                </div>
                <div style="display: flex; align-items: center; gap: 64px; padding: 0 32px;">
                    <a href="https://business.google.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'"><svg height="28" viewBox="0 0 272 92" fill="white"><path d="M115.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18C71.25 34.32 81.24 25 93.5 25s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44S80.99 39.2 80.99 47.18c0 7.9 5.79 13.44 12.51 13.44s12.51-5.55 12.51-13.44z"/><path d="M163.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18c0-12.85 9.99-22.18 22.25-22.18s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44s-12.51 5.46-12.51 13.44c0 7.9 5.79 13.44 12.51 13.44s12.51-5.55 12.51-13.44z"/><path d="M209.75 26.34v39.82c0 16.38-9.66 23.07-21.08 23.07-10.75 0-17.22-7.19-19.66-13.07l8.48-3.53c1.51 3.61 5.21 7.87 11.17 7.87 7.31 0 11.84-4.51 11.84-13v-3.19h-.34c-2.18 2.69-6.38 5.04-11.68 5.04-11.09 0-21.25-9.66-21.25-22.09 0-12.52 10.16-22.26 21.25-22.26 5.29 0 9.49 2.35 11.68 4.96h.34v-3.61h9.25zm-8.56 20.92c0-7.81-5.21-13.52-11.84-13.52-6.72 0-12.35 5.71-12.35 13.52 0 7.73 5.63 13.36 12.35 13.36 6.63 0 11.84-5.63 11.84-13.36z"/><path d="M225 3v65h-9.5V3h9.5z"/><path d="M262.02 54.48l7.56 5.04c-2.44 3.61-8.32 9.83-18.48 9.83-12.6 0-22.01-9.74-22.01-22.18 0-13.19 9.49-22.18 20.92-22.18 11.51 0 17.14 9.16 18.98 14.11l1.01 2.52-29.65 12.28c2.27 4.45 5.8 6.72 10.75 6.72 4.96 0 8.4-2.44 10.92-6.14zm-23.27-7.98l19.82-8.23c-1.09-2.77-4.37-4.7-8.23-4.7-4.95 0-11.84 4.37-11.59 12.93z"/><path d="M35.29 41.41V32H67c.31 1.64.47 3.58.47 5.68 0 7.06-1.93 15.79-8.15 22.01-6.05 6.3-13.78 9.66-24.02 9.66C16.32 69.35.36 53.89.36 34.91.36 15.93 16.32.47 35.3.47c10.5 0 17.98 4.12 23.6 9.49l-6.64 6.64c-4.03-3.78-9.49-6.72-16.97-6.72-13.86 0-24.7 11.17-24.7 25.03 0 13.86 10.84 25.03 24.7 25.03 8.99 0 14.11-3.61 17.39-6.89 2.66-2.66 4.41-6.46 5.1-11.65l-22.49.01z"/></svg></a>
                    <a href="https://www.trustpilot.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 22px; font-weight: 800; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Trustpilot</a>
                    <a href="https://www.designrush.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 20px; font-weight: 800; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">DesignRush</a>
                    <a href="https://clutch.co" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 22px; font-weight: 800; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Clutch</a>
                    <a href="https://businessconnect.apple.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 18px; font-weight: 700; color: white; text-decoration: none; display: flex; align-items: center; gap: 8px;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'"><svg height="20" viewBox="0 0 814 1000" fill="white"><path d="M788.1 340.9c-5.8 4.5-108.2 62.2-108.2 190.5 0 148.4 130.3 200.9 134.2 202.2-.6 3.2-20.7 71.9-68.7 141.9-42.8 61.6-87.5 123.1-155.5 123.1s-85.5-39.5-164-39.5c-76.5 0-103.7 40.8-165.9 40.8s-105.6-57-155.5-127C46.7 781.5 0 643.9 0 453.8c0-243.2 158.1-372.2 313.9-372.2 62.9 0 115.3 41.3 154.9 41.3 37.7 0 96.5-43.9 168.3-43.9 27.1 0 124.5 2.5 188.9 95.9zm-237.5-173c31.3-37.5 53.9-89.6 53.9-141.9 0-7.2-.6-14.5-1.9-20.4-51.4 1.9-112.2 34.3-148.9 77.4-28.9 33-57 85.2-57 138.1 0 7.9 1.3 15.8 1.9 18.3 3.2.6 8.4 1.3 13.5 1.3 46.1 0 103.7-30.8 138.5-72.8z"/></svg>Business Connect</a>
                    <a href="https://www.facebook.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 20px; font-weight: 700; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Facebook</a>
                    <a href="https://www.bingplaces.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 18px; font-weight: 700; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Bing Places</a>
                    <a href="https://www.manta.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 20px; font-weight: 800; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Manta</a>
                    <a href="https://detroitdesignfestival.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 16px; font-weight: 700; color: white; text-decoration: none; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Detroit Design Festival</a>
                    <a href="https://techtowndetroit.org" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 18px; font-weight: 800; color: white; text-decoration: none;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">TechTown Detroit</a>
                    <a href="https://autorama.com" target="_blank" style="opacity: 0.5; transition: opacity 0.3s; font-size: 16px; font-weight: 700; color: white; text-decoration: none; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">Detroit Autorama</a>
                </div>
            </div>
        </section>
        <section class="cta-section" id="contact">
            <h2>READY TO<br>DOMINATE?</h2>
            <p>Stop playing small. Let's build a brand that demands attention and drives real revenue.</p>
            <button class="btn-white">Book Your Strategy Call</button>
        </section>
        <footer class="footer">
            <div class="footer-content">
                <a class="footer-logo" onclick="showView('home')"><img src="NUI.avif" alt="NUI" style="height: 40px;"></a>
                <div class="footer-links">
                    <a onclick="showView('services')">Services</a>
                    <a onclick="showView('portfolio')">Portfolio</a>
                    <a onclick="showView('about')">About</a>
                    <a onclick="showView('portal')">Client Portal</a>
                </div>
                <div style="color: var(--gray); font-size: 14px;">Â© 2026 New Urban Influence. Unapologetically Detroit.</div>
            </div>
        </footer>
    `;
    const video = document.getElementById('heroVideo');
    if (video) { video.muted = true; video.play().catch(e => {}); }
}

// ==================== ABOUT VIEW ====================
function loadAboutView() {
    const teamHTML = aboutData.team.map((member, i) => `
        <div class="team-card">
            <div class="team-photo">
                ${member.photo ? `<img src="${member.photo}" alt="${member.name}">` : 'Photo'}
            </div>
            <h3 class="team-name">${member.name}</h3>
            <p class="team-title">${member.title}</p>
            <p class="team-bio">${member.bio}</p>
        </div>
    `).join('');

    document.getElementById('aboutView').innerHTML = `
        <section class="about-hero"><div class="hero-content"><h1>About <span>Us</span></h1><p>We're a Detroit-rooted creative agency crafting bold brands and digital experiences for visionaries who refuse to blend in.</p></div></section>
        <section class="section dark">
            <div class="story-section">
                <div class="story-content">
                    <div class="label">Our Story</div>
                    <h2>BORN IN THE <span class="red">D.</span><br>BUILT TO <span class="red">DOMINATE.</span></h2>
                    <p>New Urban Influence was founded with a simple mission: to bring the bold, unapologetic energy of Detroit to every brand we touch.</p>
                    <p>We believe that great design isn't just about looking good - it's about creating systems that drive real business results. Every pixel we push, every strategy we craft, is designed to help our clients dominate their markets.</p>
                </div>
                <div class="story-image" style="background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.15); font-size: 14px;">
                    ${aboutData.storyImage ? `<img src="${aboutData.storyImage}" alt="Our Story" style="width: 100%; height: 100%; object-fit: cover;">` : 'Image'}
                </div>
            </div>
        </section>
        <section class="section dark"><div class="section-header"><h2 class="section-title">OUR <span class="red">VALUES</span></h2></div><div class="values-grid"><div class="value-card"><div class="number">01</div><h3>Bold Creativity</h3><p>We don't play it safe. Every project gets our full creative energy.</p></div><div class="value-card"><div class="number">02</div><h3>Results First</h3><p>Beautiful design that drives real business outcomes.</p></div><div class="value-card"><div class="number">03</div><h3>Detroit Grit</h3><p>The hustle and resilience of our city runs through everything.</p></div><div class="value-card"><div class="number">04</div><h3>Client Partners</h3><p>We're invested partners in your success and growth.</p></div></div></section>
        <section class="section dark" style="border-top: 1px solid rgba(255,255,255,0.06);">
            <div class="section-header">
                <div class="label" style="justify-content: center;">The Crew</div>
                <h2 class="section-title">MEET THE <span class="red">TEAM</span></h2>
                <p class="section-subtitle">The creative minds behind New Urban Influence</p>
            </div>
            <div class="team-grid">
                ${teamHTML}
            </div>
        </section>
        <section class="section" style="background: var(--red);"><div class="stats-grid"><div class="stat-item"><div class="value">50+</div><div class="stat-label">Brands Elevated</div></div><div class="stat-item"><div class="value">$2M+</div><div class="stat-label">Revenue Generated</div></div><div class="stat-item"><div class="value">100%</div><div class="stat-label">Detroit Pride</div></div><div class="stat-item"><div class="value">313</div><div class="stat-label">Area Code Strong</div></div></div></section>
        <section class="cta-section"><h2>READY TO <span>WORK</span> WITH US?</h2><p>Let's build something legendary together.</p><button class="btn-white" onclick="scrollToContact()">Book Your Strategy Call</button></section>
        <footer class="footer"><div class="footer-content"><a class="footer-logo" onclick="showView('home')"><img src="NUI.avif" alt="NUI" style="height: 40px;"></a><div class="footer-links"><a onclick="showView('services')">Services</a><a onclick="showView('portfolio')">Portfolio</a><a onclick="showView('blog')">Blog</a><a onclick="showView('about')">About</a><a onclick="showView('portal')">Client Portal</a></div><div style="color: var(--gray); font-size: 14px;">Â© 2026 New Urban Influence</div></div></footer>
    `;
}

// ==================== SERVICES VIEW ====================
function loadServicesView() {
    document.getElementById('servicesView').innerHTML = `
        <style>
            .package-section { padding: 0 0 80px 0; border-bottom: 1px solid rgba(255,255,255,0.06); }
            .package-image { position: relative; width: 100%; height: 300px; overflow: hidden; margin-bottom: 60px; }
            .package-image img { width: 100%; height: 100%; object-fit: cover; }
            .package-image::after { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(255,59,48,0.4) 0%, rgba(255,59,48,0.2) 50%, rgba(0,0,0,0.9) 100%); }
            .package-header { text-align: center; margin-bottom: 60px; }
            .package-label { font-size: 11px; color: var(--red); text-transform: uppercase; letter-spacing: 3px; font-weight: 700; margin-bottom: 16px; }
            .package-title { font-size: 42px; font-weight: 900; margin-bottom: 16px; }
            .package-subtitle { color: var(--gray); font-size: 16px; max-width: 600px; margin: 0 auto; }
            .package-price { font-size: 48px; font-weight: 900; color: var(--red); margin: 24px 0; }
            .package-price span { font-size: 18px; color: var(--gray); font-weight: 400; }

            .deliverables-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; max-width: 1200px; margin: 0 auto; }
            .deliverable-card { background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; padding: 32px; transition: all 0.3s; cursor: pointer; }
            .deliverable-card:hover { background: #fff; border-color: #fff; transform: translateY(-4px); box-shadow: 0 20px 40px rgba(255,255,255,0.1); }
            .deliverable-card:hover .deliverable-icon { color: var(--red); }
            .deliverable-card:hover .deliverable-title { color: #000; }
            .deliverable-card:hover .deliverable-desc { color: #333; }
            .deliverable-card:hover .deliverable-list li { color: #333; border-color: rgba(0,0,0,0.1); }
            .deliverable-card:hover .deliverable-list li::before { color: var(--red); }
            .deliverable-icon { font-size: 32px; margin-bottom: 20px; }
            .deliverable-title { font-size: 18px; font-weight: 800; margin-bottom: 12px; color: #fff; }
            .deliverable-desc { font-size: 13px; color: var(--gray); line-height: 1.6; margin-bottom: 20px; }
            .deliverable-list { list-style: none; padding: 0; margin: 0; }
            .deliverable-list li { font-size: 13px; color: rgba(255,255,255,0.7); padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.04); display: flex; align-items: center; gap: 10px; }
            .deliverable-list li:last-child { border-bottom: none; }
            .deliverable-list li::before { content: 'âœ“'; color: var(--red); font-weight: 700; }

            .category-section { margin-bottom: 60px; }
            .category-header { display: flex; align-items: center; gap: 16px; margin-bottom: 32px; }
            .category-icon { width: 48px; height: 48px; background: rgba(255,59,48,0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
            .category-title { font-size: 24px; font-weight: 800; }
            .category-subtitle { font-size: 13px; color: var(--gray); margin-top: 4px; }

            .items-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; }
            .item-card { background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 8px; padding: 20px; transition: all 0.3s; cursor: pointer; }
            .item-card:hover { background: #fff; border-color: #fff; transform: translateY(-2px); box-shadow: 0 10px 30px rgba(255,255,255,0.1); }
            .item-card h4 { font-size: 14px; font-weight: 700; margin-bottom: 8px; transition: color 0.3s; }
            .item-card:hover h4 { color: #000; }
            .item-card p { font-size: 12px; color: var(--gray); line-height: 1.5; transition: color 0.3s; }
            .item-card:hover p { color: #333; }

            .package-cta { text-align: center; margin-top: 48px; }
            .btn-package { background: var(--red); color: #fff; border: none; padding: 18px 48px; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
            .btn-package:hover { background: #fff; color: #000; transform: scale(1.02); }

            .comparison-table { max-width: 1000px; margin: 60px auto; }
            .comparison-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 2px; margin-bottom: 2px; }
            .comparison-cell { background: #080808; padding: 16px 20px; font-size: 13px; }
            .comparison-cell.header { background: rgba(255,59,48,0.1); font-weight: 700; text-align: center; }
            .comparison-cell.feature { color: rgba(255,255,255,0.8); }
            .comparison-cell.check { text-align: center; color: var(--red); font-size: 18px; }
            .comparison-cell.empty { text-align: center; color: rgba(255,255,255,0.2); }

            /* SERVICES PAGE MOBILE RESPONSIVE */
            @media (max-width: 768px) {
                .package-section { padding: 0 0 60px 0; }
                .package-image { height: 180px; margin-bottom: 32px; }
                .package-header { margin-bottom: 40px; padding: 0 16px; }
                .package-title { font-size: 28px !important; }
                .package-subtitle { font-size: 14px; padding: 0 8px; }
                .package-price { font-size: 36px !important; margin: 16px 0; }
                .package-price span { font-size: 14px; }

                .deliverables-grid { grid-template-columns: 1fr !important; gap: 16px; padding: 0 16px; }
                .deliverable-card { padding: 24px 20px; border-radius: 12px; }
                .deliverable-icon { font-size: 28px; margin-bottom: 16px; }
                .deliverable-title { font-size: 16px; }
                .deliverable-desc { font-size: 13px; margin-bottom: 16px; }
                .deliverable-list li { font-size: 12px; padding: 6px 0; }

                .category-section { margin-bottom: 40px; padding: 0 16px; }
                .category-header { flex-direction: column; align-items: flex-start; gap: 12px; margin-bottom: 24px; }
                .category-icon { width: 40px; height: 40px; font-size: 20px; }
                .category-title { font-size: 20px; }

                .items-grid { grid-template-columns: 1fr !important; gap: 12px; }
                .item-card { padding: 16px; }
                .item-card h4 { font-size: 14px; }
                .item-card p { font-size: 11px; }

                .package-cta { margin-top: 32px; padding: 0 16px; }
                .btn-package { width: 100%; padding: 16px 24px; font-size: 13px; }

                .comparison-table { margin: 40px 16px; overflow-x: auto; }
                .comparison-row { grid-template-columns: 1.5fr 1fr 1fr 1fr; min-width: 500px; }
                .comparison-cell { padding: 12px 8px; font-size: 11px; }
            }

            @media (max-width: 480px) {
                .package-title { font-size: 24px !important; }
                .package-price { font-size: 32px !important; }
                .deliverable-card { padding: 20px 16px; }
                .deliverable-title { font-size: 15px; }
                .category-title { font-size: 18px; }
            }
        </style>

        <section class="section dark" style="padding-top: 160px; text-align: center;">
            <h1 class="section-title">SERVICE <span class="red">PACKAGES</span></h1>
            <p class="section-subtitle">Comprehensive branding solutions designed for product-based and service-based businesses. Every deliverable comes with clear direction on how to use it.</p>
        </section>

        <!-- BRAND KIT - STARTER PACKAGE -->
        <section class="package-section" style="background: linear-gradient(180deg, #0a0a0a 0%, #050505 100%);">
            <div class="package-image">
                <img src="https://images.unsplash.com/photo-1558655146-9f40138edfeb?w=1920&q=80" alt="Brand Design">
            </div>
            <div style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
                <div class="package-header">
                    <div class="package-label">Starter Package</div>
                    <h2 class="package-title">BRAND <span class="red">KIT</span></h2>
                    <p class="package-subtitle">Everything you need to launch your brand with confidence. Logo, voice, visuals, and social presence â€” all in one complete package.</p>
                    <div class="package-price">$1,500 <span>flat rate</span></div>
                </div>

                <div class="deliverables-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="deliverable-card">
                        <div class="deliverable-icon">â—†</div>
                        <h3 class="deliverable-title">Logo Design</h3>
                        <p class="deliverable-desc">Your primary mark that represents your business everywhere.</p>
                        <ul class="deliverable-list">
                            <li>Primary Logo</li>
                            <li>Secondary Logo Variation</li>
                            <li>Icon/Mark Version</li>
                            <li>All File Formats (PNG, SVG, PDF)</li>
                        </ul>
                        <p style="font-size: 11px; color: var(--red); margin-top: 16px; font-weight: 600;">USE FOR: Business cards, website, signage, social profiles</p>
                    </div>

                    <div class="deliverable-card">
                        <div class="deliverable-icon">ðŸŽ¨</div>
                        <h3 class="deliverable-title">Color Palette & Typography</h3>
                        <p class="deliverable-desc">Strategic colors and fonts that define your visual identity.</p>
                        <ul class="deliverable-list">
                            <li>Primary & Secondary Colors</li>
                            <li>HEX, RGB, CMYK Values</li>
                            <li>Heading & Body Fonts</li>
                            <li>Font Pairing Guidelines</li>
                        </ul>
                        <p style="font-size: 11px; color: var(--red); margin-top: 16px; font-weight: 600;">USE FOR: All marketing materials, website, print</p>
                    </div>

                    <div class="deliverable-card">
                        <div class="deliverable-icon">ðŸŽ¯</div>
                        <h3 class="deliverable-title">Target Market Identifier</h3>
                        <p class="deliverable-desc">Know exactly who you're talking to and how to reach them.</p>
                        <ul class="deliverable-list">
                            <li>Ideal Customer Profile</li>
                            <li>Demographics & Psychographics</li>
                            <li>Pain Points & Desires</li>
                            <li>Where to Find Them</li>
                        </ul>
                        <p style="font-size: 11px; color: var(--red); margin-top: 16px; font-weight: 600;">USE FOR: Marketing strategy, ad targeting, content</p>
                    </div>

                    <div class="deliverable-card">
                        <div class="deliverable-icon">ðŸ—£ï¸</div>
                        <h3 class="deliverable-title">Brand Voice</h3>
                        <p class="deliverable-desc">How your brand speaks, writes, and connects with your audience.</p>
                        <ul class="deliverable-list">
                            <li>Brand Personality Traits</li>
                            <li>Tone of Voice Guidelines</li>
                            <li>Messaging Do's & Don'ts</li>
                            <li>Sample Copy Examples</li>
                        </ul>
                        <p style="font-size: 11px; color: var(--red); margin-top: 16px; font-weight: 600;">USE FOR: Social posts, website copy, emails, ads</p>
                    </div>

                    <div class="deliverable-card">
                        <div class="deliverable-icon">ðŸ“±</div>
                        <h3 class="deliverable-title">Social Media Banners</h3>
                        <p class="deliverable-desc">Professional graphics for all your social platforms.</p>
                        <ul class="deliverable-list">
                            <li>Facebook Cover</li>
                            <li>Instagram Profile & Highlight Covers</li>
                            <li>LinkedIn Banner</li>
                            <li>YouTube Channel Art</li>
                        </ul>
                        <p style="font-size: 11px; color: var(--red); margin-top: 16px; font-weight: 600;">USE FOR: Social media profiles, channel branding</p>
                    </div>

                    <div class="deliverable-card">
                        <div class="deliverable-icon">ðŸ“¸</div>
                        <h3 class="deliverable-title">Logo In Action</h3>
                        <p class="deliverable-desc">See your logo applied to real-world mockups.</p>
                        <ul class="deliverable-list">
                            <li>Business Card Mockup</li>
                            <li>Social Media Preview</li>
                            <li>Signage/Storefront Mockup</li>
                            <li>Apparel/Merch Preview</li>
                        </ul>
                        <p style="font-size: 11px; color: var(--red); margin-top: 16px; font-weight: 600;">USE FOR: Visualizing your brand, presentations, pitches</p>
                    </div>
                </div>

                <div class="package-cta">
                    <button class="btn-package" onclick="startServiceIntake('brand-kit')">Get Your Brand Kit â†’</button>
                </div>
            </div>
        </section>

        <!-- PRODUCT BUSINESS BRAND IDENTITY -->
        <section class="package-section" style="background: #050505;">
            <div class="package-image">
                <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=1920&q=80" alt="Product Branding">
            </div>
            <div style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
                <div class="package-header">
                    <div class="package-label">For Product-Based Businesses</div>
                    <h2 class="package-title">PRODUCT <span class="red">BRAND IDENTITY</span></h2>
                    <p class="package-subtitle">Complete branding system for businesses selling physical products. From packaging to retail displays, we've got you covered.</p>
                    <div class="package-price">$5,500 <span>starting at</span></div>
                </div>

                <!-- Core Brand Identity -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">â—†</div>
                        <div>
                            <h3 class="category-title">Core Brand Identity</h3>
                            <p class="category-subtitle">The foundation of your visual brand</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Logo Suite</h4>
                            <p>Primary, secondary, icon mark, and watermark versions in all formats</p>
                        </div>
                        <div class="item-card">
                            <h4>Color System</h4>
                            <p>Full palette with primary, secondary, and accent colors plus usage rules</p>
                        </div>
                        <div class="item-card">
                            <h4>Typography</h4>
                            <p>Heading, body, and accent fonts with hierarchy guidelines</p>
                        </div>
                        <div class="item-card">
                            <h4>Brand Guidelines</h4>
                            <p>Complete PDF guide on how to use all brand elements correctly</p>
                        </div>
                    </div>
                </div>

                <!-- Product Packaging & Labels -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸ“¦</div>
                        <div>
                            <h3 class="category-title">Product Packaging & Labels</h3>
                            <p class="category-subtitle">Make your product stand out on the shelf</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Product Labels</h4>
                            <p>Custom label designs for bottles, jars, boxes, and bags. Print-ready files included.</p>
                        </div>
                        <div class="item-card">
                            <h4>Packaging Design</h4>
                            <p>Box designs, mailer boxes, and product sleeves that grab attention.</p>
                        </div>
                        <div class="item-card">
                            <h4>Hang Tags</h4>
                            <p>Branded tags for apparel and products with care instructions.</p>
                        </div>
                        <div class="item-card">
                            <h4>Stickers & Seals</h4>
                            <p>Thank you stickers, brand seals, and packaging tape design.</p>
                        </div>
                    </div>
                </div>

                <!-- Print & In-Store -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸª</div>
                        <div>
                            <h3 class="category-title">Print & In-Store Design</h3>
                            <p class="category-subtitle">Dominate retail spaces and physical locations</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Posters & Signage</h4>
                            <p>Eye-catching posters for in-store displays, windows, and events.</p>
                        </div>
                        <div class="item-card">
                            <h4>Window Decals</h4>
                            <p>Storefront window graphics and promotional decals.</p>
                        </div>
                        <div class="item-card">
                            <h4>Banners & Displays</h4>
                            <p>Trade show banners, pop-up displays, and table covers.</p>
                        </div>
                        <div class="item-card">
                            <h4>Wall Murals</h4>
                            <p>Large-scale branded graphics for store interiors.</p>
                        </div>
                    </div>
                </div>

                <!-- Apparel & Merch -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸ‘•</div>
                        <div>
                            <h3 class="category-title">Apparel & Merchandise</h3>
                            <p class="category-subtitle">Turn customers into walking billboards</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>T-Shirt Designs</h4>
                            <p>Branded tees for staff uniforms or merchandise sales.</p>
                        </div>
                        <div class="item-card">
                            <h4>Hat & Cap Designs</h4>
                            <p>Embroidery-ready logo files and hat mockups.</p>
                        </div>
                        <div class="item-card">
                            <h4>Uniform Design</h4>
                            <p>Cohesive staff uniforms including aprons, polos, and jackets.</p>
                        </div>
                        <div class="item-card">
                            <h4>Tote Bags</h4>
                            <p>Branded shopping bags and reusable totes.</p>
                        </div>
                    </div>
                </div>

                <!-- Digital Marketing -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸ“±</div>
                        <div>
                            <h3 class="category-title">Digital Marketing Assets</h3>
                            <p class="category-subtitle">Everything you need to market online</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Email Templates</h4>
                            <p>Branded email headers, newsletters, and promo templates.</p>
                        </div>
                        <div class="item-card">
                            <h4>Digital Mailers</h4>
                            <p>E-blasts and digital flyers for promotions and announcements.</p>
                        </div>
                        <div class="item-card">
                            <h4>Social Media Kit</h4>
                            <p>Post templates, story templates, and profile graphics.</p>
                        </div>
                        <div class="item-card">
                            <h4>Ad Creatives</h4>
                            <p>Facebook, Instagram, and Google ad graphics in all sizes.</p>
                        </div>
                    </div>
                </div>

                <!-- Motion & Video -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸŽ¬</div>
                        <div>
                            <h3 class="category-title">Motion & Video</h3>
                            <p class="category-subtitle">Bring your brand to life</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Logo Animation</h4>
                            <p>Animated logo reveal for videos, presentations, and social.</p>
                        </div>
                        <div class="item-card">
                            <h4>Brand Commercial</h4>
                            <p>15-30 second brand video for ads and social media.</p>
                        </div>
                        <div class="item-card">
                            <h4>Product Showcase</h4>
                            <p>Motion graphics showcasing your products in action.</p>
                        </div>
                        <div class="item-card">
                            <h4>Social Reels</h4>
                            <p>Short-form video content templates for Instagram/TikTok.</p>
                        </div>
                    </div>
                </div>

                <!-- Photography -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸ“·</div>
                        <div>
                            <h3 class="category-title">Photography & Production</h3>
                            <p class="category-subtitle">Professional imagery that sells</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Product Photography</h4>
                            <p>Studio shots of your products on white and styled backgrounds.</p>
                        </div>
                        <div class="item-card">
                            <h4>Lifestyle Shoots</h4>
                            <p>Products in real-world settings showing actual usage.</p>
                        </div>
                        <div class="item-card">
                            <h4>Flat Lay Photography</h4>
                            <p>Curated overhead shots for social media and e-commerce.</p>
                        </div>
                        <div class="item-card">
                            <h4>Video Content</h4>
                            <p>Short product videos and unboxing content.</p>
                        </div>
                    </div>
                </div>

                <div class="package-cta">
                    <button class="btn-package" onclick="startServiceIntake('product-brand')">Build Your Product Brand â†’</button>
                </div>
            </div>
        </section>

        <!-- SERVICE BUSINESS BRAND IDENTITY -->
        <section class="package-section" style="background: linear-gradient(180deg, #0a0a0a 0%, #050505 100%);">
            <div class="package-image">
                <img src="https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=1920&q=80" alt="Service Branding">
            </div>
            <div style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
                <div class="package-header">
                    <div class="package-label">For Service-Based Businesses</div>
                    <h2 class="package-title">SERVICE <span class="red">BRAND IDENTITY</span></h2>
                    <p class="package-subtitle">Complete branding system for consultants, agencies, contractors, and service providers. Build trust and attract premium clients.</p>
                    <div class="package-price">$4,500 <span>starting at</span></div>
                </div>

                <!-- Core Brand Identity -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">â—†</div>
                        <div>
                            <h3 class="category-title">Core Brand Identity</h3>
                            <p class="category-subtitle">Professional foundation for your business</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Logo Suite</h4>
                            <p>Primary, secondary, and icon versions for all applications</p>
                        </div>
                        <div class="item-card">
                            <h4>Color System</h4>
                            <p>Professional palette that builds trust and recognition</p>
                        </div>
                        <div class="item-card">
                            <h4>Typography</h4>
                            <p>Font system for documents, presentations, and web</p>
                        </div>
                        <div class="item-card">
                            <h4>Brand Guidelines</h4>
                            <p>Complete usage guide for consistency across all touchpoints</p>
                        </div>
                    </div>
                </div>

                <!-- Print Collateral -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸ“„</div>
                        <div>
                            <h3 class="category-title">Print Collateral</h3>
                            <p class="category-subtitle">Professional materials that close deals</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Business Cards</h4>
                            <p>Premium card design with print-ready files and vendor recommendations.</p>
                        </div>
                        <div class="item-card">
                            <h4>Letterhead & Envelopes</h4>
                            <p>Professional stationery for proposals and correspondence.</p>
                        </div>
                        <div class="item-card">
                            <h4>Brochures & Flyers</h4>
                            <p>Service brochures and promotional flyers for events.</p>
                        </div>
                        <div class="item-card">
                            <h4>Presentation Folders</h4>
                            <p>Custom folders for client proposals and welcome packets.</p>
                        </div>
                    </div>
                </div>

                <!-- Vehicle & Signage -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸš—</div>
                        <div>
                            <h3 class="category-title">Vehicle & Outdoor Signage</h3>
                            <p class="category-subtitle">Mobile advertising that works 24/7</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Car Magnets</h4>
                            <p>Removable vehicle graphics for cars and trucks.</p>
                        </div>
                        <div class="item-card">
                            <h4>Vehicle Wraps</h4>
                            <p>Full or partial wrap designs for fleet vehicles.</p>
                        </div>
                        <div class="item-card">
                            <h4>Yard Signs</h4>
                            <p>Job site signs and promotional yard signs.</p>
                        </div>
                        <div class="item-card">
                            <h4>Building Signage</h4>
                            <p>Storefront and office signage design.</p>
                        </div>
                    </div>
                </div>

                <!-- Uniforms & Apparel -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸ‘”</div>
                        <div>
                            <h3 class="category-title">Uniforms & Apparel</h3>
                            <p class="category-subtitle">Look professional on every job</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Polo Shirts</h4>
                            <p>Embroidery-ready designs for professional staff polos.</p>
                        </div>
                        <div class="item-card">
                            <h4>Work Shirts</h4>
                            <p>Button-up and work shirt designs with logo placement.</p>
                        </div>
                        <div class="item-card">
                            <h4>Hats & Caps</h4>
                            <p>Branded headwear for team and promotional use.</p>
                        </div>
                        <div class="item-card">
                            <h4>Jackets & Outerwear</h4>
                            <p>Branded jackets and vests for field work.</p>
                        </div>
                    </div>
                </div>

                <!-- Digital Presence -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸŒ</div>
                        <div>
                            <h3 class="category-title">Digital Presence</h3>
                            <p class="category-subtitle">Dominate online and attract leads</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Website Design</h4>
                            <p>Professional website that converts visitors into clients.</p>
                        </div>
                        <div class="item-card">
                            <h4>Email Signature</h4>
                            <p>Branded email signatures for the whole team.</p>
                        </div>
                        <div class="item-card">
                            <h4>Social Media Kit</h4>
                            <p>Profile images, cover photos, and post templates.</p>
                        </div>
                        <div class="item-card">
                            <h4>Google Business Profile</h4>
                            <p>Optimized profile with branded images and posts.</p>
                        </div>
                    </div>
                </div>

                <!-- Digital Marketing -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸ“§</div>
                        <div>
                            <h3 class="category-title">Digital Marketing</h3>
                            <p class="category-subtitle">Automated systems that generate leads</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Email Templates</h4>
                            <p>Welcome sequences, newsletters, and promotional emails.</p>
                        </div>
                        <div class="item-card">
                            <h4>Digital Mailers</h4>
                            <p>E-blasts for service announcements and promotions.</p>
                        </div>
                        <div class="item-card">
                            <h4>Lead Magnets</h4>
                            <p>PDF guides, checklists, and downloads to capture leads.</p>
                        </div>
                        <div class="item-card">
                            <h4>Ad Creatives</h4>
                            <p>Facebook, Instagram, and Google ad graphics.</p>
                        </div>
                    </div>
                </div>

                <!-- Motion & Video -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸŽ¬</div>
                        <div>
                            <h3 class="category-title">Motion & Video</h3>
                            <p class="category-subtitle">Build trust with video content</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Logo Animation</h4>
                            <p>Animated logo for video intros and presentations.</p>
                        </div>
                        <div class="item-card">
                            <h4>Brand Commercial</h4>
                            <p>30-60 second company overview video.</p>
                        </div>
                        <div class="item-card">
                            <h4>Service Explainers</h4>
                            <p>Videos explaining your services and process.</p>
                        </div>
                        <div class="item-card">
                            <h4>Testimonial Videos</h4>
                            <p>Client testimonial video production and editing.</p>
                        </div>
                    </div>
                </div>

                <!-- Photography -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">ðŸ“·</div>
                        <div>
                            <h3 class="category-title">Photography & Headshots</h3>
                            <p class="category-subtitle">Professional imagery that builds trust</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Team Headshots</h4>
                            <p>Professional headshots for website and LinkedIn.</p>
                        </div>
                        <div class="item-card">
                            <h4>Office/Location Shots</h4>
                            <p>Professional photos of your workspace and team in action.</p>
                        </div>
                        <div class="item-card">
                            <h4>Project Photography</h4>
                            <p>Before/after and project completion photos.</p>
                        </div>
                        <div class="item-card">
                            <h4>Social Content</h4>
                            <p>Behind-the-scenes and day-in-the-life content.</p>
                        </div>
                    </div>
                </div>

                <div class="package-cta">
                    <button class="btn-package" onclick="startServiceIntake('service-brand')">Build Your Service Brand â†’</button>
                </div>
            </div>
        </section>

        <!-- COMPARISON TABLE -->
        <section class="section dark">
            <div style="max-width: 1000px; margin: 0 auto; padding: 0 24px;">
                <div class="package-header">
                    <div class="package-label">Compare Packages</div>
                    <h2 class="package-title">WHAT'S <span class="red">INCLUDED</span></h2>
                </div>

                <div class="comparison-table">
                    <div class="comparison-row">
                        <div class="comparison-cell header">Deliverable</div>
                        <div class="comparison-cell header">Brand Kit</div>
                        <div class="comparison-cell header">Product</div>
                        <div class="comparison-cell header">Service</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Logo Suite</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Color Palette</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Typography System</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Brand Guidelines</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Product Labels & Packaging</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell empty">â€”</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Business Cards & Stationery</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Vehicle Graphics</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Uniforms & Apparel</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Social Media Kit</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Email Templates</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Logo Animation</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Brand Commercial</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Photography Session</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-cell feature">Print Signage</div>
                        <div class="comparison-cell empty">â€”</div>
                        <div class="comparison-cell check">âœ“</div>
                        <div class="comparison-cell check">âœ“</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- WEBSITE & WEBAPP PACKAGES -->
        <section class="package-section" style="background: #050505;">
            <div class="package-image">
                <img src="https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=1920&q=80" alt="Website Development">
            </div>
            <div style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
                <div class="package-header">
                    <div class="package-label">Digital Products</div>
                    <h2 class="package-title">WEBSITE & <span class="red">WEB APPS</span></h2>
                    <p class="package-subtitle">Your digital headquarters. Built for conversion, designed to dominate.</p>
                </div>

                <div class="deliverables-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 60px;">
                    <!-- Basic Website -->
                    <div class="deliverable-card" style="border-color: rgba(255,255,255,0.1);">
                        <div style="font-size: 11px; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-weight: 700; margin-bottom: 16px;">Starter</div>
                        <h3 class="deliverable-title" style="font-size: 24px;">Landing Page</h3>
                        <div style="font-size: 32px; font-weight: 900; color: var(--red); margin: 16px 0;">$1,200</div>
                        <p class="deliverable-desc">Single page website perfect for capturing leads or launching a product.</p>
                        <ul class="deliverable-list">
                            <li>Custom Design</li>
                            <li>Mobile Responsive</li>
                            <li>Contact Form</li>
                            <li>SEO Basics</li>
                            <li>1 Week Delivery</li>
                        </ul>
                        <button class="btn-package" style="width: 100%; margin-top: 24px; padding: 14px;" onclick="startServiceIntake('landing-page')">Get Started â†’</button>
                    </div>

                    <!-- Business Website -->
                    <div class="deliverable-card" style="border-color: var(--red); position: relative;">
                        <div style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--red); color: #fff; font-size: 10px; font-weight: 700; padding: 4px 16px; border-radius: 4px; text-transform: uppercase; letter-spacing: 1px;">Most Popular</div>
                        <div style="font-size: 11px; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-weight: 700; margin-bottom: 16px;">Professional</div>
                        <h3 class="deliverable-title" style="font-size: 24px;">Business Website</h3>
                        <div style="font-size: 32px; font-weight: 900; color: var(--red); margin: 16px 0;">$3,500</div>
                        <p class="deliverable-desc">Full multi-page website for established businesses ready to dominate online.</p>
                        <ul class="deliverable-list">
                            <li>5-7 Custom Pages</li>
                            <li>CMS Integration</li>
                            <li>Blog Setup</li>
                            <li>Advanced SEO</li>
                            <li>Analytics Dashboard</li>
                            <li>Speed Optimization</li>
                            <li>2-3 Week Delivery</li>
                        </ul>
                        <button class="btn-package" style="width: 100%; margin-top: 24px; padding: 14px;" onclick="startServiceIntake('business-website')">Get Started â†’</button>
                    </div>

                    <!-- E-Commerce -->
                    <div class="deliverable-card" style="border-color: rgba(255,255,255,0.1);">
                        <div style="font-size: 11px; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-weight: 700; margin-bottom: 16px;">E-Commerce</div>
                        <h3 class="deliverable-title" style="font-size: 24px;">Online Store</h3>
                        <div style="font-size: 32px; font-weight: 900; color: var(--red); margin: 16px 0;">$5,500</div>
                        <p class="deliverable-desc">Full e-commerce solution to sell products online 24/7.</p>
                        <ul class="deliverable-list">
                            <li>Shopify / WooCommerce</li>
                            <li>Product Upload (up to 50)</li>
                            <li>Payment Integration</li>
                            <li>Shipping Setup</li>
                            <li>Abandoned Cart Recovery</li>
                            <li>Inventory Management</li>
                            <li>3-4 Week Delivery</li>
                        </ul>
                        <button class="btn-package" style="width: 100%; margin-top: 24px; padding: 14px;" onclick="startServiceIntake('ecommerce')">Get Started â†’</button>
                    </div>
                </div>

                <!-- Web App Section -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">âš¡</div>
                        <div>
                            <h3 class="category-title">Custom Web Applications</h3>
                            <p class="category-subtitle">Powerful tools built for your specific business needs</p>
                        </div>
                    </div>
                    <div class="items-grid">
                        <div class="item-card">
                            <h4>Client Portals</h4>
                            <p>Secure login areas for clients to access files, invoices, and project updates.</p>
                        </div>
                        <div class="item-card">
                            <h4>Booking Systems</h4>
                            <p>Custom appointment scheduling with calendar sync and reminders.</p>
                        </div>
                        <div class="item-card">
                            <h4>Member Dashboards</h4>
                            <p>Membership sites with content access, progress tracking, and community features.</p>
                        </div>
                        <div class="item-card">
                            <h4>Custom CRM</h4>
                            <p>Contact management and sales pipeline tools tailored to your workflow.</p>
                        </div>
                    </div>
                    <p style="text-align: center; color: var(--gray); margin-top: 32px; font-size: 14px;">Web app pricing starts at <span style="color: var(--red); font-weight: 700;">$7,500</span> â€” <a onclick="startServiceIntake('webapp')" style="color: #fff; text-decoration: underline; cursor: pointer;">Request a Quote</a></p>
                </div>
            </div>
        </section>

        <!-- MOBILE APP PACKAGES -->
        <section class="package-section" style="background: linear-gradient(180deg, #0a0a0a 0%, #050505 100%);">
            <div class="package-image">
                <img src="https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=1920&q=80" alt="Mobile App Development">
            </div>
            <div style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
                <div class="package-header">
                    <div class="package-label">Mobile Development</div>
                    <h2 class="package-title">MOBILE <span class="red">APPS</span></h2>
                    <p class="package-subtitle">Put your business in your customers' pockets. Native and cross-platform solutions.</p>
                </div>

                <div class="deliverables-grid" style="grid-template-columns: repeat(2, 1fr);">
                    <!-- MVP App -->
                    <div class="deliverable-card">
                        <div style="font-size: 11px; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-weight: 700; margin-bottom: 16px;">Launch Fast</div>
                        <h3 class="deliverable-title" style="font-size: 24px;">MVP App</h3>
                        <div style="font-size: 32px; font-weight: 900; color: var(--red); margin: 16px 0;">$12,000 <span style="font-size: 14px; color: var(--gray); font-weight: 400;">starting at</span></div>
                        <p class="deliverable-desc">Minimum viable product to test your app idea and get to market fast.</p>
                        <ul class="deliverable-list">
                            <li>Cross-Platform (iOS + Android)</li>
                            <li>Core Feature Set (3-5 features)</li>
                            <li>User Authentication</li>
                            <li>Basic Admin Panel</li>
                            <li>App Store Submission</li>
                            <li>6-8 Week Delivery</li>
                        </ul>
                        <button class="btn-package" style="width: 100%; margin-top: 24px; padding: 14px;" onclick="startServiceIntake('mvp-app')">Get Started â†’</button>
                    </div>

                    <!-- Full App -->
                    <div class="deliverable-card">
                        <div style="font-size: 11px; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-weight: 700; margin-bottom: 16px;">Full Product</div>
                        <h3 class="deliverable-title" style="font-size: 24px;">Custom Mobile App</h3>
                        <div style="font-size: 32px; font-weight: 900; color: var(--red); margin: 16px 0;">$20,000+ <span style="font-size: 14px; color: var(--gray); font-weight: 400;">custom quote</span></div>
                        <p class="deliverable-desc">Full-featured mobile application with advanced functionality and integrations.</p>
                        <ul class="deliverable-list">
                            <li>Native or Cross-Platform</li>
                            <li>Unlimited Features</li>
                            <li>Payment Integration</li>
                            <li>Push Notifications</li>
                            <li>API Integrations</li>
                            <li>Full Admin Dashboard</li>
                            <li>Ongoing Support Options</li>
                        </ul>
                        <button class="btn-package" style="width: 100%; margin-top: 24px; padding: 14px;" onclick="startServiceIntake('custom-app')">Request Quote â†’</button>
                    </div>
                </div>

                <!-- App Features -->
                <div class="category-section" style="margin-top: 60px;">
                    <div class="category-header">
                        <div class="category-icon">ðŸ“²</div>
                        <div>
                            <h3 class="category-title">Available App Features</h3>
                            <p class="category-subtitle">Build the exact functionality your business needs</p>
                        </div>
                    </div>
                    <div class="items-grid" style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));">
                        <div class="item-card"><h4>User Profiles</h4></div>
                        <div class="item-card"><h4>Social Login</h4></div>
                        <div class="item-card"><h4>Push Notifications</h4></div>
                        <div class="item-card"><h4>In-App Purchases</h4></div>
                        <div class="item-card"><h4>Booking/Scheduling</h4></div>
                        <div class="item-card"><h4>Chat & Messaging</h4></div>
                        <div class="item-card"><h4>GPS & Maps</h4></div>
                        <div class="item-card"><h4>Camera & Media</h4></div>
                        <div class="item-card"><h4>Payment Processing</h4></div>
                        <div class="item-card"><h4>Analytics Dashboard</h4></div>
                        <div class="item-card"><h4>Loyalty Programs</h4></div>
                        <div class="item-card"><h4>Offline Mode</h4></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SALES FUNNELS & AUTOMATION -->
        <section class="package-section" style="background: #050505;">
            <div class="package-image">
                <img src="https://images.unsplash.com/photo-1533750349088-cd871a92f312?w=1920&q=80" alt="Sales Funnels Marketing">
            </div>
            <div style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
                <div class="package-header">
                    <div class="package-label">Marketing Systems</div>
                    <h2 class="package-title">SALES <span class="red">FUNNELS</span></h2>
                    <p class="package-subtitle">Automated systems that turn strangers into customers while you sleep.</p>
                </div>

                <div class="deliverables-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="deliverable-card">
                        <div style="font-size: 11px; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-weight: 700; margin-bottom: 16px;">Lead Generation</div>
                        <h3 class="deliverable-title">Lead Capture Funnel</h3>
                        <div style="font-size: 32px; font-weight: 900; color: var(--red); margin: 16px 0;">$1,500</div>
                        <ul class="deliverable-list">
                            <li>Landing Page Design</li>
                            <li>Lead Magnet Creation</li>
                            <li>Thank You Page</li>
                            <li>5-Email Welcome Sequence</li>
                            <li>CRM Integration</li>
                        </ul>
                        <button class="btn-package" style="width: 100%; margin-top: 24px; padding: 14px;" onclick="startServiceIntake('lead-funnel')">Get Started â†’</button>
                    </div>

                    <div class="deliverable-card" style="border-color: var(--red);">
                        <div style="font-size: 11px; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-weight: 700; margin-bottom: 16px;">Sales Machine</div>
                        <h3 class="deliverable-title">Full Sales Funnel</h3>
                        <div style="font-size: 32px; font-weight: 900; color: var(--red); margin: 16px 0;">$3,500</div>
                        <ul class="deliverable-list">
                            <li>Multi-Step Funnel</li>
                            <li>Sales Page Design</li>
                            <li>Order/Checkout Pages</li>
                            <li>Upsell/Downsell Pages</li>
                            <li>Full Email Automation</li>
                            <li>Payment Integration</li>
                        </ul>
                        <button class="btn-package" style="width: 100%; margin-top: 24px; padding: 14px;" onclick="startServiceIntake('sales-funnel')">Get Started â†’</button>
                    </div>

                    <div class="deliverable-card">
                        <div style="font-size: 11px; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-weight: 700; margin-bottom: 16px;">Webinar</div>
                        <h3 class="deliverable-title">Webinar Funnel</h3>
                        <div style="font-size: 32px; font-weight: 900; color: var(--red); margin: 16px 0;">$4,500</div>
                        <ul class="deliverable-list">
                            <li>Registration Page</li>
                            <li>Reminder Sequences</li>
                            <li>Live/Evergreen Setup</li>
                            <li>Replay Page</li>
                            <li>Follow-Up Automation</li>
                            <li>Sales Page Integration</li>
                        </ul>
                        <button class="btn-package" style="width: 100%; margin-top: 24px; padding: 14px;" onclick="startServiceIntake('webinar-funnel')">Get Started â†’</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- BUILD YOUR OWN PACKAGE -->
        <section class="package-section" style="background: linear-gradient(180deg, #0a0a0a 0%, #080808 100%);">
            <div class="package-image">
                <img src="https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=1920&q=80" alt="Custom Package">
            </div>
            <div style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
                <div class="package-header">
                    <div class="package-label">Customize Your Solution</div>
                    <h2 class="package-title">BUILD YOUR <span class="red">OWN PACKAGE</span></h2>
                    <p class="package-subtitle">Select only the services you need. Mix and match to create the perfect solution for your business.</p>
                </div>

                <div id="customPackageBuilder" style="background: #0a0a0a; border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 40px; margin-bottom: 40px;">

                    <!-- Brand & Identity -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="font-size: 16px; font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                            <span style="width: 32px; height: 32px; background: rgba(255,59,48,0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">â—†</span>
                            Brand & Identity
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Logo Design" data-price="500"><span class="checkmark"></span><span class="service-name">Logo Design</span><span class="service-price">$500</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Color Palette" data-price="200"><span class="checkmark"></span><span class="service-name">Color Palette</span><span class="service-price">$200</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Typography System" data-price="200"><span class="checkmark"></span><span class="service-name">Typography System</span><span class="service-price">$200</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Brand Guidelines" data-price="750"><span class="checkmark"></span><span class="service-name">Brand Guidelines</span><span class="service-price">$750</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Business Cards" data-price="150"><span class="checkmark"></span><span class="service-name">Business Cards</span><span class="service-price">$150</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Letterhead & Stationery" data-price="250"><span class="checkmark"></span><span class="service-name">Letterhead & Stationery</span><span class="service-price">$250</span></label>
                        </div>
                    </div>

                    <!-- Print & Physical -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="font-size: 16px; font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                            <span style="width: 32px; height: 32px; background: rgba(255,59,48,0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">ðŸ“¦</span>
                            Print & Physical
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Product Labels" data-price="300"><span class="checkmark"></span><span class="service-name">Product Labels</span><span class="service-price">$300</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Packaging Design" data-price="500"><span class="checkmark"></span><span class="service-name">Packaging Design</span><span class="service-price">$500</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Posters & Signage" data-price="250"><span class="checkmark"></span><span class="service-name">Posters & Signage</span><span class="service-price">$250</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Window Decals" data-price="200"><span class="checkmark"></span><span class="service-name">Window Decals</span><span class="service-price">$200</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Vehicle Magnets Pair (Design+Print)" data-price="195"><span class="checkmark"></span><span class="service-name">Vehicle Magnets Pair</span><span class="service-price">$195</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Vehicle Wrap Design" data-price="800"><span class="checkmark"></span><span class="service-name">Vehicle Wrap Design</span><span class="service-price">$800</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Wall Mural Design" data-price="600"><span class="checkmark"></span><span class="service-name">Wall Mural Design</span><span class="service-price">$600</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Brochures & Flyers" data-price="200"><span class="checkmark"></span><span class="service-name">Brochures & Flyers</span><span class="service-price">$200</span></label>
                        </div>
                    </div>

                    <!-- Apparel & Merch -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="font-size: 16px; font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                            <span style="width: 32px; height: 32px; background: rgba(255,59,48,0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">ðŸ‘•</span>
                            Apparel & Merchandise
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="T-Shirt Design" data-price="150"><span class="checkmark"></span><span class="service-name">T-Shirt Design</span><span class="service-price">$150</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Hoodie Design" data-price="150"><span class="checkmark"></span><span class="service-name">Hoodie Design</span><span class="service-price">$150</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Hat/Cap Design" data-price="100"><span class="checkmark"></span><span class="service-name">Hat/Cap Design</span><span class="service-price">$100</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Uniform Design (Full Set)" data-price="400"><span class="checkmark"></span><span class="service-name">Uniform Design (Full)</span><span class="service-price">$400</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Tote Bag Design" data-price="100"><span class="checkmark"></span><span class="service-name">Tote Bag Design</span><span class="service-price">$100</span></label>
                        </div>
                    </div>

                    <!-- Digital Marketing -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="font-size: 16px; font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                            <span style="width: 32px; height: 32px; background: rgba(255,59,48,0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">ðŸ“±</span>
                            Digital Marketing
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Social Media Kit" data-price="350"><span class="checkmark"></span><span class="service-name">Social Media Kit</span><span class="service-price">$350</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Email Templates (5)" data-price="300"><span class="checkmark"></span><span class="service-name">Email Templates (5)</span><span class="service-price">$300</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Digital Mailers" data-price="150"><span class="checkmark"></span><span class="service-name">Digital Mailers</span><span class="service-price">$150</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Ad Creatives (10)" data-price="400"><span class="checkmark"></span><span class="service-name">Ad Creatives (10)</span><span class="service-price">$400</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Lead Magnet Design" data-price="250"><span class="checkmark"></span><span class="service-name">Lead Magnet Design</span><span class="service-price">$250</span></label>
                        </div>
                    </div>

                    <!-- Motion & Video -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="font-size: 16px; font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                            <span style="width: 32px; height: 32px; background: rgba(255,59,48,0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">ðŸŽ¬</span>
                            Motion & Video
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Logo Animation" data-price="400"><span class="checkmark"></span><span class="service-name">Logo Animation</span><span class="service-price">$400</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Brand Commercial (30sec)" data-price="1200"><span class="checkmark"></span><span class="service-name">Brand Commercial</span><span class="service-price">$1,200</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Social Reels (5)" data-price="500"><span class="checkmark"></span><span class="service-name">Social Reels (5)</span><span class="service-price">$500</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Motion Graphics Pack" data-price="600"><span class="checkmark"></span><span class="service-name">Motion Graphics Pack</span><span class="service-price">$600</span></label>
                        </div>
                    </div>

                    <!-- Photography -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="font-size: 16px; font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                            <span style="width: 32px; height: 32px; background: rgba(255,59,48,0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">ðŸ“·</span>
                            Photography & Production
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Product Photography (10)" data-price="400"><span class="checkmark"></span><span class="service-name">Product Photos (10)</span><span class="service-price">$400</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Headshots (5 people)" data-price="350"><span class="checkmark"></span><span class="service-name">Headshots (5 people)</span><span class="service-price">$350</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Lifestyle Photo Session" data-price="600"><span class="checkmark"></span><span class="service-name">Lifestyle Session</span><span class="service-price">$600</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Location/Office Shoot" data-price="500"><span class="checkmark"></span><span class="service-name">Location Shoot</span><span class="service-price">$500</span></label>
                        </div>
                    </div>

                    <!-- Web & Digital -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="font-size: 16px; font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                            <span style="width: 32px; height: 32px; background: rgba(255,59,48,0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center;">ðŸŒ</span>
                            Web & Digital Products
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Landing Page" data-price="1200"><span class="checkmark"></span><span class="service-name">Landing Page</span><span class="service-price">$1,200</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Business Website" data-price="3500"><span class="checkmark"></span><span class="service-name">Business Website</span><span class="service-price">$3,500</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="E-Commerce Store" data-price="5500"><span class="checkmark"></span><span class="service-name">E-Commerce Store</span><span class="service-price">$5,500</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Sales Funnel" data-price="2000"><span class="checkmark"></span><span class="service-name">Sales Funnel</span><span class="service-price">$2,000</span></label>
                            <label class="custom-service-item" onclick="toggleCustomService(event, this)"><input type="checkbox" data-service="Google Business Setup" data-price="200"><span class="checkmark"></span><span class="service-name">Google Business Setup</span><span class="service-price">$200</span></label>
                        </div>
                    </div>

                    <!-- Summary Box -->
                    <div id="customPackageSummary" style="background: #050505; border: 2px solid rgba(255,59,48,0.3); border-radius: 12px; padding: 32px; margin-top: 40px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 24px;">
                            <div>
                                <div style="font-size: 13px; color: var(--gray); margin-bottom: 8px;">Your Custom Package</div>
                                <div style="font-size: 14px; color: rgba(255,255,255,0.6);" id="selectedServicesCount">0 services selected</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 13px; color: var(--gray); margin-bottom: 8px;">Estimated Total</div>
                                <div style="font-size: 36px; font-weight: 900; color: var(--red);" id="customPackageTotal">$0</div>
                            </div>
                            <button class="btn-package" onclick="submitCustomPackage()" style="padding: 18px 48px;">Request Custom Quote â†’</button>
                        </div>
                        <div id="selectedServicesList" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid rgba(255,255,255,0.06); display: none;">
                            <div style="font-size: 12px; color: var(--gray); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px;">Selected Services:</div>
                            <div id="selectedServicesDisplay" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <style>
            .custom-service-item { display: flex; align-items: center; gap: 12px; background: #0c0c0c; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 16px 18px; cursor: pointer; transition: all 0.25s ease; }
            .custom-service-item:hover { border-color: rgba(255,255,255,0.3); background: rgba(255,255,255,0.04); transform: translateY(-2px); box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
            .custom-service-item.selected { border-color: var(--red); background: rgba(255,59,48,0.12); box-shadow: 0 0 20px rgba(255,59,48,0.2); }
            .custom-service-item.selected:hover { background: rgba(255,59,48,0.18); }
            .custom-service-item input { display: none; }
            .custom-service-item .checkmark { width: 22px; height: 22px; border: 2px solid rgba(255,255,255,0.25); border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0; }
            .custom-service-item:hover .checkmark { border-color: rgba(255,255,255,0.4); }
            .custom-service-item.selected .checkmark { background: var(--red); border-color: var(--red); }
            .custom-service-item.selected .checkmark::after { content: 'âœ“'; color: #fff; font-size: 13px; font-weight: 700; }
            .custom-service-item .service-name { flex: 1; font-size: 14px; font-weight: 600; color: rgba(255,255,255,0.95); }
            .custom-service-item .service-price { font-size: 14px; font-weight: 800; color: var(--red); }
            .custom-service-item.selected .service-name { color: #fff; }
            .selected-service-tag { background: rgba(255,59,48,0.2); border: 1px solid rgba(255,59,48,0.4); color: #fff; font-size: 11px; padding: 8px 14px; border-radius: 6px; font-weight: 600; }
        </style>

        <section class="cta-section"><h2>HAVE <span>QUESTIONS?</span></h2><p>Book a free strategy call and we'll help you figure out exactly what your business needs.</p><button class="btn-white" onclick="startServiceIntake('consultation')">Book Free Consultation</button></section>
        <footer class="footer"><div class="footer-content"><a class="footer-logo" onclick="showView('home')"><img src="NUI.avif" alt="NUI" style="height: 40px;"></a><div class="footer-links"><a onclick="showView('services')">Services</a><a onclick="showView('portfolio')">Portfolio</a><a onclick="showView('blog')">Blog</a><a onclick="showView('about')">About</a><a onclick="showView('portal')">Client Portal</a></div><div style="color: var(--gray); font-size: 14px;">Â© 2026 New Urban Influence</div></div></footer>
    `;
}

// Custom Package Builder Functions
function toggleCustomService(event, el) {
    event.preventDefault();
    event.stopPropagation();
    el.classList.toggle('selected');
    const input = el.querySelector('input');
    if (input) input.checked = el.classList.contains('selected');
    updateCustomPackageTotal();
}

function updateCustomPackageTotal() {
    const selected = document.querySelectorAll('.custom-service-item.selected');
    let total = 0;
    let services = [];
    selected.forEach(item => {
        const input = item.querySelector('input');
        total += parseInt(input.dataset.price);
        services.push(input.dataset.service);
    });
    document.getElementById('customPackageTotal').textContent = '$' + total.toLocaleString();
    document.getElementById('selectedServicesCount').textContent = selected.length + ' service' + (selected.length !== 1 ? 's' : '') + ' selected';
    const listEl = document.getElementById('selectedServicesList');
    const displayEl = document.getElementById('selectedServicesDisplay');
    if (services.length > 0) {
        listEl.style.display = 'block';
        displayEl.innerHTML = services.map(s => '<span class="selected-service-tag">' + s + '</span>').join('');
    } else {
        listEl.style.display = 'none';
    }
}

function submitCustomPackage() {
    try {
        const selected = document.querySelectorAll('.custom-service-item.selected');
        if (selected.length === 0) {
            alert('Please select at least one service to continue.');
            return;
        }
        let services = [];
        let total = 0;
        selected.forEach(item => {
            const input = item.querySelector('input');
            services.push(input.dataset.service);
            total += parseInt(input.dataset.price);
        });
        localStorage.setItem('customPackageServices', JSON.stringify(services));
        localStorage.setItem('customPackageTotal', total.toString());
        console.log('Submitting custom package:', services, total);
        startServiceIntake('custom-package');
    } catch (e) {
        console.error('Error in submitCustomPackage:', e);
        alert('Error: ' + e.message);
    }
}

// ==================== PORTFOLIO VIEW ====================
let portfolioData = JSON.parse(localStorage.getItem('nui_portfolio')) || [
    { id: 'good-cakes', name: 'Good Cakes and Bakes', tag: 'Brand Identity + Web', desc: 'Complete brand transformation for Detroit\'s favorite bakery', mission: 'To bring joy to Detroit one delicious bake at a time, crafting memories with every bite.', slogan: 'Baked with Love, Served with Soul', websiteUrl: 'https://goodcakesandbakes.com', img: 'https://images.unsplash.com/photo-1558961363-fa8fdf82db35?w=800', colors: ['#D4A574', '#2C1810', '#F5E6D3', '#8B4513'], fonts: { heading: 'Playfair Display', body: 'Lato' }, assets: { primaryLogo: 'https://images.unsplash.com/photo-1558961363-fa8fdf82db35?w=400', secondaryLogo: '', iconMark: '', mockups: [] }, results: { revenue: '+340%', traffic: '+520%', engagement: '+280%' }, testimonial: { text: 'NUI transformed our small bakery into a recognized Detroit brand. Our online orders tripled within 3 months!', author: 'Sarah Mitchell', title: 'Owner' } },
    { id: 'motor-city', name: 'Motor City Bistro', tag: 'Web Design + Marketing', desc: 'Culinary excellence meets digital sophistication', mission: 'Elevating Detroit\'s culinary scene with innovative cuisine and exceptional hospitality.', slogan: 'Where Detroit Dines Different', websiteUrl: 'https://motorcitybistro.com', img: 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800', colors: ['#1A1A2E', '#C4A35A', '#F0F0F0', '#2C2C54'], fonts: { heading: 'Cormorant Garamond', body: 'Montserrat' }, assets: { primaryLogo: 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400', secondaryLogo: '', iconMark: '', mockups: [] }, results: { revenue: '+280%', traffic: '+410%', engagement: '+190%' }, testimonial: { text: 'The website they built us is stunning. Reservations are up 200% and we\'re now booked weeks in advance.', author: 'Marcus Johnson', title: 'Executive Chef' } },
    { id: 'detroit-canvas', name: 'Detroit Canvas Co.', tag: 'Social Media + Video', desc: 'Art meets commerce with scroll-stopping content', mission: 'Empowering artists to share their vision and build sustainable creative businesses.', slogan: 'Your Art. Your Story. Your Canvas.', websiteUrl: 'https://detroitcanvas.co', img: 'https://images.unsplash.com/photo-1513364776144-60967b0f800f?w=800', colors: ['#FF6B6B', '#4ECDC4', '#1A1A1A', '#F8F8F8'], fonts: { heading: 'Bebas Neue', body: 'Open Sans' }, assets: { primaryLogo: 'https://images.unsplash.com/photo-1513364776144-60967b0f800f?w=400', secondaryLogo: '', iconMark: '', mockups: [] }, results: { revenue: '+190%', traffic: '+680%', engagement: '+450%' }, testimonial: { text: 'Our Instagram went from 2K to 50K followers. The content they create is absolutely fire.', author: 'Jamal Greene', title: 'Founder' } },
    { id: 'ascend-coaching', name: 'Ascend Coaching Group', tag: 'Funnels + Automation', desc: 'Lead generation systems that convert 24/7', mission: 'Helping entrepreneurs unlock their potential and build thriving businesses through expert coaching.', slogan: 'Rise. Lead. Succeed.', websiteUrl: 'https://ascendcoaching.com', img: 'https://images.unsplash.com/photo-1571902943202-507ec2618e8f?w=800', colors: ['#2D3436', '#00B894', '#FDFDFD', '#636E72'], fonts: { heading: 'Poppins', body: 'Inter' }, assets: { primaryLogo: 'https://images.unsplash.com/photo-1571902943202-507ec2618e8f?w=400', secondaryLogo: '', iconMark: '', mockups: [] }, results: { revenue: '+520%', traffic: '+310%', engagement: '+240%' }, testimonial: { text: 'The funnel they built generates leads while I sleep. Best investment I ever made for my business.', author: 'Sarah Chen', title: 'CEO' } }
];
function savePortfolio() { localStorage.setItem('nui_portfolio', JSON.stringify(portfolioData)); }

// ==================== ABOUT PAGE DATA ====================
let aboutData = JSON.parse(localStorage.getItem('nui_about')) || {
    storyImage: '',
    team: [
        { name: 'Faren Young', title: 'Creative Director & Founder', bio: 'Native Detroiter with 20+ years guiding businesses to success through bold design and strategic branding.', photo: '' },
        { name: 'Creative Team', title: 'Design & Development', bio: 'A network of skilled designers, developers, and strategists ready to bring your vision to life.', photo: '' },
        { name: 'You?', title: 'Join Our Team', bio: 'We\'re always looking for talented creatives who share our passion for bold design.', photo: '' }
    ]
};
function saveAbout() { localStorage.setItem('nui_about', JSON.stringify(aboutData)); }

function loadPortfolioView() {
    document.getElementById('portfolioView').innerHTML = `
        <style>
            /* PORTFOLIO CARDS GRID */
            .portfolio-cards-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 32px; margin-bottom: 60px; }
            .portfolio-preview-card { position: relative; border-radius: 24px; overflow: hidden; cursor: pointer; transition: all 0.4s ease; box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
            .portfolio-preview-card:hover { transform: translateY(-8px); box-shadow: 0 30px 80px rgba(0,0,0,0.6); }
            .portfolio-card-image { width: 100%; aspect-ratio: 16/10; object-fit: cover; display: block; }
            .portfolio-card-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.6) 40%, rgba(0,0,0,0.3) 100%); display: flex; flex-direction: column; justify-content: flex-end; padding: 32px; }
            .portfolio-card-tag { font-size: 11px; text-transform: uppercase; letter-spacing: 2px; font-weight: 600; margin-bottom: 12px; }
            .portfolio-card-title { font-size: 28px; font-weight: 800; margin-bottom: 12px; line-height: 1.2; }
            .portfolio-card-desc { font-size: 14px; color: rgba(255,255,255,0.7); line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
            .portfolio-card-btn { margin-top: 20px; display: inline-flex; align-items: center; gap: 8px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: #fff; opacity: 0; transform: translateY(10px); transition: all 0.3s; }
            .portfolio-preview-card:hover .portfolio-card-btn { opacity: 1; transform: translateY(0); }

            /* CASE STUDY EXPANDED */
            .case-study { background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 8px; margin-bottom: 32px; overflow: hidden; display: none; }
            .case-study.open { display: block; }
            .case-header { display: flex; align-items: center; justify-content: space-between; padding: 32px 40px; cursor: pointer; transition: all 0.3s; position: relative; background: rgba(0,0,0,0.4); }
            .case-header::before { display: none; }
            .case-header:hover { background: rgba(255,255,255,0.02); }
            .case-header-left { display: flex; align-items: center; gap: 24px; position: relative; z-index: 1; }
            .case-logo { width: 64px; height: 64px; border-radius: 6px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
            .case-logo img { width: 100%; height: 100%; object-fit: cover; }
            .case-info h3 { font-size: 24px; font-weight: 800; margin-bottom: 6px; letter-spacing: -0.5px; }
            .case-info .tag { background: transparent; border: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.7); font-size: 10px; padding: 4px 12px; border-radius: 4px; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 600; }
            .case-toggle { width: 40px; height: 40px; border: 1px solid rgba(255,255,255,0.15); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: all 0.3s; position: relative; z-index: 1; }
            .case-study.open .case-toggle { border-color: rgba(255,255,255,0.3); background: rgba(255,255,255,0.05); }

            @media (max-width: 968px) {
                .portfolio-cards-grid { grid-template-columns: 1fr; gap: 24px; }
                .portfolio-card-title { font-size: 22px; }
                .portfolio-card-overlay { padding: 24px; }
            }
            @media (max-width: 580px) {
                .portfolio-cards-grid { gap: 16px; }
                .portfolio-card-title { font-size: 18px; }
                .portfolio-card-desc { font-size: 12px; }
                .portfolio-card-overlay { padding: 20px; }
            }
            .case-content { max-height: 0; overflow: hidden; transition: max-height 0.8s ease; }
            .case-study.open .case-content { max-height: 8000px; }
            .case-tabs { display: flex; border-bottom: 1px solid rgba(255,255,255,0.06); padding: 0 40px; background: rgba(0,0,0,0.5); }
            .case-tab { padding: 16px 28px; font-size: 11px; font-weight: 700; color: rgba(255,255,255,0.35); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.3s; text-transform: uppercase; letter-spacing: 2px; }
            .case-tab:hover { color: rgba(255,255,255,0.6); }
            .case-tab.active { color: #fff; border-color: currentColor; }
            .case-panels { padding: 0; }
            .case-panel { display: none; animation: fadeIn 0.4s ease; }
            .case-panel.active { display: block; }
            .brand-section { margin-bottom: 56px; }
            .brand-section-title { font-size: 11px; color: var(--red); text-transform: uppercase; letter-spacing: 3px; font-weight: 700; margin-bottom: 32px; display: flex; align-items: center; gap: 12px; }
            .brand-section-title::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, rgba(255,59,48,0.3), transparent); }
            .logo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
            .logo-box { background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; padding: 0; text-align: center; transition: all 0.3s; aspect-ratio: 4/3; display: flex; flex-direction: column; overflow: hidden; }
            .logo-box:hover { border-color: rgba(255,255,255,0.12); transform: scale(1.01); }
            .logo-box-label { font-size: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 2px; padding: 12px 16px; background: rgba(0,0,0,0.9); font-weight: 600; position: absolute; bottom: 0; left: 0; right: 0; z-index: 2; }
            .logo-box-img { flex: 1; display: flex; align-items: center; justify-content: center; padding: 0; position: relative; background: #080808; }
            .logo-box-img img { width: 100%; height: 100%; object-fit: contain; padding: 20px; }
            .logo-placeholder { width: 100%; height: 100%; background: #080808; border: none; border-radius: 0; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.1); font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
            .color-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
            .color-box { aspect-ratio: 1; border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; padding: 12px; position: relative; overflow: hidden; }
            .color-box::before { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.7), transparent); }
            .color-hex { position: relative; font-size: 11px; font-weight: 700; color: #fff; letter-spacing: 1px; }
            .font-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
            .font-box { background: #fff; border: 1px solid rgba(0,0,0,0.08); border-radius: 8px; padding: 32px; }
            .font-label { font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 16px; }
            .font-name { font-size: 36px; font-weight: 700; margin-bottom: 8px; color: #000; }
            .font-sample { color: #333; font-size: 14px; line-height: 1.6; }
            .mockup-grid { display: flex; flex-direction: column; gap: 16px; }
            .mockup-row { display: grid; gap: 16px; }
            .mockup-row.full { grid-template-columns: 1fr; }
            .mockup-row.split { grid-template-columns: 1fr 1fr; }
            .mockup-box { background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; overflow: hidden; position: relative; transition: all 0.3s ease; }
            .mockup-box.wide { aspect-ratio: 16/9; }
            .mockup-box.tall { aspect-ratio: 4/5; }
            .mockup-box:hover { transform: scale(1.01); border-color: rgba(255,255,255,0.12); }
            .mockup-box img, .mockup-box video { width: 100%; height: 100%; object-fit: cover; }
            .mockup-box::after { display: none; }
            .mockup-placeholder { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: rgba(255,255,255,0.12); font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; gap: 10px; background: #080808; }
            .mockup-placeholder::before { content: '+'; width: 32px; height: 32px; border: 1px solid rgba(255,255,255,0.08); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: rgba(255,255,255,0.1); }
            .results-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
            .result-card { background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.08); border-radius: 8px; padding: 48px 32px; text-align: center; position: relative; overflow: hidden; }
            .result-card::before { display: none; }
            .result-number { font-size: 64px; font-weight: 900; position: relative; }
            .result-label { font-size: 11px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 3px; margin-top: 12px; position: relative; }
            .website-preview { border-radius: 8px; overflow: hidden; border: 1px solid rgba(255,255,255,0.08); }
            .website-preview img { width: 100%; display: block; }
            .testimonial-box { background: rgba(0,0,0,0.3); border-left: 3px solid; padding: 48px; border-radius: 0 8px 8px 0; }
            .testimonial-box p { font-size: 22px; font-style: italic; line-height: 1.7; margin-bottom: 32px; font-weight: 300; }
            .testimonial-author { display: flex; align-items: center; gap: 20px; }
            .testimonial-avatar { width: 48px; height: 48px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; }
            @media (max-width: 768px) {
                .case-study { border-radius: 6px; margin-bottom: 16px; }
                .case-header { padding: 20px; }
                .case-header-left { gap: 16px; }
                .case-logo { width: 48px; height: 48px; border-radius: 4px; }
                .case-info h3 { font-size: 16px; margin-bottom: 4px; }
                .case-info .tag { font-size: 9px; padding: 3px 8px; border-radius: 3px; }
                .case-toggle { width: 32px; height: 32px; font-size: 12px; border-radius: 4px; }
                .case-tabs { padding: 0 16px; }
                .case-tab { padding: 12px 14px; font-size: 9px; letter-spacing: 1px; }
                .brand-section { margin-bottom: 36px; }
                .brand-section-title { font-size: 9px; margin-bottom: 20px; }
                .logo-grid { grid-template-columns: 1fr !important; gap: 12px; }
                .logo-box { border-radius: 6px; aspect-ratio: 16/9; }
                .logo-box-label { font-size: 9px; padding: 10px 12px; }
                .logo-box-img img { padding: 16px; }
                .logo-placeholder { font-size: 9px; }
                .color-grid { grid-template-columns: repeat(2, 1fr) !important; gap: 8px; }
                .color-box { border-radius: 4px; }
                .color-hex { font-size: 9px; }
                .font-grid { grid-template-columns: 1fr !important; gap: 12px; }
                .font-box { padding: 20px; border-radius: 6px; }
                .font-label { font-size: 9px; }
                .font-name { font-size: 24px; }
                .font-sample { font-size: 11px; }
                .mockup-grid { gap: 12px; }
                .mockup-row.split { grid-template-columns: 1fr; gap: 12px; }
                .mockup-box { border-radius: 6px; }
                .mockup-box.tall { aspect-ratio: 16/9; }
                .mockup-placeholder { font-size: 10px; }
                .results-grid { grid-template-columns: 1fr !important; gap: 12px; }
                .result-card { padding: 24px; border-radius: 14px; }
                .result-number { font-size: 36px; }
                .result-label { font-size: 9px; letter-spacing: 2px; }
                .website-preview { border-radius: 10px; }
                .website-preview img { height: 200px; }
                .testimonial-box { padding: 24px; border-radius: 0 12px 12px 0; }
                .testimonial-box p { font-size: 16px; margin-bottom: 20px; }
                .testimonial-author { gap: 12px; }
                .testimonial-avatar { width: 40px; height: 40px; font-size: 16px; }
            }
        </style>
        <section class="section dark" style="padding-top: 160px;">
            <div class="portfolio-header" style="text-align: center; margin-bottom: 80px;">
                <div class="label" style="justify-content: center; margin-bottom: 24px;">Case Studies</div>
                <h2 class="section-title">OUR <span class="red">WORK</span></h2>
                <p class="section-subtitle" style="max-width: 600px; margin: 24px auto 0;">Explore our complete brand transformations. Click each case study to dive into the brand guide, website, results, and client testimonials.</p>
            </div>
            <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px;">
                <!-- PORTFOLIO PREVIEW CARDS -->
                <div class="portfolio-cards-grid">
                    ${portfolioData.map((p, i) => `
                        <div class="portfolio-preview-card" onclick="openPortfolioCase('${p.id}')" style="background: linear-gradient(145deg, ${p.colors[1] || '#0a0a0a'} 0%, #0a0a0a 100%); border: 1px solid ${p.colors[0]}30;">
                            <img src="${p.img}" alt="${p.name}" class="portfolio-card-image">
                            <div class="portfolio-card-overlay" style="background: linear-gradient(to top, ${p.colors[1] || '#000'}ee 0%, ${p.colors[1] || '#000'}99 30%, transparent 100%);">
                                <div class="portfolio-card-tag" style="color: ${p.colors[0]};">${p.tag}</div>
                                <div class="portfolio-card-title">${p.name}</div>
                                <div class="portfolio-card-desc">${p.desc}</div>
                                <div class="portfolio-card-btn" style="color: ${p.colors[0]};">View Case Study <span>â†’</span></div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <!-- EXPANDED CASE STUDIES -->
                ${portfolioData.map((p, i) => `
                    <div class="case-study" id="case-${p.id}">
                        <div class="case-header" onclick="toggleCase('${p.id}')">
                            <div class="case-header-left">
                                <div class="case-logo"><img src="${p.assets?.primaryLogo || p.img}" alt="${p.name}"></div>
                                <div class="case-info">
                                    <h3>${p.name}</h3>
                                    <span class="tag">${p.tag}</span>
                                </div>
                            </div>
                            <div class="case-toggle">âœ•</div>
                        </div>
                        <div class="case-content">
                            <div class="case-tabs">
                                <div class="case-tab active" onclick="switchCaseTab('${p.id}', 0, this)">Brand Guide</div>
                                <div class="case-tab" onclick="switchCaseTab('${p.id}', 1, this)">Website / Webapp</div>
                                <div class="case-tab" onclick="switchCaseTab('${p.id}', 2, this)">Results</div>
                                <div class="case-tab" onclick="switchCaseTab('${p.id}', 3, this)">Testimonial</div>
                            </div>
                            <div class="case-panels" style="padding: 0;">
                                <!-- BRAND HERO BANNER -->
                                <div class="brand-hero" style="width: 100%; min-height: 360px; background: linear-gradient(145deg, ${p.colors[1]} 0%, #050505 100%); position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; padding: 60px 40px;">
                                    <div style="position: absolute; inset: 0; background: url('${p.img}') center/cover; opacity: 0.2;"></div>
                                    <div style="position: absolute; inset: 0; background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.7) 100%);"></div>
                                    <div style="position: relative; text-align: center; z-index: 1; max-width: 100%;">
                                        <div style="font-size: 11px; text-transform: uppercase; letter-spacing: 4px; color: ${p.colors[0]}; margin-bottom: 16px; font-weight: 600;">${p.tag}</div>
                                        <h2 style="font-size: clamp(32px, 7vw, 80px); font-weight: 900; text-transform: uppercase; letter-spacing: -2px; line-height: 1;">${p.name}</h2>
                                        <p style="color: rgba(255,255,255,0.5); font-size: 15px; margin-top: 20px; max-width: 550px; margin-left: auto; margin-right: auto; line-height: 1.6;">${p.desc}</p>
                                    </div>
                                    <div style="position: absolute; bottom: 24px; left: 50%; transform: translateX(-50%); display: flex; gap: 6px;">
                                        ${p.colors.map(c => `<div style="width: 28px; height: 28px; border-radius: 4px; background: ${c}; border: 1px solid rgba(255,255,255,0.15);"></div>`).join('')}
                                    </div>
                                </div>
                                <div class="case-panel active" data-case="${p.id}" data-panel="0" style="padding: 48px; background: linear-gradient(180deg, transparent 0%, ${p.colors[1]}10 100%);">
                                    <!-- MISSION & SLOGAN -->
                                    ${(p.slogan || p.mission) ? `
                                    <div class="brand-section">
                                        <div class="brand-section-title" style="color: ${p.colors[0]};">Brand Voice</div>
                                        <div style="display: grid; grid-template-columns: ${p.slogan && p.mission ? '1fr 1fr' : '1fr'}; gap: 20px;">
                                            ${p.slogan ? `
                                            <div style="background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; padding: 32px;">
                                                <div style="font-size: 10px; color: ${p.colors[0]}; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 16px; font-weight: 600;">Slogan</div>
                                                <div style="font-size: 24px; font-weight: 700; line-height: 1.3; color: #fff;">"${p.slogan}"</div>
                                            </div>` : ''}
                                            ${p.mission ? `
                                            <div style="background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; padding: 32px;">
                                                <div style="font-size: 10px; color: ${p.colors[0]}; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 16px; font-weight: 600;">Mission Statement</div>
                                                <div style="font-size: 16px; line-height: 1.7; color: rgba(255,255,255,0.7);">${p.mission}</div>
                                            </div>` : ''}
                                        </div>
                                    </div>` : ''}
                                    <!-- LOGOS SECTION -->
                                    <div class="brand-section">
                                        <div class="brand-section-title" style="color: ${p.colors[0]};">Logo System</div>
                                        <div class="logo-grid">
                                            <div class="logo-box" style="border-color: ${p.colors[0]}20; position: relative;">
                                                <div class="logo-box-img">${p.assets?.primaryLogo ? `<img src="${p.assets.primaryLogo}" alt="Primary Logo">` : '<div class="logo-placeholder">No Logo</div>'}</div>
                                                <div class="logo-box-label" style="background: rgba(0,0,0,0.8);">Primary Logo</div>
                                            </div>
                                            <div class="logo-box" style="border-color: ${p.colors[0]}20; position: relative;">
                                                <div class="logo-box-img">${p.assets?.secondaryLogo ? `<img src="${p.assets.secondaryLogo}" alt="Secondary Logo">` : '<div class="logo-placeholder">No Logo</div>'}</div>
                                                <div class="logo-box-label" style="background: rgba(0,0,0,0.8);">Secondary Logo</div>
                                            </div>
                                            <div class="logo-box" style="border-color: ${p.colors[0]}20; position: relative;">
                                                <div class="logo-box-img">${p.assets?.iconMark ? `<img src="${p.assets.iconMark}" alt="Icon Mark">` : '<div class="logo-placeholder">No Icon</div>'}</div>
                                                <div class="logo-box-label" style="background: rgba(0,0,0,0.8);">Icon / Logo Mark</div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- COLOR PALETTE -->
                                    <div class="brand-section">
                                        <div class="brand-section-title" style="color: ${p.colors[0]};">Color Palette</div>
                                        <div class="color-grid">
                                            ${p.colors.map((c, idx) => `<div class="color-box" style="background: ${c};"><div class="color-hex">${c}</div></div>`).join('')}
                                        </div>
                                    </div>
                                    <!-- FONT SYSTEM -->
                                    <div class="brand-section">
                                        <div class="brand-section-title" style="color: ${p.colors[0]};">Font System</div>
                                        <div class="font-grid">
                                            <div class="font-box">
                                                <div class="font-label">Heading Font</div>
                                                <div class="font-name">${p.fonts?.heading || p.fonts?.[0] || 'Inter'}</div>
                                                <div class="font-sample">ABCDEFGHIJKLMNOPQRSTUVWXYZ<br>abcdefghijklmnopqrstuvwxyz<br>0123456789</div>
                                            </div>
                                            <div class="font-box">
                                                <div class="font-label">Body Font</div>
                                                <div class="font-name">${p.fonts?.body || p.fonts?.[1] || 'Inter'}</div>
                                                <div class="font-sample">The quick brown fox jumps over the lazy dog. Pack my box with five dozen liquor jugs.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- BRAND MOCKUPS -->
                                    <div class="brand-section">
                                        <div class="brand-section-title" style="color: ${p.colors[0]};">Brand Mockups</div>
                                        <div class="mockup-grid">
                                            <!-- Top 16:9 -->
                                            <div class="mockup-row full">
                                                <div class="mockup-box wide" style="border-color: ${p.colors[0]}15;">
                                                    ${p.assets?.mockups?.[0] ? (p.assets.mockups[0].includes('video') || p.assets.mockups[0].match(/\.(mp4|webm|mov|ogg)$/i) ? `<video src="${p.assets.mockups[0]}" autoplay muted loop playsinline style="width:100%;height:100%;object-fit:cover;"></video>` : `<img src="${p.assets.mockups[0]}" alt="Mockup">`) : '<div class="mockup-placeholder">Image / Video</div>'}
                                                </div>
                                            </div>
                                            <!-- Middle two 4:5 -->
                                            <div class="mockup-row split">
                                                <div class="mockup-box tall" style="border-color: ${p.colors[0]}15;">
                                                    ${p.assets?.mockups?.[1] ? (p.assets.mockups[1].includes('video') || p.assets.mockups[1].match(/\.(mp4|webm|mov|ogg)$/i) ? `<video src="${p.assets.mockups[1]}" autoplay muted loop playsinline style="width:100%;height:100%;object-fit:cover;"></video>` : `<img src="${p.assets.mockups[1]}" alt="Mockup">`) : '<div class="mockup-placeholder">Image / Video</div>'}
                                                </div>
                                                <div class="mockup-box tall" style="border-color: ${p.colors[0]}15;">
                                                    ${p.assets?.mockups?.[2] ? (p.assets.mockups[2].includes('video') || p.assets.mockups[2].match(/\.(mp4|webm|mov|ogg)$/i) ? `<video src="${p.assets.mockups[2]}" autoplay muted loop playsinline style="width:100%;height:100%;object-fit:cover;"></video>` : `<img src="${p.assets.mockups[2]}" alt="Mockup">`) : '<div class="mockup-placeholder">Image / Video</div>'}
                                                </div>
                                            </div>
                                            <!-- Bottom 16:9 -->
                                            <div class="mockup-row full">
                                                <div class="mockup-box wide" style="border-color: ${p.colors[0]}15;">
                                                    ${p.assets?.mockups?.[3] ? (p.assets.mockups[3].includes('video') || p.assets.mockups[3].match(/\.(mp4|webm|mov|ogg)$/i) ? `<video src="${p.assets.mockups[3]}" autoplay muted loop playsinline style="width:100%;height:100%;object-fit:cover;"></video>` : `<img src="${p.assets.mockups[3]}" alt="Mockup">`) : '<div class="mockup-placeholder">Image / Video</div>'}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="case-panel" data-case="${p.id}" data-panel="1" style="padding: 48px; background: linear-gradient(180deg, transparent 0%, ${p.colors[1]}10 100%);">
                                    <div class="website-preview" style="border-color: ${p.colors[0]}20; position: relative;">
                                        <img src="${p.img}" alt="${p.name} Website" style="width: 100%; height: 500px; object-fit: cover;">
                                        ${p.websiteUrl ? `<a href="${p.websiteUrl}" target="_blank" style="position: absolute; bottom: 24px; right: 24px; background: ${p.colors[0]}; color: #fff; padding: 14px 28px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">Visit Site <span style="font-size: 18px;">â†’</span></a>` : ''}
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 32px; flex-wrap: wrap; gap: 20px;">
                                        <p style="color: var(--gray); line-height: 1.8; font-size: 16px; flex: 1; min-width: 280px;">We designed and developed a fully responsive, high-converting website/webapp that captures the essence of ${p.name}. The platform features custom functionality, seamless navigation, and is optimized for both desktop and mobile users.</p>
                                        ${p.websiteUrl ? `<a href="${p.websiteUrl}" target="_blank" style="background: transparent; border: 1px solid ${p.colors[0]}; color: ${p.colors[0]}; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 13px; white-space: nowrap;">${p.websiteUrl.replace('https://', '')}</a>` : ''}
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 32px;">
                                        <div style="aspect-ratio: 4/5; background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                                            ${p.assets?.webMockups?.[0] ? (p.assets.webMockups[0].includes('video') || p.assets.webMockups[0].match(/\\.(mp4|webm|mov|ogg)$/i) ? `<video src="${p.assets.webMockups[0]}" autoplay muted loop playsinline style="width:100%;height:100%;object-fit:cover;"></video>` : `<img src="${p.assets.webMockups[0]}" alt="Web Mockup" style="width:100%;height:100%;object-fit:cover;">`) : `<div style="color: rgba(255,255,255,0.12); font-size: 14px;">Image / Video</div>`}
                                        </div>
                                        <div style="aspect-ratio: 4/5; background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                                            ${p.assets?.webMockups?.[1] ? (p.assets.webMockups[1].includes('video') || p.assets.webMockups[1].match(/\\.(mp4|webm|mov|ogg)$/i) ? `<video src="${p.assets.webMockups[1]}" autoplay muted loop playsinline style="width:100%;height:100%;object-fit:cover;"></video>` : `<img src="${p.assets.webMockups[1]}" alt="Web Mockup" style="width:100%;height:100%;object-fit:cover;">`) : `<div style="color: rgba(255,255,255,0.12); font-size: 14px;">Image / Video</div>`}
                                        </div>
                                    </div>
                                </div>
                                <div class="case-panel" data-case="${p.id}" data-panel="2" style="padding: 48px; background: linear-gradient(180deg, transparent 0%, ${p.colors[1]}10 100%);">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 48px;">
                                        <div style="background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; padding: 32px;">
                                            <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: ${p.colors[0]}; margin-bottom: 16px; font-weight: 600;">Problem</div>
                                            <p style="color: var(--gray); line-height: 1.8; font-size: 15px; margin: 0;">${p.problem || 'The client faced challenges with brand visibility, outdated digital presence, and difficulty reaching their target audience effectively.'}</p>
                                        </div>
                                        <div style="background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; padding: 32px;">
                                            <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: ${p.colors[0]}; margin-bottom: 16px; font-weight: 600;">Solution</div>
                                            <p style="color: var(--gray); line-height: 1.8; font-size: 15px; margin: 0;">${p.solution || 'We developed a comprehensive brand strategy with modern visual identity, responsive web platform, and targeted digital marketing campaigns.'}</p>
                                        </div>
                                    </div>
                                    <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: ${p.colors[0]}; margin-bottom: 24px; font-weight: 600;">Results</div>
                                    <div class="results-grid">
                                        <div class="result-card" style="border-color: ${p.colors[0]}30;"><div class="result-number" style="color: ${p.colors[0]};">${p.results.revenue}</div><div class="result-label">Revenue Growth</div></div>
                                        <div class="result-card" style="border-color: ${p.colors[0]}30;"><div class="result-number" style="color: ${p.colors[0]};">${p.results.traffic}</div><div class="result-label">Web Traffic</div></div>
                                        <div class="result-card" style="border-color: ${p.colors[0]}30;"><div class="result-number" style="color: ${p.colors[0]};">${p.results.engagement}</div><div class="result-label">Engagement</div></div>
                                    </div>
                                </div>
                                <div class="case-panel" data-case="${p.id}" data-panel="3" style="padding: 48px; background: linear-gradient(180deg, transparent 0%, ${p.colors[1]}10 100%);">
                                    <div class="testimonial-box" style="border-color: ${p.colors[0]};">
                                        <p>"${p.testimonial.text}"</p>
                                        <div class="testimonial-author">
                                            <div class="testimonial-avatar" style="background: ${p.colors[0]};">${p.testimonial.author.charAt(0)}</div>
                                            <div>
                                                <div style="font-weight: 700;">${p.testimonial.author}</div>
                                                <div style="color: var(--gray); font-size: 14px;">${p.testimonial.title}, ${p.name}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </section>
        <section class="cta-section"><h2>READY TO BE<br>OUR NEXT SUCCESS?</h2><p>Let's create something legendary together.</p><button class="btn-white" onclick="scrollToContact()">Book Your Strategy Call</button></section>
        <footer class="footer"><div class="footer-content"><a class="footer-logo" onclick="showView('home')"><img src="NUI.avif" alt="NUI" style="height: 40px;"></a><div class="footer-links"><a onclick="showView('services')">Services</a><a onclick="showView('portfolio')">Portfolio</a><a onclick="showView('blog')">Blog</a><a onclick="showView('about')">About</a><a onclick="showView('portal')">Client Portal</a></div><div style="color: var(--gray); font-size: 14px;">Â© 2026 New Urban Influence</div></div></footer>
    `;
}

function toggleCase(id) {
    const caseEl = document.getElementById('case-' + id);
    caseEl.classList.toggle('open');
    if (!caseEl.classList.contains('open')) {
        // Scroll back to the cards grid when closing
        document.querySelector('.portfolio-cards-grid').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

function openPortfolioCase(id) {
    // Close all other cases
    document.querySelectorAll('.case-study').forEach(c => c.classList.remove('open'));
    // Open the selected case
    const caseEl = document.getElementById('case-' + id);
    caseEl.classList.add('open');
    // Scroll to the case study
    setTimeout(() => {
        caseEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
}

function switchCaseTab(caseId, panelIndex, tabEl) {
    // Update tabs
    const tabs = tabEl.parentElement.querySelectorAll('.case-tab');
    tabs.forEach(t => t.classList.remove('active'));
    tabEl.classList.add('active');
    // Update panels
    const panels = document.querySelectorAll(`.case-panel[data-case="${caseId}"]`);
    panels.forEach(p => p.classList.remove('active'));
    panels[panelIndex].classList.add('active');
}

// ==================== PORTAL STYLES ====================
const portalStyles = `
<style>
.portal-login { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding-top: 80px; background: linear-gradient(135deg, #1a0a0a 0%, #000 100%); }
.login-box { max-width: 420px; width: 100%; padding: 48px; background: #111; border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; }
.login-tabs { display: flex; margin-bottom: 24px; border: 2px solid #333; border-radius: 8px; overflow: hidden; }
.login-tab { flex: 1; padding: 12px; border: none; background: #000; color: #fff; font-weight: 600; cursor: pointer; font-family: inherit; }
.login-tab.active { background: #fff; color: #000; }
.form-group { margin-bottom: 20px; }
.form-label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 8px; color: rgba(255,255,255,0.9); }
.form-input { width: 100%; padding: 14px 16px; border: 1px solid rgba(255,255,255,0.2); background: #0a0a0a; color: #fff; font-size: 15px; border-radius: 8px; font-family: inherit; }
.form-input:focus { outline: none; border-color: var(--red); box-shadow: 0 0 0 3px rgba(255,0,0,0.1); }
.form-select { width: 100%; padding: 14px 16px; border: 1px solid rgba(255,255,255,0.2); background: #0a0a0a; color: #fff; font-size: 15px; border-radius: 8px; font-family: inherit; }
.form-textarea { width: 100%; padding: 14px 16px; border: 1px solid rgba(255,255,255,0.2); background: #0a0a0a; color: #fff; font-size: 15px; border-radius: 8px; font-family: inherit; min-height: 100px; resize: vertical; }
.admin-header { background: #0a0a0a; color: #fff; padding: 16px 32px; display: flex; justify-content: space-between; align-items: center; position: fixed; top: 76px; left: 0; right: 0; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.08); }
.admin-container { display: flex; padding-top: 132px; min-height: 100vh; background: #000; }
.admin-sidebar { width: 260px; background: #0a0a0a; border-right: 1px solid rgba(255,255,255,0.06); padding: 20px 16px; position: fixed; left: 0; top: 132px; bottom: 0; overflow-y: auto; }
.admin-nav { display: flex; flex-direction: column; gap: 4px; }
.admin-nav-group { margin-bottom: 20px; }
.admin-nav-label { display: block; font-size: 10px; font-weight: 700; letter-spacing: 1.5px; color: rgba(255,255,255,0.35); padding: 8px 12px; text-transform: uppercase; }
.admin-nav-link { display: block; padding: 10px 12px; color: rgba(255,255,255,0.6); cursor: pointer; border-radius: 8px; font-weight: 500; font-size: 13px; transition: all 0.2s; }
.admin-nav-link:hover { background: rgba(255,255,255,0.05); color: #fff; }
.admin-nav-link.active { background: rgba(255,0,0,0.15); color: var(--red); }
.admin-main { flex: 1; margin-left: 260px; padding: 32px; color: #fff; background: #000; }
.admin-panel { display: none; }
.admin-panel.active { display: block; }
.panel-header { margin-bottom: 32px; }
.panel-title { font-size: 28px; font-weight: 800; margin-bottom: 8px; }
.panel-subtitle { color: rgba(255,255,255,0.5); font-size: 14px; }
.stat-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px; }
.stat-card { background: #0a0a0a; padding: 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.06); }
.stat-card .num { font-size: 36px; font-weight: 800; color: #fff; }
.stat-card .lbl { color: rgba(255,255,255,0.5); font-size: 13px; margin-top: 4px; }
.stat-card.highlight { background: linear-gradient(135deg, rgba(255,0,0,0.15) 0%, rgba(255,0,0,0.05) 100%); border-color: rgba(255,0,0,0.2); }
.stat-card.highlight .num { color: var(--red); }
.card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
.client-card { background: #0a0a0a; border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; overflow: hidden; transition: all 0.3s; }
.client-card:hover { border-color: rgba(255,0,0,0.3); transform: translateY(-4px); }
.client-card-header { height: 100px; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 48px; font-weight: 700; }
.client-card-body { padding: 24px; }
.client-card-name { font-size: 18px; font-weight: 700; margin-bottom: 4px; color: #fff; }
.client-card-meta { font-size: 13px; color: rgba(255,255,255,0.5); margin-bottom: 16px; }
.client-card-btns { display: flex; gap: 8px; }
.client-card-btns button { flex: 1; padding: 10px; border: none; cursor: pointer; border-radius: 8px; font-weight: 600; font-family: inherit; font-size: 12px; }
.order-card { background: #0a0a0a; border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; padding: 24px; margin-bottom: 16px; }
.order-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px; }
.order-title { font-size: 18px; font-weight: 700; color: #fff; }
.order-client { font-size: 13px; color: rgba(255,255,255,0.5); }
.order-status { padding: 6px 14px; border-radius: 100px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
.order-status.pending { background: rgba(245,158,11,0.2); color: #f59e0b; }
.order-status.in_progress { background: rgba(59,130,246,0.2); color: #3b82f6; }
.order-status.review { background: rgba(168,85,247,0.2); color: #a855f7; }
.order-status.delivered, .order-status.approved { background: rgba(16,185,129,0.2); color: #10b981; }
.order-status.revision { background: rgba(239,68,68,0.2); color: #ef4444; }
.order-details { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; padding: 16px 0; border-top: 1px solid rgba(255,255,255,0.06); border-bottom: 1px solid rgba(255,255,255,0.06); margin-bottom: 16px; }
.order-detail { text-align: center; }
.order-detail .val { font-size: 16px; font-weight: 700; color: #fff; }
.order-detail .lbl { font-size: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }
.progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; background: linear-gradient(90deg, var(--red) 0%, #ff6b6b 100%); transition: width 0.3s; }
.form-section { background: #0a0a0a; border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; padding: 28px; margin-bottom: 24px; }
.form-section-title { font-size: 16px; font-weight: 700; margin-bottom: 20px; color: #fff; display: flex; align-items: center; gap: 10px; }
.form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
/* Toggle Switch */
.switch { position: relative; display: inline-block; width: 50px; height: 26px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255,255,255,0.2); transition: 0.3s; }
.slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: 0.3s; }
input:checked + .slider { background-color: #2ecc71; }
input:checked + .slider:before { transform: translateX(24px); }
.slider.round { border-radius: 26px; }
.slider.round:before { border-radius: 50%; }
.category-tabs { display: flex; gap: 8px; margin-bottom: 24px; flex-wrap: wrap; }
.category-tab { padding: 10px 20px; border: 1px solid rgba(255,255,255,0.15); border-radius: 100px; background: transparent; color: rgba(255,255,255,0.7); font-size: 13px; font-weight: 600; cursor: pointer; font-family: inherit; transition: all 0.2s; }
.category-tab:hover { border-color: rgba(255,255,255,0.3); color: #fff; }
.category-tab.active { background: var(--red); color: #fff; border-color: var(--red); }
.upload-zone { border: 2px dashed rgba(255,255,255,0.2); border-radius: 16px; padding: 48px; text-align: center; cursor: pointer; transition: all 0.2s; margin-bottom: 24px; background: rgba(255,255,255,0.02); }
.upload-zone:hover { border-color: var(--red); background: rgba(255,0,0,0.05); }
.upload-zone p { color: rgba(255,255,255,0.5); margin-bottom: 8px; }
.upload-zone span { color: var(--red); font-weight: 600; }
.assets-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; }
.asset-card { background: #0a0a0a; border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; overflow: hidden; transition: all 0.2s; }
.asset-card:hover { border-color: rgba(255,0,0,0.3); }
.asset-preview { aspect-ratio: 1; background: rgba(255,255,255,0.03); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; color: rgba(255,255,255,0.2); }
.asset-preview img { width: 100%; height: 100%; object-fit: cover; }
.asset-info { padding: 14px; }
.asset-name { font-size: 13px; font-weight: 600; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #fff; }
.asset-meta { font-size: 11px; color: rgba(255,255,255,0.4); }
/* Pipeline/Kanban Styles */
.pipeline-board { display: flex; gap: 16px; overflow-x: auto; padding-bottom: 16px; }
.pipeline-column { min-width: 280px; background: #0a0a0a; border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; padding: 16px; }
.pipeline-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.06); }
.pipeline-title { font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
.pipeline-count { background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 100px; font-size: 12px; font-weight: 600; }
.pipeline-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 10px; padding: 16px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; }
.pipeline-card:hover { border-color: rgba(255,0,0,0.3); transform: translateY(-2px); }
.pipeline-card-name { font-weight: 600; margin-bottom: 4px; }
.pipeline-card-company { font-size: 12px; color: rgba(255,255,255,0.5); margin-bottom: 12px; }
.pipeline-card-value { font-size: 18px; font-weight: 700; color: var(--red); }
/* Project Tracker Styles */
.project-stages { display: flex; gap: 4px; margin-bottom: 24px; padding: 4px; background: rgba(255,255,255,0.03); border-radius: 12px; }
.project-stage { flex: 1; padding: 12px; text-align: center; font-size: 12px; font-weight: 600; border-radius: 8px; cursor: pointer; transition: all 0.2s; color: rgba(255,255,255,0.5); }
.project-stage.active { background: var(--red); color: #fff; }
.project-stage.completed { background: rgba(16,185,129,0.2); color: #10b981; }
/* Proof System Styles */
.proof-card { background: #0a0a0a; border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; overflow: hidden; margin-bottom: 20px; }
.proof-preview { aspect-ratio: 16/9; background: rgba(255,255,255,0.03); display: flex; align-items: center; justify-content: center; position: relative; }
.proof-preview img { width: 100%; height: 100%; object-fit: contain; }
.proof-actions { position: absolute; bottom: 16px; right: 16px; display: flex; gap: 8px; }
.proof-content { padding: 24px; }
.proof-title { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
.proof-meta { font-size: 13px; color: rgba(255,255,255,0.5); margin-bottom: 16px; }
.proof-comments { border-top: 1px solid rgba(255,255,255,0.06); padding-top: 16px; }
.comment { background: rgba(255,255,255,0.03); border-radius: 8px; padding: 12px; margin-bottom: 8px; }
.comment-author { font-weight: 600; font-size: 13px; margin-bottom: 4px; }
.comment-text { font-size: 13px; color: rgba(255,255,255,0.7); }
/* Buttons */
.btn-admin { padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; font-family: inherit; transition: all 0.2s; }
.btn-admin.primary { background: var(--red); color: #fff; }
.btn-admin.primary:hover { background: #cc0000; }
.btn-admin.secondary { background: rgba(255,255,255,0.1); color: #fff; }
.btn-admin.secondary:hover { background: rgba(255,255,255,0.15); }
.btn-admin.success { background: rgba(16,185,129,0.2); color: #10b981; }
.btn-admin.danger { background: rgba(239,68,68,0.2); color: #ef4444; }
/* Table Styles */
.data-table { width: 100%; border-collapse: collapse; }
.data-table th { text-align: left; padding: 14px 16px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.4); border-bottom: 1px solid rgba(255,255,255,0.06); }
.data-table td { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 14px; }
.data-table tr:hover { background: rgba(255,255,255,0.02); }
/* Image Upload Card */
.image-upload-card { background: #0a0a0a; border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; overflow: hidden; }
.image-upload-preview { aspect-ratio: 16/9; background: rgba(255,255,255,0.03); display: flex; align-items: center; justify-content: center; position: relative; }
.image-upload-preview img { width: 100%; height: 100%; object-fit: cover; }
.image-upload-preview .placeholder { color: rgba(255,255,255,0.2); font-size: 48px; }
.image-upload-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; gap: 12px; opacity: 0; transition: opacity 0.2s; }
.image-upload-card:hover .image-upload-overlay { opacity: 1; }
.image-upload-info { padding: 16px; display: flex; justify-content: space-between; align-items: center; }
.image-upload-label { font-size: 14px; font-weight: 600; }
.image-upload-hint { font-size: 12px; color: rgba(255,255,255,0.4); }
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(4px); }
.modal-overlay.active { display: flex; }
.modal { background: #111; border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
.modal-header { padding: 24px; border-bottom: 1px solid rgba(255,255,255,0.06); display: flex; justify-content: space-between; align-items: center; }
.modal-title { font-size: 20px; font-weight: 700; color: #fff; }
.modal-close { width: 36px; height: 36px; border: none; background: rgba(255,255,255,0.1); border-radius: 50%; cursor: pointer; font-size: 20px; color: #fff; }
.modal-close:hover { background: rgba(255,0,0,0.2); color: var(--red); }
.modal-body { padding: 24px; color: #fff; }
.modal-footer { padding: 24px; border-top: 1px solid rgba(255,255,255,0.06); display: flex; gap: 12px; justify-content: flex-end; }
.invoice-preview { background: #fff; border-radius: 12px; padding: 32px; color: #000; }
.invoice-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 32px; padding-bottom: 24px; border-bottom: 2px solid #000; }
.invoice-logo { font-size: 24px; font-weight: 800; color: var(--red); }
.invoice-title { font-size: 32px; font-weight: 700; text-align: right; }
.invoice-meta { font-size: 13px; color: #666; text-align: right; }
.invoice-parties { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-bottom: 32px; }
.invoice-party h4 { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
.invoice-party p { font-size: 14px; line-height: 1.6; }
.invoice-table { width: 100%; border-collapse: collapse; margin-bottom: 24px; }
.invoice-table th { text-align: left; padding: 12px; border-bottom: 2px solid #000; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
.invoice-table td { padding: 12px; border-bottom: 1px solid #e5e5e5; }
.invoice-total { text-align: right; font-size: 24px; font-weight: 700; margin-top: 16px; }
/* SEO Panel Styles */
.seo-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
.seo-card { background: #0a0a0a; border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; padding: 24px; }
.seo-card-title { font-size: 14px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
.seo-score { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; }
.seo-score-circle { width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 800; }
.seo-score-circle.good { background: rgba(16,185,129,0.2); color: #10b981; }
.seo-score-circle.medium { background: rgba(245,158,11,0.2); color: #f59e0b; }
.seo-score-circle.bad { background: rgba(239,68,68,0.2); color: #ef4444; }
.faq-item { background: rgba(255,255,255,0.03); border-radius: 12px; padding: 16px; margin-bottom: 12px; }
.faq-question { font-weight: 600; margin-bottom: 8px; }
.faq-answer { font-size: 13px; color: rgba(255,255,255,0.6); }
/* Tags Input */
.tags-input { display: flex; flex-wrap: wrap; gap: 8px; padding: 12px; background: #0a0a0a; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; min-height: 50px; }
.tag { display: inline-flex; align-items: center; gap: 6px; background: rgba(255,0,0,0.15); color: var(--red); padding: 6px 12px; border-radius: 100px; font-size: 12px; font-weight: 600; }
.tag-remove { cursor: pointer; opacity: 0.7; }
.tag-remove:hover { opacity: 1; }
.tags-input input { flex: 1; min-width: 120px; border: none; background: transparent; color: #fff; font-size: 14px; outline: none; }
@media (max-width: 968px) {
    .admin-sidebar { display: none; }
    .admin-main { margin-left: 0; padding: 20px; }
    .stat-cards { grid-template-columns: repeat(2, 1fr); }
    .form-row { grid-template-columns: 1fr; }
    .order-details { grid-template-columns: repeat(2, 1fr); }
    .seo-grid { grid-template-columns: 1fr; }
    .pipeline-board { flex-direction: column; }
    .pipeline-column { min-width: 100%; }
}

/* Timer Button Styles */
.timer-btn { transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; }
.timer-btn:hover { transform: scale(1.1); }
.timer-btn.active { animation: pulse-timer 1.5s infinite; }
@keyframes pulse-timer {
    0%, 100% { box-shadow: 0 0 0 0 rgba(230, 57, 70, 0.4); }
    50% { box-shadow: 0 0 0 8px rgba(230, 57, 70, 0); }
}

/* Stats Grid Enhancement */
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 24px; }
.stat-card { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.06); }
.stat-label { font-size: 12px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
.stat-value { font-size: 28px; font-weight: 700; color: #fff; }

/* Invoice Animation */
.invoice-line-item { animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

/* Payment Progress Bar */
.payment-progress { display: flex; gap: 4px; margin-top: 8px; }
.payment-progress-segment { height: 6px; border-radius: 3px; transition: all 0.3s ease; }
.payment-progress-segment.paid { background: #2a9d8f; }
.payment-progress-segment.pending { background: rgba(255,255,255,0.1); }

/* Smooth scrollbar for modals */
.modal-body::-webkit-scrollbar { width: 6px; }
.modal-body::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 3px; }
.modal-body::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
.modal-body::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }
</style>
`;

// ==================== BLOG VIEW ====================
const blogPosts = [
    {
        id: 1,
        slug: 'why-ai-logo-design-will-destroy-your-brand',
        title: 'Why AI Logo Design Will Destroy Your Brand (And What Smart Business Owners Do Instead)',
        excerpt: 'That $20 AI logo might seem like a deal, but it\'s actually costing you thousands in lost revenue. Here\'s the truth about AI design tools.',
        category: 'Branding',
        image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'January 28, 2026',
        readTime: '8 min read',
        content: `
            <p class="blog-lead">Every week, I get calls from business owners who "saved money" with an AI logo generator. Six months later, they're rebranding because customers don't take them seriously. Let me save you from becoming another cautionary tale.</p>

            <h2>The AI Logo Trap</h2>
            <p>Here's what the AI logo generators don't tell you: They're trained on existing logos. Which means your "unique" logo is actually a Frankenstein mashup of designs that already exist. You might be one cease-and-desist letter away from a complete rebrand.</p>

            <p>I've seen it happen. A Detroit restaurant owner came to me after getting a legal notice that their AI-generated logo was too similar to a national chain. Cost them $15,000 in legal fees and emergency rebranding. That "$50 AI logo" ended up costing more than my premium package.</p>

            <h2>What AI Can't Do</h2>
            <p>AI doesn't understand your story. It can't capture the 3 AM moments that led you to start your business. It doesn't know your grandmother's recipe that inspired your menu, or the Detroit neighborhood that shaped who you are.</p>

            <p>A real brand strategist asks questions AI never will:</p>
            <ul>
                <li>What emotion do you want customers to feel?</li>
                <li>Who are your competitors and how do we differentiate?</li>
                <li>What's your 5-year vision?</li>
                <li>What story does your brand need to tell?</li>
            </ul>

            <h2>The Smart Money Move</h2>
            <p>Invest in professional branding once. It costs more upfront but pays dividends forever. Nike didn't become Nike with a $20 logo. Apple didn't build a trillion-dollar company on clip art.</p>

            <p>Your brand is the single most valuable asset you'll ever own. Treat it that way.</p>

            <div class="blog-cta">
                <h3>Ready to Build a Brand That Actually Works?</h3>
                <p>Let's create something that makes your competition nervous.</p>
                <a onclick="showView('services')" class="btn-cta">View Our Brand Packages</a>
            </div>
        `
    },
    {
        id: 2,
        slug: 'emyth-revisited-lessons-for-detroit-entrepreneurs',
        title: 'The E-Myth Revisited: 5 Lessons Every Detroit Entrepreneur Needs to Hear',
        excerpt: 'Michael Gerber\'s classic business book changed how I run my agency. Here are the game-changing insights that apply to every small business owner.',
        category: 'Business Strategy',
        image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'January 21, 2026',
        readTime: '10 min read',
        content: `
            <p class="blog-lead">If you haven't read "The E-Myth Revisited" by Michael Gerber, stop everything and order it today. This book single-handedly transformed how I think about business â€” and it'll do the same for you.</p>

            <h2>Lesson 1: You're Not Just a Technician</h2>
            <p>Gerber's biggest insight: Most businesses are started by technicians who are good at their craft but have no idea how to run a business. A great chef opens a restaurant. A talented designer starts an agency. Sound familiar?</p>

            <p>The problem? Being good at making food doesn't mean you're good at managing inventory, marketing, hiring, or financial planning. You need to develop three personalities: The Technician (does the work), The Manager (creates systems), and The Entrepreneur (builds the vision).</p>

            <h2>Lesson 2: Work ON Your Business, Not IN It</h2>
            <p>This is the one that hit me like a truck. I was working 80-hour weeks doing client work, but my business wasn't growing. Why? Because I never stepped back to build systems, create processes, or plan for scale.</p>

            <p>Your business should be able to run without you grinding 24/7. If it can't, you don't have a business â€” you have a job you created for yourself.</p>

            <h2>Lesson 3: The Franchise Prototype</h2>
            <p>Gerber asks: "Could you franchise your business?" Not because you should, but because the question forces you to create documented systems for everything. Every process should be so clear that anyone could follow it.</p>

            <h2>Lesson 4: Your Business is a Product</h2>
            <p>Mind-blowing concept: Your business itself is the product, not just what you sell. You're building something that creates value independent of your daily involvement.</p>

            <h2>Lesson 5: Start With the End in Mind</h2>
            <p>What do you want your business to look like in 10 years? If you can't answer that clearly, you're building randomly. Every decision should move you toward that vision.</p>

            <div class="blog-cta">
                <h3>Need a Brand That Supports Your Vision?</h3>
                <p>Let's build something that grows with your business.</p>
                <a onclick="showView('services')" class="btn-cta">Explore Brand Packages</a>
            </div>
        `
    },
    {
        id: 3,
        slug: 'how-nike-built-brand-empire',
        title: 'How Nike Built a $50 Billion Brand (And What Small Businesses Can Steal)',
        excerpt: 'Nike didn\'t become Nike by accident. Here\'s the branding playbook they used â€” and how you can apply the same principles to your business.',
        category: 'Brand Strategy',
        image: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'January 14, 2026',
        readTime: '12 min read',
        content: `
            <p class="blog-lead">Nike sells shoes. So does Payless. But Nike is worth $50 billion while Payless went bankrupt. The difference isn't the product â€” it's the brand. Let's break down exactly what Nike does differently.</p>

            <h2>They Sell Identity, Not Products</h2>
            <p>Nike doesn't sell running shoes. They sell the identity of being an athlete. "Just Do It" isn't about footwear â€” it's about who you become when you push past your limits.</p>

            <p>Ask yourself: What identity are you selling? If your answer is "quality products at fair prices," you're already losing. That's a feature, not an identity.</p>

            <h2>Emotional Storytelling Over Features</h2>
            <p>When's the last time you saw a Nike ad talking about "breathable mesh uppers" or "responsive foam technology"? They don't lead with specs â€” they lead with stories.</p>

            <p>Colin Kaepernick. Serena Williams. The kid from Detroit who became a champion. Nike tells stories that make you FEEL something. Your brand should do the same.</p>

            <h2>Consistent Visual Identity Everywhere</h2>
            <p>The Swoosh looks the same on a billboard in Tokyo as it does on a shoe tag in Detroit. That consistency builds recognition and trust. Every touchpoint reinforces the brand.</p>

            <p>Is your Instagram consistent with your website? Does your business card match your storefront? Every inconsistency costs you credibility.</p>

            <h2>Premium Positioning</h2>
            <p>Nike charges more because they've earned the right to. But here's the secret: the premium positioning came BEFORE the premium prices. They built the brand first, then raised prices.</p>

            <h2>What You Can Steal Today</h2>
            <ul>
                <li>Define the identity you're selling (not just the product)</li>
                <li>Lead with emotion, support with logic</li>
                <li>Audit every touchpoint for consistency</li>
                <li>Position premium before pricing premium</li>
            </ul>

            <div class="blog-cta">
                <h3>Ready to Build a Brand Like the Big Players?</h3>
                <p>Let's create something that commands attention and premium prices.</p>
                <a onclick="showView('services')" class="btn-cta">Start Your Brand Journey</a>
            </div>
        `
    },
    {
        id: 4,
        slug: 'chris-do-futur-lessons-creative-business',
        title: 'What Chris Do and The Futur Taught Me About Running a Creative Business',
        excerpt: 'The Futur YouTube channel is a goldmine for creative entrepreneurs. Here are the biggest lessons that transformed my agency.',
        category: 'Business Growth',
        image: 'https://images.unsplash.com/photo-1552664730-d307ca884978?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'January 7, 2026',
        readTime: '9 min read',
        content: `
            <p class="blog-lead">If you run a creative business and you're not watching The Futur, you're leaving money on the table. Chris Do's content has completely changed how I price, sell, and position my agency.</p>

            <h2>Value-Based Pricing Changed Everything</h2>
            <p>The Futur's biggest lesson: Stop charging for time, start charging for value. A logo that helps a company make an extra $500K is worth way more than the 20 hours it took to design.</p>

            <p>When I switched to value-based pricing, my average project went from $1,500 to $4,500. Same work. Different conversation.</p>

            <h2>The Discovery Call Framework</h2>
            <p>Chris Do's approach to sales calls is pure gold. Instead of pitching, you're asking questions. Instead of convincing, you're qualifying. The client sells themselves on working with you.</p>

            <p>Key questions I now ask every prospect:</p>
            <ul>
                <li>"What happens if you don't solve this problem?"</li>
                <li>"What would success look like for this project?"</li>
                <li>"What's the cost of staying where you are?"</li>
            </ul>

            <h2>Positioning as an Expert</h2>
            <p>Stop being a "vendor" and become a "strategic partner." The Futur taught me to speak the language of business outcomes, not creative deliverables.</p>

            <p>I don't sell "logo design" anymore. I sell "brand positioning that attracts premium customers." Same service, different value perception.</p>

            <h2>Saying No to Bad Clients</h2>
            <p>Not every dollar is a good dollar. The Futur community helped me realize that bad clients cost more than they pay. Now I have a qualification process that filters for fit.</p>

            <div class="blog-cta">
                <h3>Want to Work With an Agency That Gets Business?</h3>
                <p>We speak your language and focus on results.</p>
                <a onclick="scrollToContact()" class="btn-cta">Book a Strategy Call</a>
            </div>
        `
    },
    {
        id: 5,
        slug: 'automation-ai-small-business-guide',
        title: 'AI and Automation: How Smart Small Businesses Are Winning in 2026',
        excerpt: 'AI isn\'t replacing businesses â€” it\'s amplifying the ones that use it right. Here\'s how to leverage automation without losing your soul.',
        category: 'Technology',
        image: 'https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'December 30, 2025',
        readTime: '11 min read',
        content: `
            <p class="blog-lead">AI is the most overhyped AND underhyped technology of our generation. It won't replace you, but someone using AI might. Here's how to stay on the right side of that equation.</p>

            <h2>Where AI Actually Helps</h2>
            <p>Let's be real: AI is incredible for certain tasks. Email automation, appointment scheduling, data analysis, content repurposing, customer service bots â€” these are legitimate time-savers.</p>

            <p>I use AI tools for:</p>
            <ul>
                <li>Scheduling and calendar management</li>
                <li>First-draft email responses</li>
                <li>Social media scheduling</li>
                <li>Data analysis and reporting</li>
                <li>Research and competitive analysis</li>
            </ul>

            <h2>Where AI Falls Short</h2>
            <p>Strategy. Creativity. Emotional intelligence. Understanding context. Building relationships. These are still human domains, and they're where the real value lives.</p>

            <p>AI can write a blog post, but can it understand what your specific audience needs to hear right now? Can it capture your brand voice in a way that feels authentic? Not really.</p>

            <h2>The Winning Formula</h2>
            <p>Use AI to handle the 80% of tasks that are repetitive and time-consuming. Then invest that saved time into the 20% that actually moves the needle: strategy, relationships, and creative problem-solving.</p>

            <h2>Automation Stack for Small Businesses</h2>
            <ul>
                <li><strong>CRM:</strong> Automate follow-ups and lead nurturing</li>
                <li><strong>Email Marketing:</strong> Sequences that run while you sleep</li>
                <li><strong>Social Media:</strong> Schedule content in batches</li>
                <li><strong>Invoicing:</strong> Automatic payment reminders</li>
                <li><strong>Booking:</strong> Calendly or similar for appointments</li>
            </ul>

            <div class="blog-cta">
                <h3>Need a Website That Works While You Sleep?</h3>
                <p>We build automated systems that turn visitors into customers.</p>
                <a onclick="showView('services')" class="btn-cta">See Our Web Packages</a>
            </div>
        `
    },
    {
        id: 6,
        slug: 'website-not-converting-seven-fixes',
        title: 'Your Website Isn\'t Converting. Here Are 7 Fixes That Actually Work.',
        excerpt: 'Getting traffic but no sales? Your website has a conversion problem. Here\'s exactly how to fix it.',
        category: 'Web Design',
        image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'December 23, 2025',
        readTime: '7 min read',
        content: `
            <p class="blog-lead">"I'm getting traffic but no one's buying." I hear this every week. The problem isn't your product or your traffic â€” it's your website. Here are the fixes that work.</p>

            <h2>1. Your Headline Doesn't Speak to Pain</h2>
            <p>Most websites lead with "Welcome to [Business Name]!" No one cares. Lead with the problem you solve or the transformation you provide.</p>
            <p><strong>Bad:</strong> "Welcome to Smith's Accounting Services"</p>
            <p><strong>Good:</strong> "Stop Leaving Money on the Table at Tax Time"</p>

            <h2>2. Too Many Choices</h2>
            <p>When you give visitors 10 options, they choose none. Guide them to ONE clear action. What's the most important thing you want them to do? Make that obvious.</p>

            <h2>3. No Social Proof</h2>
            <p>People trust other people more than they trust you. Reviews, testimonials, case studies, logos of clients you've worked with â€” these build credibility fast.</p>

            <h2>4. Slow Load Time</h2>
            <p>Every second of load time costs you 7% of conversions. Test your site speed and optimize those images.</p>

            <h2>5. Weak Call-to-Action</h2>
            <p>"Submit" and "Learn More" are boring. Try "Get My Free Quote" or "Start Making Money." Action-oriented, benefit-driven CTAs convert.</p>

            <h2>6. No Urgency</h2>
            <p>Why should they act now instead of later? Limited-time offers, scarcity, and clear deadlines drive action.</p>

            <h2>7. Mobile Experience Sucks</h2>
            <p>60%+ of your traffic is on mobile. If your site isn't flawless on a phone, you're losing more than half your potential customers.</p>

            <div class="blog-cta">
                <h3>Ready for a Website That Actually Converts?</h3>
                <p>We build sites that turn visitors into customers.</p>
                <a onclick="showView('services')" class="btn-cta">See Website Packages</a>
            </div>
        `
    },
    {
        id: 7,
        slug: 'richest-man-in-babylon-wealth-lessons',
        title: 'The Richest Man in Babylon: Timeless Wealth Lessons for Modern Entrepreneurs',
        excerpt: 'This 1926 classic still holds the secrets to building wealth. Here\'s how to apply ancient Babylonian wisdom to your business today.',
        category: 'Business Strategy',
        image: 'https://images.unsplash.com/photo-1579621970563-ebec7560ff3e?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'December 16, 2025',
        readTime: '11 min read',
        content: `
            <p class="blog-lead">"The Richest Man in Babylon" by George S. Clason was written nearly 100 years ago, but its wisdom about wealth-building is more relevant than ever. If you run a business and haven't read it, you're missing foundational knowledge.</p>

            <h2>Pay Yourself First (The 10% Rule)</h2>
            <p>Arkad, the richest man in Babylon, built his fortune with one simple rule: "A part of all you earn is yours to keep." Before you pay rent, before you pay employees, before you buy that new equipment â€” pay yourself first.</p>

            <p>Most business owners pay themselves last. They take whatever's "left over" after expenses. That's backwards. Set aside at least 10% of every dollar that comes into your business for wealth-building. This isn't optional â€” it's how fortunes are made.</p>

            <h2>Make Your Money Work For You</h2>
            <p>The Babylonians called this "putting your gold to work." Today we call it investing. But the principle is identical: money sitting idle is money wasted.</p>

            <p>For business owners, this means:</p>
            <ul>
                <li>Reinvesting profits into growth</li>
                <li>Building assets that generate passive income</li>
                <li>Creating systems that work without you</li>
                <li>Investing in education and skills</li>
            </ul>

            <h2>Guard Your Wealth From Loss</h2>
            <p>"Guard thy treasures from loss by investing only where thy principal is safe." The Babylonians knew that getting rich slowly beats getting poor quickly.</p>

            <p>Don't chase every shiny opportunity. Don't invest in things you don't understand. The first rule of wealth is: don't lose what you already have.</p>

            <h2>Invest in Yourself</h2>
            <p>"The more wisdom we know, the more we may earn." Your greatest investment is always your own skills and knowledge. A better brand strategist, a better salesperson, a better leader â€” these compound over decades.</p>

            <h2>Take Action</h2>
            <p>"Wealth, like a tree, grows from a tiny seed." You can't think your way to wealth. You have to plant seeds and nurture them. Start with what you have, where you are.</p>

            <div class="blog-cta">
                <h3>Ready to Invest in Your Brand?</h3>
                <p>Your brand is an asset that appreciates over time.</p>
                <a onclick="showView('services')" class="btn-cta">Build Your Brand Asset</a>
            </div>
        `
    },
    {
        id: 8,
        slug: 'what-logo-design-actually-does',
        title: 'What Your Logo Is Actually For (And What It Can\'t Do)',
        excerpt: 'Your logo isn\'t going to save your business. But used correctly, it\'s one of your most powerful tools. Here\'s the truth about logo design.',
        category: 'Branding',
        image: 'https://images.unsplash.com/photo-1626785774625-ddcddc3445e9?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'December 9, 2025',
        readTime: '8 min read',
        content: `
            <p class="blog-lead">I've had clients tell me they need a "better logo" to fix their struggling business. That's like saying you need better business cards to get more customers. Let's talk about what logos actually do â€” and don't do.</p>

            <h2>What Your Logo IS For</h2>

            <h3>1. Recognition & Memory</h3>
            <p>Your logo is a visual shortcut. When someone sees the Nike swoosh, they don't need to read "Nike" â€” they already know. That instant recognition takes years to build, but it's incredibly valuable.</p>

            <h3>2. Professionalism & Trust</h3>
            <p>A polished logo signals that you're a legitimate operation. It's the difference between a handwritten sign and a professional storefront. First impressions matter.</p>

            <h3>3. Consistency Across Touchpoints</h3>
            <p>Your logo anchors your visual identity. It appears on your website, business cards, social media, packaging, signage, invoices â€” everywhere. It creates cohesion.</p>

            <h3>4. Differentiation</h3>
            <p>In a sea of competitors, your logo helps you stand out. It's a visual stake in the ground that says "this is who we are."</p>

            <h2>What Your Logo CAN'T Do</h2>

            <h3>It Can't Fix a Bad Product</h3>
            <p>No amount of good design will save a product or service people don't want. Your logo is packaging, not the product itself.</p>

            <h3>It Can't Replace Marketing</h3>
            <p>A logo sitting on your computer does nothing. You need to get it in front of people consistently over time.</p>

            <h3>It Can't Communicate Everything</h3>
            <p>Your logo doesn't need to show what you do. Apple's logo isn't a computer. Nike's isn't a shoe. The meaning comes from the experiences people have with your brand.</p>

            <h2>Where to Use Your Logo</h2>
            <ul>
                <li><strong>Primary:</strong> Website header, business cards, email signature</li>
                <li><strong>Social:</strong> Profile pictures, cover images, watermarks</li>
                <li><strong>Physical:</strong> Signage, packaging, uniforms, vehicles</li>
                <li><strong>Documents:</strong> Invoices, proposals, presentations</li>
            </ul>

            <div class="blog-cta">
                <h3>Need a Logo That Works Everywhere?</h3>
                <p>We create versatile logos built for real-world use.</p>
                <a onclick="showView('services')" class="btn-cta">View Logo Packages</a>
            </div>
        `
    },
    {
        id: 9,
        slug: 'brand-assets-attention-guide',
        title: '10 Ways to Use Your Brand Assets to Grab Attention (That Most Businesses Miss)',
        excerpt: 'You paid for brand assets. Now make them work. Here\'s how to leverage your logo, colors, and visual identity to stand out everywhere.',
        category: 'Brand Strategy',
        image: 'https://images.unsplash.com/photo-1561070791-2526d30994b5?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'December 2, 2025',
        readTime: '9 min read',
        content: `
            <p class="blog-lead">Most businesses get their brand done and then... nothing. The logo sits on their website. The colors show up sometimes. The fonts are "whatever's available." Here's how to actually USE your brand assets to get attention.</p>

            <h2>1. Own Your Color</h2>
            <p>Coca-Cola red. Tiffany blue. T-Mobile magenta. These brands OWN their colors because they use them obsessively, consistently, everywhere. Pick your primary brand color and make it impossible to miss.</p>

            <h2>2. Create Social Media Templates</h2>
            <p>Every post should be instantly recognizable as yours. Create templates in your brand colors with your fonts. When someone's scrolling, your content should pop.</p>

            <h2>3. Brand Your Physical Space</h2>
            <p>If you have a storefront, office, or vehicle â€” brand it. Wall graphics, window decals, vehicle wraps. Turn every physical touchpoint into a billboard.</p>

            <h2>4. Watermark Everything</h2>
            <p>Your photos, videos, graphics â€” add a subtle watermark. When your content gets shared, your brand goes with it.</p>

            <h2>5. Consistent Email Signatures</h2>
            <p>Every email your team sends is a brand touchpoint. Professional email signatures with your logo, colors, and social links. Multiply that by hundreds of emails per week.</p>

            <h2>6. Branded Packaging</h2>
            <p>If you ship products, your packaging IS marketing. Custom boxes, branded tape, tissue paper in your colors, thank you cards. Create an unboxing experience.</p>

            <h2>7. Presentation Templates</h2>
            <p>Sales decks, proposals, reports â€” all in your brand. Professional, consistent, memorable.</p>

            <h2>8. Branded Swag That People Actually Want</h2>
            <p>Skip the cheap pens. Create merchandise people WANT to wear and use. Quality hoodies, useful notebooks, premium stickers. Walking billboards.</p>

            <h2>9. Video Intros & Outros</h2>
            <p>If you create video content, branded intros and outros build recognition. Even a simple logo animation makes a difference.</p>

            <h2>10. Consistent Photo Style</h2>
            <p>Define a photo editing style â€” color grading, filters, composition rules. Your photos should look like they belong together.</p>

            <div class="blog-cta">
                <h3>Need Brand Assets That Actually Work?</h3>
                <p>We create complete brand systems designed for real-world use.</p>
                <a onclick="showView('services')" class="btn-cta">Explore Brand Packages</a>
            </div>
        `
    },
    {
        id: 10,
        slug: 'psychology-of-color-branding',
        title: 'The Psychology of Color in Branding: What Your Colors Are Saying',
        excerpt: 'Colors aren\'t just aesthetic choices â€” they trigger emotions and associations. Here\'s how to choose colors that work for your brand.',
        category: 'Branding',
        image: 'https://images.unsplash.com/photo-1525909002-1b05e0c869d8?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'November 25, 2025',
        readTime: '10 min read',
        content: `
            <p class="blog-lead">Color is one of the most powerful tools in branding, yet most businesses choose colors because they "look nice." Here's the science behind color psychology and how to use it strategically.</p>

            <h2>Red: Energy, Urgency, Passion</h2>
            <p>Red increases heart rate and creates urgency. That's why sale signs are red. It's bold, attention-grabbing, and emotional. Use it for brands that want to feel energetic, passionate, or urgent.</p>
            <p><strong>Brands using red:</strong> Coca-Cola, Netflix, YouTube, Target</p>

            <h2>Blue: Trust, Stability, Professionalism</h2>
            <p>Blue is the most universally liked color. It communicates reliability and trustworthiness. That's why banks, tech companies, and healthcare brands love it.</p>
            <p><strong>Brands using blue:</strong> Facebook, IBM, American Express, Ford</p>

            <h2>Yellow: Optimism, Clarity, Warmth</h2>
            <p>Yellow grabs attention and communicates cheerfulness. It's energizing without being aggressive. Great for brands that want to feel approachable and positive.</p>
            <p><strong>Brands using yellow:</strong> McDonald's, IKEA, Snapchat, Best Buy</p>

            <h2>Green: Growth, Health, Nature</h2>
            <p>Green signals growth, health, and environmental consciousness. It's calming and associated with wealth (money is green). Perfect for wellness, finance, and eco-brands.</p>
            <p><strong>Brands using green:</strong> Whole Foods, Starbucks, Spotify, John Deere</p>

            <h2>Black: Luxury, Sophistication, Power</h2>
            <p>Black is timeless and premium. It communicates exclusivity and elegance. High-end fashion and luxury brands lean into black heavily.</p>
            <p><strong>Brands using black:</strong> Chanel, Nike, Uber, Apple</p>

            <h2>Orange: Creativity, Adventure, Friendliness</h2>
            <p>Orange combines red's energy with yellow's friendliness. It's playful and creative without being aggressive.</p>
            <p><strong>Brands using orange:</strong> Nickelodeon, Fanta, Harley-Davidson, Amazon</p>

            <h2>Choosing Your Brand Colors</h2>
            <ul>
                <li>Consider your industry expectations</li>
                <li>Think about the emotions you want to evoke</li>
                <li>Look at what competitors are using (then differentiate)</li>
                <li>Test across different applications</li>
                <li>Ensure accessibility and contrast</li>
            </ul>

            <div class="blog-cta">
                <h3>Need Help Choosing the Right Colors?</h3>
                <p>We create strategic color palettes based on psychology and positioning.</p>
                <a onclick="showView('services')" class="btn-cta">Get Your Brand Kit</a>
            </div>
        `
    },
    {
        id: 11,
        slug: 'consistency-beats-creativity',
        title: 'Why Consistency Beats Creativity in Branding (Every Single Time)',
        excerpt: 'The secret to brand recognition isn\'t being clever â€” it\'s being consistent. Here\'s why boring discipline builds billion-dollar brands.',
        category: 'Brand Strategy',
        image: 'https://images.unsplash.com/photo-1507925921958-8a62f3d1a50d?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'November 18, 2025',
        readTime: '7 min read',
        content: `
            <p class="blog-lead">Everyone wants the viral moment. The clever campaign. The creative breakthrough. But the brands that actually win? They're boringly, relentlessly consistent.</p>

            <h2>The Math of Recognition</h2>
            <p>Marketing research shows it takes 5-7 impressions before someone remembers your brand. But here's the catch: those impressions need to be consistent. If your brand looks different every time, you're starting from zero each time.</p>

            <p>McDonald's golden arches look exactly the same whether you're in Detroit or Dubai. That consistency is worth billions.</p>

            <h2>Consistency Builds Trust</h2>
            <p>When your brand looks professional and cohesive, people trust you more. When it looks different everywhere â€” different fonts, different colors, different styles â€” people subconsciously question your legitimacy.</p>

            <p>Consistency signals: "We have our act together."</p>

            <h2>Where Consistency Matters Most</h2>
            <ul>
                <li><strong>Logo usage:</strong> Same logo, same placement, same clear space</li>
                <li><strong>Color palette:</strong> Exact hex codes, not "close enough"</li>
                <li><strong>Typography:</strong> Same fonts, same hierarchy</li>
                <li><strong>Voice & tone:</strong> Same personality in every piece of copy</li>
                <li><strong>Photography style:</strong> Same editing, same mood</li>
                <li><strong>Design elements:</strong> Consistent patterns, shapes, icons</li>
            </ul>

            <h2>The Brand Guidelines Test</h2>
            <p>Could someone who's never met you create on-brand content using just your brand guidelines? If not, your guidelines aren't clear enough â€” or you don't have them at all.</p>

            <h2>Creativity WITHIN Consistency</h2>
            <p>This doesn't mean being boring. Apple is incredibly creative within their clean, minimalist framework. Creativity happens within the rules, not by breaking them constantly.</p>

            <div class="blog-cta">
                <h3>Need Brand Guidelines That Actually Work?</h3>
                <p>We create comprehensive brand systems for consistent execution.</p>
                <a onclick="showView('services')" class="btn-cta">Build Your Brand System</a>
            </div>
        `
    },
    {
        id: 12,
        slug: 'small-business-big-brand-energy',
        title: 'How to Give Your Small Business Big Brand Energy',
        excerpt: 'You don\'t need Nike\'s budget to look like a premium brand. Here are the moves that make small businesses look like industry leaders.',
        category: 'Branding',
        image: 'https://images.unsplash.com/photo-1556761175-4b46a572b786?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'November 11, 2025',
        readTime: '9 min read',
        content: `
            <p class="blog-lead">Some small businesses look like Fortune 500 companies. Others look like they designed their brand in Microsoft Word. The difference isn't budget â€” it's knowing what actually matters. Here's the playbook.</p>

            <h2>1. Invest in Photography</h2>
            <p>Nothing screams "small-time" like bad photos. Stock photos that look generic. iPhone photos with bad lighting. Grainy, pixelated images.</p>
            <p>Professional photography â€” especially for your team, products, and workspace â€” instantly elevates perception. It's one of the highest-ROI investments you can make.</p>

            <h2>2. Simplify Everything</h2>
            <p>Amateur brands try to do too much. Too many colors. Too many fonts. Too much clutter. Premium brands are simple and confident.</p>
            <p>When in doubt, remove something.</p>

            <h2>3. Write Like a Human</h2>
            <p>Corporate jargon screams "we're trying too hard." The best brands sound like real people having real conversations. Clear, confident, conversational.</p>

            <h2>4. Nail the Details</h2>
            <p>Big brands sweat the small stuff. Consistent spacing. Proper alignment. Quality paper for print materials. These details compound.</p>

            <h2>5. Create Systems, Not One-Offs</h2>
            <p>Don't design a social post. Design a social media system. Don't create a flyer. Create a template library. Systems create consistency.</p>

            <h2>6. Say No More Often</h2>
            <p>Premium brands are selective. They don't chase every trend. They don't work with every client. Selectivity signals value.</p>

            <h2>7. Tell Your Story</h2>
            <p>Big brands have narratives. Apple is about thinking different. Nike is about athletic achievement. What's your story? Make it clear.</p>

            <h2>8. Invest in Experience</h2>
            <p>How does it feel to interact with your brand? The packaging, the website navigation, the customer service? Every touchpoint matters.</p>

            <div class="blog-cta">
                <h3>Ready for Big Brand Energy?</h3>
                <p>We help small businesses look and feel like industry leaders.</p>
                <a onclick="showView('services')" class="btn-cta">Level Up Your Brand</a>
            </div>
        `
    },
    {
        id: 13,
        slug: 'gary-vee-personal-branding-document-dont-create',
        title: 'Gary Vee Was Right: Document Don\'t Create â€” Build Your Personal Brand in 2026',
        excerpt: 'Gary Vaynerchuk\'s "document don\'t create" strategy changed how entrepreneurs build personal brands. Here\'s how to apply it to grow your business.',
        category: 'Personal Branding',
        image: 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'November 4, 2025',
        readTime: '10 min read',
        content: `
            <p class="blog-lead">Gary Vaynerchuk built a $200 million empire by showing up every single day. His advice? Stop trying to create perfect content. Document your journey instead. Here's why this personal branding strategy works and how to execute it.</p>

            <h2>Why "Document Don't Create" Changes Everything</h2>
            <p>Most entrepreneurs freeze when they think about content creation. They want everything perfect. The lighting. The script. The editing. Gary V flipped this: just pull out your phone and share what you're already doing.</p>

            <p>The power of documenting:</p>
            <ul>
                <li><strong>Authenticity:</strong> People connect with real, not polished</li>
                <li><strong>Consistency:</strong> You can post daily without burnout</li>
                <li><strong>Storytelling:</strong> Your journey IS the content</li>
                <li><strong>Trust:</strong> Transparency builds loyal audiences</li>
            </ul>

            <h2>Personal Branding Is Business Branding</h2>
            <p>Gary V says people buy from people they know, like, and trust. Your personal brand IS your business development strategy. When you become the face of your expertise, you become the obvious choice.</p>

            <p>The equation is simple: Attention + Trust = Revenue.</p>

            <h2>Video Content Is Non-Negotiable</h2>
            <p>Gary's been screaming this for years: video is king. Instagram Reels, TikTok, YouTube Shorts â€” short-form video is how you build awareness in 2026. You don't need a studio. You need a smartphone and something to say.</p>

            <h2>The $1.80 Strategy</h2>
            <p>Gary V's famous $1.80 strategy: Leave your "two cents" on 90 posts per day across 10 hashtags. It's not about posting â€” it's about engaging. Comment on others. Build relationships. Be part of the conversation.</p>

            <h2>Patience Is the Game</h2>
            <p>The biggest lesson from Gary V: This takes time. Years, not months. The entrepreneurs who win are the ones who keep showing up when nobody's watching. Compound attention is real.</p>

            <div class="blog-cta">
                <h3>Need a Personal Brand That Converts?</h3>
                <p>We build brand identities that make you the authority in your space.</p>
                <a onclick="showView('services')" class="btn-cta">Build Your Personal Brand</a>
            </div>
        `
    },
    {
        id: 14,
        slug: 'grant-cardone-10x-sales-branding',
        title: 'What Grant Cardone Gets Right About Sales, Branding, and 10X Thinking',
        excerpt: 'Grant Cardone built a $4 billion real estate empire with 10X thinking. Here\'s how his sales philosophy applies to your brand strategy.',
        category: 'Sales Strategy',
        image: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'October 28, 2025',
        readTime: '9 min read',
        content: `
            <p class="blog-lead">Love him or hate him, Grant Cardone understands sales and attention better than almost anyone. His 10X Rule has helped millions of entrepreneurs think bigger. Here's what his philosophy teaches us about branding and selling.</p>

            <h2>The 10X Rule Applied to Branding</h2>
            <p>Grant's core message: Whatever you think you need to do, multiply it by 10. Think you need to post once a day? Post 10 times. Think you need 100 leads? Get 1,000. Think your brand is "good enough"? It's not even close.</p>

            <p>Most businesses are invisible because they're playing small. 10X branding means:</p>
            <ul>
                <li>Being impossible to ignore in your market</li>
                <li>Showing up more than your competitors</li>
                <li>Investing more in your visual identity</li>
                <li>Creating content at volume, not perfection</li>
            </ul>

            <h2>Omnipresence Is the Goal</h2>
            <p>Cardone preaches omnipresence â€” being everywhere your customer looks. Website. Social media. Email. Billboards. Vehicle wraps. Signage. The business that's everywhere is the business that gets called.</p>

            <p>Your brand should feel inescapable in your local market.</p>

            <h2>Sales Is a Contact Sport</h2>
            <p>Grant says most people don't follow up enough. The average sale takes 8 touches. Most salespeople give up after 2. Your brand needs to keep showing up until the prospect is ready to buy.</p>

            <h2>Speed and Aggression Win</h2>
            <p>Cardone's philosophy: Move fast, be bold, take massive action. In branding terms, this means launching before you're ready, iterating in public, and outworking the competition on visibility.</p>

            <h2>Invest in Your Image</h2>
            <p>Grant drives Rolls Royces and flies private. Why? Because image matters. Your brand is your business's image. A premium brand commands premium prices. Looking cheap costs you money.</p>

            <div class="blog-cta">
                <h3>Ready to 10X Your Brand?</h3>
                <p>We create bold brand identities that demand attention.</p>
                <a onclick="showView('services')" class="btn-cta">Get 10X Branding</a>
            </div>
        `
    },
    {
        id: 15,
        slug: 'coach-consultant-mentor-personal-brand-guide',
        title: 'Building a Coaching or Consulting Brand: The Complete Personal Branding Guide',
        excerpt: 'Coaches, consultants, and mentors live and die by their personal brand. Here\'s exactly how to position yourself as the go-to expert in your niche.',
        category: 'Personal Branding',
        image: 'https://images.unsplash.com/photo-1552581234-26160f608093?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'October 21, 2025',
        readTime: '12 min read',
        content: `
            <p class="blog-lead">If you're a coach, consultant, or mentor, YOU are the product. Your personal brand is everything. It determines whether you charge $50/hour or $500/hour. Here's how to build a brand that commands premium rates.</p>

            <h2>Why Personal Branding Matters for Coaches</h2>
            <p>The coaching industry is flooded. Everyone's a "business coach" or "life coach" now. The only way to stand out is to become the obvious expert in a specific niche. Your personal brand does that positioning work for you.</p>

            <p>A strong coaching brand:</p>
            <ul>
                <li>Attracts ideal clients who are ready to pay</li>
                <li>Positions you as the authority, not a commodity</li>
                <li>Justifies premium pricing</li>
                <li>Creates inbound leads instead of cold outreach</li>
            </ul>

            <h2>Define Your Niche (Then Go Narrower)</h2>
            <p>"Business coach" is not a niche. "Sales coach for SaaS startups doing $1-5M ARR" is a niche. The more specific your positioning, the easier it is to become the obvious choice.</p>

            <h2>Video Builds Trust Faster Than Anything</h2>
            <p>People need to feel like they know you before they'll pay you. Video content â€” YouTube, Instagram Reels, TikTok, LinkedIn video â€” lets prospects experience your coaching style before the sales call.</p>

            <h2>Host Events and Workshops</h2>
            <p>Nothing builds authority like standing on a stage. Virtual workshops, webinars, local meetups, mentor days â€” events position you as the expert and generate qualified leads. Plus, you can capture content to repurpose across all platforms.</p>

            <h2>Your Visual Identity Signals Your Value</h2>
            <p>A coach with a Canva logo and a Wix template site will never command $10K packages. Your visual brand â€” logo, colors, website, photography â€” needs to match your desired price point.</p>

            <h2>Build Your Ecosystem</h2>
            <p>The most successful coaches have:</p>
            <ul>
                <li>A professional website with clear offers</li>
                <li>Consistent social media presence</li>
                <li>Email list and newsletter</li>
                <li>Free content that demonstrates expertise</li>
                <li>Testimonials and case studies</li>
                <li>A signature framework or methodology</li>
            </ul>

            <div class="blog-cta">
                <h3>Ready to Build Your Coaching Brand?</h3>
                <p>We create premium personal brands for coaches and consultants.</p>
                <a onclick="showView('services')" class="btn-cta">Build Your Expert Brand</a>
            </div>
        `
    },
    {
        id: 16,
        slug: 'vehicle-wraps-window-signage-brand-visibility',
        title: 'Vehicle Wraps and Window Signage: Turn Your Business Into a Moving Billboard',
        excerpt: 'Your car and storefront are advertising real estate you already own. Here\'s how vehicle wraps and window signage generate thousands of impressions daily.',
        category: 'Brand Strategy',
        image: 'https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'October 14, 2025',
        readTime: '8 min read',
        content: `
            <p class="blog-lead">You drive your car every day. You have a storefront or office window. These are advertising surfaces you're paying for anyway. Vehicle wraps and window signage turn them into 24/7 brand billboards.</p>

            <h2>The Math on Vehicle Wraps</h2>
            <p>A wrapped vehicle generates 30,000-70,000 impressions PER DAY depending on your market. At a cost of $2,500-$5,000 for a quality wrap that lasts 5-7 years, you're looking at a cost per thousand impressions (CPM) of about $0.04. Compare that to:</p>
            <ul>
                <li>Facebook Ads: $5-15 CPM</li>
                <li>Google Display: $2-10 CPM</li>
                <li>Billboards: $3-18 CPM</li>
            </ul>
            <p>Vehicle wraps are one of the most cost-effective advertising methods that exist.</p>

            <h2>Design Principles for Vehicle Wraps</h2>
            <p>Your wrap has about 3 seconds to communicate. That means:</p>
            <ul>
                <li><strong>Big, readable logo:</strong> Should be visible from 100 feet</li>
                <li><strong>One clear message:</strong> What do you do?</li>
                <li><strong>Phone number or website:</strong> Make it huge</li>
                <li><strong>High contrast colors:</strong> Stand out on the road</li>
            </ul>
            <p>Don't try to fit your entire service menu on your truck. Less is more.</p>

            <h2>Window Signage That Works</h2>
            <p>Your storefront window is prime real estate. Effective window signage includes:</p>
            <ul>
                <li><strong>Business name and logo:</strong> Prominent and professional</li>
                <li><strong>Hours of operation:</strong> Don't make people guess</li>
                <li><strong>Call to action:</strong> "Walk-ins welcome" or "Free consultations"</li>
                <li><strong>Seasonal promotions:</strong> Easily changeable graphics</li>
            </ul>

            <h2>Brand Consistency Is Key</h2>
            <p>Your vehicle wrap, window signage, business cards, and website should all look like they belong to the same company. Same colors. Same fonts. Same visual language. This consistency builds recognition.</p>

            <h2>Fleet Branding Multiplies Impact</h2>
            <p>If you have multiple vehicles, fleet branding creates serious presence. Three wrapped vans driving around your city every day makes your business feel established and everywhere.</p>

            <div class="blog-cta">
                <h3>Ready for Professional Signage Design?</h3>
                <p>We create vehicle wrap and signage designs that get noticed.</p>
                <a onclick="showView('services')" class="btn-cta">Get Signage Design</a>
            </div>
        `
    },
    {
        id: 17,
        slug: 'custom-web-app-business-growth',
        title: 'Why Every Growing Business Needs a Custom Web App (Not Just a Website)',
        excerpt: 'Websites inform. Web apps transform. Here\'s why custom web applications are the secret weapon of businesses that scale.',
        category: 'Technology',
        image: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'October 7, 2025',
        readTime: '11 min read',
        content: `
            <p class="blog-lead">A website is a digital brochure. A custom web app is a digital employee that works 24/7, never calls in sick, and scales infinitely. If you're still running your business on spreadsheets and email, you're leaving money on the table.</p>

            <h2>Website vs. Web App: What's the Difference?</h2>
            <p>A <strong>website</strong> displays information. Visitors read content, maybe fill out a contact form, and leave. A <strong>web application</strong> performs tasks. Users log in, interact with data, complete workflows, and get things done.</p>

            <p>Examples of web apps:</p>
            <ul>
                <li><strong>Client portals:</strong> Customers check order status, access documents</li>
                <li><strong>Booking systems:</strong> Appointments scheduled without phone calls</li>
                <li><strong>Project management:</strong> Team collaboration in one place</li>
                <li><strong>Custom CRMs:</strong> Track leads and customers your way</li>
                <li><strong>Internal tools:</strong> Automate repetitive business processes</li>
            </ul>

            <h2>Why Custom Beats Off-the-Shelf</h2>
            <p>Tools like Salesforce, Monday, and HubSpot are powerful. They're also expensive, bloated, and force you to work their way. A custom web app is built around YOUR processes, not the other way around.</p>

            <p>Benefits of custom:</p>
            <ul>
                <li><strong>Exact fit:</strong> Does exactly what you need, nothing more</li>
                <li><strong>Competitive advantage:</strong> Your competitors can't buy it</li>
                <li><strong>Scalability:</strong> Grows with your business</li>
                <li><strong>Integration:</strong> Connects with your existing tools</li>
                <li><strong>Ownership:</strong> You own the code and data forever</li>
            </ul>

            <h2>Signs You Need a Custom Web App</h2>
            <p>If any of these sound familiar, it's time:</p>
            <ul>
                <li>You're copying data between multiple spreadsheets</li>
                <li>Your team wastes hours on repetitive tasks</li>
                <li>Customers are frustrated with your ordering/booking process</li>
                <li>You're paying for 10 SaaS tools that don't talk to each other</li>
                <li>Your business process is too unique for standard software</li>
            </ul>

            <h2>The ROI of Automation</h2>
            <p>A custom web app that saves your team 10 hours per week is worth $25,000/year in labor alone. Most apps pay for themselves in months, then keep generating returns forever.</p>

            <h2>Start With One Problem</h2>
            <p>You don't need to build everything at once. Pick the one process that's causing the most pain. Automate that. Prove the value. Then expand.</p>

            <div class="blog-cta">
                <h3>Ready to Build Your Custom Web App?</h3>
                <p>We build web applications that automate your business processes.</p>
                <a onclick="showView('services')" class="btn-cta">Explore Web App Solutions</a>
            </div>
        `
    },
    {
        id: 18,
        slug: 'why-every-business-needs-three-logos',
        title: 'Why Every Business Needs 3 Logos (And What Each One Is For)',
        excerpt: 'One logo is not enough. Here is why professional brands have multiple logo variations and how to use each one correctly.',
        category: 'Branding',
        image: 'https://images.unsplash.com/photo-1558655146-9f40138edfeb?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'September 30, 2025',
        readTime: '7 min read',
        content: `
            <p class="blog-lead">If you only have one logo, you are already behind. Professional brands have multiple logo variations designed for different contexts. Here is the logo system every serious business needs.</p>

            <h2>The Primary Logo (Horizontal Lockup)</h2>
            <p>This is your main logo â€” the full version with your symbol/icon and wordmark side by side. Use this when you have plenty of horizontal space:</p>
            <ul>
                <li>Website header</li>
                <li>Email signatures</li>
                <li>Business cards</li>
                <li>Letterhead</li>
                <li>Presentations</li>
            </ul>
            <p>This is the logo most people picture when they think of your brand.</p>

            <h2>The Stacked Logo (Vertical Lockup)</h2>
            <p>Same elements as your primary logo, but arranged vertically â€” icon on top, wordmark below. Use this when you have more vertical space or need a more compact format:</p>
            <ul>
                <li>Social media profile pictures</li>
                <li>Signage</li>
                <li>Packaging</li>
                <li>Apparel embroidery</li>
                <li>Square format applications</li>
            </ul>

            <h2>The Icon/Brandmark (Favicon)</h2>
            <p>Just your symbol or a simplified mark â€” no text. This is crucial for small spaces where your wordmark would be unreadable:</p>
            <ul>
                <li>Favicon (browser tab icon)</li>
                <li>App icons</li>
                <li>Social media avatars</li>
                <li>Watermarks</li>
                <li>Embossed materials</li>
            </ul>

            <h2>Bonus: Responsive Logo Variations</h2>
            <p>Some brands also have size-responsive variations â€” simplified versions that work at tiny sizes. Think about how your logo looks at 16x16 pixels.</p>

            <h2>Color Variations Matter Too</h2>
            <p>Each of these three logos should also have:</p>
            <ul>
                <li><strong>Full color:</strong> Your primary brand colors</li>
                <li><strong>Single color:</strong> For one-color printing</li>
                <li><strong>Reversed/White:</strong> For dark backgrounds</li>
                <li><strong>Black:</strong> For documents and faxes</li>
            </ul>

            <div class="blog-cta">
                <h3>Need a Complete Logo System?</h3>
                <p>We create professional logo packages with all the variations you need.</p>
                <a onclick="showView('services')" class="btn-cta">Get Your Logo System</a>
            </div>
        `
    },
    {
        id: 19,
        slug: 'what-is-brand-identity-complete-guide',
        title: 'What Is Brand Identity? The Complete Guide for Business Owners',
        excerpt: 'Brand identity is more than a logo. Here is everything that makes up your visual brand system and why each piece matters.',
        category: 'Branding',
        image: 'https://images.unsplash.com/photo-1586717791821-3f44a563fa4c?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'September 23, 2025',
        readTime: '9 min read',
        content: `
            <p class="blog-lead">Brand identity is the complete visual system that represents your business. It is not just a logo â€” it is every visual element that helps customers recognize and remember you.</p>

            <h2>The Core Elements of Brand Identity</h2>

            <h3>1. Logo System</h3>
            <p>Your logo is the cornerstone, but as we covered, you need multiple versions â€” primary, stacked, and icon variations in multiple color formats.</p>

            <h3>2. Color Palette</h3>
            <p>A defined set of colors used consistently across everything. This typically includes:</p>
            <ul>
                <li>Primary colors (1-2)</li>
                <li>Secondary colors (2-3)</li>
                <li>Accent colors</li>
                <li>Neutral colors (backgrounds, text)</li>
            </ul>

            <h3>3. Typography</h3>
            <p>The fonts you use communicate personality. Most brands need:</p>
            <ul>
                <li>Heading font (bold, attention-grabbing)</li>
                <li>Body font (readable, professional)</li>
                <li>Accent font (optional, for special uses)</li>
            </ul>

            <h3>4. Imagery Style</h3>
            <p>Guidelines for photography, illustrations, and graphics. What mood? What subjects? What editing style?</p>

            <h3>5. Graphic Elements</h3>
            <p>Patterns, shapes, icons, and textures that create visual consistency beyond the logo.</p>

            <h3>6. Voice and Tone</h3>
            <p>While technically part of brand strategy, your verbal identity works with visual identity to create a complete brand experience.</p>

            <h2>Brand Identity vs. Brand vs. Branding</h2>
            <ul>
                <li><strong>Brand:</strong> How people perceive you (reputation)</li>
                <li><strong>Brand Identity:</strong> The visual tools you use to shape perception</li>
                <li><strong>Branding:</strong> The process of building and managing your brand</li>
            </ul>

            <h2>Why Brand Identity Matters</h2>
            <p>Consistent brand identity increases revenue by up to 23% according to research. It builds recognition, creates trust, and makes marketing more effective.</p>

            <div class="blog-cta">
                <h3>Ready for a Professional Brand Identity?</h3>
                <p>We create complete brand identity systems for businesses ready to level up.</p>
                <a onclick="showView('services')" class="btn-cta">Explore Brand Packages</a>
            </div>
        `
    },
    {
        id: 20,
        slug: 'what-is-a-web-app-explained',
        title: 'What Is a Web App? A Simple Explanation for Non-Technical Business Owners',
        excerpt: 'Web apps, websites, mobile apps â€” what is the difference? Here is a plain English guide to understanding web applications.',
        category: 'Technology',
        image: 'https://images.unsplash.com/photo-1547658719-da2b51169166?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'September 16, 2025',
        readTime: '6 min read',
        content: `
            <p class="blog-lead">You have heard the term "web app" but what does it actually mean? Here is a simple explanation without the tech jargon.</p>

            <h2>Website vs. Web App: The Simple Version</h2>
            <p><strong>Website:</strong> You visit it to READ information. It is like a digital brochure or magazine.</p>
            <p><strong>Web App:</strong> You visit it to DO something. It is like a digital tool or software.</p>

            <h2>Real Examples</h2>
            <p><strong>Websites:</strong></p>
            <ul>
                <li>A restaurant menu page</li>
                <li>A company's "About Us" page</li>
                <li>A news article</li>
                <li>A portfolio showcase</li>
            </ul>
            <p><strong>Web Apps:</strong></p>
            <ul>
                <li>Gmail (you send and receive emails)</li>
                <li>Google Docs (you create documents)</li>
                <li>Online banking (you manage money)</li>
                <li>Canva (you design graphics)</li>
                <li>A booking system (you schedule appointments)</li>
            </ul>

            <h2>Web App vs. Mobile App</h2>
            <p><strong>Mobile App:</strong> Downloaded from app store, installed on your phone</p>
            <p><strong>Web App:</strong> Accessed through a browser, no download needed</p>
            <p>Many services have both. You can use Instagram as a mobile app OR go to instagram.com in your browser (web app).</p>

            <h2>Why Would Your Business Need a Web App?</h2>
            <ul>
                <li><strong>Client Portal:</strong> Customers log in to see their orders, documents, or account info</li>
                <li><strong>Booking System:</strong> Clients schedule appointments without calling you</li>
                <li><strong>Quote Calculator:</strong> Visitors get instant pricing estimates</li>
                <li><strong>Internal Tools:</strong> Your team manages projects, inventory, or processes</li>
            </ul>

            <h2>The Benefit Over Mobile Apps</h2>
            <p>Web apps work on any device with a browser â€” no app store approval, no downloads, no updates for users to install. One version works everywhere.</p>

            <div class="blog-cta">
                <h3>Need a Custom Web App for Your Business?</h3>
                <p>We build web applications that solve real business problems.</p>
                <a onclick="showView('services')" class="btn-cta">Discuss Your Web App</a>
            </div>
        `
    },
    {
        id: 21,
        slug: 'what-is-a-vector-file-explained',
        title: 'What Is a Vector File? Why Your Designer Keeps Asking for It',
        excerpt: 'PNG, JPG, SVG, AI, EPS â€” what do these mean and why does it matter? Here is everything you need to know about vector files.',
        category: 'Branding',
        image: 'https://images.unsplash.com/photo-1611532736597-de2d4265fba3?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'September 9, 2025',
        readTime: '6 min read',
        content: `
            <p class="blog-lead">Every time you work with a designer or printer, they ask for "vector files." But what does that actually mean? Here is the simple explanation.</p>

            <h2>Vector vs. Raster: The Difference</h2>
            <p><strong>Raster images (JPG, PNG, GIF):</strong> Made of tiny squares called pixels. Like a mosaic. When you zoom in, you see the squares and it gets blurry.</p>
            <p><strong>Vector images (SVG, AI, EPS, PDF):</strong> Made of mathematical paths and shapes. Like connect-the-dots. They can scale to ANY size without losing quality.</p>

            <h2>Why Vectors Matter for Your Logo</h2>
            <p>Your logo needs to work at every size:</p>
            <ul>
                <li>Tiny: Favicon (16x16 pixels)</li>
                <li>Small: Business card</li>
                <li>Medium: Website header</li>
                <li>Large: Trade show banner</li>
                <li>Huge: Building signage, billboards</li>
            </ul>
            <p>A raster logo that looks fine on a business card will be a pixelated mess on a billboard. A vector logo looks crisp at ANY size.</p>

            <h2>Common File Types Explained</h2>
            <ul>
                <li><strong>.AI:</strong> Adobe Illustrator file (vector, editable)</li>
                <li><strong>.EPS:</strong> Encapsulated PostScript (vector, universal)</li>
                <li><strong>.SVG:</strong> Scalable Vector Graphics (vector, web-friendly)</li>
                <li><strong>.PDF:</strong> Can be vector OR raster depending on how it was made</li>
                <li><strong>.PNG:</strong> Raster, but supports transparency</li>
                <li><strong>.JPG:</strong> Raster, compressed, no transparency</li>
            </ul>

            <h2>What Files Should You Have?</h2>
            <p>A professional logo package should include:</p>
            <ul>
                <li>Vector files (.AI, .EPS, .SVG) for printing and scaling</li>
                <li>High-res PNG files for digital use</li>
                <li>Various color versions (full color, white, black)</li>
            </ul>

            <h2>Red Flag: "I Only Have a JPG"</h2>
            <p>If your "designer" only gave you JPG files, you do not have a professional logo. You have a picture of a logo. Always get your vector source files.</p>

            <div class="blog-cta">
                <h3>Need Proper Logo Files?</h3>
                <p>We deliver complete file packages with every format you will ever need.</p>
                <a onclick="showView('services')" class="btn-cta">Get Professional Logo Files</a>
            </div>
        `
    },
    {
        id: 22,
        slug: 'small-brands-beating-ai-with-real-designers',
        title: 'How Small Brands Who Hire Real Designers Are Beating AI-Generated Competition',
        excerpt: 'While everyone rushes to AI design tools, smart small brands are winning by investing in human creativity. Here is why.',
        category: 'Branding',
        image: 'https://images.unsplash.com/photo-1558655146-364adaf1fcc9?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'September 2, 2025',
        readTime: '8 min read',
        content: `
            <p class="blog-lead">AI logo generators are everywhere. They are cheap. They are fast. And they are creating a sea of forgettable, generic brands. Here is why the smart money is going the other direction.</p>

            <h2>The AI Design Problem</h2>
            <p>AI tools like Looka, Canva AI, and MidJourney can generate logos in seconds. But here is what they cannot do:</p>
            <ul>
                <li>Understand your specific market positioning</li>
                <li>Research your competitors to ensure differentiation</li>
                <li>Create truly original concepts</li>
                <li>Guarantee the design is not similar to existing trademarks</li>
                <li>Adapt based on strategic feedback</li>
            </ul>

            <h2>The "AI Look" Is Becoming Obvious</h2>
            <p>AI-generated designs have patterns. Certain styles. Particular tendencies. Customers are starting to recognize â€” even subconsciously â€” when something looks AI-generated. And it signals: "This business did not invest in their brand."</p>

            <h2>The Differentiation Opportunity</h2>
            <p>When everyone zigs toward AI, zagging toward human design creates instant differentiation. A thoughtfully crafted brand identity stands out in a sea of algorithmic sameness.</p>

            <h2>Real Designers Provide Strategy</h2>
            <p>A logo is not just a pretty picture. It is a strategic business asset. Real designers:</p>
            <ul>
                <li>Ask about your target audience</li>
                <li>Research your competitive landscape</li>
                <li>Consider your business goals</li>
                <li>Think about practical applications</li>
                <li>Ensure scalability and versatility</li>
            </ul>

            <h2>The Hidden Costs of AI Design</h2>
            <p>That $50 AI logo might cost you:</p>
            <ul>
                <li>Customer trust (looks cheap)</li>
                <li>Trademark issues (AI does not check)</li>
                <li>Rebrand costs in 2 years (when you outgrow it)</li>
                <li>Lost premium pricing power</li>
            </ul>

            <h2>Investment vs. Expense</h2>
            <p>AI design is an expense. Professional design is an investment. The brands winning in 2026 understand the difference.</p>

            <div class="blog-cta">
                <h3>Ready for Human-Crafted Design?</h3>
                <p>We create strategic brand identities that AI cannot replicate.</p>
                <a onclick="showView('services')" class="btn-cta">Work With Real Designers</a>
            </div>
        `
    },
    {
        id: 23,
        slug: 'what-is-brand-story-why-you-need-one',
        title: 'What Is a Brand Story and Why Does Your Business Need One?',
        excerpt: 'Facts tell, stories sell. Here is what a brand story actually is and how to craft one that connects with customers.',
        category: 'Brand Strategy',
        image: 'https://images.unsplash.com/photo-1456324504439-367cee3b3c32?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'August 26, 2025',
        readTime: '9 min read',
        content: `
            <p class="blog-lead">Nike does not sell shoes. They sell the story of athletic achievement. Apple does not sell computers. They sell the story of thinking different. What story does your brand tell?</p>

            <h2>What Is a Brand Story?</h2>
            <p>Your brand story is the narrative that connects your business to your customers emotionally. It is not just your company history â€” it is the "why" behind everything you do.</p>

            <p>A brand story answers:</p>
            <ul>
                <li>Why does your company exist?</li>
                <li>What problem were you born to solve?</li>
                <li>Who do you serve and why do you care?</li>
                <li>What makes your approach different?</li>
                <li>What future are you creating?</li>
            </ul>

            <h2>Why Stories Beat Facts</h2>
            <p>Neuroscience shows stories activate more parts of the brain than facts alone. When someone hears a story, their brain synchronizes with the storyteller. That is connection. That is trust.</p>

            <p>People remember stories 22x better than facts alone.</p>

            <h2>The Brand Story Framework</h2>
            <ol>
                <li><strong>The Problem:</strong> What frustration or pain exists in the world?</li>
                <li><strong>The Awakening:</strong> What moment made you decide to act?</li>
                <li><strong>The Mission:</strong> What are you setting out to change?</li>
                <li><strong>The Solution:</strong> How do you uniquely solve the problem?</li>
                <li><strong>The Vision:</strong> What does success look like for your customers?</li>
            </ol>

            <h2>Brand Story Examples</h2>
            <p><strong>TOMS:</strong> "With every product you purchase, TOMS will help a person in need." Simple. Emotional. Memorable.</p>
            <p><strong>Warby Parker:</strong> Started because glasses were too expensive and buying them was frustrating. They made it accessible and easy.</p>

            <h2>Where Your Brand Story Lives</h2>
            <ul>
                <li>Your "About" page</li>
                <li>Social media bios</li>
                <li>Pitch decks and proposals</li>
                <li>Team training and culture</li>
                <li>Customer communications</li>
            </ul>

            <div class="blog-cta">
                <h3>Need Help Crafting Your Brand Story?</h3>
                <p>We help businesses discover and articulate their authentic brand narrative.</p>
                <a onclick="showView('services')" class="btn-cta">Develop Your Brand Story</a>
            </div>
        `
    },
    {
        id: 24,
        slug: 'what-is-brand-voice-how-to-use-it',
        title: 'What Is Brand Voice? (And How to Use It Consistently Everywhere)',
        excerpt: 'Your brand voice is how your business sounds in writing. Here is how to define it, document it, and use it to stand out.',
        category: 'Brand Strategy',
        image: 'https://images.unsplash.com/photo-1589903308904-1010c2294adc?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'August 19, 2025',
        readTime: '8 min read',
        content: `
            <p class="blog-lead">If your brand was a person, how would they talk? That is your brand voice. It is the personality that comes through in every email, social post, and webpage you write.</p>

            <h2>What Is Brand Voice?</h2>
            <p>Brand voice is the consistent personality and style of your written and verbal communication. It includes:</p>
            <ul>
                <li><strong>Tone:</strong> Formal or casual? Serious or playful?</li>
                <li><strong>Language:</strong> Technical or simple? Industry jargon or everyday words?</li>
                <li><strong>Personality:</strong> Warm or authoritative? Quirky or straightforward?</li>
                <li><strong>Rhythm:</strong> Short punchy sentences or flowing prose?</li>
            </ul>

            <h2>Why Brand Voice Matters</h2>
            <p>Consistency builds recognition. When your brand sounds the same everywhere, customers learn to recognize you â€” even without seeing your logo. Voice creates familiarity. Familiarity creates trust.</p>

            <h2>How to Define Your Brand Voice</h2>
            <p><strong>Step 1:</strong> Describe your brand as a person. Give them traits. "If our brand was a person, they would be confident but approachable, smart but not arrogant."</p>
            <p><strong>Step 2:</strong> List 3-5 voice attributes. Examples: Friendly, Bold, Expert, Playful, Direct, Warm, Rebellious.</p>
            <p><strong>Step 3:</strong> Create do's and don'ts for each attribute.</p>

            <h2>Example Brand Voice Guidelines</h2>
            <p><strong>Voice Attribute: Friendly</strong></p>
            <ul>
                <li>DO: Use contractions (we're, you'll, it's)</li>
                <li>DO: Address the reader as "you"</li>
                <li>DON'T: Use cold corporate language</li>
                <li>DON'T: Sound like a press release</li>
            </ul>

            <h2>Using Your Brand Voice Everywhere</h2>
            <ul>
                <li>Website copy</li>
                <li>Social media posts</li>
                <li>Email marketing</li>
                <li>Customer service responses</li>
                <li>Proposals and contracts</li>
                <li>Product descriptions</li>
                <li>Job postings</li>
            </ul>

            <h2>Voice vs. Tone</h2>
            <p>Voice stays consistent. Tone adapts to context. Your voice might be "friendly and expert." But the tone of a complaint response differs from a promotional email â€” while both still sound like YOU.</p>

            <div class="blog-cta">
                <h3>Need Help Defining Your Brand Voice?</h3>
                <p>We create brand voice guidelines that keep your messaging consistent.</p>
                <a onclick="showView('services')" class="btn-cta">Develop Your Brand Voice</a>
            </div>
        `
    },
    {
        id: 25,
        slug: 'why-social-media-reach-is-failing',
        title: 'Why Your Social Media Reach Is Dying (And What Actually Works in 2026)',
        excerpt: 'Organic reach is plummeting. The algorithm hates your posts. Here is what is really happening and how to fix it.',
        category: 'Social Media',
        image: 'https://images.unsplash.com/photo-1611162616305-c69b3fa7fbe0?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'August 12, 2025',
        readTime: '10 min read',
        content: `
            <p class="blog-lead">You post consistently. You use hashtags. You follow all the "tips." Yet your reach keeps dropping. Here is the brutal truth about social media in 2026 â€” and what actually works.</p>

            <h2>Why Organic Reach Is Dying</h2>
            <p>The platforms WANT you to pay. Facebook organic reach is down to 2-5% of your followers. Instagram is not much better. The business model is: give you a taste for free, then charge for access to YOUR OWN audience.</p>

            <h2>The Algorithm Rewards Engagement</h2>
            <p>The algorithm does not care about your business goals. It cares about keeping users on the platform. Posts that get quick engagement (comments, shares, saves) get shown to more people. Posts that get scrolled past get buried.</p>

            <h2>Common Mistakes Killing Your Reach</h2>
            <ul>
                <li><strong>Posting links:</strong> Platforms hate when you send people away</li>
                <li><strong>Being boring:</strong> Safe, corporate content gets ignored</li>
                <li><strong>Inconsistent posting:</strong> The algorithm forgets you exist</li>
                <li><strong>Ignoring video:</strong> All platforms prioritize video content</li>
                <li><strong>No engagement:</strong> If you do not comment, they do not show your posts</li>
            </ul>

            <h2>What Actually Works in 2026</h2>

            <h3>1. Short-Form Video Is King</h3>
            <p>Reels, TikToks, Shorts â€” this is where the reach is. The platforms are competing for attention against TikTok, so they push video content hard.</p>

            <h3>2. Engagement Before Broadcasting</h3>
            <p>Spend 15 minutes engaging with other accounts BEFORE you post. The algorithm sees you as active and rewards your content.</p>

            <h3>3. Native Content Only</h3>
            <p>Stop sharing links. Create content native to each platform. Put the value IN the post, not behind a click.</p>

            <h3>4. Build Email Instead</h3>
            <p>Social media is rented land. Your email list is owned. Use social to drive email signups, then nurture through email.</p>

            <h3>5. Pay to Play</h3>
            <p>Accept that organic is supplemental. Budget for paid promotion of your best content. Even $50-100/month makes a difference.</p>

            <div class="blog-cta">
                <h3>Need a Social Media Strategy That Works?</h3>
                <p>We create branded content systems designed for the algorithm.</p>
                <a onclick="showView('services')" class="btn-cta">Fix Your Social Strategy</a>
            </div>
        `
    },
    {
        id: 26,
        slug: 'alex-hormozi-100m-offers-brand-lessons',
        title: 'Alex Hormozi\'s $100M Offers: How to Apply Grand Slam Offer Strategy to Your Brand',
        excerpt: 'Alex Hormozi sold $100M+ in services by creating irresistible offers. Here is how to apply his framework to your branding and marketing.',
        category: 'Business Strategy',
        image: 'https://images.unsplash.com/photo-1553729459-efe14ef6055d?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'August 5, 2025',
        readTime: '11 min read',
        content: `
            <p class="blog-lead">Alex Hormozi's "$100M Offers" is required reading for anyone selling services. His Grand Slam Offer framework changes how you think about pricing, packaging, and presenting your brand. Here is how to apply it.</p>

            <h2>The Core Concept: Value vs. Price</h2>
            <p>Hormozi's formula: Make the value SO obvious that price becomes irrelevant. If your offer delivers $100,000 in value, charging $10,000 is a no-brainer. The problem? Most businesses cannot articulate their value.</p>

            <h2>The Value Equation</h2>
            <p>Value = (Dream Outcome x Perceived Likelihood of Achievement) / (Time Delay x Effort & Sacrifice)</p>
            <ul>
                <li><strong>Dream Outcome:</strong> What do they REALLY want?</li>
                <li><strong>Perceived Likelihood:</strong> Do they believe you can deliver?</li>
                <li><strong>Time Delay:</strong> How fast do they get results?</li>
                <li><strong>Effort Required:</strong> How hard is it for them?</li>
            </ul>

            <h2>Applying This to Your Brand</h2>
            <p>Your brand should communicate each element of the value equation:</p>
            <ul>
                <li><strong>Dream Outcome:</strong> Your messaging should paint the vision</li>
                <li><strong>Likelihood:</strong> Testimonials, case studies, and credibility markers</li>
                <li><strong>Speed:</strong> Clear timelines and fast-start options</li>
                <li><strong>Ease:</strong> Done-for-you services, simple processes</li>
            </ul>

            <h2>Stack the Value</h2>
            <p>Hormozi teaches value stacking â€” adding bonuses and components that increase perceived value without increasing cost. For branding, this means:</p>
            <ul>
                <li>Include brand guidelines (not just the logo)</li>
                <li>Add social media templates</li>
                <li>Include business card designs</li>
                <li>Provide a brand strategy document</li>
                <li>Offer revision rounds</li>
            </ul>

            <h2>Create Urgency and Scarcity</h2>
            <p>Limited slots. Deadline pricing. Bonuses that expire. Hormozi shows that ethical urgency increases conversions. Your brand should create reasons to act NOW.</p>

            <h2>Name Your Offer</h2>
            <p>Do not sell "logo design." Sell "The Brand Launch System" or "The Authority Brand Package." Naming creates perceived uniqueness.</p>

            <div class="blog-cta">
                <h3>Ready for a Grand Slam Brand?</h3>
                <p>We create value-stacked brand packages designed to convert.</p>
                <a onclick="showView('services')" class="btn-cta">See Our Brand Packages</a>
            </div>
        `
    },
    {
        id: 27,
        slug: 'dale-carnegie-influence-branding-lessons',
        title: 'Dale Carnegie\'s Timeless Principles: How to Win Customers and Influence Your Market',
        excerpt: 'Dale Carnegie wrote the book on human influence in 1936. His principles are more relevant than ever for building a brand people love.',
        category: 'Business Strategy',
        image: 'https://images.unsplash.com/photo-1521791136064-7986c2920216?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'July 29, 2025',
        readTime: '10 min read',
        content: `
            <p class="blog-lead">"How to Win Friends and Influence People" has sold 30+ million copies since 1936. Dale Carnegie's principles about human nature apply directly to how we build brands that connect. Here is the playbook.</p>

            <h2>Principle 1: Become Genuinely Interested in Other People</h2>
            <p>Carnegie's first rule: Care about others. For brands, this means customer-centric everything. Your website should be about THEM, not you. Your content should solve THEIR problems. Your social media should respond to THEIR needs.</p>
            <p>Brands that talk about themselves all day lose. Brands that focus on customer transformation win.</p>

            <h2>Principle 2: Smile</h2>
            <p>In branding terms: Be approachable. Your visual identity, your copy, your customer service â€” all of it should feel welcoming, not intimidating. Warmth converts.</p>

            <h2>Principle 3: Remember Names</h2>
            <p>Personalization matters. Use customer names in emails. Remember their preferences. CRM systems exist for this reason. Making someone feel known creates loyalty.</p>

            <h2>Principle 4: Be a Good Listener</h2>
            <p>Listen to your market. Read comments. Monitor reviews. Conduct surveys. The brands that win are the ones that hear what customers actually want â€” not what the brand THINKS they want.</p>

            <h2>Principle 5: Talk in Terms of Others' Interests</h2>
            <p>Features tell, benefits sell. Nobody cares that your product has "advanced technology." They care that it saves them 2 hours per day. Translate everything into customer benefit.</p>

            <h2>Principle 6: Make People Feel Important</h2>
            <p>User-generated content. Customer spotlights. Loyalty programs. Handwritten thank-you notes. Small gestures that say "you matter" create brand evangelists.</p>

            <h2>Principle 7: Avoid Arguments</h2>
            <p>On social media, in reviews, in customer service â€” never argue. Acknowledge, empathize, solve. You will never win an argument with a customer, even if you are right.</p>

            <h2>Principle 8: Admit Mistakes</h2>
            <p>Brands that own their mistakes build trust. Defensiveness destroys it. When you mess up, say so clearly, apologize sincerely, and fix it fast.</p>

            <h2>The Carnegie Brand Test</h2>
            <p>Ask yourself: Does my brand make people feel valued, heard, and important? If not, revisit these principles.</p>

            <div class="blog-cta">
                <h3>Build a Brand People Love</h3>
                <p>We create brands designed around human connection.</p>
                <a onclick="showView('services')" class="btn-cta">Start Your Brand Journey</a>
            </div>
        `
    },
    {
        id: 28,
        slug: 'what-is-sop-standard-operating-procedure',
        title: 'What Is an SOP? How Standard Operating Procedures Scale Your Business',
        excerpt: 'SOPs are the secret weapon of businesses that grow without chaos. Here is what they are, why you need them, and how to create them.',
        category: 'Business Strategy',
        image: 'https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'July 22, 2025',
        readTime: '8 min read',
        content: `
            <p class="blog-lead">You cannot scale what is only in your head. Standard Operating Procedures (SOPs) are how businesses go from dependent on the founder to running like a machine. Here is everything you need to know.</p>

            <h2>What Is an SOP?</h2>
            <p>An SOP (Standard Operating Procedure) is a step-by-step document that explains exactly how to complete a specific task or process. Think of it as a recipe â€” anyone should be able to follow it and get the same result.</p>

            <p>Examples of SOPs:</p>
            <ul>
                <li>How to onboard a new client</li>
                <li>How to process a refund</li>
                <li>How to post on social media</li>
                <li>How to respond to customer complaints</li>
                <li>How to create an invoice</li>
            </ul>

            <h2>Why SOPs Matter</h2>
            <p><strong>Consistency:</strong> Every customer gets the same experience, every time.</p>
            <p><strong>Training:</strong> New employees can get up to speed fast.</p>
            <p><strong>Delegation:</strong> You can hand off tasks without constant supervision.</p>
            <p><strong>Scale:</strong> Processes work whether you have 2 employees or 200.</p>
            <p><strong>Quality:</strong> Mistakes decrease when there is a documented process.</p>

            <h2>How to Create an SOP</h2>
            <ol>
                <li><strong>Pick one process:</strong> Start with something you do frequently</li>
                <li><strong>Record yourself doing it:</strong> Use Loom or screen recording</li>
                <li><strong>Write each step:</strong> Be specific â€” assume the reader knows nothing</li>
                <li><strong>Add screenshots:</strong> Visual guides reduce confusion</li>
                <li><strong>Test it:</strong> Have someone follow it and note where they get stuck</li>
                <li><strong>Refine:</strong> Update based on feedback</li>
            </ol>

            <h2>SOP Format Template</h2>
            <ul>
                <li><strong>Title:</strong> What process is this?</li>
                <li><strong>Purpose:</strong> Why does this process exist?</li>
                <li><strong>Scope:</strong> When does this apply?</li>
                <li><strong>Materials:</strong> What tools or access is needed?</li>
                <li><strong>Steps:</strong> Numbered, detailed instructions</li>
                <li><strong>Troubleshooting:</strong> Common issues and solutions</li>
            </ul>

            <h2>Where to Store SOPs</h2>
            <p>Google Docs, Notion, Trainual, or your project management tool. The key is that everyone can access and search them easily.</p>

            <div class="blog-cta">
                <h3>Need Branded SOP Templates?</h3>
                <p>We create professional document templates that match your brand.</p>
                <a onclick="showView('services')" class="btn-cta">Get Branded Templates</a>
            </div>
        `
    },
    {
        id: 29,
        slug: 'what-is-crm-customer-relationship-management',
        title: 'What Is a CRM? The Small Business Guide to Customer Relationship Management',
        excerpt: 'A CRM is the command center for your customer relationships. Here is what it does, why you need one, and which options work for small businesses.',
        category: 'Technology',
        image: 'https://images.unsplash.com/photo-1552581234-26160f608093?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'July 15, 2025',
        readTime: '9 min read',
        content: `
            <p class="blog-lead">If your customer data lives in spreadsheets, sticky notes, and your memory, you are leaving money on the table. A CRM (Customer Relationship Management) system changes everything.</p>

            <h2>What Is a CRM?</h2>
            <p>A CRM is software that helps you track and manage all your interactions with customers and potential customers. It is a central database where every conversation, purchase, and touchpoint is recorded.</p>

            <p>Think of it as your business's memory â€” but better, because it is searchable, shareable, and never forgets.</p>

            <h2>What Does a CRM Do?</h2>
            <ul>
                <li><strong>Contact Management:</strong> Store all customer info in one place</li>
                <li><strong>Interaction Tracking:</strong> Log calls, emails, meetings</li>
                <li><strong>Deal Pipeline:</strong> Track sales opportunities through stages</li>
                <li><strong>Task Management:</strong> Set reminders to follow up</li>
                <li><strong>Email Integration:</strong> Send and track emails from the CRM</li>
                <li><strong>Reporting:</strong> See sales metrics and forecasts</li>
                <li><strong>Automation:</strong> Trigger actions based on customer behavior</li>
            </ul>

            <h2>Why Your Business Needs a CRM</h2>
            <p><strong>No more lost leads:</strong> Every inquiry is tracked and followed up.</p>
            <p><strong>Better customer service:</strong> Anyone on your team can see full history.</p>
            <p><strong>More sales:</strong> Consistent follow-up closes more deals.</p>
            <p><strong>Data-driven decisions:</strong> See what is working and what is not.</p>
            <p><strong>Scale your team:</strong> New salespeople can hit the ground running.</p>

            <h2>Popular CRM Options for Small Business</h2>
            <ul>
                <li><strong>HubSpot CRM:</strong> Free tier, great for beginners</li>
                <li><strong>Pipedrive:</strong> Visual pipeline, sales-focused</li>
                <li><strong>Zoho CRM:</strong> Affordable, full-featured</li>
                <li><strong>Salesforce:</strong> Enterprise-level, complex</li>
                <li><strong>Monday.com:</strong> Flexible, good for project + CRM</li>
                <li><strong>GoHighLevel:</strong> All-in-one marketing + CRM</li>
            </ul>

            <h2>When to Get a CRM</h2>
            <p>If you have more than 20 customers or leads, you need a CRM. If you are forgetting to follow up, you need a CRM. If more than one person talks to customers, you need a CRM.</p>

            <div class="blog-cta">
                <h3>Need a Custom CRM Solution?</h3>
                <p>We build custom web apps tailored to your exact business process.</p>
                <a onclick="showView('services')" class="btn-cta">Explore Custom Solutions</a>
            </div>
        `
    },
    {
        id: 30,
        slug: 'email-branding-how-it-works',
        title: 'How Email Branding Works: Make Every Email Represent Your Business',
        excerpt: 'Your emails are brand touchpoints. Here is how to brand your email signatures, templates, and newsletters for professional impact.',
        category: 'Branding',
        image: 'https://images.unsplash.com/photo-1596526131083-e8c633c948d2?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'July 8, 2025',
        readTime: '7 min read',
        content: `
            <p class="blog-lead">Your team sends hundreds of emails per week. Every single one is a brand impression. Here is how to make sure those impressions are working for you.</p>

            <h2>The Three Layers of Email Branding</h2>

            <h3>1. Professional Email Address</h3>
            <p>yourname@gmail.com says amateur. yourname@yourbusiness.com says professional. Custom domain email is non-negotiable for any serious business.</p>
            <p>Options: Google Workspace, Microsoft 365, Zoho Mail</p>

            <h3>2. Email Signature</h3>
            <p>Your signature appears on every email. It should include:</p>
            <ul>
                <li>Your name and title</li>
                <li>Company name and logo</li>
                <li>Phone number</li>
                <li>Website link</li>
                <li>Social media icons (optional)</li>
                <li>Call-to-action or tagline (optional)</li>
            </ul>
            <p>Keep it clean. Avoid quotes, too many colors, or massive images.</p>

            <h3>3. Email Templates</h3>
            <p>For newsletters, promotions, and announcements, branded templates create consistency. Your colors, fonts, and logo should be instantly recognizable.</p>

            <h2>Email Signature Best Practices</h2>
            <ul>
                <li><strong>Keep it under 6 lines:</strong> Nobody reads a novel</li>
                <li><strong>Use your brand colors:</strong> Sparingly, for links or accents</li>
                <li><strong>Logo size:</strong> Keep it small (100-150px wide max)</li>
                <li><strong>Mobile-friendly:</strong> Test how it looks on phones</li>
                <li><strong>Consistent across team:</strong> Everyone should match</li>
            </ul>

            <h2>Newsletter Branding Elements</h2>
            <ul>
                <li><strong>Header:</strong> Logo and brand colors</li>
                <li><strong>Typography:</strong> Web-safe fonts that match your brand</li>
                <li><strong>Button styles:</strong> Consistent with your website</li>
                <li><strong>Footer:</strong> Contact info, social links, unsubscribe</li>
                <li><strong>Image style:</strong> Consistent editing and treatment</li>
            </ul>

            <h2>Tools for Email Branding</h2>
            <ul>
                <li><strong>Signatures:</strong> WiseStamp, HubSpot, Canva</li>
                <li><strong>Newsletters:</strong> Mailchimp, ConvertKit, Klaviyo</li>
                <li><strong>Templates:</strong> Stripo, Bee Free, Litmus</li>
            </ul>

            <div class="blog-cta">
                <h3>Need Professional Email Templates?</h3>
                <p>We design branded email signatures and newsletter templates.</p>
                <a onclick="showView('services')" class="btn-cta">Get Email Branding</a>
            </div>
        `
    },
    {
        id: 31,
        slug: 'how-to-send-email-blast-eblast-guide',
        title: 'How to Send an Email Blast: The Complete E-Blast Guide for Small Business',
        excerpt: 'Email blasts still work when done right. Here is how to send e-blasts that get opened, read, and drive action.',
        category: 'Marketing',
        image: 'https://images.unsplash.com/photo-1563986768494-4dee2763ff3f?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'July 1, 2025',
        readTime: '10 min read',
        content: `
            <p class="blog-lead">An email blast (or e-blast) is a single email sent to your entire list at once. Done right, it is one of the highest-ROI marketing activities. Done wrong, it lands in spam. Here is how to do it right.</p>

            <h2>What Is an Email Blast?</h2>
            <p>An email blast is a one-time email sent to many recipients simultaneously. Unlike automated sequences that trigger based on behavior, an e-blast is a broadcast â€” same message, same time, to everyone (or a segment).</p>

            <p>Common uses:</p>
            <ul>
                <li>Product launches</li>
                <li>Sale announcements</li>
                <li>Event invitations</li>
                <li>Company news</li>
                <li>Newsletter editions</li>
            </ul>

            <h2>Step-by-Step: Sending Your First E-Blast</h2>

            <h3>Step 1: Choose Your Platform</h3>
            <p>You cannot send mass emails from Gmail â€” you will get flagged as spam. Use an email marketing platform:</p>
            <ul>
                <li><strong>Mailchimp:</strong> Free up to 500 contacts</li>
                <li><strong>ConvertKit:</strong> Great for creators</li>
                <li><strong>Constant Contact:</strong> Small business friendly</li>
                <li><strong>Klaviyo:</strong> E-commerce focused</li>
                <li><strong>Brevo (Sendinblue):</strong> Affordable high volume</li>
            </ul>

            <h3>Step 2: Build Your List</h3>
            <p>Import your contacts. Make sure you have permission to email them (they opted in). Buying email lists is illegal in many places and destroys deliverability.</p>

            <h3>Step 3: Segment If Needed</h3>
            <p>Not every email should go to everyone. Segment by customer type, location, purchase history, or engagement level.</p>

            <h3>Step 4: Write Your Email</h3>
            <ul>
                <li><strong>Subject line:</strong> 40 characters or less, creates curiosity</li>
                <li><strong>Preview text:</strong> Supports the subject line</li>
                <li><strong>Body:</strong> One clear message, one clear CTA</li>
                <li><strong>Design:</strong> Use your branded template</li>
            </ul>

            <h3>Step 5: Test Before Sending</h3>
            <p>Send a test to yourself. Check on desktop AND mobile. Click every link.</p>

            <h3>Step 6: Schedule and Send</h3>
            <p>Best times vary, but Tuesday-Thursday between 10am-2pm tends to perform well. Test and track your own data.</p>

            <h2>E-Blast Mistakes to Avoid</h2>
            <ul>
                <li>No clear call-to-action</li>
                <li>Too many topics in one email</li>
                <li>Sending from no-reply@ addresses</li>
                <li>Forgetting mobile optimization</li>
                <li>Not cleaning your list regularly</li>
            </ul>

            <div class="blog-cta">
                <h3>Need E-Blast Templates That Convert?</h3>
                <p>We design branded email templates that get results.</p>
                <a onclick="showView('services')" class="btn-cta">Get Email Templates</a>
            </div>
        `
    },
    {
        id: 32,
        slug: 'how-to-get-more-dms-direct-messages',
        title: 'How to Get More DMs: Turn Your Social Media Into a Lead Machine',
        excerpt: 'DMs are where deals happen. Here is how to create content that makes people want to message you â€” and start real conversations.',
        category: 'Social Media',
        image: 'https://images.unsplash.com/photo-1611926653458-09294b3142bf?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'June 24, 2025',
        readTime: '9 min read',
        content: `
            <p class="blog-lead">Likes are vanity. DMs are money. The businesses winning on social media are the ones turning followers into conversations. Here is exactly how to get more direct messages.</p>

            <h2>Why DMs Matter More Than Followers</h2>
            <p>A DM is intent. Someone took time to privately reach out. That is a warm lead. 10 DMs from qualified prospects beats 10,000 passive followers every time.</p>

            <h2>Content That Generates DMs</h2>

            <h3>1. "DM Me" Call-to-Actions</h3>
            <p>Literally ask. "DM me 'GUIDE' and I will send you my free checklist." "Have questions? DM me, I respond to everyone." Direct asks work.</p>

            <h3>2. Controversial Takes</h3>
            <p>Strong opinions attract people who agree (and disagree). They will DM to share their thoughts. Safe, boring content generates nothing.</p>

            <h3>3. Behind-the-Scenes Content</h3>
            <p>Show your process. People are curious. They will DM asking questions about how you do what you do.</p>

            <h3>4. Results and Case Studies</h3>
            <p>"Just helped a client 3x their revenue." People who want similar results will reach out.</p>

            <h3>5. Relatable Struggles</h3>
            <p>Share your challenges. Vulnerability creates connection. People DM to say "me too."</p>

            <h2>Optimize Your Profile for DMs</h2>
            <ul>
                <li><strong>Bio:</strong> Clear statement of who you help and how</li>
                <li><strong>CTA in bio:</strong> "DM me to get started"</li>
                <li><strong>Highlights:</strong> Testimonials, services, FAQ</li>
                <li><strong>Link:</strong> Booking page or lead magnet</li>
            </ul>

            <h2>The DM Conversation Framework</h2>
            <ol>
                <li><strong>Acknowledge:</strong> Thank them for reaching out</li>
                <li><strong>Qualify:</strong> Ask about their situation</li>
                <li><strong>Provide value:</strong> Give a quick win or insight</li>
                <li><strong>Transition:</strong> Offer a call or next step</li>
            </ol>

            <h2>Use Stories to Drive DMs</h2>
            <p>Instagram Stories with polls, questions, and sliders create interaction. Reply to every response â€” this opens a DM thread. Now you are in conversation.</p>

            <div class="blog-cta">
                <h3>Need a Social Media Strategy?</h3>
                <p>We create content systems designed to generate leads.</p>
                <a onclick="showView('services')" class="btn-cta">Build Your Social Strategy</a>
            </div>
        `
    },
    {
        id: 33,
        slug: 'how-to-get-more-engagement-social-media',
        title: 'How to Get More Engagement on Social Media (Without Begging for Likes)',
        excerpt: 'Engagement is not about luck â€” it is about strategy. Here are the proven tactics that make people comment, share, and save your content.',
        category: 'Social Media',
        image: 'https://images.unsplash.com/photo-1611162618071-b39a2ec055fb?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'June 17, 2025',
        readTime: '10 min read',
        content: `
            <p class="blog-lead">"Like if you agree!" is not a strategy. Real engagement comes from content that triggers emotional and intellectual responses. Here is how to create posts people actually interact with.</p>

            <h2>Why Engagement Matters</h2>
            <p>The algorithm rewards engagement. Posts with comments, shares, and saves get shown to more people. Low engagement = the algorithm buries your content. It is a flywheel â€” engagement creates more reach, which creates more engagement.</p>

            <h2>The Engagement Hierarchy</h2>
            <p>Not all engagement is equal. From most to least valuable:</p>
            <ol>
                <li><strong>Saves:</strong> Highest signal â€” people want to return to this</li>
                <li><strong>Shares:</strong> They are putting their reputation on it</li>
                <li><strong>Comments:</strong> They took time to respond</li>
                <li><strong>Likes:</strong> Lowest effort, but still counts</li>
            </ol>

            <h2>Content Types That Drive Engagement</h2>

            <h3>1. Ask Questions</h3>
            <p>End posts with a genuine question. Not "thoughts?" â€” that is lazy. Specific questions: "What is the biggest challenge you are facing with X right now?"</p>

            <h3>2. Hot Takes and Opinions</h3>
            <p>"Unpopular opinion: [your take]." Strong positions polarize â€” and polarization drives engagement. Agreers and disagreers both comment.</p>

            <h3>3. Educational Carousels</h3>
            <p>Multi-slide posts with valuable information get saved. "5 mistakes killing your [X]" â€” people save these to reference later.</p>

            <h3>4. Story-Driven Content</h3>
            <p>Personal stories create emotional connection. Vulnerability, failures, and comebacks resonate more than polished success.</p>

            <h3>5. Fill-in-the-Blank</h3>
            <p>"The best business advice I ever got was ______." Easy for people to respond to.</p>

            <h2>Engagement Tactics That Work</h2>
            <ul>
                <li><strong>Reply to every comment:</strong> Doubles your comment count and builds relationships</li>
                <li><strong>Engage before posting:</strong> 15 minutes of commenting on others' posts primes the algorithm</li>
                <li><strong>Post when your audience is online:</strong> Check your analytics</li>
                <li><strong>Use all features:</strong> Reels, Stories, carousels â€” platforms reward users who use new features</li>
                <li><strong>Create "saveable" content:</strong> Checklists, frameworks, templates</li>
            </ul>

            <h2>What Kills Engagement</h2>
            <ul>
                <li>Posting links (platforms hate sending people away)</li>
                <li>Stock photos and generic graphics</li>
                <li>Pure self-promotion with no value</li>
                <li>Inconsistent posting (algorithm forgets you)</li>
                <li>Ignoring comments and DMs</li>
            </ul>

            <div class="blog-cta">
                <h3>Need Content That Engages?</h3>
                <p>We create social media templates and strategies that drive real interaction.</p>
                <a onclick="showView('services')" class="btn-cta">Boost Your Engagement</a>
            </div>
        `
    },
    {
        id: 34,
        slug: 'businesses-leaving-social-media-traditional-marketing',
        title: 'Why Smart Businesses Are Leaving Social Media and Going Back to Cold Calls and Mailers',
        excerpt: 'The social media backlash is real. Here is why some businesses are ditching the algorithm and returning to direct mail, cold calling, and old-school marketing.',
        category: 'Marketing',
        image: 'https://images.unsplash.com/photo-1586769852044-692d6e3703f0?w=800&q=80',
        author: 'Faren Young',
        authorImage: 'NUI.avif',
        date: 'June 10, 2025',
        readTime: '11 min read',
        content: `
            <p class="blog-lead">Something interesting is happening. While everyone obsesses over Instagram algorithms and TikTok trends, a growing number of successful businesses are quietly going back to basics: cold calls, direct mail, and face-to-face networking. Here is why â€” and what it means for your marketing strategy.</p>

            <h2>The Social Media Exhaustion Is Real</h2>
            <p>Business owners are burned out. The constant content treadmill. The algorithm changes. The pay-to-play model where organic reach keeps dying. Many are asking: "Is this actually working, or am I just busy?"</p>

            <p>The numbers tell the story:</p>
            <ul>
                <li>Facebook organic reach: down to 2-5% of followers</li>
                <li>Instagram engagement rates: dropped 30% since 2020</li>
                <li>Time spent creating content: 10-20 hours per week for most businesses</li>
                <li>Actual ROI: often unmeasurable or disappointing</li>
            </ul>

            <h2>Why Traditional Marketing Is Making a Comeback</h2>

            <h3>1. Less Competition in the Mailbox</h3>
            <p>Everyone went digital. That means physical mailboxes are less crowded than they have been in decades. A well-designed direct mail piece stands out because nobody else is doing it.</p>
            <p>Direct mail response rates are now 5-9% compared to email's 1%. That is not a typo.</p>

            <h3>2. Cold Calling Actually Works (When Done Right)</h3>
            <p>The phone still works. Decision makers answer calls. While everyone is hiding behind DMs and emails, the salesperson who picks up the phone gets through. Less competition = more opportunity.</p>

            <h3>3. You Own the Relationship</h3>
            <p>Social media followers are rented. The platform can change the rules, ban your account, or die (remember Vine?). A phone number, email address, or mailing address is YOURS. Nobody can algorithm that away.</p>

            <h3>4. Higher Quality Conversations</h3>
            <p>A phone call or in-person meeting builds more trust in 15 minutes than 6 months of social media content. Real conversation beats parasocial relationships.</p>

            <h3>5. Measurable ROI</h3>
            <p>You sent 500 mailers. 25 people called. 5 became customers worth $10,000 each. That is clear math. Social media? "We got 50,000 impressions" means nothing to your bank account.</p>

            <h2>What Traditional Marketing Looks Like in 2026</h2>

            <h3>Direct Mail (Done Right)</h3>
            <ul>
                <li><strong>Handwritten envelopes:</strong> 99% open rate</li>
                <li><strong>Dimensional mailers:</strong> Boxes and tubes get opened</li>
                <li><strong>Personalization:</strong> Variable data printing makes each piece unique</li>
                <li><strong>Follow-up sequences:</strong> Multiple touches, not one-and-done</li>
            </ul>

            <h3>Cold Calling (The Modern Way)</h3>
            <ul>
                <li><strong>Research first:</strong> Know who you are calling and why</li>
                <li><strong>Value-first approach:</strong> Lead with insight, not a pitch</li>
                <li><strong>Multi-channel:</strong> Call + email + LinkedIn touch</li>
                <li><strong>Persistence:</strong> Average sale takes 8 touches</li>
            </ul>

            <h3>Networking and Events</h3>
            <ul>
                <li><strong>Industry conferences:</strong> One conversation can be worth 1,000 followers</li>
                <li><strong>Local business groups:</strong> BNI, Chamber of Commerce, meetups</li>
                <li><strong>Hosting your own events:</strong> Workshops, lunch-and-learns</li>
            </ul>

            <h2>The Hybrid Approach: Best of Both Worlds</h2>
            <p>The smartest businesses are not abandoning social media entirely â€” they are rebalancing. Social media for awareness and credibility. Traditional methods for conversion and relationship-building.</p>

            <p>A balanced marketing mix might look like:</p>
            <ul>
                <li>30% social media (brand awareness, content)</li>
                <li>25% email marketing (nurturing, offers)</li>
                <li>20% direct outreach (cold calls, LinkedIn DMs)</li>
                <li>15% direct mail (high-value prospects)</li>
                <li>10% networking/events (relationship building)</li>
            </ul>

            <h2>When to Consider Going Traditional</h2>
            <ul>
                <li>Your target customer is over 40</li>
                <li>You sell high-ticket B2B services</li>
                <li>Your local market matters more than national reach</li>
                <li>You are exhausted by the content hamster wheel</li>
                <li>Your social media ROI is unclear or negative</li>
            </ul>

            <h2>Your Brand Still Matters (Maybe More)</h2>
            <p>Here is the thing: traditional marketing requires even better branding. Your direct mail piece has 3 seconds to make an impression. Your cold call opener needs instant credibility. Your business card gets judged immediately.</p>

            <p>Going old-school does not mean looking old-school. Premium brand identity makes every traditional touchpoint more effective.</p>

            <div class="blog-cta">
                <h3>Need Branding That Works Everywhere?</h3>
                <p>We create brand systems designed for both digital and traditional marketing.</p>
                <a onclick="showView('services')" class="btn-cta">Build Your Brand System</a>
            </div>
        `
    }
];

let currentBlogPost = null;

function loadBlogView() {
    document.getElementById('blogView').innerHTML = `
        <style>
            .blog-hero { padding: 140px 48px 80px; text-align: center; background: linear-gradient(180deg, #0a0a0a 0%, #050505 100%); position: relative; }
            .blog-hero::before { content: ''; position: absolute; inset: 0; background: url('https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=1920&q=80') center/cover; opacity: 0.15; }
            .blog-hero-content { position: relative; z-index: 2; }
            .blog-hero h1 { font-size: clamp(48px, 8vw, 80px); font-weight: 900; text-transform: uppercase; margin-bottom: 16px; }
            .blog-hero h1 span { color: var(--red); }
            .blog-hero p { font-size: 18px; color: var(--gray); max-width: 600px; margin: 0 auto; }

            .blog-categories { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; padding: 32px 24px; background: #080808; border-bottom: 1px solid rgba(255,255,255,0.06); }
            .blog-category { padding: 10px 24px; background: transparent; border: 1px solid rgba(255,255,255,0.15); border-radius: 100px; color: rgba(255,255,255,0.7); font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
            .blog-category:hover, .blog-category.active { background: var(--red); border-color: var(--red); color: white; }

            .blog-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 32px; max-width: 1400px; margin: 0 auto; padding: 60px 48px; }
            .blog-card { background: #0a0a0a; border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; overflow: hidden; transition: all 0.3s; cursor: pointer; }
            .blog-card:hover { transform: translateY(-8px); border-color: rgba(255,59,48,0.3); box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
            .blog-card-image { position: relative; aspect-ratio: 16/9; overflow: hidden; }
            .blog-card-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
            .blog-card:hover .blog-card-image img { transform: scale(1.05); }
            .blog-card-image::after { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, transparent 50%, rgba(0,0,0,0.8) 100%); }
            .blog-card-category { position: absolute; top: 16px; left: 16px; background: var(--red); color: white; padding: 6px 14px; border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; z-index: 2; }
            .blog-card-content { padding: 28px; }
            .blog-card-title { font-size: 20px; font-weight: 800; line-height: 1.3; margin-bottom: 12px; color: #fff; }
            .blog-card-excerpt { font-size: 14px; color: var(--gray); line-height: 1.6; margin-bottom: 20px; }
            .blog-card-meta { display: flex; align-items: center; gap: 12px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.06); }
            .blog-card-author-img { width: 36px; height: 36px; border-radius: 50%; background: var(--red); display: flex; align-items: center; justify-content: center; overflow: hidden; }
            .blog-card-author-img img { width: 100%; height: 100%; object-fit: cover; }
            .blog-card-author-name { font-size: 13px; font-weight: 600; color: #fff; }
            .blog-card-date { font-size: 12px; color: var(--gray); }
            .blog-card-read { font-size: 12px; color: var(--red); margin-left: auto; font-weight: 600; }

            /* SINGLE POST */
            .blog-post { max-width: 800px; margin: 0 auto; padding: 140px 24px 80px; }
            .blog-post-back { display: inline-flex; align-items: center; gap: 8px; color: var(--gray); font-size: 14px; margin-bottom: 32px; cursor: pointer; transition: color 0.3s; }
            .blog-post-back:hover { color: var(--red); }
            .blog-post-category { display: inline-block; background: var(--red); color: white; padding: 8px 16px; border-radius: 4px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; }
            .blog-post-title { font-size: clamp(32px, 5vw, 48px); font-weight: 900; line-height: 1.2; margin-bottom: 24px; }
            .blog-post-meta { display: flex; align-items: center; gap: 20px; padding-bottom: 32px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 40px; flex-wrap: wrap; }
            .blog-post-author { display: flex; align-items: center; gap: 12px; }
            .blog-post-author-img { width: 48px; height: 48px; border-radius: 50%; overflow: hidden; border: 2px solid var(--red); }
            .blog-post-author-img img { width: 100%; height: 100%; object-fit: cover; }
            .blog-post-author-name { font-weight: 700; color: #fff; }
            .blog-post-author-title { font-size: 13px; color: var(--gray); }
            .blog-post-date { color: var(--gray); font-size: 14px; }
            .blog-post-read { color: var(--red); font-size: 14px; font-weight: 600; }

            .blog-post-image { width: 100%; aspect-ratio: 16/9; border-radius: 16px; overflow: hidden; margin-bottom: 48px; position: relative; }
            .blog-post-image img { width: 100%; height: 100%; object-fit: cover; }
            .blog-post-image::after { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(255,59,48,0.2) 0%, transparent 100%); }

            .blog-post-content { font-size: 17px; line-height: 1.9; color: rgba(255,255,255,0.85); }
            .blog-post-content h2 { font-size: 28px; font-weight: 800; color: #fff; margin: 48px 0 20px; }
            .blog-post-content p { margin-bottom: 24px; }
            .blog-post-content .blog-lead { font-size: 20px; color: #fff; line-height: 1.7; margin-bottom: 32px; }
            .blog-post-content ul { margin: 24px 0; padding-left: 24px; }
            .blog-post-content li { margin-bottom: 12px; color: rgba(255,255,255,0.8); }
            .blog-post-content strong { color: #fff; }

            .blog-cta { background: linear-gradient(135deg, rgba(255,59,48,0.15) 0%, rgba(255,59,48,0.05) 100%); border: 1px solid rgba(255,59,48,0.2); border-radius: 16px; padding: 40px; text-align: center; margin: 48px 0; }
            .blog-cta h3 { font-size: 24px; font-weight: 800; margin-bottom: 12px; }
            .blog-cta p { color: var(--gray); margin-bottom: 24px; }
            .blog-cta .btn-cta { display: inline-block; }

            /* SHARE */
            .blog-share { display: flex; align-items: center; gap: 16px; padding: 32px 0; border-top: 1px solid rgba(255,255,255,0.1); margin-top: 48px; }
            .blog-share-label { font-size: 14px; font-weight: 600; color: var(--gray); }
            .blog-share-buttons { display: flex; gap: 12px; }
            .blog-share-btn { width: 44px; height: 44px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; color: #fff; font-size: 18px; cursor: pointer; transition: all 0.3s; text-decoration: none; }
            .blog-share-btn:hover { background: var(--red); border-color: var(--red); transform: scale(1.1); }

            @media (max-width: 968px) {
                .blog-grid { grid-template-columns: repeat(2, 1fr); gap: 24px; padding: 40px 24px; }
            }
            @media (max-width: 600px) {
                .blog-hero { padding: 120px 24px 60px; }
                .blog-hero h1 { font-size: 36px; }
                .blog-grid { grid-template-columns: 1fr; gap: 20px; padding: 32px 16px; }
                .blog-card-content { padding: 20px; }
                .blog-card-title { font-size: 18px; }
                .blog-post { padding: 120px 16px 60px; }
                .blog-post-title { font-size: 28px; }
                .blog-post-content { font-size: 15px; }
                .blog-post-content h2 { font-size: 22px; }
                .blog-categories { padding: 20px 16px; gap: 8px; }
                .blog-category { padding: 8px 16px; font-size: 11px; }
            }
        </style>

        <div id="blogList">
            <section class="blog-hero">
                <div class="blog-hero-content">
                    <h1>THE <span>INFLUENCE</span> BLOG</h1>
                    <p>Insights, strategies, and real talk about building brands that dominate. No fluff, just actionable advice.</p>
                </div>
            </section>

            <div class="blog-categories">
                <button class="blog-category active" onclick="filterBlogPosts('all')">All Posts</button>
                <button class="blog-category" onclick="filterBlogPosts('Branding')">Branding</button>
                <button class="blog-category" onclick="filterBlogPosts('Personal Branding')">Personal Branding</button>
                <button class="blog-category" onclick="filterBlogPosts('Sales Strategy')">Sales</button>
                <button class="blog-category" onclick="filterBlogPosts('Business Strategy')">Business Strategy</button>
                <button class="blog-category" onclick="filterBlogPosts('Brand Strategy')">Brand Strategy</button>
                <button class="blog-category" onclick="filterBlogPosts('Web Design')">Web Design</button>
                <button class="blog-category" onclick="filterBlogPosts('Technology')">Technology</button>
                <button class="blog-category" onclick="filterBlogPosts('Social Media')">Social Media</button>
                <button class="blog-category" onclick="filterBlogPosts('Marketing')">Marketing</button>
            </div>

            <div class="blog-grid" id="blogGrid">
                ${blogPosts.map(post => `
                    <article class="blog-card" data-category="${post.category}" onclick="showBlogPost(${post.id})">
                        <div class="blog-card-image">
                            <img src="${post.image}" alt="${post.title}">
                            <span class="blog-card-category">${post.category}</span>
                        </div>
                        <div class="blog-card-content">
                            <h3 class="blog-card-title">${post.title}</h3>
                            <p class="blog-card-excerpt">${post.excerpt}</p>
                            <div class="blog-card-meta">
                                <div class="blog-card-author-img"><img src="${post.authorImage}" alt="${post.author}"></div>
                                <div>
                                    <div class="blog-card-author-name">${post.author}</div>
                                    <div class="blog-card-date">${post.date}</div>
                                </div>
                                <span class="blog-card-read">${post.readTime}</span>
                            </div>
                        </div>
                    </article>
                `).join('')}
            </div>
        </div>

        <div id="blogSingle" style="display: none;"></div>

        <footer class="footer"><div class="footer-content"><a class="footer-logo" onclick="showView('home')"><img src="NUI.avif" alt="NUI" style="height: 40px;"></a><div class="footer-links"><a onclick="showView('services')">Services</a><a onclick="showView('portfolio')">Portfolio</a><a onclick="showView('blog')">Blog</a><a onclick="showView('portal')">Client Portal</a></div><div style="color: var(--gray); font-size: 14px;">Â© 2026 New Urban Influence</div></div></footer>
    `;
}

function filterBlogPosts(category) {
    document.querySelectorAll('.blog-category').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.includes(category) || (category === 'all' && btn.textContent === 'All Posts'));
    });

    document.querySelectorAll('.blog-card').forEach(card => {
        if (category === 'all' || card.dataset.category === category) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

function showBlogPost(postId) {
    const post = blogPosts.find(p => p.id === postId);
    if (!post) return;

    currentBlogPost = post;
    document.getElementById('blogList').style.display = 'none';
    document.getElementById('blogSingle').style.display = 'block';

    const shareUrl = encodeURIComponent(window.location.href);
    const shareText = encodeURIComponent(post.title + ' - New Urban Influence');

    document.getElementById('blogSingle').innerHTML = `
        <article class="blog-post">
            <a class="blog-post-back" onclick="closeBlogPost()">â† Back to Blog</a>
            <span class="blog-post-category">${post.category}</span>
            <h1 class="blog-post-title">${post.title}</h1>
            <div class="blog-post-meta">
                <div class="blog-post-author">
                    <div class="blog-post-author-img"><img src="${post.authorImage}" alt="${post.author}"></div>
                    <div>
                        <div class="blog-post-author-name">${post.author}</div>
                        <div class="blog-post-author-title">Founder, New Urban Influence</div>
                    </div>
                </div>
                <span class="blog-post-date">${post.date}</span>
                <span class="blog-post-read">${post.readTime}</span>
            </div>
            <div class="blog-post-image">
                <img src="${post.image}" alt="${post.title}">
            </div>
            <div class="blog-post-content">
                ${post.content}
            </div>
            <div class="blog-share">
                <span class="blog-share-label">Share this article:</span>
                <div class="blog-share-buttons">
                    <a href="https://twitter.com/intent/tweet?text=${shareText}&url=${shareUrl}" target="_blank" class="blog-share-btn" title="Share on X/Twitter">ð•</a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=${shareUrl}" target="_blank" class="blog-share-btn" title="Share on Facebook">f</a>
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=${shareUrl}&title=${shareText}" target="_blank" class="blog-share-btn" title="Share on LinkedIn">in</a>
                    <a href="mailto:?subject=${shareText}&body=Check out this article: ${shareUrl}" class="blog-share-btn" title="Share via Email">âœ‰</a>
                </div>
            </div>
        </article>
        <footer class="footer"><div class="footer-content"><a class="footer-logo" onclick="showView('home')"><img src="NUI.avif" alt="NUI" style="height: 40px;"></a><div class="footer-links"><a onclick="showView('services')">Services</a><a onclick="showView('portfolio')">Portfolio</a><a onclick="showView('blog')">Blog</a><a onclick="showView('portal')">Client Portal</a></div><div style="color: var(--gray); font-size: 14px;">Â© 2026 New Urban Influence</div></div></footer>
    `;

    window.scrollTo(0, 0);
}

function closeBlogPost() {
    document.getElementById('blogList').style.display = 'block';
    document.getElementById('blogSingle').style.display = 'none';
    currentBlogPost = null;
    window.scrollTo(0, 0);
}

// ==================== PORTAL VIEW ====================
function loadPortalView() {
    document.getElementById('portalView').innerHTML = portalStyles + `
        <div id="portalLogin" class="portal-login">
            <div class="login-box">
                <div style="text-align: center; margin-bottom: 32px;">
                    <img src="NUI.avif" alt="NUI" style="height: 60px; margin-bottom: 16px;">
                    <h2 style="font-size: 24px; margin-bottom: 8px;">Brand Portal</h2>
                    <p style="color: var(--gray); font-size: 14px;">Access your brand assets & orders</p>
                </div>
                <div class="login-tabs">
                    <button onclick="setLoginType('client')" id="clientTab" class="login-tab active">Client</button>
                    <button onclick="setLoginType('designer')" id="designerTab" class="login-tab">Designer</button>
                    <button onclick="setLoginType('admin')" id="adminTab" class="login-tab">Admin</button>
                </div>
                <form onsubmit="handlePortalLogin(event)">
                    <div class="form-group"><label class="form-label">Email</label><input type="email" id="portalEmail" class="form-input" placeholder="you@example.com" required></div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="portalPassword" class="form-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                        <a onclick="forgotPassword()" style="display: block; text-align: right; margin-top: 8px; color: var(--red); font-size: 12px; cursor: pointer;">Forgot Password?</a>
                    </div>
                    <button type="submit" class="btn-cta" style="width: 100%; justify-content: center;">Sign In</button>
                </form>

                <div style="display: flex; align-items: center; margin: 24px 0; gap: 16px;">
                    <div style="flex: 1; height: 1px; background: #333;"></div>
                    <span style="color: #666; font-size: 12px;">or continue with</span>
                    <div style="flex: 1; height: 1px; background: #333;"></div>
                </div>

                <!-- Social Login Buttons -->
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button onclick="googleSignIn()" style="display: flex; align-items: center; justify-content: center; gap: 12px; width: 100%; padding: 12px 16px; background: #fff; color: #333; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">
                        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        Continue with Google
                    </button>
                </div>

                <p style="text-align: center; margin-top: 24px; color: var(--gray); font-size: 11px;">Demo: client@test.com / client123<br>Designer: faren@nui.com / designer123<br>Admin: admin@nui.com / admin123</p>

                <!-- Quick Access Buttons for Demo Mode -->
                <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 16px;">
                    <button onclick="quickAdminAccess()" style="padding: 12px 16px; background: linear-gradient(135deg, #e11d48, #be185d); border: none; color: #fff; cursor: pointer; border-radius: 8px; font-size: 14px; font-weight: 600; width: 100%;">âš¡ Quick Admin Access (Demo Mode)</button>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="quickDesignerAccess()" style="flex: 1; padding: 10px 12px; background: #3b82f6; border: none; color: #fff; cursor: pointer; border-radius: 6px; font-size: 12px; font-weight: 500;">ðŸ‘¨â€ðŸŽ¨ Designer</button>
                        <button onclick="quickClientAccess()" style="flex: 1; padding: 10px 12px; background: #10b981; border: none; color: #fff; cursor: pointer; border-radius: 6px; font-size: 12px; font-weight: 500;">ðŸ‘¤ Demo Client</button>
                    </div>
                </div>

                <button onclick="resetAllData()" style="margin-top: 12px; padding: 8px 16px; background: transparent; border: 1px solid #444; color: #888; cursor: pointer; border-radius: 4px; font-size: 11px; width: 100%;">ðŸ”„ Reset All Data (if login issues)</button>
            </div>
        </div>
        <div id="adminDashboard" style="display: none;">
            <header class="admin-header">
                <div style="display: flex; align-items: center; gap: 16px;"><img src="NUI.avif" alt="NUI" style="height: 32px;"><span style="font-weight: 600;">Admin Dashboard</span></div>
                <div style="display: flex; align-items: center; gap: 12px;">
                    <button onclick="validateAllWorkflows()" style="padding: 8px 16px; background: #10b981; border: none; color: #fff; cursor: pointer; border-radius: 4px; font-family: inherit; font-weight: 500;">ðŸ” Test Workflows</button>
                    <button onclick="initializeDemoData(); location.reload();" style="padding: 8px 16px; background: #3b82f6; border: none; color: #fff; cursor: pointer; border-radius: 4px; font-family: inherit; font-weight: 500;">ðŸ”„ Reset Demo Data</button>
                    <button onclick="portalLogout()" style="padding: 8px 16px; background: transparent; border: 1px solid rgba(255,255,255,0.3); color: #fff; cursor: pointer; border-radius: 4px;">Logout</button>
                </div>
            </header>
            <div class="admin-container">
                <aside class="admin-sidebar">
                    <nav class="admin-nav">
                        <div class="admin-nav-group">
                            <span class="admin-nav-label">OVERVIEW</span>
                            <a onclick="showAdminPanel('dashboard')" class="admin-nav-link active" data-panel="dashboard">ðŸ“Š Dashboard</a>
                            <a onclick="showAdminPanel('analytics')" class="admin-nav-link" data-panel="analytics">ðŸ“ˆ Site Analytics</a>
                            <a onclick="showAdminPanel('reviews')" class="admin-nav-link" data-panel="reviews">â­ Google Reviews</a>
                        </div>
                        <div class="admin-nav-group">
                            <span class="admin-nav-label">CRM & SALES</span>
                            <a onclick="showAdminPanel('crm')" class="admin-nav-link" data-panel="crm">ðŸ’¼ CRM Pipeline</a>
                            <a onclick="showAdminPanel('clients')" class="admin-nav-link" data-panel="clients">ðŸ‘¥ Clients</a>
                            <a onclick="showAdminPanel('leads')" class="admin-nav-link" data-panel="leads">ðŸŽ¯ Leads</a>
                            <a onclick="showAdminPanel('submissions')" class="admin-nav-link" data-panel="submissions">ðŸ“© Submissions</a>
                        </div>
                        <div class="admin-nav-group">
                            <span class="admin-nav-label">PROJECTS</span>
                            <a onclick="showAdminPanel('projects')" class="admin-nav-link" data-panel="projects">ðŸ“‚ Project Tracker</a>
                            <a onclick="showAdminPanel('orders')" class="admin-nav-link" data-panel="orders">ðŸ“‹ Orders</a>
                            <a onclick="showAdminPanel('proofs')" class="admin-nav-link" data-panel="proofs">âœ… Proof Approval</a>
                            <a onclick="showAdminPanel('brandguide')" class="admin-nav-link" data-panel="brandguide">ðŸ“˜ Brand Guide</a>
                            <a onclick="showAdminPanel('delivery')" class="admin-nav-link" data-panel="delivery">ðŸ“¦ Delivery</a>
                        </div>
                        <div class="admin-nav-group">
                            <span class="admin-nav-label">BILLING</span>
                            <a onclick="showAdminPanel('payments')" class="admin-nav-link" data-panel="payments">ðŸ’³ Payments</a>
                            <a onclick="showAdminPanel('invoices')" class="admin-nav-link" data-panel="invoices">ðŸ“„ Invoices</a>
                            <a onclick="showAdminPanel('payouts')" class="admin-nav-link" data-panel="payouts">ðŸ’° Payouts</a>
                            <a onclick="showAdminPanel('stripe')" class="admin-nav-link" data-panel="stripe">ðŸ’Ž Stripe</a>
                        </div>
                        <div class="admin-nav-group">
                            <span class="admin-nav-label">SEO & MARKETING</span>
                            <a onclick="showAdminPanel('seo')" class="admin-nav-link" data-panel="seo">ðŸ” SEO/AEO/GEO</a>
                            <a onclick="showAdminPanel('gmb')" class="admin-nav-link" data-panel="gmb">ðŸ“ Google Business</a>
                            <a onclick="showAdminPanel('emailmarketing')" class="admin-nav-link" data-panel="emailmarketing">ðŸ“§ Email Marketing</a>
                            <a onclick="showAdminPanel('loyalty')" class="admin-nav-link" data-panel="loyalty">ðŸŽ Loyalty Program</a>
                        </div>
                        <div class="admin-nav-group">
                            <span class="admin-nav-label">COMMUNICATIONS</span>
                            <a onclick="showAdminPanel('communications')" class="admin-nav-link" data-panel="communications">ðŸ’¬ Inbox Hub</a>
                            <a onclick="showAdminPanel('socialdm')" class="admin-nav-link" data-panel="socialdm">ðŸ“± Social DMs</a>
                            <a onclick="showAdminPanel('sms')" class="admin-nav-link" data-panel="sms">ðŸ“² SMS (OpenPhone)</a>
                        </div>
                        <div class="admin-nav-group">
                            <span class="admin-nav-label">CONTENT</span>
                            <a onclick="showAdminPanel('siteimages')" class="admin-nav-link" data-panel="siteimages">ðŸ–¼ï¸ Site Images</a>
                            <a onclick="showAdminPanel('assets')" class="admin-nav-link" data-panel="assets">ðŸ“ Client Assets</a>
                            <a onclick="showAdminPanel('portfolio')" class="admin-nav-link" data-panel="portfolio">ðŸŽ¨ Portfolio</a>
                            <a onclick="showAdminPanel('about')" class="admin-nav-link" data-panel="about">ðŸ“„ About Page</a>
                        </div>
                        <div class="admin-nav-group">
                            <span class="admin-nav-label">TEAM</span>
                            <a onclick="showAdminPanel('designers')" class="admin-nav-link" data-panel="designers">ðŸŽ¨ Designers</a>
                            <a onclick="showAdminPanel('newclient')" class="admin-nav-link" data-panel="newclient">âž• New Client</a>
                            <a onclick="showAdminPanel('neworder')" class="admin-nav-link" data-panel="neworder">âž• New Order</a>
                        </div>
                        <div class="admin-nav-group">
                            <span class="admin-nav-label">INTEGRATIONS</span>
                            <a onclick="showAdminPanel('integrations')" class="admin-nav-link" data-panel="integrations">ðŸ”— All Integrations</a>
                        </div>
                    </nav>
                </aside>
                <main class="admin-main">
                    <div id="adminDashboardPanel" class="admin-panel active"></div>
                    <div id="adminAnalyticsPanel" class="admin-panel"></div>
                    <div id="adminReviewsPanel" class="admin-panel"></div>
                    <div id="adminCrmPanel" class="admin-panel"></div>
                    <div id="adminClientsPanel" class="admin-panel"></div>
                    <div id="adminOrdersPanel" class="admin-panel"></div>
                    <div id="adminNewOrderPanel" class="admin-panel"></div>
                    <div id="adminLeadsPanel" class="admin-panel"></div>
                    <div id="adminSubmissionsPanel" class="admin-panel"></div>
                    <div id="adminProjectsPanel" class="admin-panel"></div>
                    <div id="adminProofsPanel" class="admin-panel"></div>
                    <div id="adminBrandguidePanel" class="admin-panel"></div>
                    <div id="adminDeliveryPanel" class="admin-panel"></div>
                    <div id="adminPaymentsPanel" class="admin-panel"></div>
                    <div id="adminInvoicesPanel" class="admin-panel"></div>
                    <div id="adminPayoutsPanel" class="admin-panel"></div>
                    <div id="adminStripePanel" class="admin-panel"></div>
                    <div id="adminSeoPanel" class="admin-panel"></div>
                    <div id="adminGmbPanel" class="admin-panel"></div>
                    <div id="adminEmailmarketingPanel" class="admin-panel"></div>
                    <div id="adminLoyaltyPanel" class="admin-panel"></div>
                    <div id="adminCommunicationsPanel" class="admin-panel"></div>
                    <div id="adminSocialdmPanel" class="admin-panel"></div>
                    <div id="adminSmsPanel" class="admin-panel"></div>
                    <div id="adminSiteimagesPanel" class="admin-panel"></div>
                    <div id="adminNewClientPanel" class="admin-panel"></div>
                    <div id="adminAssetsPanel" class="admin-panel"></div>
                    <div id="adminPortfolioPanel" class="admin-panel"></div>
                    <div id="adminAboutPanel" class="admin-panel"></div>
                    <div id="adminDesignersPanel" class="admin-panel"></div>
                    <div id="adminIntegrationsPanel" class="admin-panel"></div>
                </main>
            </div>
        </div>
        <div id="clientPortal" style="display: none; min-height: 100vh; background: #000; color: #fff;">
            <header style="background: #000; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 16px 32px; display: flex; justify-content: space-between; align-items: center; position: fixed; top: 76px; left: 0; right: 0; z-index: 100;">
                <span id="clientPortalName" style="font-weight: 600;"></span>
                <button onclick="portalLogout()" style="padding: 8px 16px; background: transparent; border: 1px solid rgba(255,255,255,0.3); color: #fff; cursor: pointer; border-radius: 4px;">Sign Out</button>
            </header>
            <div id="clientPortalContent" style="padding-top: 132px;"></div>
        </div>
        <div id="invoiceModal" class="modal-overlay">
            <div class="modal">
                <div class="modal-header"><h3 class="modal-title">Invoice Preview</h3><button class="modal-close" onclick="closeInvoiceModal()">Ã—</button></div>
                <div class="modal-body" id="invoiceContent"></div>
                <div class="modal-footer"><button class="btn-cta" onclick="printInvoice()">Print Invoice</button></div>
            </div>
        </div>
    `;
    // Reset state and show login
    currentUser = null;
    loginType = 'client';
    setTimeout(() => {
        const loginEl = document.getElementById('portalLogin');
        const adminEl = document.getElementById('adminDashboard');
        const clientEl = document.getElementById('clientPortal');
        if (loginEl) loginEl.style.display = 'flex';
        if (adminEl) adminEl.style.display = 'none';
        if (clientEl) clientEl.style.display = 'none';
    }, 10);
}

function setLoginType(type) {
    loginType = type;
    document.getElementById('clientTab').classList.toggle('active', type === 'client');
    document.getElementById('designerTab').classList.toggle('active', type === 'designer');
    document.getElementById('adminTab').classList.toggle('active', type === 'admin');
}

// DEMO MODE - Password checks disabled
const DEMO_MODE = true;

function handlePortalLogin(e) {
    e.preventDefault();
    const emailEl = document.getElementById('portalEmail');
    const passwordEl = document.getElementById('portalPassword');
    if (!emailEl || !passwordEl) { alert('Form elements not found. Please refresh.'); return; }
    const email = emailEl.value.trim().toLowerCase();
    const password = passwordEl.value;
    console.log('Login attempt:', loginType, email);

    if (loginType === 'admin') {
        // DEMO MODE: Skip password check
        if (DEMO_MODE || (email === 'admin@nui.com' && password === 'admin123')) {
            currentUser = { type: 'admin', email: 'admin@nui.com' };
            document.getElementById('portalLogin').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            loadAdminDashboardPanel();
            console.log('Admin login successful (DEMO MODE)');
        } else { alert('Invalid admin credentials.\nUse: admin@nui.com / admin123'); }
    } else if (loginType === 'designer') {
        // DEMO MODE: Auto-login as first designer
        const designer = DEMO_MODE ? designers[0] : designers.find(d => d.email.toLowerCase() === email && d.password === password);
        if (designer) {
            currentUser = { type: 'designer', ...designer };
            document.getElementById('portalLogin').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            loadDesignerDashboard(designer);
            console.log('Designer login successful:', designer.name);
        } else { alert('Invalid designer credentials.\nUse: faren@nui.com / designer123'); }
    } else {
        console.log('Checking clients:', clients.length);
        // DEMO MODE: Auto-login as first client or find by email only
        const client = DEMO_MODE ? (clients.find(c => c.email.toLowerCase() === email) || clients[0]) : clients.find(c => c.email.toLowerCase() === email && c.password === password);
        if (client) {
            currentUser = { type: 'client', ...client };
            document.getElementById('portalLogin').style.display = 'none';
            document.getElementById('clientPortal').style.display = 'block';
            showClientPortal(client);
            console.log('Client login successful:', client.name);
        } else { alert('Invalid client credentials.\nUse: client@test.com / client123'); }
    }
}

// Quick Admin Access Button (DEMO MODE)
function quickAdminAccess() {
    currentUser = { type: 'admin', email: 'admin@nui.com' };
    document.getElementById('portalLogin').style.display = 'none';
    document.getElementById('adminDashboard').style.display = 'block';
    loadAdminDashboardPanel();
    console.log('Quick Admin Access (DEMO MODE)');
}

// Quick Designer Access (DEMO MODE)
function quickDesignerAccess() {
    currentUser = { type: 'designer', email: 'faren@nui.com', name: 'Faren' };
    document.getElementById('portalLogin').style.display = 'none';
    document.getElementById('adminDashboard').style.display = 'block';
    loadAdminDashboardPanel();
    console.log('Quick Designer Access (DEMO MODE)');
}

// Quick Client Access (DEMO MODE)
function quickClientAccess() {
    const clients = JSON.parse(localStorage.getItem('nui_clients')) || [];
    const demoClient = clients.find(c => c.email === 'hello@detroitcoffee.com') || clients[0];
    if (demoClient) {
        currentUser = { type: 'client', clientId: demoClient.id, email: demoClient.email, name: demoClient.name };
        document.getElementById('portalLogin').style.display = 'none';
        document.getElementById('clientPortal').style.display = 'block';
        loadClientPortal(demoClient);
        console.log('Quick Client Access (DEMO MODE) - ' + demoClient.name);
    } else {
        // If no clients exist, initialize demo data first
        initializeDemoData();
        const newClients = JSON.parse(localStorage.getItem('nui_clients')) || [];
        if (newClients.length > 0) {
            currentUser = { type: 'client', clientId: newClients[0].id, email: newClients[0].email, name: newClients[0].name };
            document.getElementById('portalLogin').style.display = 'none';
            document.getElementById('clientPortal').style.display = 'block';
            loadClientPortal(newClients[0]);
        } else {
            alert('No demo clients available. Please try Reset Demo Data.');
        }
    }
}

// Google Sign-In using Google Identity Services
function googleSignIn() {
    // Check if Google Identity Services is loaded
    if (typeof google !== 'undefined' && google.accounts) {
        google.accounts.id.initialize({
            client_id: 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com', // Replace with actual client ID in production
            callback: handleGoogleCredentialResponse,
            auto_select: false
        });

        google.accounts.id.prompt((notification) => {
            if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                // Fallback to manual flow if One Tap isn't available
                googleSignInFallback();
            }
        });
    } else {
        // Fallback for when Google Identity Services isn't loaded
        googleSignInFallback();
    }
}

// Handle Google credential response (JWT)
function handleGoogleCredentialResponse(response) {
    try {
        // Decode the JWT credential
        const payload = JSON.parse(atob(response.credential.split('.')[1]));

        const googleUser = {
            email: payload.email,
            name: payload.name || payload.email.split('@')[0],
            picture: payload.picture || '',
            emailVerified: payload.email_verified || false
        };

        processGoogleUser(googleUser);
    } catch (error) {
        console.error('Error processing Google credential:', error);
        alert('Error signing in with Google. Please try again.');
    }
}

// Fallback when Google API isn't available (for testing/demo)
function googleSignInFallback() {
    const email = prompt('Enter your Google email address:', '');
    if (!email) return;

    if (!validateEmail(email)) {
        alert('Please enter a valid email address.');
        return;
    }

    const mockGoogleUser = {
        email: email,
        name: email.split('@')[0].replace(/[._]/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
        picture: '',
        emailVerified: true
    };

    processGoogleUser(mockGoogleUser);
}

// Process Google user - login or create account
function processGoogleUser(googleUser) {
    // Check if user exists
    let existingClient = clients.find(c => c.email.toLowerCase() === googleUser.email.toLowerCase());

    if (existingClient) {
        // Login existing user
        currentUser = { type: 'client', ...existingClient };
        document.getElementById('portalLogin').style.display = 'none';
        document.getElementById('clientPortal').style.display = 'block';
        showClientPortal(existingClient);
        console.log('Google login successful:', existingClient.name);
    } else {
        // Create new account
        if (confirm('No account found with ' + googleUser.email + '. Create a new account?')) {
            const newClient = {
                id: Date.now(),
                name: googleUser.name,
                email: googleUser.email,
                password: 'google_oauth_' + Date.now(), // Random password for OAuth users
                industry: 'Not specified',
                website: '',
                colors: ['#ff0000', '#000000', '#ffffff'],
                fonts: { heading: 'Inter', body: 'Inter' },
                assets: { logos: [], mockups: [], social: [], video: [], banner: [], fonts: [], patterns: [], package: [] },
                googleLinked: true,
                googlePicture: googleUser.picture,
                emailVerified: googleUser.emailVerified,
                createdVia: 'google',
                createdAt: new Date().toISOString()
            };
            clients.push(newClient);
            saveClients();

            currentUser = { type: 'client', ...newClient };
            document.getElementById('portalLogin').style.display = 'none';
            document.getElementById('clientPortal').style.display = 'block';
            showClientPortal(newClient);
            alert('Welcome, ' + newClient.name + '! Your account has been created.');
        }
    }
}

// Forgot Password
function forgotPassword() {
    const email = prompt('Enter your email address to reset your password:');
    if (!email) return;

    const client = clients.find(c => c.email.toLowerCase() === email.toLowerCase());
    const designer = designers.find(d => d.email.toLowerCase() === email.toLowerCase());

    if (client || designer || email === 'admin@nui.com') {
        alert('Password reset link sent to ' + email + '!\n\n(In production, this would send an actual email with a reset link)');
    } else {
        alert('No account found with email: ' + email);
    }
}

function portalLogout() {
    currentUser = null;
    currentAdminClient = null;
    const loginEl = document.getElementById('portalLogin');
    const adminEl = document.getElementById('adminDashboard');
    const clientEl = document.getElementById('clientPortal');
    const emailEl = document.getElementById('portalEmail');
    const passwordEl = document.getElementById('portalPassword');
    if (loginEl) loginEl.style.display = 'flex';
    if (adminEl) adminEl.style.display = 'none';
    if (clientEl) clientEl.style.display = 'none';
    if (emailEl) emailEl.value = '';
    if (passwordEl) passwordEl.value = '';
    loginType = 'client';
    const clientTab = document.getElementById('clientTab');
    const adminTab = document.getElementById('adminTab');
    if (clientTab) clientTab.classList.add('active');
    if (adminTab) adminTab.classList.remove('active');
}

function showAdminPanel(panel) {
    document.querySelectorAll('.admin-nav-link').forEach(l => l.classList.remove('active'));
    const activeLink = document.querySelector(`[data-panel="${panel}"]`);
    if (activeLink) activeLink.classList.add('active');
    document.querySelectorAll('.admin-panel').forEach(p => p.classList.remove('active'));
    const panelEl = document.getElementById('admin' + panel.charAt(0).toUpperCase() + panel.slice(1) + 'Panel');
    if (panelEl) panelEl.classList.add('active');

    // Load panel content
    const panelLoaders = {
        'dashboard': loadAdminDashboardPanel,
        'analytics': loadAdminAnalyticsPanel,
        'reviews': loadAdminReviewsPanel,
        'crm': loadAdminCrmPanel,
        'clients': loadAdminClientsPanel,
        'orders': loadAdminOrdersPanel,
        'neworder': loadAdminNewOrderPanel,
        'leads': loadAdminLeadsPanel,
        'submissions': loadAdminSubmissionsPanel,
        'projects': loadAdminProjectsPanel,
        'proofs': loadAdminProofsPanel,
        'brandguide': loadAdminBrandGuidePanel,
        'delivery': loadAdminDeliveryPanel,
        'payments': loadAdminPaymentsPanel,
        'invoices': loadAdminInvoicesPanel,
        'payouts': loadAdminPayoutsPanel,
        'stripe': loadAdminStripePanel,
        'seo': loadAdminSeoPanel,
        'gmb': loadAdminGmbPanel,
        'emailmarketing': loadAdminEmailMarketingPanel,
        'loyalty': loadAdminLoyaltyPanel,
        'communications': loadAdminCommunicationsPanel,
        'socialdm': loadAdminSocialDmPanel,
        'sms': loadAdminSmsPanel,
        'siteimages': loadAdminSiteImagesPanel,
        'newclient': loadAdminNewClientPanel,
        'assets': loadAdminAssetsPanel,
        'portfolio': loadAdminPortfolioPanel,
        'about': loadAdminAboutPanel,
        'designers': loadAdminDesignersPanel,
        'integrations': loadAdminIntegrationsPanel
    };
    if (panelLoaders[panel]) panelLoaders[panel]();
}

// ==================== ADMIN PORTFOLIO PANEL ====================
let currentPortfolioCase = null;
let portfolioAssetCategory = 'primaryLogo';

function loadAdminPortfolioPanel() {
    document.getElementById('adminPortfolioPanel').innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <h1 style="font-size: 28px; font-weight: 700;">Portfolio Case Studies</h1>
            <button onclick="addNewPortfolioCase()" class="btn-cta">+ Add Case Study</button>
        </div>
        <div class="card-grid">
            ${portfolioData.map(p => `
                <div class="client-card" style="cursor: pointer;" onclick="editPortfolioCase('${p.id}')">
                    <div class="client-card-header" style="background: linear-gradient(135deg, ${p.colors[0]}, ${p.colors[1]});">
                        <img src="${p.assets?.primaryLogo || p.img}" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
                    </div>
                    <div class="client-card-body">
                        <div class="client-card-name">${p.name}</div>
                        <div class="client-card-meta">${p.tag}</div>
                        <div style="display: flex; gap: 8px; margin-top: 12px;">
                            <span style="font-size: 11px; background: #f0f0f0; padding: 4px 8px; border-radius: 4px;">${p.assets?.primaryLogo ? 'âœ“ Logo' : 'â—‹ Logo'}</span>
                            <span style="font-size: 11px; background: #f0f0f0; padding: 4px 8px; border-radius: 4px;">${p.colors.length} Colors</span>
                        </div>
                    </div>
                </div>
            `).join('')}
        </div>
        ${currentPortfolioCase ? renderPortfolioEditor() : ''}
    `;
}

function renderPortfolioEditor() {
    const p = portfolioData.find(x => x.id === currentPortfolioCase);
    if (!p) return '';
    return `
        <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 40px;">
            <div style="background: #fff; width: 100%; max-width: 900px; max-height: 90vh; overflow-y: auto; border-radius: 16px;">
                <div style="padding: 24px; border-bottom: 1px solid #e5e5e5; display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="font-size: 24px; font-weight: 700;">Edit: ${p.name}</h2>
                    <button onclick="currentPortfolioCase = null; loadAdminPortfolioPanel();" style="background: none; border: none; font-size: 24px; cursor: pointer;">Ã—</button>
                </div>
                <div style="padding: 24px;">
                    <div class="form-section">
                        <div class="form-section-title">Basic Info</div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Name</label><input type="text" class="form-input" value="${p.name}" onchange="updatePortfolioField('${p.id}', 'name', this.value)"></div>
                            <div class="form-group"><label class="form-label">Tag</label><input type="text" class="form-input" value="${p.tag}" onchange="updatePortfolioField('${p.id}', 'tag', this.value)"></div>
                        </div>
                        <div class="form-group"><label class="form-label">Description</label><textarea class="form-input" rows="2" onchange="updatePortfolioField('${p.id}', 'desc', this.value)">${p.desc}</textarea></div>
                        <div class="form-group"><label class="form-label">Slogan</label><input type="text" class="form-input" value="${p.slogan || ''}" onchange="updatePortfolioField('${p.id}', 'slogan', this.value)" placeholder="e.g., Your Brand Tagline Here"></div>
                        <div class="form-group"><label class="form-label">Mission Statement</label><textarea class="form-input" rows="3" onchange="updatePortfolioField('${p.id}', 'mission', this.value)" placeholder="What is the brand's mission?">${p.mission || ''}</textarea></div>
                        <div class="form-group"><label class="form-label">Website URL</label><input type="url" class="form-input" value="${p.websiteUrl || ''}" onchange="updatePortfolioField('${p.id}', 'websiteUrl', this.value)" placeholder="https://example.com"></div>
                    </div>
                    <div class="form-section" style="margin-top: 24px;">
                        <div class="form-section-title">Hero Banner Image (21:9 Full Width)</div>
                        <div style="aspect-ratio: 21/9; border: 2px dashed #ddd; border-radius: 16px; overflow: hidden; background: linear-gradient(135deg, ${p.colors[0]} 0%, ${p.colors[1]} 100%); position: relative;">
                            ${p.img ? `<img src="${p.img}" style="width: 100%; height: 100%; object-fit: cover; opacity: 0.5;">` : ''}
                            <div style="position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px;">
                                <div style="font-size: 32px; font-weight: 900; color: #fff; text-shadow: 0 2px 8px rgba(0,0,0,0.5);">${p.name}</div>
                                <input type="file" id="heroImageUpload" style="display: none;" onchange="uploadPortfolioHero('${p.id}', this)">
                                <button onclick="document.getElementById('heroImageUpload').click()" style="padding: 12px 24px; background: rgba(0,0,0,0.7); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; backdrop-filter: blur(10px);">Upload Hero Image</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-section" style="margin-top: 24px;">
                        <div class="form-section-title">Logo System (1:1 Square)</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
                            <div style="aspect-ratio: 1/1; border: 2px dashed #ddd; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; background: #fafafa;">
                                <div style="font-size: 11px; color: #888; padding: 16px; background: #f0f0f0; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; text-align: center;">Primary Logo</div>
                                <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 24px;">
                                    ${p.assets?.primaryLogo ? `<img src="${p.assets.primaryLogo}" style="max-height: 100%; max-width: 100%; object-fit: contain;">` : '<div style="color: #ccc; font-size: 13px;">No logo</div>'}
                                </div>
                                <div style="padding: 16px; background: #f0f0f0; text-align: center;">
                                    <input type="file" id="primaryLogoUpload" style="display: none;" onchange="uploadPortfolioAsset('${p.id}', 'primaryLogo', this)">
                                    <button onclick="document.getElementById('primaryLogoUpload').click()" style="padding: 10px 20px; background: #000; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;">Upload</button>
                                </div>
                            </div>
                            <div style="aspect-ratio: 1/1; border: 2px dashed #ddd; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; background: #fafafa;">
                                <div style="font-size: 11px; color: #888; padding: 16px; background: #f0f0f0; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; text-align: center;">Secondary Logo</div>
                                <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 24px;">
                                    ${p.assets?.secondaryLogo ? `<img src="${p.assets.secondaryLogo}" style="max-height: 100%; max-width: 100%; object-fit: contain;">` : '<div style="color: #ccc; font-size: 13px;">No logo</div>'}
                                </div>
                                <div style="padding: 16px; background: #f0f0f0; text-align: center;">
                                    <input type="file" id="secondaryLogoUpload" style="display: none;" onchange="uploadPortfolioAsset('${p.id}', 'secondaryLogo', this)">
                                    <button onclick="document.getElementById('secondaryLogoUpload').click()" style="padding: 10px 20px; background: #000; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;">Upload</button>
                                </div>
                            </div>
                            <div style="aspect-ratio: 1/1; border: 2px dashed #ddd; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; background: #fafafa;">
                                <div style="font-size: 11px; color: #888; padding: 16px; background: #f0f0f0; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; text-align: center;">Icon / Logo Mark</div>
                                <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 24px;">
                                    ${p.assets?.iconMark ? `<img src="${p.assets.iconMark}" style="max-height: 100%; max-width: 100%; object-fit: contain;">` : '<div style="color: #ccc; font-size: 13px;">No icon</div>'}
                                </div>
                                <div style="padding: 16px; background: #f0f0f0; text-align: center;">
                                    <input type="file" id="iconMarkUpload" style="display: none;" onchange="uploadPortfolioAsset('${p.id}', 'iconMark', this)">
                                    <button onclick="document.getElementById('iconMarkUpload').click()" style="padding: 10px 20px; background: #000; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;">Upload</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-section" style="margin-top: 24px;">
                        <div class="form-section-title">Color Palette</div>
                        <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                            ${p.colors.map((c, i) => `
                                <div style="text-align: center;">
                                    <input type="color" value="${c}" onchange="updatePortfolioColor('${p.id}', ${i}, this.value)" style="width: 60px; height: 60px; border: none; border-radius: 8px; cursor: pointer;">
                                    <div style="font-size: 11px; color: #888; margin-top: 4px;">${c}</div>
                                </div>
                            `).join('')}
                            <button onclick="addPortfolioColor('${p.id}')" style="width: 60px; height: 60px; border: 2px dashed #ddd; border-radius: 8px; background: none; cursor: pointer; font-size: 24px; color: #ccc;">+</button>
                        </div>
                    </div>
                    <div class="form-section" style="margin-top: 24px;">
                        <div class="form-section-title">Font System</div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Heading Font</label><input type="text" class="form-input" value="${p.fonts?.heading || ''}" onchange="updatePortfolioFont('${p.id}', 'heading', this.value)"></div>
                            <div class="form-group"><label class="form-label">Body Font</label><input type="text" class="form-input" value="${p.fonts?.body || ''}" onchange="updatePortfolioFont('${p.id}', 'body', this.value)"></div>
                        </div>
                    </div>
                    <div class="form-section" style="margin-top: 24px;">
                        <div class="form-section-title">Brand Mockups (Image / Video)</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            ${(p.assets?.mockups || []).map((m, i) => `
                                <div style="position: relative; border-radius: 16px; overflow: hidden; box-shadow: 0 8px 24px rgba(0,0,0,0.15);">
                                    ${m.includes('video') || m.match(/\.(mp4|webm|mov|ogg)$/i) ? `<video src="${m}" autoplay muted loop playsinline style="width: 100%; aspect-ratio: 16/9; object-fit: cover;"></video>` : `<img src="${m}" style="width: 100%; aspect-ratio: 16/9; object-fit: cover;">`}
                                    <div style="position: absolute; bottom: 12px; left: 12px; background: rgba(0,0,0,0.7); color: #fff; padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase;">${m.includes('video') || m.match(/\.(mp4|webm|mov|ogg)$/i) ? 'â–¶ Video' : 'Image'} ${i+1}</div>
                                    <button onclick="removePortfolioMockup('${p.id}', ${i})" style="position: absolute; top: 12px; right: 12px; background: #dc2626; color: #fff; border: none; border-radius: 50%; width: 28px; height: 28px; cursor: pointer; font-size: 16px;">Ã—</button>
                                </div>
                            `).join('')}
                            <div style="border: 2px dashed #ddd; border-radius: 16px; aspect-ratio: 16/9; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; background: #fafafa;">
                                <div style="width: 48px; height: 48px; border: 2px dashed #ccc; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #ccc;">â–¶</div>
                                <input type="file" id="mockupUpload" accept="image/*,video/*" style="display: none;" onchange="uploadPortfolioMockup('${p.id}', this)">
                                <button onclick="document.getElementById('mockupUpload').click()" style="padding: 12px 24px; background: #000; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">+ Add Image / Video</button>
                                <div style="font-size: 11px; color: #888;">Supports JPG, PNG, MP4, WebM</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-section" style="margin-top: 24px;">
                        <div class="form-section-title">Results</div>
                        <div class="form-row" style="grid-template-columns: repeat(3, 1fr);">
                            <div class="form-group"><label class="form-label">Revenue Growth</label><input type="text" class="form-input" value="${p.results?.revenue || ''}" onchange="updatePortfolioResult('${p.id}', 'revenue', this.value)"></div>
                            <div class="form-group"><label class="form-label">Web Traffic</label><input type="text" class="form-input" value="${p.results?.traffic || ''}" onchange="updatePortfolioResult('${p.id}', 'traffic', this.value)"></div>
                            <div class="form-group"><label class="form-label">Engagement</label><input type="text" class="form-input" value="${p.results?.engagement || ''}" onchange="updatePortfolioResult('${p.id}', 'engagement', this.value)"></div>
                        </div>
                    </div>
                    <div style="margin-top: 32px; display: flex; gap: 16px;">
                        <button onclick="currentPortfolioCase = null; loadAdminPortfolioPanel();" class="btn-cta">Save & Close</button>
                        <button onclick="deletePortfolioCase('${p.id}')" style="padding: 12px 24px; background: #fee2e2; color: #dc2626; border: none; border-radius: 8px; cursor: pointer;">Delete Case Study</button>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function editPortfolioCase(id) {
    currentPortfolioCase = id;
    loadAdminPortfolioPanel();
}

function updatePortfolioField(id, field, value) {
    const p = portfolioData.find(x => x.id === id);
    if (p) { p[field] = value; savePortfolio(); }
}

function updatePortfolioColor(id, index, value) {
    const p = portfolioData.find(x => x.id === id);
    if (p) { p.colors[index] = value; savePortfolio(); loadAdminPortfolioPanel(); }
}

function addPortfolioColor(id) {
    const p = portfolioData.find(x => x.id === id);
    if (p && p.colors.length < 6) { p.colors.push('#000000'); savePortfolio(); loadAdminPortfolioPanel(); }
}

function updatePortfolioFont(id, type, value) {
    const p = portfolioData.find(x => x.id === id);
    if (p) { if (!p.fonts || Array.isArray(p.fonts)) p.fonts = { heading: '', body: '' }; p.fonts[type] = value; savePortfolio(); }
}

function updatePortfolioResult(id, type, value) {
    const p = portfolioData.find(x => x.id === id);
    if (p) { if (!p.results) p.results = {}; p.results[type] = value; savePortfolio(); }
}

function uploadPortfolioAsset(id, type, input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const p = portfolioData.find(x => x.id === id);
        if (p) { if (!p.assets) p.assets = {}; p.assets[type] = e.target.result; savePortfolio(); loadAdminPortfolioPanel(); }
    };
    reader.readAsDataURL(file);
}

function uploadPortfolioHero(id, input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const p = portfolioData.find(x => x.id === id);
        if (p) { p.img = e.target.result; savePortfolio(); loadAdminPortfolioPanel(); }
    };
    reader.readAsDataURL(file);
}

function uploadPortfolioMockup(id, input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const p = portfolioData.find(x => x.id === id);
        if (p) { if (!p.assets) p.assets = {}; if (!p.assets.mockups) p.assets.mockups = []; p.assets.mockups.push(e.target.result); savePortfolio(); loadAdminPortfolioPanel(); }
    };
    reader.readAsDataURL(file);
}

function removePortfolioMockup(id, index) {
    const p = portfolioData.find(x => x.id === id);
    if (p && p.assets?.mockups) { p.assets.mockups.splice(index, 1); savePortfolio(); loadAdminPortfolioPanel(); }
}

function addNewPortfolioCase() {
    const newId = 'case-' + Date.now();
    portfolioData.push({
        id: newId,
        name: 'New Case Study',
        tag: 'Brand Identity',
        desc: 'Description here...',
        img: 'https://images.unsplash.com/photo-1557804506-669a67965ba0?w=800',
        colors: ['#000000', '#ffffff', '#ff3b30'],
        fonts: { heading: 'Inter', body: 'Inter' },
        assets: { primaryLogo: '', secondaryLogo: '', iconMark: '', mockups: [] },
        results: { revenue: '+0%', traffic: '+0%', engagement: '+0%' },
        testimonial: { text: 'Testimonial here...', author: 'Client Name', title: 'Position' }
    });
    savePortfolio();
    currentPortfolioCase = newId;
    loadAdminPortfolioPanel();
}

function deletePortfolioCase(id) {
    if (!confirm('Delete this case study?')) return;
    portfolioData = portfolioData.filter(p => p.id !== id);
    savePortfolio();
    currentPortfolioCase = null;
    loadAdminPortfolioPanel();
}

// ==================== ADMIN ABOUT PAGE PANEL ====================
function loadAdminAboutPanel() {
    document.getElementById('adminAboutPanel').innerHTML = `
        <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 32px;">About Page Settings</h1>

        <div class="form-section">
            <div class="form-section-title">Story Section Image</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; align-items: start;">
                <div style="aspect-ratio: 4/5; background: #f5f5f5; border: 2px dashed #ddd; border-radius: 12px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                    ${aboutData.storyImage ? `<img src="${aboutData.storyImage}" style="width: 100%; height: 100%; object-fit: cover;">` : '<span style="color: #999;">No Image</span>'}
                </div>
                <div>
                    <p style="color: #666; margin-bottom: 16px;">Upload an image for the "Our Story" section on the About page. Recommended size: 800x1000px (4:5 ratio)</p>
                    <input type="file" id="storyImageUpload" accept="image/*" style="display: none;" onchange="uploadAboutStoryImage(this)">
                    <button onclick="document.getElementById('storyImageUpload').click()" style="padding: 12px 24px; background: var(--red); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Upload Story Image</button>
                    ${aboutData.storyImage ? `<button onclick="removeAboutStoryImage()" style="padding: 12px 24px; background: #fee2e2; color: #dc2626; border: none; border-radius: 8px; cursor: pointer; margin-left: 12px;">Remove</button>` : ''}
                </div>
            </div>
        </div>

        <div class="form-section" style="margin-top: 32px;">
            <div class="form-section-title">Team Members</div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
                ${aboutData.team.map((member, i) => `
                    <div style="background: #fff; border: 1px solid #e5e5e5; border-radius: 12px; padding: 20px;">
                        <div style="aspect-ratio: 3/4; background: #f5f5f5; border: 2px dashed #ddd; border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                            ${member.photo ? `<img src="${member.photo}" style="width: 100%; height: 100%; object-fit: cover;">` : '<span style="color: #999; font-size: 12px;">No Photo</span>'}
                        </div>
                        <input type="file" id="teamPhoto${i}" accept="image/*" style="display: none;" onchange="uploadTeamPhoto(${i}, this)">
                        <button onclick="document.getElementById('teamPhoto${i}').click()" style="width: 100%; padding: 10px; background: #000; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; margin-bottom: 12px;">Upload Photo</button>
                        ${member.photo ? `<button onclick="removeTeamPhoto(${i})" style="width: 100%; padding: 10px; background: #fee2e2; color: #dc2626; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; margin-bottom: 12px;">Remove Photo</button>` : ''}
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label class="form-label" style="font-size: 11px;">Name</label>
                            <input type="text" class="form-input" style="padding: 10px; font-size: 14px;" value="${member.name}" onchange="updateTeamMember(${i}, 'name', this.value)">
                        </div>
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label class="form-label" style="font-size: 11px;">Title</label>
                            <input type="text" class="form-input" style="padding: 10px; font-size: 14px;" value="${member.title}" onchange="updateTeamMember(${i}, 'title', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size: 11px;">Bio</label>
                            <textarea class="form-input" style="padding: 10px; font-size: 13px;" rows="3" onchange="updateTeamMember(${i}, 'bio', this.value)">${member.bio}</textarea>
                        </div>
                    </div>
                `).join('')}
            </div>
            <div style="margin-top: 20px;">
                <button onclick="addTeamMember()" style="padding: 12px 24px; background: #000; color: #fff; border: none; border-radius: 8px; cursor: pointer;">+ Add Team Member</button>
            </div>
        </div>
    `;
}

function uploadAboutStoryImage(input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        aboutData.storyImage = e.target.result;
        saveAbout();
        loadAdminAboutPanel();
        loadAboutView();
    };
    reader.readAsDataURL(file);
}

function removeAboutStoryImage() {
    aboutData.storyImage = '';
    saveAbout();
    loadAdminAboutPanel();
    loadAboutView();
}

function uploadTeamPhoto(index, input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        aboutData.team[index].photo = e.target.result;
        saveAbout();
        loadAdminAboutPanel();
        loadAboutView();
    };
    reader.readAsDataURL(file);
}

function removeTeamPhoto(index) {
    aboutData.team[index].photo = '';
    saveAbout();
    loadAdminAboutPanel();
    loadAboutView();
}

function updateTeamMember(index, field, value) {
    aboutData.team[index][field] = value;
    saveAbout();
    loadAboutView();
}

function addTeamMember() {
    aboutData.team.push({
        name: 'New Member',
        title: 'Role',
        bio: 'Bio here...',
        photo: ''
    });
    saveAbout();
    loadAdminAboutPanel();
}

// ==================== ADMIN PANELS ====================
function loadAdminDashboardPanel() {
    const totalAssets = clients.reduce((sum, c) => sum + (c.assets ? Object.values(c.assets).flat().length : 0), 0);
    const pendingOrders = orders.filter(o => o.status !== 'delivered').length;
    const totalRevenue = orders.reduce((sum, o) => sum + (o.estimate || 0), 0);
    const paidRevenue = orders.filter(o => o.paymentStatus === 'paid').reduce((sum, o) => sum + (o.estimate || 0), 0);
    const avgReview = siteAnalytics.googleReviews?.avgRating || 4.8;

    document.getElementById('adminDashboardPanel').innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <h1 style="font-size: 28px; font-weight: 700;">Dashboard</h1>
            <div style="display: flex; gap: 12px;">
                <button onclick="syncAllData()" class="btn-outline" style="display: flex; align-items: center; gap: 8px;">ðŸ”„ Sync All</button>
                <span class="sync-status" style="display: flex; align-items: center; gap: 6px; padding: 8px 16px; background: #10b981; color: #fff; border-radius: 8px; font-size: 13px;">
                    <span style="width: 8px; height: 8px; background: #fff; border-radius: 50%;"></span> All Systems Synced
                </span>
            </div>
        </div>

        <!-- Quick Stats Row -->
        <div class="stat-cards" style="margin-bottom: 32px;">
            <div class="stat-card" style="cursor: pointer;" onclick="showAdminPanel('clients')"><div class="num">${clients.length}</div><div class="lbl">Active Clients</div></div>
            <div class="stat-card" style="cursor: pointer;" onclick="showAdminPanel('orders')"><div class="num">${orders.length}</div><div class="lbl">Total Orders</div></div>
            <div class="stat-card" style="cursor: pointer;" onclick="showAdminPanel('projects')"><div class="num">${pendingOrders}</div><div class="lbl">In Progress</div></div>
            <div class="stat-card" style="cursor: pointer;" onclick="showAdminPanel('analytics')"><div class="num">${siteAnalytics.visitors?.total || 2847}</div><div class="lbl">Site Visitors</div></div>
        </div>

        <!-- Revenue & Reviews Row -->
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 32px;">
            <div style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); padding: 24px; border-radius: 16px; color: #fff;">
                <h3 style="font-size: 14px; color: #888; margin-bottom: 16px;">REVENUE OVERVIEW</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
                    <div>
                        <div style="font-size: 32px; font-weight: 700; color: var(--accent);">$${totalRevenue.toLocaleString()}</div>
                        <div style="font-size: 13px; color: #888;">Total Revenue</div>
                    </div>
                    <div>
                        <div style="font-size: 32px; font-weight: 700; color: #10b981;">$${paidRevenue.toLocaleString()}</div>
                        <div style="font-size: 13px; color: #888;">Collected</div>
                    </div>
                    <div>
                        <div style="font-size: 32px; font-weight: 700; color: #f59e0b;">$${(totalRevenue - paidRevenue).toLocaleString()}</div>
                        <div style="font-size: 13px; color: #888;">Outstanding</div>
                    </div>
                </div>
                <button onclick="showAdminPanel('payments')" class="btn-outline" style="margin-top: 20px; width: 100%;">View All Payments â†’</button>
            </div>
            <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5;">
                <h3 style="font-size: 14px; color: #888; margin-bottom: 16px;">GOOGLE REVIEWS</h3>
                <div style="text-align: center;">
                    <div style="font-size: 48px; font-weight: 700; color: #f59e0b;">â­ ${avgReview}</div>
                    <div style="font-size: 13px; color: #888;">${siteAnalytics.googleReviews?.count || 47} reviews</div>
                    <button onclick="showAdminPanel('reviews')" class="btn-cta" style="margin-top: 16px; width: 100%;">Manage Reviews</button>
                </div>
            </div>
        </div>

        <!-- Sync Status Grid -->
        <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5; margin-bottom: 32px;">
            <h3 style="font-size: 14px; color: #888; margin-bottom: 16px;">INTEGRATION STATUS</h3>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                ${renderSyncStatusCard('Stripe', siteAnalytics.stripeConnected, 'stripe')}
                ${renderSyncStatusCard('Google Reviews', siteAnalytics.googleReviewsConnected, 'reviews')}
                ${renderSyncStatusCard('Analytics', true, 'analytics')}
                ${renderSyncStatusCard('CRM', true, 'crm')}
            </div>
        </div>

        <!-- Recent Activity -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
            <div>
                <h2 style="font-size: 18px; margin-bottom: 20px;">Recent Orders</h2>
                <div>${orders.slice(-3).reverse().map(o => renderOrderCard(o)).join('')}</div>
            </div>
            <div>
                <h2 style="font-size: 18px; margin-bottom: 20px;">Recent Clients</h2>
                <div class="card-grid" style="grid-template-columns: 1fr;">${clients.slice(-3).reverse().map(c => renderClientCard(c)).join('')}</div>
            </div>
        </div>
    `;
}

function renderSyncStatusCard(name, connected, panel) {
    return `
        <div onclick="showAdminPanel('${panel}')" style="padding: 16px; background: ${connected ? '#f0fdf4' : '#fef2f2'}; border-radius: 12px; cursor: pointer; transition: transform 0.2s;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <span style="width: 10px; height: 10px; background: ${connected ? '#10b981' : '#ef4444'}; border-radius: 50%;"></span>
                <span style="font-weight: 600;">${name}</span>
            </div>
            <div style="font-size: 12px; color: ${connected ? '#059669' : '#dc2626'};">${connected ? 'Connected' : 'Not Connected'}</div>
        </div>
    `;
}

// Site Analytics Data
let siteAnalytics = JSON.parse(localStorage.getItem('nui_analytics')) || {
    visitors: { total: 2847, today: 156, week: 892 },
    pageViews: { total: 12453, today: 543, week: 3241 },
    topPages: [
        { page: 'Home', views: 4521, bounce: 32 },
        { page: 'Services', views: 2891, bounce: 41 },
        { page: 'Portfolio', views: 2143, bounce: 28 },
        { page: 'Blog', views: 1654, bounce: 35 },
        { page: 'Contact', views: 1244, bounce: 52 }
    ],
    trafficSources: [
        { source: 'Organic Search', percent: 45, color: '#10b981' },
        { source: 'Direct', percent: 28, color: '#3b82f6' },
        { source: 'Social', percent: 18, color: '#8b5cf6' },
        { source: 'Referral', percent: 9, color: '#f59e0b' }
    ],
    googleReviews: { avgRating: 4.8, count: 47 },
    stripeConnected: false,
    googleReviewsConnected: false
};
function saveAnalytics() { localStorage.setItem('nui_analytics', JSON.stringify(siteAnalytics)); }

function syncAllData() {
    const btn = event.target;
    btn.innerHTML = 'ðŸ”„ Syncing...';
    btn.disabled = true;
    setTimeout(() => {
        btn.innerHTML = 'âœ… Synced!';
        setTimeout(() => {
            btn.innerHTML = 'ðŸ”„ Sync All';
            btn.disabled = false;
        }, 2000);
    }, 1500);
}

// ==================== SITE ANALYTICS PANEL ====================
function loadAdminAnalyticsPanel() {
    const visitors = siteAnalytics.visitors || { total: 2847, today: 156, week: 892 };
    const pageViews = siteAnalytics.pageViews || { total: 12453, today: 543, week: 3241 };
    const topPages = siteAnalytics.topPages || [];
    const trafficSources = siteAnalytics.trafficSources || [];

    document.getElementById('adminAnalyticsPanel').innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <h1 style="font-size: 28px; font-weight: 700;">ðŸ“ˆ Site Analytics</h1>
            <div style="display: flex; gap: 12px;">
                <select id="analyticsDateRange" onchange="updateAnalyticsRange(this.value)" style="padding: 10px 16px; border: 1px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
                    <option value="7d">Last 7 Days</option>
                    <option value="30d">Last 30 Days</option>
                    <option value="90d">Last 90 Days</option>
                    <option value="all">All Time</option>
                </select>
                <button onclick="refreshAnalytics()" class="btn-outline">ðŸ”„ Refresh</button>
            </div>
        </div>

        <!-- Key Metrics -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px;">
            <div style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); padding: 24px; border-radius: 16px; color: #fff;">
                <div style="font-size: 13px; opacity: 0.8; margin-bottom: 8px;">Total Visitors</div>
                <div style="font-size: 36px; font-weight: 700;">${visitors.total.toLocaleString()}</div>
                <div style="font-size: 13px; margin-top: 8px; display: flex; align-items: center; gap: 4px;">
                    <span style="color: #86efac;">â†‘ 12%</span> vs last period
                </div>
            </div>
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 24px; border-radius: 16px; color: #fff;">
                <div style="font-size: 13px; opacity: 0.8; margin-bottom: 8px;">Page Views</div>
                <div style="font-size: 36px; font-weight: 700;">${pageViews.total.toLocaleString()}</div>
                <div style="font-size: 13px; margin-top: 8px; display: flex; align-items: center; gap: 4px;">
                    <span style="color: #86efac;">â†‘ 8%</span> vs last period
                </div>
            </div>
            <div style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); padding: 24px; border-radius: 16px; color: #fff;">
                <div style="font-size: 13px; opacity: 0.8; margin-bottom: 8px;">Avg. Session</div>
                <div style="font-size: 36px; font-weight: 700;">3:42</div>
                <div style="font-size: 13px; margin-top: 8px; display: flex; align-items: center; gap: 4px;">
                    <span style="color: #86efac;">â†‘ 5%</span> vs last period
                </div>
            </div>
            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 24px; border-radius: 16px; color: #fff;">
                <div style="font-size: 13px; opacity: 0.8; margin-bottom: 8px;">Bounce Rate</div>
                <div style="font-size: 36px; font-weight: 700;">38%</div>
                <div style="font-size: 13px; margin-top: 8px; display: flex; align-items: center; gap: 4px;">
                    <span style="color: #86efac;">â†“ 3%</span> vs last period
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 32px;">
            <!-- Traffic Chart -->
            <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5;">
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 20px;">Traffic Overview</h3>
                <div style="height: 200px; display: flex; align-items: flex-end; gap: 8px; padding: 20px 0;">
                    ${generateTrafficBars()}
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 12px; font-size: 12px; color: #888;">
                    <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
                </div>
            </div>

            <!-- Traffic Sources -->
            <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5;">
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 20px;">Traffic Sources</h3>
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    ${trafficSources.map(s => `
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                <span style="font-size: 14px;">${s.source}</span>
                                <span style="font-weight: 600;">${s.percent}%</span>
                            </div>
                            <div style="height: 8px; background: #f3f4f6; border-radius: 4px; overflow: hidden;">
                                <div style="width: ${s.percent}%; height: 100%; background: ${s.color}; border-radius: 4px;"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>

        <!-- Top Pages Table -->
        <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5; margin-bottom: 32px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 20px;">Top Pages</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid #e5e5e5;">
                        <th style="text-align: left; padding: 12px 0; font-size: 12px; color: #888; text-transform: uppercase;">Page</th>
                        <th style="text-align: right; padding: 12px 0; font-size: 12px; color: #888; text-transform: uppercase;">Views</th>
                        <th style="text-align: right; padding: 12px 0; font-size: 12px; color: #888; text-transform: uppercase;">Bounce Rate</th>
                        <th style="text-align: right; padding: 12px 0; font-size: 12px; color: #888; text-transform: uppercase;">Trend</th>
                    </tr>
                </thead>
                <tbody>
                    ${topPages.map((p, i) => `
                        <tr style="border-bottom: 1px solid #f3f4f6;">
                            <td style="padding: 16px 0;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <span style="width: 24px; height: 24px; background: #f3f4f6; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600;">${i + 1}</span>
                                    <span style="font-weight: 500;">/${p.page.toLowerCase()}</span>
                                </div>
                            </td>
                            <td style="text-align: right; padding: 16px 0; font-weight: 600;">${p.views.toLocaleString()}</td>
                            <td style="text-align: right; padding: 16px 0;">
                                <span style="background: ${p.bounce < 35 ? '#d1fae5' : p.bounce < 45 ? '#fef3c7' : '#fee2e2'}; color: ${p.bounce < 35 ? '#065f46' : p.bounce < 45 ? '#92400e' : '#991b1b'}; padding: 4px 10px; border-radius: 12px; font-size: 13px;">${p.bounce}%</span>
                            </td>
                            <td style="text-align: right; padding: 16px 0; color: #10b981;">â†‘ ${Math.floor(Math.random() * 15) + 1}%</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>

        <!-- Real-time Stats -->
        <div style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); padding: 24px; border-radius: 16px; color: #fff;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 16px; font-weight: 600;">Real-Time Visitors</h3>
                <span style="display: flex; align-items: center; gap: 6px;">
                    <span style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite;"></span>
                    <span style="color: #10b981; font-weight: 600;">${Math.floor(Math.random() * 20) + 5} active now</span>
                </span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                <div>
                    <div style="font-size: 24px; font-weight: 700;">${visitors.today}</div>
                    <div style="font-size: 13px; color: #888;">Today</div>
                </div>
                <div>
                    <div style="font-size: 24px; font-weight: 700;">${visitors.week}</div>
                    <div style="font-size: 13px; color: #888;">This Week</div>
                </div>
                <div>
                    <div style="font-size: 24px; font-weight: 700;">${pageViews.today}</div>
                    <div style="font-size: 13px; color: #888;">Page Views Today</div>
                </div>
                <div>
                    <div style="font-size: 24px; font-weight: 700;">2.4</div>
                    <div style="font-size: 13px; color: #888;">Pages/Session</div>
                </div>
            </div>
        </div>
    `;
}

function generateTrafficBars() {
    const heights = [65, 82, 45, 91, 73, 58, 87];
    return heights.map(h => `
        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 8px;">
            <div style="width: 100%; height: ${h}%; background: linear-gradient(180deg, #3b82f6 0%, #1d4ed8 100%); border-radius: 4px; min-height: 20px;"></div>
        </div>
    `).join('');
}

function refreshAnalytics() {
    const btn = event.target;
    btn.innerHTML = 'ðŸ”„ Loading...';
    setTimeout(() => {
        siteAnalytics.visitors.today += Math.floor(Math.random() * 10);
        siteAnalytics.pageViews.today += Math.floor(Math.random() * 20);
        saveAnalytics();
        loadAdminAnalyticsPanel();
    }, 1000);
}

function updateAnalyticsRange(range) {
    console.log('Updating analytics for range:', range);
    loadAdminAnalyticsPanel();
}

// ==================== GOOGLE REVIEWS PANEL ====================
let googleReviews = JSON.parse(localStorage.getItem('nui_reviews')) || [
    { id: 1, author: 'Marcus Johnson', rating: 5, text: 'NUI completely transformed our brand. The team understood our vision from day one and delivered beyond expectations. Highly recommend!', date: '2025-01-15', replied: true, reply: 'Thank you Marcus! It was a pleasure working with you.' },
    { id: 2, author: 'Sarah Williams', rating: 5, text: 'Professional, creative, and incredibly responsive. Our new website has already increased our leads by 40%.', date: '2025-01-10', replied: true, reply: 'We appreciate the kind words Sarah! Excited to see your business grow.' },
    { id: 3, author: 'David Chen', rating: 4, text: 'Great design work and reasonable pricing. Would have liked faster turnaround but overall satisfied with the results.', date: '2025-01-05', replied: false, reply: '' },
    { id: 4, author: 'Ashley Brown', rating: 5, text: 'The branding package was exactly what we needed. Logo, colors, everything came together perfectly. Detroit proud!', date: '2024-12-28', replied: true, reply: 'Detroit represent! Thanks for trusting us with your brand.' },
    { id: 5, author: 'Michael Torres', rating: 5, text: 'Second time working with NUI and they continue to exceed expectations. True partners in our business growth.', date: '2024-12-20', replied: false, reply: '' }
];
function saveReviews() { localStorage.setItem('nui_reviews', JSON.stringify(googleReviews)); }

function loadAdminReviewsPanel() {
    const avgRating = (googleReviews.reduce((sum, r) => sum + r.rating, 0) / googleReviews.length).toFixed(1);
    const fiveStarCount = googleReviews.filter(r => r.rating === 5).length;
    const unrepliedCount = googleReviews.filter(r => !r.replied).length;

    document.getElementById('adminReviewsPanel').innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <h1 style="font-size: 28px; font-weight: 700;">â­ Google Reviews</h1>
            <div style="display: flex; gap: 12px;">
                <button onclick="requestReview()" class="btn-outline">ðŸ“§ Request Review</button>
                <a href="https://g.page/r/YOUR_PLACE_ID/review" target="_blank" class="btn-cta">View on Google â†’</a>
            </div>
        </div>

        <!-- Stats Overview -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px;">
            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 24px; border-radius: 16px; color: #fff; text-align: center;">
                <div style="font-size: 48px; font-weight: 700;">â­ ${avgRating}</div>
                <div style="font-size: 14px; margin-top: 8px;">Average Rating</div>
            </div>
            <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5; text-align: center;">
                <div style="font-size: 48px; font-weight: 700;">${googleReviews.length}</div>
                <div style="font-size: 14px; color: #888; margin-top: 8px;">Total Reviews</div>
            </div>
            <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5; text-align: center;">
                <div style="font-size: 48px; font-weight: 700; color: #10b981;">${fiveStarCount}</div>
                <div style="font-size: 14px; color: #888; margin-top: 8px;">5-Star Reviews</div>
            </div>
            <div style="background: ${unrepliedCount > 0 ? '#fef3c7' : '#d1fae5'}; padding: 24px; border-radius: 16px; text-align: center;">
                <div style="font-size: 48px; font-weight: 700; color: ${unrepliedCount > 0 ? '#d97706' : '#059669'};">${unrepliedCount}</div>
                <div style="font-size: 14px; color: #888; margin-top: 8px;">Needs Reply</div>
            </div>
        </div>

        <!-- Rating Distribution -->
        <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5; margin-bottom: 32px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 20px;">Rating Distribution</h3>
            <div style="display: flex; flex-direction: column; gap: 12px;">
                ${[5,4,3,2,1].map(rating => {
                    const count = googleReviews.filter(r => r.rating === rating).length;
                    const percent = Math.round((count / googleReviews.length) * 100);
                    return `
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="width: 60px; font-size: 14px;">${rating} star${rating > 1 ? 's' : ''}</span>
                            <div style="flex: 1; height: 12px; background: #f3f4f6; border-radius: 6px; overflow: hidden;">
                                <div style="width: ${percent}%; height: 100%; background: ${rating >= 4 ? '#10b981' : rating === 3 ? '#f59e0b' : '#ef4444'}; border-radius: 6px;"></div>
                            </div>
                            <span style="width: 40px; text-align: right; font-weight: 600;">${count}</span>
                        </div>
                    `;
                }).join('')}
            </div>
        </div>

        <!-- Reviews List -->
        <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 16px; font-weight: 600;">All Reviews</h3>
                <select style="padding: 8px 16px; border: 1px solid #e5e5e5; border-radius: 8px;">
                    <option>Most Recent</option>
                    <option>Highest Rated</option>
                    <option>Lowest Rated</option>
                    <option>Needs Reply</option>
                </select>
            </div>
            <div style="display: flex; flex-direction: column; gap: 16px;">
                ${googleReviews.map(r => renderReviewCard(r)).join('')}
            </div>
        </div>
    `;
}

function renderReviewCard(review) {
    return `
        <div style="padding: 20px; background: #fafafa; border-radius: 12px; border-left: 4px solid ${review.rating >= 4 ? '#10b981' : review.rating === 3 ? '#f59e0b' : '#ef4444'};">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: #e5e5e5; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px;">${review.author.charAt(0)}</div>
                    <div>
                        <div style="font-weight: 600;">${review.author}</div>
                        <div style="font-size: 13px; color: #888;">${new Date(review.date).toLocaleDateString()}</div>
                    </div>
                </div>
                <div style="display: flex; gap: 2px;">
                    ${'â˜…'.repeat(review.rating)}${'â˜†'.repeat(5 - review.rating)}
                </div>
            </div>
            <p style="font-size: 14px; line-height: 1.6; margin-bottom: 12px;">"${review.text}"</p>
            ${review.replied ? `
                <div style="background: #e8f5e9; padding: 12px; border-radius: 8px; margin-top: 12px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">Your Reply:</div>
                    <p style="font-size: 13px; color: #2e7d32;">${review.reply}</p>
                </div>
            ` : `
                <button onclick="openReplyModal(${review.id})" style="padding: 8px 16px; background: var(--accent); color: #000; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Reply to Review</button>
            `}
        </div>
    `;
}

function openReplyModal(reviewId) {
    const review = googleReviews.find(r => r.id === reviewId);
    if (!review) return;
    const reply = prompt('Reply to ' + review.author + "'s review:", '');
    if (reply) {
        review.replied = true;
        review.reply = reply;
        saveReviews();
        loadAdminReviewsPanel();
    }
}

function requestReview() {
    alert('ðŸ“§ Review request feature coming soon! This will send automated emails to recent clients asking for Google reviews.');
}

function loadAdminClientsPanel(searchTerm = '') {
    const filtered = searchTerm
        ? clients.filter(c =>
            (c.name || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
            (c.email || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
            (c.industry || '').toLowerCase().includes(searchTerm.toLowerCase())
          )
        : clients;

    document.getElementById('adminClientsPanel').innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <h1 style="font-size: 28px; font-weight: 700;">All Clients</h1>
            <span style="color: #888;">${filtered.length} of ${clients.length} clients</span>
        </div>
        <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; align-items: center;">
            <input type="text" id="clientSearch" placeholder="Search clients by name, email, or industry..." value="${searchTerm}"
                oninput="loadAdminClientsPanel(this.value)"
                style="flex: 1; min-width: 250px; padding: 12px 16px; border: 1px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
            <button onclick="showCsvImportModal()" style="padding: 10px 16px; background: #10b981; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">ðŸ“¥ Import CSV</button>
            <button onclick="exportClientsCSV()" style="padding: 10px 16px; background: #f3f4f6; border: 1px solid #e5e5e5; border-radius: 8px; cursor: pointer;">ðŸ“¤ Export CSV</button>
            <button onclick="showAdminPanel('newclient')" class="btn-cta">+ New Client</button>
        </div>
        <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="handleCsvUpload(event)">
        ${filtered.length > 0 ? `
        <div class="card-grid">${filtered.map(c => renderClientCard(c)).join('')}</div>
        ` : '<p style="color: #888; text-align: center; padding: 40px;">No clients found.</p>'}
    `;
}

// Export clients to CSV
function exportClientsCSV() {
    if (clients.length === 0) {
        alert('No clients to export.');
        return;
    }

    const headers = ['ID', 'Name', 'Email', 'Industry', 'Website', 'Created Via', 'Email Verified', 'Created At'];
    const rows = clients.map(c => [
        c.id,
        c.name || '',
        c.email || '',
        c.industry || '',
        c.website || '',
        c.createdVia || 'manual',
        c.emailVerified ? 'Yes' : 'No',
        c.createdAt || ''
    ]);

    const csv = [headers.join(','), ...rows.map(r => r.map(v => '"' + String(v).replace(/"/g, '""') + '"').join(','))].join('\n');
    downloadCSV(csv, 'nui-clients-' + new Date().toISOString().split('T')[0] + '.csv');
}

// CSV Import Modal
function showCsvImportModal() {
    const modal = document.createElement('div');
    modal.id = 'csvImportModal';
    modal.innerHTML = `
        <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 9999;">
            <div style="background: #1a1a1a; border-radius: 16px; padding: 32px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="font-size: 24px; font-weight: 700;">ðŸ“¥ Import Clients from CSV</h2>
                    <button onclick="closeCsvImportModal()" style="background: none; border: none; color: #888; font-size: 24px; cursor: pointer;">&times;</button>
                </div>

                <div style="background: #252525; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="font-size: 16px; margin-bottom: 12px; color: #10b981;">ðŸ“‹ Required CSV Format</h3>
                    <p style="color: #aaa; font-size: 14px; margin-bottom: 12px;">Your CSV should include the following columns (first row must be headers):</p>
                    <div style="background: #1a1a1a; padding: 12px; border-radius: 8px; font-family: monospace; font-size: 12px; color: #10b981; overflow-x: auto;">
                        name,email,phone,industry,website,address,notes
                    </div>
                    <p style="color: #888; font-size: 12px; margin-top: 12px;">
                        <strong>Required:</strong> name, email<br>
                        <strong>Optional:</strong> phone, industry, website, address, notes
                    </p>
                </div>

                <div style="background: #252525; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="font-size: 16px; margin-bottom: 12px;">ðŸ“„ Example CSV</h3>
                    <pre style="background: #1a1a1a; padding: 12px; border-radius: 8px; font-size: 11px; color: #aaa; overflow-x: auto; white-space: pre-wrap;">name,email,phone,industry,website,address,notes
John's Bakery,john@bakery.com,555-0101,Food & Beverage,www.johnsbakery.com,"123 Main St, Detroit MI",Referred by Sarah
Tech Startup Inc,hello@techstartup.io,555-0102,Technology,techstartup.io,"456 Innovation Blvd",Needs full rebrand
Fitness Plus,contact@fitnessplus.com,555-0103,Health & Fitness,,,"Met at networking event"</pre>
                </div>

                <div id="csvDropZone" style="border: 2px dashed #444; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.2s;"
                    onclick="document.getElementById('csvFileInput').click()"
                    ondragover="event.preventDefault(); this.style.borderColor='#10b981'; this.style.background='rgba(16,185,129,0.1)';"
                    ondragleave="this.style.borderColor='#444'; this.style.background='transparent';"
                    ondrop="handleCsvDrop(event)">
                    <div style="font-size: 48px; margin-bottom: 12px;">ðŸ“</div>
                    <p style="color: #fff; font-size: 16px; margin-bottom: 8px;">Drop your CSV file here</p>
                    <p style="color: #888; font-size: 14px;">or click to browse</p>
                </div>

                <div id="csvPreviewArea" style="display: none; margin-top: 20px;"></div>

                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button onclick="downloadSampleCSV()" style="flex: 1; padding: 12px; background: #333; border: none; color: #fff; border-radius: 8px; cursor: pointer;">
                        â¬‡ï¸ Download Sample CSV
                    </button>
                    <button onclick="closeCsvImportModal()" style="flex: 1; padding: 12px; background: #444; border: none; color: #fff; border-radius: 8px; cursor: pointer;">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function closeCsvImportModal() {
    const modal = document.getElementById('csvImportModal');
    if (modal) modal.remove();
}

function downloadSampleCSV() {
    const sample = `name,email,phone,industry,website,address,notes
John's Bakery,john@bakery.com,555-0101,Food & Beverage,www.johnsbakery.com,"123 Main St, Detroit MI",Referred by Sarah
Tech Startup Inc,hello@techstartup.io,555-0102,Technology,techstartup.io,"456 Innovation Blvd",Needs full rebrand
Fitness Plus,contact@fitnessplus.com,555-0103,Health & Fitness,,,"Met at networking event"
Creative Agency,info@creativeagency.co,555-0104,Marketing & Advertising,creativeagency.co,"789 Design Ave",Hot lead
Local Restaurant,eat@localrestaurant.com,555-0105,Food & Beverage,localrestaurant.com,"321 Food St",Ready to start`;
    downloadCSV(sample, 'nui-clients-sample.csv');
}

function handleCsvDrop(event) {
    event.preventDefault();
    event.target.style.borderColor = '#444';
    event.target.style.background = 'transparent';

    const file = event.dataTransfer.files[0];
    if (file && file.name.endsWith('.csv')) {
        processCsvFile(file);
    } else {
        alert('Please upload a .csv file');
    }
}

function handleCsvUpload(event) {
    const file = event.target.files[0];
    if (file) {
        processCsvFile(file);
    }
}

function processCsvFile(file) {
    const reader = new FileReader();
    reader.onload = function(e) {
        const csvText = e.target.result;
        const parsedData = parseCSV(csvText);

        if (parsedData.length === 0) {
            alert('No valid data found in CSV file.');
            return;
        }

        showCsvPreview(parsedData);
    };
    reader.readAsText(file);
}

function parseCSV(csvText) {
    const lines = csvText.trim().split('\n');
    if (lines.length < 2) return [];

    // Parse header row
    const headers = parseCSVLine(lines[0]).map(h => h.toLowerCase().trim());

    // Check for required columns
    const nameIdx = headers.indexOf('name');
    const emailIdx = headers.indexOf('email');

    if (nameIdx === -1 || emailIdx === -1) {
        alert('CSV must contain "name" and "email" columns.');
        return [];
    }

    // Parse data rows
    const data = [];
    for (let i = 1; i < lines.length; i++) {
        const values = parseCSVLine(lines[i]);
        if (values.length >= 2 && values[nameIdx] && values[emailIdx]) {
            const row = {};
            headers.forEach((header, idx) => {
                row[header] = values[idx] || '';
            });
            data.push(row);
        }
    }

    return data;
}

function parseCSVLine(line) {
    const result = [];
    let current = '';
    let inQuotes = false;

    for (let i = 0; i < line.length; i++) {
        const char = line[i];

        if (char === '"') {
            if (inQuotes && line[i + 1] === '"') {
                current += '"';
                i++;
            } else {
                inQuotes = !inQuotes;
            }
        } else if (char === ',' && !inQuotes) {
            result.push(current.trim());
            current = '';
        } else {
            current += char;
        }
    }
    result.push(current.trim());

    return result;
}

function showCsvPreview(data) {
    const previewArea = document.getElementById('csvPreviewArea');
    const existingEmails = clients.map(c => c.email.toLowerCase());

    // Check for duplicates
    const newClients = [];
    const duplicates = [];

    data.forEach(row => {
        if (existingEmails.includes(row.email.toLowerCase())) {
            duplicates.push(row);
        } else {
            newClients.push(row);
        }
    });

    previewArea.style.display = 'block';
    previewArea.innerHTML = `
        <div style="background: #252525; border-radius: 12px; padding: 20px;">
            <h3 style="font-size: 16px; margin-bottom: 16px;">ðŸ“Š Import Preview</h3>

            <div style="display: flex; gap: 16px; margin-bottom: 16px;">
                <div style="flex: 1; background: #10b981; color: #fff; padding: 16px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 28px; font-weight: bold;">${newClients.length}</div>
                    <div style="font-size: 12px;">New Clients</div>
                </div>
                <div style="flex: 1; background: ${duplicates.length > 0 ? '#f59e0b' : '#333'}; color: #fff; padding: 16px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 28px; font-weight: bold;">${duplicates.length}</div>
                    <div style="font-size: 12px;">Duplicates (skip)</div>
                </div>
            </div>

            ${newClients.length > 0 ? `
            <div style="max-height: 200px; overflow-y: auto; margin-bottom: 16px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                        <tr style="background: #333;">
                            <th style="padding: 8px; text-align: left; border-bottom: 1px solid #444;">Name</th>
                            <th style="padding: 8px; text-align: left; border-bottom: 1px solid #444;">Email</th>
                            <th style="padding: 8px; text-align: left; border-bottom: 1px solid #444;">Industry</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${newClients.slice(0, 10).map(c => `
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #333;">${c.name}</td>
                                <td style="padding: 8px; border-bottom: 1px solid #333;">${c.email}</td>
                                <td style="padding: 8px; border-bottom: 1px solid #333;">${c.industry || '-'}</td>
                            </tr>
                        `).join('')}
                        ${newClients.length > 10 ? `<tr><td colspan="3" style="padding: 8px; color: #888; text-align: center;">...and ${newClients.length - 10} more</td></tr>` : ''}
                    </tbody>
                </table>
            </div>

            <button onclick="importCsvClients()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #10b981, #059669); border: none; color: #fff; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">
                âœ… Import ${newClients.length} Client${newClients.length !== 1 ? 's' : ''}
            </button>
            ` : `
            <p style="color: #f59e0b; text-align: center; padding: 20px;">All clients in this CSV already exist in your database.</p>
            `}
        </div>
    `;

    // Store for import
    window.pendingCsvImport = newClients;
}

function importCsvClients() {
    const newClients = window.pendingCsvImport || [];

    if (newClients.length === 0) {
        alert('No clients to import.');
        return;
    }

    const maxId = clients.length > 0 ? Math.max(...clients.map(c => c.id)) : 0;

    newClients.forEach((row, idx) => {
        const newClient = {
            id: maxId + idx + 1,
            name: row.name,
            email: row.email,
            phone: row.phone || '',
            industry: row.industry || '',
            website: row.website || '',
            address: row.address || '',
            notes: row.notes || '',
            password: 'client123',
            createdAt: new Date().toISOString(),
            createdVia: 'csv_import',
            emailVerified: false,
            brandAssets: { logo: '', colors: ['#e11d48', '#1a1a1a', '#ffffff'], fonts: [] }
        };
        clients.push(newClient);

        // Also add to CRM contacts
        const crmContacts = JSON.parse(localStorage.getItem('nui_crm_contacts')) || [];
        crmContacts.push({
            id: Date.now() + idx,
            name: row.name,
            email: row.email,
            phone: row.phone || '',
            company: row.name,
            stage: 1,
            value: 0,
            source: 'CSV Import',
            createdAt: new Date().toISOString(),
            lastContact: null,
            activities: [{ type: 'note', date: new Date().toISOString(), content: 'Imported from CSV' }]
        });
        localStorage.setItem('nui_crm_contacts', JSON.stringify(crmContacts));
    });

    localStorage.setItem('nui_clients', JSON.stringify(clients));

    closeCsvImportModal();
    loadAdminClientsPanel();

    alert(`âœ… Successfully imported ${newClients.length} client${newClients.length !== 1 ? 's' : ''}!`);
}

function loadAdminOrdersPanel(searchTerm = '', statusFilter = 'all') {
    const designersList = JSON.parse(localStorage.getItem('nui_designers')) || [];

    let filtered = orders;
    if (searchTerm) {
        filtered = filtered.filter(o => {
            const client = clients.find(c => c.id === o.clientId);
            return (o.service || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
                   (client?.name || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
                   (o.assignedDesigner || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
                   String(o.id).includes(searchTerm);
        });
    }
    if (statusFilter !== 'all') {
        if (statusFilter === 'unassigned') {
            filtered = filtered.filter(o => !o.assignedDesigner && o.status !== 'delivered');
        } else {
            filtered = filtered.filter(o => o.status === statusFilter);
        }
    }

    const unassignedOrders = orders.filter(o => !o.assignedDesigner && o.status !== 'delivered').length;
    const inProgressOrders = orders.filter(o => o.status === 'in_progress').length;
    const completedOrders = orders.filter(o => o.status === 'delivered').length;

    document.getElementById('adminOrdersPanel').innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <h1 style="font-size: 28px; font-weight: 700;">ðŸ“‹ Order Tracking</h1>
            <span style="color: #888;">${filtered.length} of ${orders.length} orders</span>
        </div>

        <!-- Search, Filter, and Actions -->
        <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; align-items: center;">
            <input type="text" id="orderSearch" placeholder="Search by client, service, designer..." value="${searchTerm}"
                oninput="loadAdminOrdersPanel(this.value, document.getElementById('orderFilter').value)"
                style="flex: 1; min-width: 200px; padding: 12px 16px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; font-size: 14px; background: #252525; color: #fff;">
            <select id="orderFilter" onchange="loadAdminOrdersPanel(document.getElementById('orderSearch').value, this.value)" style="padding: 10px 16px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: #252525; color: #fff;">
                <option value="all" ${statusFilter === 'all' ? 'selected' : ''}>All Orders</option>
                <option value="unassigned" ${statusFilter === 'unassigned' ? 'selected' : ''}>Unassigned</option>
                <option value="in_progress" ${statusFilter === 'in_progress' ? 'selected' : ''}>In Progress</option>
                <option value="delivered" ${statusFilter === 'delivered' ? 'selected' : ''}>Completed</option>
            </select>
            <button onclick="exportOrdersCSV()" style="padding: 10px 16px; background: #333; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; cursor: pointer; color: #fff;">Export CSV</button>
            <button onclick="showAdminPanel('neworder')" class="btn-cta">+ New Order</button>
        </div>

        <!-- Order Stats -->
        <div class="stat-cards" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 32px;">
            <div class="stat-card"><div class="num">${orders.length}</div><div class="lbl">Total Orders</div></div>
            <div class="stat-card" style="border-color: #f59e0b;"><div class="num" style="color: #f59e0b;">${unassignedOrders}</div><div class="lbl">Unassigned</div></div>
            <div class="stat-card" style="border-color: var(--blue);"><div class="num" style="color: var(--blue);">${inProgressOrders}</div><div class="lbl">In Progress</div></div>
            <div class="stat-card" style="border-color: var(--green);"><div class="num" style="color: var(--green);">${completedOrders}</div><div class="lbl">Completed</div></div>
        </div>

        <!-- Unassigned Alert -->
        ${unassignedOrders > 0 ? `
        <div style="background: #fef3c7; border: 1px solid #fcd34d; padding: 16px 24px; border-radius: 12px; margin-bottom: 24px; display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 24px;">âš ï¸</span>
                <div>
                    <strong style="color: #92400e;">${unassignedOrders} orders need designer assignment</strong>
                    <p style="font-size: 13px; color: #b45309; margin: 0;">Assign designers to start tracking progress</p>
                </div>
            </div>
            <button onclick="showQuickAssignModal()" style="padding: 8px 16px; background: #d97706; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Quick Assign All</button>
        </div>
        ` : ''}

        <!-- Orders List -->
        <div id="ordersListContainer">
            ${filtered.length ? filtered.slice().reverse().map(o => renderOrderCardEnhanced(o, designersList)).join('') : '<p style="color: #888; text-align: center; padding: 40px;">No orders found.</p>'}
        </div>
    `;
}

// Export orders to CSV
function exportOrdersCSV() {
    if (orders.length === 0) {
        alert('No orders to export.');
        return;
    }

    const headers = ['Order ID', 'Client', 'Service', 'Estimate', 'Status', 'Assigned Designer', 'Progress', 'Created Date'];
    const rows = orders.map(o => {
        const client = clients.find(c => c.id === o.clientId);
        return [
            o.id,
            client?.name || 'Unknown',
            o.service || '',
            o.estimate || 0,
            o.status || '',
            o.assignedDesigner || 'Unassigned',
            (o.progress || 0) + '%',
            o.createdAt || ''
        ];
    });

    const csv = [headers.join(','), ...rows.map(r => r.map(v => '"' + String(v).replace(/"/g, '""') + '"').join(','))].join('\n');
    downloadCSV(csv, 'nui-orders-' + new Date().toISOString().split('T')[0] + '.csv');
}

function renderOrderCardEnhanced(o, designers) {
    const client = clients.find(c => c.id === o.clientId);
    const progress = o.status === 'delivered' ? 100 : o.status === 'in_progress' ? 60 : o.status === 'pending' ? 20 : 40;
    const daysLeft = Math.ceil((new Date(o.dueDate) - new Date()) / (1000*60*60*24));
    const designerRaw = o.assignedDesigner || null;
    const designer = typeof designerRaw === 'object' ? (designerRaw?.name || null) : designerRaw;

    return `
    <div class="order-card" style="margin-bottom: 16px; position: relative; overflow: hidden;">
        ${!designer ? '<div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: #f59e0b;"></div>' : ''}
        <div class="order-header" style="display: flex; justify-content: space-between; align-items: start;">
            <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                    <div class="order-title" style="font-size: 18px;">${o.projectName}</div>
                    <span class="order-status ${o.status}" style="text-transform: capitalize;">${o.status.replace('_', ' ')}</span>
                </div>
                <div class="order-client" style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                    <span>ðŸ‘¤ ${client ? client.name : 'Unknown Client'}</span>
                    <span style="color: #888;">|</span>
                    <span style="color: ${daysLeft < 0 ? 'var(--red)' : daysLeft < 3 ? '#f59e0b' : '#888'};">
                        ðŸ“… ${daysLeft < 0 ? 'Overdue by ' + Math.abs(daysLeft) + ' days' : daysLeft + ' days left'}
                    </span>
                    <span style="color: #888;">|</span>
                    <span style="color: var(--green); font-weight: 600;">ðŸ’° $${o.estimate?.toLocaleString() || 0}</span>
                </div>
            </div>
            <div style="text-align: right;">
                ${designer ? `
                    <div style="display: flex; align-items: center; gap: 8px; background: #f0fdf4; padding: 8px 12px; border-radius: 8px;">
                        <span style="width: 32px; height: 32px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">${String(designer).charAt(0)}</span>
                        <div>
                            <div style="font-weight: 600; font-size: 14px;">${designer}</div>
                            <div style="font-size: 11px; color: #059669;">Assigned</div>
                        </div>
                    </div>
                ` : `
                    <select onchange="assignDesignerToOrder(${o.id}, this.value)" style="padding: 10px 16px; border: 2px solid #f59e0b; border-radius: 8px; background: #fffbeb; font-weight: 600; cursor: pointer;">
                        <option value="">âš ï¸ Assign Designer</option>
                        ${designers.map(d => `<option value="${d.name}">${d.name}</option>`).join('')}
                    </select>
                `}
            </div>
        </div>

        <!-- Progress Section -->
        <div style="margin: 16px 0;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-size: 13px; color: #666;">Progress</span>
                <span style="font-size: 13px; font-weight: 600;">${progress}%</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" style="width: ${progress}%; background: ${o.status === 'delivered' ? 'var(--green)' : o.status === 'in_progress' ? 'var(--blue)' : '#f59e0b'}"></div></div>
        </div>

        <!-- Order Timeline (if in progress) -->
        ${o.status === 'in_progress' ? `
        <div style="display: flex; gap: 8px; margin: 16px 0; flex-wrap: wrap;">
            <div style="padding: 6px 12px; background: #d1fae5; color: #059669; border-radius: 6px; font-size: 12px;">âœ“ Order Received</div>
            <div style="padding: 6px 12px; background: #d1fae5; color: #059669; border-radius: 6px; font-size: 12px;">âœ“ In Design</div>
            <div style="padding: 6px 12px; background: #fef3c7; color: #d97706; border-radius: 6px; font-size: 12px;">â—¯ Review</div>
            <div style="padding: 6px 12px; background: #f3f4f6; color: #888; border-radius: 6px; font-size: 12px;">â—¯ Delivery</div>
        </div>
        ` : ''}

        <!-- Actions -->
        <div style="display: flex; gap: 8px; margin-top: 16px; flex-wrap: wrap;">
            <button onclick="viewOrderDetails(${o.id})" class="btn-outline" style="padding: 8px 16px;">View Details</button>
            <button onclick="showInvoice(${o.id})" style="padding: 8px 16px; background: #f5f5f5; border: none; border-radius: 6px; cursor: pointer;">Invoice</button>
            ${o.status !== 'delivered' ? `
                <button onclick="updateOrderStatus(${o.id})" style="padding: 8px 16px; background: var(--blue); color: #fff; border: none; border-radius: 6px; cursor: pointer;">Update Status</button>
                <button onclick="markDelivered(${o.id})" style="padding: 8px 16px; background: var(--green); color: #fff; border: none; border-radius: 6px; cursor: pointer;">âœ“ Mark Delivered</button>
            ` : `
                <span style="padding: 8px 16px; background: #d1fae5; color: #059669; border-radius: 6px;">âœ“ Completed ${o.deliveredAt ? new Date(o.deliveredAt).toLocaleDateString() : ''}</span>
            `}
        </div>
    </div>`;
}

function assignDesignerToOrder(orderId, designerName) {
    const order = orders.find(o => o.id === orderId);
    if (order && designerName) {
        order.assignedDesigner = designerName;
        order.assignedAt = new Date().toISOString();
        if (order.status === 'pending') order.status = 'in_progress';
        saveOrders();
        loadAdminOrdersPanel();
    }
}

function showQuickAssignModal() {
    const designers = JSON.parse(localStorage.getItem('nui_designers')) || [];
    const unassignedOrders = orders.filter(o => !o.assignedDesigner && o.status !== 'delivered');

    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'quickAssignModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Quick Assign Designers</h3>
                <button class="modal-close" onclick="document.getElementById('quickAssignModal').remove()">Ã—</button>
            </div>
            <div class="modal-body">
                ${unassignedOrders.map(o => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: #f8fafc; border-radius: 8px; margin-bottom: 12px;">
                        <div>
                            <div style="font-weight: 600;">${o.projectName}</div>
                            <div style="font-size: 13px; color: #888;">${clients.find(c => c.id === o.clientId)?.name || 'Unknown'}</div>
                        </div>
                        <select id="assign_${o.id}" style="padding: 8px 12px; border: 1px solid #e5e5e5; border-radius: 6px;">
                            <option value="">Select Designer</option>
                            ${designers.map(d => `<option value="${d.name}">${d.name}</option>`).join('')}
                        </select>
                    </div>
                `).join('')}
                <button onclick="applyQuickAssignments()" class="btn-cta" style="width: 100%; margin-top: 16px;">Assign All Selected</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function applyQuickAssignments() {
    const unassignedOrders = orders.filter(o => !o.assignedDesigner && o.status !== 'delivered');
    let assignedCount = 0;

    unassignedOrders.forEach(o => {
        const select = document.getElementById('assign_' + o.id);
        if (select && select.value) {
            o.assignedDesigner = select.value;
            o.assignedAt = new Date().toISOString();
            if (o.status === 'pending') o.status = 'in_progress';
            assignedCount++;
        }
    });

    saveOrders();
    document.getElementById('quickAssignModal').remove();
    loadAdminOrdersPanel();
    alert('Successfully assigned ' + assignedCount + ' orders!');
}

function viewOrderDetails(orderId) {
    const order = orders.find(o => o.id === orderId);
    if (!order) return;
    const client = clients.find(c => c.id === order.clientId);

    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'orderDetailsModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">Order Details: ${order.projectName}</h3>
                <button class="modal-close" onclick="document.getElementById('orderDetailsModal').remove()">Ã—</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <div>
                        <h4 style="font-size: 12px; color: #888; margin-bottom: 8px;">CLIENT</h4>
                        <p style="font-weight: 600;">${client?.name || 'Unknown'}</p>
                        <p style="font-size: 14px; color: #666;">${client?.email || ''}</p>
                    </div>
                    <div>
                        <h4 style="font-size: 12px; color: #888; margin-bottom: 8px;">DESIGNER</h4>
                        <p style="font-weight: 600;">${order.assignedDesigner || 'Not Assigned'}</p>
                        ${order.assignedAt ? `<p style="font-size: 14px; color: #666;">Assigned: ${new Date(order.assignedAt).toLocaleDateString()}</p>` : ''}
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                    <div style="padding: 16px; background: #f8fafc; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 700;">$${order.estimate?.toLocaleString() || 0}</div>
                        <div style="font-size: 12px; color: #888;">Estimate</div>
                    </div>
                    <div style="padding: 16px; background: #f8fafc; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 700;">${order.turnaround || 'N/A'}</div>
                        <div style="font-size: 12px; color: #888;">Turnaround</div>
                    </div>
                    <div style="padding: 16px; background: #f8fafc; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 700;">${new Date(order.dueDate).toLocaleDateString()}</div>
                        <div style="font-size: 12px; color: #888;">Due Date</div>
                    </div>
                    <div style="padding: 16px; background: ${order.status === 'delivered' ? '#d1fae5' : '#fef3c7'}; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; text-transform: capitalize;">${order.status.replace('_', ' ')}</div>
                        <div style="font-size: 12px; color: #888;">Status</div>
                    </div>
                </div>
                ${order.description ? `<div style="margin-bottom: 24px;"><h4 style="font-size: 12px; color: #888; margin-bottom: 8px;">DESCRIPTION</h4><p>${order.description}</p></div>` : ''}
                <div style="display: flex; gap: 12px;">
                    <button onclick="document.getElementById('orderDetailsModal').remove(); showInvoice(${order.id});" class="btn-cta">View Invoice</button>
                    <button onclick="document.getElementById('orderDetailsModal').remove();" class="btn-outline">Close</button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function filterOrders(filter) {
    const containers = document.getElementById('ordersListContainer');
    const designers = JSON.parse(localStorage.getItem('nui_designers')) || [];
    let filteredOrders = orders;

    if (filter === 'unassigned') {
        filteredOrders = orders.filter(o => !o.assignedDesigner && o.status !== 'delivered');
    } else if (filter === 'in_progress') {
        filteredOrders = orders.filter(o => o.status === 'in_progress');
    } else if (filter === 'delivered') {
        filteredOrders = orders.filter(o => o.status === 'delivered');
    }

    containers.innerHTML = filteredOrders.length ?
        filteredOrders.slice().reverse().map(o => renderOrderCardEnhanced(o, designers)).join('') :
        '<p style="color: #888; text-align: center; padding: 40px;">No orders match this filter.</p>';
}

function loadAdminLeadsPanel() {
    const newLeads = leads.filter(l => l.status === 'new').length;
    document.getElementById('adminLeadsPanel').innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <h1 style="font-size: 28px; font-weight: 700;">Lead Management</h1>
            <button onclick="addManualLead()" class="btn-cta">+ Add Lead</button>
        </div>

        <div class="stat-cards" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 32px;">
            <div class="stat-card"><div class="num">${leads.length}</div><div class="lbl">Total Leads</div></div>
            <div class="stat-card" style="border-color: var(--green);"><div class="num" style="color: var(--green);">${newLeads}</div><div class="lbl">New Leads</div></div>
            <div class="stat-card"><div class="num">${leads.filter(l => l.status === 'converted').length}</div><div class="lbl">Converted</div></div>
        </div>

        <div class="form-section">
            <div class="form-section-title">ðŸŽ¯ All Leads</div>
            ${leads.length > 0 ? `
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid #e5e5e5; text-align: left;">
                        <th style="padding: 12px 8px; font-size: 12px; text-transform: uppercase; color: #888;">Name</th>
                        <th style="padding: 12px 8px; font-size: 12px; text-transform: uppercase; color: #888;">Contact</th>
                        <th style="padding: 12px 8px; font-size: 12px; text-transform: uppercase; color: #888;">Service</th>
                        <th style="padding: 12px 8px; font-size: 12px; text-transform: uppercase; color: #888;">Budget</th>
                        <th style="padding: 12px 8px; font-size: 12px; text-transform: uppercase; color: #888;">Status</th>
                        <th style="padding: 12px 8px; font-size: 12px; text-transform: uppercase; color: #888;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${leads.map(lead => `
                    <tr style="border-bottom: 1px solid #e5e5e5;">
                        <td style="padding: 16px 8px;"><strong>${lead.name}</strong><br><span style="font-size: 12px; color: #888;">${lead.business || '-'}</span></td>
                        <td style="padding: 16px 8px;"><a href="mailto:${lead.email}" style="color: var(--red);">${lead.email}</a><br><span style="font-size: 12px; color: #888;">${lead.phone || '-'}</span></td>
                        <td style="padding: 16px 8px; font-size: 14px;">${lead.service || '-'}</td>
                        <td style="padding: 16px 8px; font-size: 14px;">${lead.budget || '-'}</td>
                        <td style="padding: 16px 8px;">
                            <select onchange="updateLeadStatus(${lead.id}, this.value)" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; background: ${lead.status === 'new' ? '#fef3c7' : lead.status === 'contacted' ? '#dbeafe' : lead.status === 'converted' ? '#d1fae5' : '#f5f5f5'};">
                                <option value="new" ${lead.status === 'new' ? 'selected' : ''}>New</option>
                                <option value="contacted" ${lead.status === 'contacted' ? 'selected' : ''}>Contacted</option>
                                <option value="qualified" ${lead.status === 'qualified' ? 'selected' : ''}>Qualified</option>
                                <option value="converted" ${lead.status === 'converted' ? 'selected' : ''}>Converted</option>
                                <option value="lost" ${lead.status === 'lost' ? 'selected' : ''}>Lost</option>
                            </select>
                        </td>
                        <td style="padding: 16px 8px;">
                            <button onclick="convertLeadToClient(${lead.id})" style="padding: 6px 12px; background: var(--green); color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; margin-right: 4px;">â†’ Client</button>
                            <button onclick="deleteLead(${lead.id})" style="padding: 6px 12px; background: #fee2e2; color: #dc2626; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">Ã—</button>
                        </td>
                    </tr>
                    `).join('')}
                </tbody>
            </table>
            ` : '<p style="text-align: center; color: #888; padding: 40px;">No leads yet. Generate a lead form to start capturing leads!</p>'}
        </div>

        <div class="form-section" style="margin-top: 24px;">
            <div class="form-section-title">ðŸ”— Get Your Lead Form</div>
            <p style="color: #666; margin-bottom: 16px;">Go to <strong>New Order</strong> â†’ Select a package â†’ Click "Generate Lead Form" to get embeddable form code.</p>
            <button onclick="showAdminPanel('neworder')" class="btn-cta">Go to New Order â†’</button>
        </div>
    `;
}

function updateLeadStatus(leadId, newStatus) {
    const lead = leads.find(l => l.id === leadId);
    if (lead) {
        lead.status = newStatus;
        saveLeads();
        loadAdminLeadsPanel();
    }
}

function convertLeadToClient(leadId) {
    const lead = leads.find(l => l.id === leadId);
    if (!lead) return;
    if (!confirm('Convert ' + lead.name + ' to a client?')) return;

    // Create new client from lead
    const newClient = {
        id: Date.now(),
        name: lead.business || lead.name,
        email: lead.email,
        password: 'client' + Math.random().toString(36).substring(7),
        industry: '',
        website: '',
        colors: ['#ff0000', '#000000', '#ffffff'],
        fonts: { heading: 'Inter', body: 'Inter' },
        assets: { logos: [], mockups: [], social: [], video: [], banner: [], fonts: [], patterns: [], package: [] }
    };
    clients.push(newClient);
    saveClients();

    // Update lead status
    lead.status = 'converted';
    saveLeads();

    alert('Client created!\nEmail: ' + newClient.email + '\nPassword: ' + newClient.password);
    loadAdminLeadsPanel();
}

function deleteLead(leadId) {
    if (!confirm('Delete this lead?')) return;
    leads = leads.filter(l => l.id !== leadId);
    saveLeads();
    loadAdminLeadsPanel();
}

function addManualLead() {
    const name = prompt('Lead Name:');
    if (!name) return;
    const email = prompt('Email:');
    const phone = prompt('Phone:');
    const service = prompt('Service Interest:');
    const budget = prompt('Budget:');

    const newLead = {
        id: Date.now(),
        name, email, phone,
        business: '',
        service, budget,
        message: '',
        status: 'new',
        createdAt: new Date().toISOString()
    };
    leads.push(newLead);
    saveLeads();

    // Trigger workflow: Add to pipeline and email subscribers
    triggerNewLead(newLead.id);

    loadAdminLeadsPanel();
}

// Service Packages defined globally at top of file

function loadAdminNewOrderPanel() {
    document.getElementById('adminNewOrderPanel').innerHTML = `
        <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 32px;">Create New Order</h1>

        <!-- SERVICE PACKAGES -->
        <div class="form-section">
            <div class="form-section-title">ðŸ“¦ Select Service Package</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px;">
                ${servicePackages.map(pkg => `
                    <div class="package-card" onclick="selectPackage('${pkg.id}')" id="pkg-${pkg.id}" style="padding: 20px; border: 2px solid #e5e5e5; border-radius: 12px; cursor: pointer; transition: all 0.2s;">
                        <div style="font-weight: 600; font-size: 16px; margin-bottom: 8px;">${pkg.name}</div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--red); margin-bottom: 8px;">${pkg.price > 0 ? '$' + pkg.price.toLocaleString() : 'Custom'}</div>
                        <div style="font-size: 12px; color: #888; margin-bottom: 8px;">${pkg.turnaround}</div>
                        <div style="font-size: 13px; color: #666;">${pkg.desc}</div>
                    </div>
                `).join('')}
            </div>
        </div>

        <!-- ORDER FORM -->
        <form onsubmit="createOrder(event)" class="form-section" style="max-width: 700px;">
            <div class="form-section-title">ðŸ“‹ Order Details</div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Client *</label>
                    <select id="orderClient" class="form-input" required style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                        <option value="">-- Select or Add New --</option>
                        ${clients.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                        <option value="new">+ Add New Client</option>
                    </select>
                </div>
                <div class="form-group"><label class="form-label">Package</label>
                    <select id="orderPackage" class="form-input" onchange="fillPackageDetails()" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                        <option value="">-- Select Package --</option>
                        <optgroup label="ðŸ“¦ Service Packages">
                        ${servicePackages.map(p => `<option value="${p.id}">${p.name} - $${p.price}</option>`).join('')}
                        </optgroup>
                        <optgroup label="ðŸŽ¯ Individual Services">
                        ${individualServices.map(s => `<option value="svc-${s.id}">${s.name} - $${s.price}</option>`).join('')}
                        </optgroup>
                        <option value="custom">âž• Create Custom Package</option>
                    </select>
                </div>
            </div>

            <!-- Custom Package Builder -->
            <div id="customPackageBuilder" style="display: none; margin-bottom: 20px; padding: 20px; background: rgba(225,29,72,0.1); border-radius: 12px; border: 1px solid rgba(225,29,72,0.3);">
                <div style="font-weight: 600; margin-bottom: 12px; color: var(--red);">ðŸŽ¨ Build Custom Package</div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;" id="selectedServicesContainer"></div>
                <select id="addServiceToPackage" onchange="addServiceToCustomPackage(this.value)" style="width: 100%; padding: 10px; background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px;">
                    <option value="">âž• Add service to package...</option>
                    ${individualServices.map(s => `<option value="${s.id}">${s.name} - $${s.price}</option>`).join('')}
                </select>
                <div style="margin-top: 12px; font-size: 14px; color: rgba(255,255,255,0.7);">Package Total: <strong id="customPackageTotal">$0</strong></div>
            </div>
            <div class="form-group"><label class="form-label">Project Name *</label><input type="text" id="orderProject" class="form-input" required></div>
            <div class="form-group"><label class="form-label">Description</label><textarea id="orderDesc" class="form-input" rows="2"></textarea></div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Price ($) *</label><input type="number" id="orderEstimate" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Turnaround *</label><input type="text" id="orderTurnaround" class="form-input" required></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Due Date *</label><input type="date" id="orderDueDate" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Status</label>
                    <select id="orderStatus" class="form-input">
                        <option value="pending">Pending</option>
                        <option value="in_progress">In Progress</option>
                        <option value="delivered">Delivered</option>
                    </select>
                </div>
            </div>
            <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button type="submit" class="btn-cta" style="flex: 1;">Create Order & Invoice</button>
                <button type="button" onclick="generateLeadForm()" class="btn-cta" style="flex: 1; background: #000;">Generate Lead Form</button>
            </div>
        </form>

        <!-- LEAD FORM GENERATOR -->
        <div class="form-section" id="leadFormSection" style="display: none;">
            <div class="form-section-title">ðŸŽ¯ Lead Capture Form Code</div>
            <p style="color: #666; margin-bottom: 16px;">Copy this code and paste it on your website to capture leads:</p>
            <textarea id="leadFormCode" class="form-input" rows="12" style="font-family: monospace; font-size: 12px;" readonly></textarea>
            <button onclick="copyLeadForm()" class="btn-cta" style="margin-top: 12px;">ðŸ“‹ Copy Form Code</button>
        </div>
    `;
}

function selectPackage(pkgId) {
    document.querySelectorAll('.package-card').forEach(el => el.style.borderColor = '#e5e5e5');
    document.getElementById('pkg-' + pkgId).style.borderColor = 'var(--red)';
    document.getElementById('orderPackage').value = pkgId;
    fillPackageDetails();
}

let customPackageServices = [];

function fillPackageDetails() {
    const pkgId = document.getElementById('orderPackage').value;
    const customBuilder = document.getElementById('customPackageBuilder');

    // Handle custom package option
    if (pkgId === 'custom') {
        customBuilder.style.display = 'block';
        document.getElementById('orderProject').value = 'Custom Package';
        return;
    } else {
        customBuilder.style.display = 'none';
    }

    // Handle individual service
    if (pkgId.startsWith('svc-')) {
        const svcId = pkgId.replace('svc-', '');
        const svc = individualServices.find(s => s.id == svcId);
        if (svc) {
            document.getElementById('orderProject').value = svc.name;
            document.getElementById('orderDesc').value = svc.description || '';
            document.getElementById('orderEstimate').value = svc.price;
            document.getElementById('orderTurnaround').value = svc.turnaround || '5-7 days';
            const days = parseInt(svc.turnaround) || 7;
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + days);
            document.getElementById('orderDueDate').value = dueDate.toISOString().split('T')[0];
        }
        return;
    }

    // Handle package
    const pkg = servicePackages.find(p => p.id === pkgId);
    if (pkg) {
        document.getElementById('orderProject').value = pkg.name;
        document.getElementById('orderDesc').value = pkg.desc;
        document.getElementById('orderEstimate').value = pkg.price;
        document.getElementById('orderTurnaround').value = pkg.turnaround;
        const days = parseInt(pkg.turnaround) || 14;
        const dueDate = new Date();
        dueDate.setDate(dueDate.getDate() + days);
        document.getElementById('orderDueDate').value = dueDate.toISOString().split('T')[0];
    }
}

function addServiceToCustomPackage(serviceId) {
    if (!serviceId) return;
    const svc = individualServices.find(s => s.id == serviceId);
    if (!svc || customPackageServices.find(s => s.id == serviceId)) return;

    customPackageServices.push(svc);
    renderCustomPackageServices();
    document.getElementById('addServiceToPackage').value = '';
}

function removeFromCustomPackage(serviceId) {
    customPackageServices = customPackageServices.filter(s => s.id != serviceId);
    renderCustomPackageServices();
}

function renderCustomPackageServices() {
    const container = document.getElementById('selectedServicesContainer');
    const total = customPackageServices.reduce((sum, s) => sum + (s.price || 0), 0);

    container.innerHTML = customPackageServices.map(s => `
        <span style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; background: #252525; border-radius: 20px; font-size: 13px;">
            ${s.name} - $${s.price}
            <button onclick="removeFromCustomPackage(${s.id})" style="background: none; border: none; color: #ff4444; cursor: pointer; font-size: 16px;">Ã—</button>
        </span>
    `).join('');

    document.getElementById('customPackageTotal').textContent = '$' + total.toLocaleString();
    document.getElementById('orderEstimate').value = total;
    document.getElementById('orderDesc').value = customPackageServices.map(s => s.name).join(', ');
}

function generateLeadForm() {
    const pkgId = document.getElementById('orderPackage').value;
    const pkg = servicePackages.find(p => p.id === pkgId) || { name: 'Project Inquiry', price: '', desc: '' };

    const formCode = `<!-- NUI Lead Capture Form -->
<style>
.nui-form{font-family:'Inter',sans-serif;max-width:500px;margin:0 auto;padding:40px;background:#000;color:#fff;border-radius:12px}
.nui-form h3{font-size:24px;margin-bottom:8px}
.nui-form p{color:#888;margin-bottom:24px;font-size:14px}
.nui-form input,.nui-form select,.nui-form textarea{width:100%;padding:14px;margin-bottom:16px;border:1px solid #333;background:#111;color:#fff;border-radius:8px;font-size:14px}
.nui-form input:focus,.nui-form select:focus,.nui-form textarea:focus{outline:none;border-color:#ff0000}
.nui-form button{width:100%;padding:16px;background:#ff0000;color:#fff;border:none;font-weight:600;font-size:16px;cursor:pointer;border-radius:8px}
.nui-form button:hover{background:#cc0000}
.nui-form .logo{color:#ff0000;font-weight:800;font-size:20px;margin-bottom:24px}
</style>
<form class="nui-form" action="https://formspree.io/f/YOUR_FORM_ID" method="POST">
  <div class="logo">NUI.</div>
  <h3>${pkg.name || 'Get Started'}</h3>
  <p>${pkg.desc || "Fill out the form below and we'll get back to you within 24 hours."}</p>
  <input type="text" name="name" placeholder="Your Name *" required>
  <input type="email" name="email" placeholder="Email Address *" required>
  <input type="tel" name="phone" placeholder="Phone Number">
  <input type="text" name="business" placeholder="Business Name">
  <select name="service">
    <option value="">Select Service Interest</option>
    ${servicePackages.map(p => `<option value="${p.name}">${p.name} - $${p.price}</option>`).join('\n    ')}
  </select>
  <input type="text" name="budget" placeholder="Budget Range">
  <textarea name="message" rows="3" placeholder="Tell us about your project..."></textarea>
  <input type="hidden" name="source" value="NUI Lead Form - ${pkg.name}">
  <button type="submit">Get Your Free Quote â†’</button>
</form>`;

    document.getElementById('leadFormCode').value = formCode;
    document.getElementById('leadFormSection').style.display = 'block';
    document.getElementById('leadFormSection').scrollIntoView({ behavior: 'smooth' });
}

function copyLeadForm() {
    const code = document.getElementById('leadFormCode');
    code.select();
    document.execCommand('copy');
    alert('Lead form code copied to clipboard!');
}

function loadAdminNewClientPanel() {
    document.getElementById('adminNewClientPanel').innerHTML = `
        <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 32px;">Create New Client</h1>
        <form onsubmit="createClient(event)" class="form-section" style="max-width: 600px;">
            <div class="form-group"><label class="form-label">Business Name *</label><input type="text" id="newClientName" class="form-input" required></div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Email *</label><input type="email" id="newClientEmail" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Password *</label><input type="text" id="newClientPassword" class="form-input" required></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Industry</label><input type="text" id="newClientIndustry" class="form-input" placeholder="e.g., Technology"></div>
                <div class="form-group"><label class="form-label">Website</label><input type="url" id="newClientWebsite" class="form-input" placeholder="https://"></div>
            </div>
            <div class="form-group"><label class="form-label">Brand Colors</label>
                <div style="display: flex; gap: 12px;">
                    <input type="color" id="color1" value="#ff0000" style="width: 50px; height: 40px; border: none; cursor: pointer;">
                    <input type="color" id="color2" value="#000000" style="width: 50px; height: 40px; border: none; cursor: pointer;">
                    <input type="color" id="color3" value="#ffffff" style="width: 50px; height: 40px; border: none; cursor: pointer;">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Heading Font</label><input type="text" id="newClientHeadingFont" class="form-input" value="Inter"></div>
                <div class="form-group"><label class="form-label">Body Font</label><input type="text" id="newClientBodyFont" class="form-input" value="Inter"></div>
            </div>
            <button type="submit" class="btn-cta" style="width: 100%;">Create Client Portal</button>
        </form>
    `;
}

function loadAdminAssetsPanel() {
    // Calculate storage stats
    const totalAssets = clients.reduce((sum, c) => {
        if (!c.assets) return sum;
        return sum + Object.values(c.assets).reduce((s, arr) => s + (arr?.length || 0), 0);
    }, 0);

    const clientsWithAssets = clients.filter(c => {
        if (!c.assets) return false;
        return Object.values(c.assets).some(arr => arr?.length > 0);
    });

    document.getElementById('adminAssetsPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ“ Client Brand Asset Storage</h1>
            <p class="panel-subtitle">Centralized storage for all client brand assets</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-label">Total Assets</div><div class="stat-value">${totalAssets}</div></div>
            <div class="stat-card"><div class="stat-label">Clients with Assets</div><div class="stat-value">${clientsWithAssets.length}</div></div>
            <div class="stat-card"><div class="stat-label">Total Clients</div><div class="stat-value">${clients.length}</div></div>
            <div class="stat-card"><div class="stat-label">Asset Categories</div><div class="stat-value">8</div></div>
        </div>

        <!-- Client Selector -->
        <div class="form-section">
            <div class="form-section-title">ðŸ“‚ Select Client</div>
            <div class="form-row">
                <div class="form-group" style="flex: 2;">
                    <select id="assetClient" class="form-select" onchange="selectAssetClient(this.value)">
                        <option value="">-- Select Client to View/Upload Assets --</option>
                        ${clients.map(c => {
                            const assetCount = c.assets ? Object.values(c.assets).reduce((s, arr) => s + (arr?.length || 0), 0) : 0;
                            return '<option value="' + c.id + '">' + c.name + ' (' + assetCount + ' assets)</option>';
                        }).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <button class="btn-admin primary" onclick="showBulkAssetUpload()">ðŸ“¤ Bulk Upload</button>
                </div>
            </div>
        </div>

        <!-- Quick Access - Clients with Assets -->
        <div class="form-section">
            <div class="form-section-title">â­ Quick Access - Clients with Assets</div>
            ${clientsWithAssets.length === 0 ? '<p style="color: rgba(255,255,255,0.5);">No clients have assets yet. Select a client above to start uploading.</p>' : ''}
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                ${clientsWithAssets.slice(0, 10).map(c => {
                    const assetCount = Object.values(c.assets || {}).reduce((s, arr) => s + (arr?.length || 0), 0);
                    const firstLogo = c.assets?.logos?.[0]?.data || '';
                    return `
                    <div onclick="selectAssetClient(${c.id})" style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 12px; min-width: 200px; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='rgba(255,255,255,0.05)'">
                        <div style="width: 48px; height: 48px; border-radius: 8px; background: linear-gradient(135deg, ${c.colors?.[0] || '#ff3b30'}, ${c.colors?.[1] || '#000'}); display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            ${firstLogo ? '<img src="' + firstLogo + '" style="width: 100%; height: 100%; object-fit: contain; padding: 4px;">' : '<span style="color: #fff; font-weight: 700;">' + c.name.charAt(0) + '</span>'}
                        </div>
                        <div>
                            <div style="font-weight: 600; color: #fff;">${c.name}</div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.5);">${assetCount} assets</div>
                        </div>
                    </div>
                `;}).join('')}
            </div>
        </div>

        <!-- Asset Upload Area -->
        <div id="assetUploadArea"></div>

        <!-- All Clients Assets Overview -->
        <div class="form-section" style="margin-top: 24px;">
            <div class="form-section-title">ðŸ“Š All Clients Asset Overview</div>
            <table class="data-table">
                <thead><tr><th>Client</th><th>Logos</th><th>Mockups</th><th>Social</th><th>Video</th><th>Fonts</th><th>Total</th><th>Actions</th></tr></thead>
                <tbody>
                    ${clients.slice(0, 20).map(c => {
                        const a = c.assets || {};
                        const total = Object.values(a).reduce((s, arr) => s + (arr?.length || 0), 0);
                        return `
                        <tr>
                            <td style="font-weight: 600;">${c.name}</td>
                            <td>${a.logos?.length || 0}</td>
                            <td>${a.mockups?.length || 0}</td>
                            <td>${a.social?.length || 0}</td>
                            <td>${a.video?.length || 0}</td>
                            <td>${a.fonts?.length || 0}</td>
                            <td style="font-weight: 600;">${total}</td>
                            <td>
                                <button class="btn-admin small" onclick="selectAssetClient(${c.id})">View</button>
                                ${total > 0 ? '<button class="btn-admin small primary" onclick="downloadClientAssets(' + c.id + ')">Download</button>' : ''}
                            </td>
                        </tr>
                    `;}).join('')}
                </tbody>
            </table>
        </div>
    `;
}

function selectAssetClient(clientId) {
    if (!clientId) {
        currentAdminClient = null;
        document.getElementById('assetUploadArea').innerHTML = '';
        return;
    }
    currentAdminClient = clients.find(c => c.id == clientId);
    document.getElementById('assetClient').value = clientId;
    renderAssetUpload();
}

function downloadClientAssets(clientId) {
    const client = clients.find(c => c.id == clientId);
    if (!client) return;

    const assetCount = Object.values(client.assets || {}).reduce((s, arr) => s + (arr?.length || 0), 0);
    alert('Downloading ' + assetCount + ' assets for ' + client.name + '...\n\nIn production, this would generate a ZIP file with all brand assets organized by category.');
}

function renderAssetUpload() {
    if (!currentAdminClient) { document.getElementById('assetUploadArea').innerHTML = ''; return; }

    // Initialize assets object if it doesn't exist
    if (!currentAdminClient.assets) {
        currentAdminClient.assets = {};
    }

    const categories = ['logos', 'video', 'mockups', 'social', 'banner', 'fonts', 'patterns', 'package'];
    const currentAssets = currentAdminClient.assets[assetCategory] || [];
    const categoryName = assetCategory ? assetCategory.charAt(0).toUpperCase() + assetCategory.slice(1) : 'Assets';

    document.getElementById('assetUploadArea').innerHTML = `
        <div class="category-tabs">${categories.map(cat => `<button class="category-tab ${assetCategory === cat ? 'active' : ''}" onclick="assetCategory='${cat}'; renderAssetUpload();">${cat.charAt(0).toUpperCase() + cat.slice(1)}</button>`).join('')}</div>
        <div class="upload-zone" onclick="document.getElementById('assetFile').click();" ondragover="event.preventDefault(); this.style.borderColor='var(--red)';" ondragleave="this.style.borderColor='#ccc';" ondrop="handleAssetDrop(event);">
            <p>Drag & drop files here or <span>browse</span></p>
            <small>PNG, JPG, SVG, MP4, ZIP supported</small>
            <input type="file" id="assetFile" style="display: none;" multiple onchange="handleAssetUpload(event)">
        </div>
        <h3 style="margin-bottom: 16px;">Current ${categoryName} (${currentAssets.length})</h3>
        <div class="assets-grid">${currentAssets.map((a, i) => `
            <div class="asset-card">
                <div class="asset-preview">${a.data && a.data.startsWith('data:image') ? `<img src="${a.data}">` : a.type}</div>
                <div class="asset-info"><div class="asset-name">${a.name}</div><div class="asset-meta">${a.size} â€¢ ${a.type}</div></div>
                <div style="padding: 0 12px 12px;"><button onclick="deleteAsset(${i})" style="width: 100%; padding: 8px; background: #fee2e2; color: #dc2626; border: none; border-radius: 4px; cursor: pointer; font-family: inherit;">Delete</button></div>
            </div>
        `).join('') || '<p style="color: #888; grid-column: 1/-1; text-align: center; padding: 40px;">No assets yet</p>'}</div>
    `;
}

function handleAssetUpload(e) {
    if (!currentAdminClient) return;

    // Initialize assets object if it doesn't exist
    if (!currentAdminClient.assets) {
        currentAdminClient.assets = {};
    }

    Array.from(e.target.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = (ev) => {
            if (!currentAdminClient.assets[assetCategory]) currentAdminClient.assets[assetCategory] = [];
            currentAdminClient.assets[assetCategory].push({
                name: file.name,
                size: (file.size / 1024).toFixed(1) + ' KB',
                type: file.name.split('.').pop().toUpperCase(),
                data: ev.target.result,
                uploadedAt: new Date().toISOString()
            });
            saveClients();
            renderAssetUpload();
        };
        reader.readAsDataURL(file);
    });
}

function handleAssetDrop(e) {
    e.preventDefault();
    e.target.style.borderColor = '#ccc';
    if (e.dataTransfer.files.length) {
        document.getElementById('assetFile').files = e.dataTransfer.files;
        handleAssetUpload({ target: { files: e.dataTransfer.files } });
    }
}

function deleteAsset(index) {
    if (!confirm('Delete this asset?')) return;
    if (currentAdminClient && currentAdminClient.assets && currentAdminClient.assets[assetCategory]) {
        currentAdminClient.assets[assetCategory].splice(index, 1);
        saveClients();
        renderAssetUpload();
    }
}

// ==================== RENDER HELPERS ====================
function renderClientCard(c) {
    const headerColor = (c.colors && c.colors[0]) ? c.colors[0] : '#e11d48';
    return `<div class="client-card">
        <div class="client-card-header" style="background: ${headerColor};">${c.name.charAt(0)}</div>
        <div class="client-card-body">
            <div class="client-card-name">${c.name}</div>
            <div class="client-card-meta">${c.industry || 'No industry'} â€¢ ${c.assets ? Object.values(c.assets).flat().length : 0} assets</div>
            <div class="client-card-btns">
                <button onclick="viewClientAsAdmin(${c.id})" style="background: #000; color: #fff;">View Portal</button>
                <button onclick="currentAdminClient = clients.find(x => x.id === ${c.id}); showAdminPanel('assets');" style="background: #f5f5f5; color: #000;">Upload</button>
                <button onclick="deleteClient(${c.id})" style="background: #fee2e2; color: #dc2626;">Ã—</button>
            </div>
        </div>
    </div>`;
}

function renderOrderCard(o, showActions = false) {
    const client = clients.find(c => c.id === o.clientId);
    const progress = o.status === 'delivered' ? 100 : o.status === 'in_progress' ? 60 : 20;
    const daysLeft = Math.ceil((new Date(o.dueDate) - new Date()) / (1000*60*60*24));
    return `<div class="order-card">
        <div class="order-header">
            <div><div class="order-title">${o.projectName}</div><div class="order-client">${client ? client.name : 'Unknown'}</div></div>
            <span class="order-status ${o.status}">${o.status.replace('_', ' ')}</span>
        </div>
        <div class="order-details">
            <div class="order-detail"><div class="val">$${(o.estimate || 0).toLocaleString()}</div><div class="lbl">Estimate</div></div>
            <div class="order-detail"><div class="val">${o.turnaround}</div><div class="lbl">Turnaround</div></div>
            <div class="order-detail"><div class="val">${new Date(o.dueDate).toLocaleDateString()}</div><div class="lbl">Due Date</div></div>
            <div class="order-detail"><div class="val" style="color: ${daysLeft < 0 ? 'var(--red)' : daysLeft < 3 ? 'var(--yellow)' : 'var(--green)'}">${daysLeft < 0 ? 'Overdue' : daysLeft + ' days'}</div><div class="lbl">Remaining</div></div>
        </div>
        <div class="progress-bar"><div class="progress-fill" style="width: ${progress}%; background: ${o.status === 'delivered' ? 'var(--green)' : o.status === 'in_progress' ? 'var(--blue)' : 'var(--yellow)'}"></div></div>
        ${showActions ? `<div style="display: flex; gap: 8px; margin-top: 16px;">
            <button onclick="showInvoice(${o.id})" class="btn-cta btn-sm">View Invoice</button>
            <button onclick="updateOrderStatus(${o.id})" style="padding: 10px 16px; background: #f5f5f5; border: none; border-radius: 4px; cursor: pointer; font-family: inherit;">Update Status</button>
            ${o.status !== 'delivered' ? `<button onclick="markDelivered(${o.id})" style="padding: 10px 16px; background: var(--green); color: #fff; border: none; border-radius: 4px; cursor: pointer; font-family: inherit;">Mark Delivered</button>` : ''}
        </div>` : ''}
    </div>`;
}

// ==================== ORDER FUNCTIONS ====================
function createOrder(e) {
    e.preventDefault();
    const order = {
        id: Date.now(),
        clientId: parseInt(document.getElementById('orderClient').value),
        projectName: document.getElementById('orderProject').value,
        description: document.getElementById('orderDesc').value,
        estimate: parseFloat(document.getElementById('orderEstimate').value),
        turnaround: document.getElementById('orderTurnaround').value,
        dueDate: document.getElementById('orderDueDate').value,
        status: document.getElementById('orderStatus').value,
        createdAt: new Date().toISOString(),
        deliveredAt: null,
        deliverables: []
    };
    orders.push(order);
    saveOrders();
    showInvoice(order.id);
    showAdminPanel('orders');
}

function createClient(e) {
    e.preventDefault();

    const email = document.getElementById('newClientEmail').value;
    const name = document.getElementById('newClientName').value;

    // Validate email format
    if (!validateEmail(email)) {
        alert('Please enter a valid email address.');
        return;
    }

    // Check if email already exists
    if (clients.find(c => c.email.toLowerCase() === email.toLowerCase())) {
        alert('A client with this email already exists.');
        return;
    }

    const client = {
        id: Date.now(),
        name: name,
        email: email,
        password: document.getElementById('newClientPassword').value,
        industry: document.getElementById('newClientIndustry').value,
        website: document.getElementById('newClientWebsite').value,
        colors: [document.getElementById('color1').value, document.getElementById('color2').value, document.getElementById('color3').value],
        fonts: { heading: document.getElementById('newClientHeadingFont').value || 'Inter', body: document.getElementById('newClientBodyFont').value || 'Inter' },
        assets: { logos: [], mockups: [], social: [], video: [], banner: [], fonts: [], patterns: [], package: [] },
        emailVerified: false,
        verificationToken: generateToken(),
        createdAt: new Date().toISOString()
    };
    clients.push(client);
    saveClients();

    // Send verification email (simulated)
    sendVerificationEmail(client);

    alert('Client created! A verification email has been sent to ' + email);
    showAdminPanel('clients');
}

// Email validation
function validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

// Generate verification token
function generateToken() {
    return 'verify_' + Math.random().toString(36).substring(2) + Date.now().toString(36);
}

// Send verification email (simulated)
function sendVerificationEmail(client) {
    console.log('Verification email sent to:', client.email);
    console.log('Verification link: https://newurbaninfluence.com/verify?token=' + client.verificationToken);
    // In production, this would send an actual email via an email service API
}

// Verify email with token
function verifyEmail(token) {
    const client = clients.find(c => c.verificationToken === token);
    if (client) {
        client.emailVerified = true;
        client.verificationToken = null;
        saveClients();
        alert('Email verified successfully! You can now log in.');
        return true;
    }
    alert('Invalid or expired verification token.');
    return false;
}

// Resend verification email
function resendVerification(clientId) {
    const client = clients.find(c => c.id === clientId);
    if (client && !client.emailVerified) {
        client.verificationToken = generateToken();
        saveClients();
        sendVerificationEmail(client);
        alert('Verification email resent to ' + client.email);
    }
}

function deleteClient(id) {
    if (!confirm('Delete this client and all their data?')) return;
    clients = clients.filter(c => c.id !== id);
    orders = orders.filter(o => o.clientId !== id);
    saveClients();
    saveOrders();
    loadAdminClientsPanel();
}

function updateOrderStatus(id) {
    const order = orders.find(o => o.id === id);
    const newStatus = prompt('Enter new status (pending, in_progress, delivered):', order.status);
    if (newStatus && ['pending', 'in_progress', 'delivered'].includes(newStatus)) {
        order.status = newStatus;
        if (newStatus === 'delivered') order.deliveredAt = new Date().toISOString();
        saveOrders();
        loadAdminOrdersPanel();
    }
}

function markDelivered(id) {
    const order = orders.find(o => o.id === id);
    if (!order) return;
    order.status = 'delivered';
    order.deliveredAt = new Date().toISOString();
    saveOrders();

    // Trigger workflow: Send delivery notification
    triggerOrderDelivered(id);

    alert('Order marked as delivered! Client will see notification.');
    // Refresh the active panel
    const activePanel = document.querySelector('.admin-panel.active');
    if (activePanel?.id === 'adminDeliveryPanel') {
        loadAdminDeliveryPanel();
    } else {
        loadAdminOrdersPanel();
    }
}

function viewClientAsAdmin(id) {
    const client = clients.find(c => c.id === id);
    if (client) {
        document.getElementById('adminDashboard').style.display = 'none';
        document.getElementById('clientPortal').style.display = 'block';
        showClientPortal(client);
    }
}

// ==================== INVOICE ====================
function showInvoice(orderId) {
    const order = orders.find(o => o.id === orderId);
    const client = clients.find(c => c.id === order.clientId);
    document.getElementById('invoiceContent').innerHTML = `
        <div class="invoice-preview" id="invoicePrint">
            <div class="invoice-header">
                <div><div class="invoice-logo">NEW URBAN INFLUENCE</div><p style="font-size: 12px; color: #666; margin-top: 8px;">Detroit's Premier Digital Agency<br>newurbaninfluence@gmail.com</p></div>
                <div><div class="invoice-title">INVOICE</div><div class="invoice-meta">#${order.id}<br>${new Date(order.createdAt).toLocaleDateString()}</div></div>
            </div>
            <div class="invoice-parties">
                <div class="invoice-party"><h4>Bill To</h4><p><strong>${client ? client.name : 'Client'}</strong><br>${client ? client.email : ''}<br>${client ? client.industry : ''}</p></div>
                <div class="invoice-party"><h4>Project Details</h4><p><strong>Due Date:</strong> ${new Date(order.dueDate).toLocaleDateString()}<br><strong>Turnaround:</strong> ${order.turnaround}<br><strong>Status:</strong> ${order.status.replace('_', ' ')}</p></div>
            </div>
            <table class="invoice-table">
                <thead><tr><th>Description</th><th style="text-align: right;">Amount</th></tr></thead>
                <tbody>
                    <tr><td><strong>${order.projectName}</strong><br><span style="font-size: 13px; color: #666;">${order.description || 'No description'}</span></td><td style="text-align: right;">$${(order.estimate || 0).toLocaleString()}</td></tr>
                </tbody>
            </table>
            <div class="invoice-total">Total: $${(order.estimate || 0).toLocaleString()}</div>
            <p style="margin-top: 32px; font-size: 12px; color: #888; text-align: center;">Thank you for your business! â€¢ New Urban Influence â€¢ Unapologetically Detroit</p>
        </div>
    `;
    document.getElementById('invoiceModal').classList.add('active');
}

function closeInvoiceModal() { document.getElementById('invoiceModal').classList.remove('active'); }

function printInvoice() {
    const content = document.getElementById('invoicePrint').innerHTML;
    const win = window.open('', '', 'width=800,height=600');
    win.document.write(`<html><head><title>Invoice</title><style>body{font-family:Inter,sans-serif;padding:40px;}.invoice-preview{max-width:700px;margin:0 auto;}.invoice-header{display:flex;justify-content:space-between;margin-bottom:32px;padding-bottom:24px;border-bottom:2px solid #000;}.invoice-logo{font-size:24px;font-weight:800;color:#ff0000;}.invoice-title{font-size:32px;font-weight:700;text-align:right;}.invoice-meta{font-size:13px;color:#666;text-align:right;}.invoice-parties{display:grid;grid-template-columns:1fr 1fr;gap:32px;margin-bottom:32px;}.invoice-party h4{font-size:12px;color:#888;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;}.invoice-table{width:100%;border-collapse:collapse;margin-bottom:24px;}.invoice-table th{text-align:left;padding:12px;border-bottom:2px solid #000;font-size:12px;text-transform:uppercase;}.invoice-table td{padding:12px;border-bottom:1px solid #e5e5e5;}.invoice-total{text-align:right;font-size:24px;font-weight:700;}</style></head><body>${content}</body></html>`);
    win.document.close();
    win.print();
}

// ==================== CLIENT PORTAL (PORTFOLIO-STYLE BRAND GUIDE) ====================
function showClientPortal(client) {
    document.getElementById('clientPortalName').textContent = client.name + ' Brand Portal';
    const clientOrders = orders.filter(o => o.clientId === client.id);
    const deliveredOrders = clientOrders.filter(o => o.status === 'delivered');
    const activeOrders = clientOrders.filter(o => o.status !== 'delivered');
    const logos = client.assets?.logos || [];
    const videos = client.assets?.video || [];
    const mockups = client.assets?.mockups || [];
    const social = client.assets?.social || [];
    const banners = client.assets?.banner || [];
    const allAssets = Object.values(client.assets || {}).flat();

    // Get brand guide proof status
    const brandGuide = client.brandGuide || { status: 'draft', proofComments: [] };
    const isPaid = checkClientPaymentStatus(client.id);

    function isLight(c) { const hex = c.replace('#',''); const r = parseInt(hex.substr(0,2),16); const g = parseInt(hex.substr(2,2),16); const b = parseInt(hex.substr(4,2),16); return (r*299+g*587+b*114)/1000 > 128; }

    document.getElementById('clientPortalContent').innerHTML = `
        <!-- Back Navigation Bar -->
        <div class="portal-nav-bar" style="background: rgba(0,0,0,0.95); padding: 12px 24px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100;">
            <button onclick="goBackFromPortal()" class="portal-back-btn" style="display: flex; align-items: center; gap: 8px; background: none; border: none; color: #fff; cursor: pointer; font-size: 16px; padding: 8px 16px; border-radius: 8px; transition: background 0.2s;">
                <span style="font-size: 20px;">â†</span> Back
            </button>
            <span style="color: #888; font-size: 14px;">${client.name} Brand Portal</span>
            ${currentUser?.type === 'admin' ? '<button onclick="backToAdmin()" style="background: var(--accent); color: #000; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">Admin Dashboard</button>' : '<div></div>'}
        </div>

        <style>
            /* PORTFOLIO-STYLE BRAND GUIDE CSS */
            .brand-portal-case { background: #080808; border-radius: 8px; overflow: hidden; }
            .brand-portal-tabs { display: flex; border-bottom: 1px solid rgba(255,255,255,0.06); padding: 0 40px; background: rgba(0,0,0,0.5); }
            .brand-portal-tab { padding: 16px 28px; font-size: 11px; font-weight: 700; color: rgba(255,255,255,0.35); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.3s; text-transform: uppercase; letter-spacing: 2px; }
            .brand-portal-tab:hover { color: rgba(255,255,255,0.6); }
            .brand-portal-tab.active { color: #fff; border-color: ${client.colors[0]}; }
            .brand-portal-panel { display: none; animation: fadeIn 0.4s ease; }
            .brand-portal-panel.active { display: block; }
            .brand-section { margin-bottom: 56px; }
            .brand-section-title { font-size: 11px; color: ${client.colors[0]}; text-transform: uppercase; letter-spacing: 3px; font-weight: 700; margin-bottom: 32px; display: flex; align-items: center; gap: 12px; }
            .brand-section-title::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, ${client.colors[0]}50, transparent); }
            .logo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
            .logo-box { background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; padding: 0; text-align: center; transition: all 0.3s; aspect-ratio: 4/3; display: flex; flex-direction: column; overflow: hidden; position: relative; }
            .logo-box:hover { border-color: rgba(255,255,255,0.12); transform: scale(1.01); }
            .logo-box-label { font-size: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 2px; padding: 12px 16px; background: rgba(0,0,0,0.9); font-weight: 600; position: absolute; bottom: 0; left: 0; right: 0; z-index: 2; }
            .logo-box-img { flex: 1; display: flex; align-items: center; justify-content: center; padding: 0; position: relative; background: #080808; }
            .logo-box-img img { width: 100%; height: 100%; object-fit: contain; padding: 20px; }
            .logo-placeholder { width: 100%; height: 100%; background: #080808; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.1); font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
            .color-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
            .color-box { aspect-ratio: 1; border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; padding: 12px; position: relative; overflow: hidden; }
            .color-box::before { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.7), transparent); }
            .color-hex { position: relative; font-size: 11px; font-weight: 700; color: #fff; letter-spacing: 1px; }
            .font-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
            .font-box { background: #fff; border: 1px solid rgba(0,0,0,0.08); border-radius: 8px; padding: 32px; }
            .font-label { font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 16px; }
            .font-name { font-size: 36px; font-weight: 700; margin-bottom: 8px; color: #000; }
            .font-sample { color: #333; font-size: 14px; line-height: 1.6; }
            .mockup-grid { display: flex; flex-direction: column; gap: 16px; }
            .mockup-row { display: grid; gap: 16px; }
            .mockup-row.full { grid-template-columns: 1fr; }
            .mockup-row.split { grid-template-columns: 1fr 1fr; }
            .mockup-box { background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; overflow: hidden; position: relative; transition: all 0.3s ease; }
            .mockup-box.wide { aspect-ratio: 16/9; }
            .mockup-box.tall { aspect-ratio: 4/5; }
            .mockup-box:hover { transform: scale(1.01); border-color: rgba(255,255,255,0.12); }
            .mockup-box img, .mockup-box video { width: 100%; height: 100%; object-fit: cover; }
            .mockup-placeholder { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: rgba(255,255,255,0.12); font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; gap: 10px; background: #080808; }
            .mockup-placeholder::before { content: '+'; width: 32px; height: 32px; border: 1px solid rgba(255,255,255,0.08); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: rgba(255,255,255,0.1); }
            .results-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
            .result-card { background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.08); border-radius: 8px; padding: 48px 32px; text-align: center; position: relative; overflow: hidden; }
            .result-number { font-size: 64px; font-weight: 900; position: relative; color: ${client.colors[0]}; }
            .result-label { font-size: 11px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 3px; margin-top: 12px; position: relative; }
            .website-preview { border-radius: 8px; overflow: hidden; border: 1px solid rgba(255,255,255,0.08); }
            .website-preview img { width: 100%; display: block; }
            .testimonial-box { background: rgba(0,0,0,0.3); border-left: 3px solid ${client.colors[0]}; padding: 48px; border-radius: 0 8px 8px 0; }
            .testimonial-box p { font-size: 22px; font-style: italic; line-height: 1.7; margin-bottom: 32px; font-weight: 300; }
            .testimonial-author { display: flex; align-items: center; gap: 20px; }
            .testimonial-avatar { width: 48px; height: 48px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; background: ${client.colors[0]}; }
            .proof-approval-bar { background: #111; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 24px; margin: 24px 48px; }
            .proof-status-badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 100px; font-size: 12px; font-weight: 600; }
            .download-section { background: #0a0a0a; padding: 48px; border-top: 1px solid rgba(255,255,255,0.06); }
            .download-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
            .download-card { background: #1a1a1a; padding: 24px; border-radius: 12px; display: flex; flex-direction: column; justify-content: space-between; min-height: 160px; transition: transform 0.2s; }
            .download-card:hover { transform: translateY(-4px); }
            .download-card h4 { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
            .download-card p { font-size: 13px; color: #888; }
            .download-btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 0; font-weight: 600; color: #fff; cursor: pointer; border-bottom: 2px solid #fff; transition: gap 0.2s; background: none; border-top: none; border-left: none; border-right: none; font-family: inherit; }
            .download-btn:hover { gap: 14px; }
            .download-btn:disabled { opacity: 0.5; cursor: not-allowed; }
            @media (max-width: 768px) {
                .brand-portal-tabs { padding: 0 16px; flex-wrap: wrap; }
                .brand-portal-tab { padding: 12px 14px; font-size: 9px; }
                .logo-grid { grid-template-columns: 1fr !important; }
                .color-grid { grid-template-columns: repeat(2, 1fr) !important; }
                .font-grid { grid-template-columns: 1fr !important; }
                .mockup-row.split { grid-template-columns: 1fr; }
                .results-grid { grid-template-columns: 1fr !important; }
                .download-grid { grid-template-columns: 1fr !important; }
                .proof-approval-bar { margin: 24px 16px; }
            }
        </style>

        <!-- BRAND HERO BANNER (Portfolio Style) -->
        <div class="brand-hero" style="width: 100%; min-height: 360px; background: linear-gradient(145deg, ${client.colors[1] || client.colors[0]} 0%, #050505 100%); position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; padding: 60px 40px;">
            <div style="position: absolute; inset: 0; background: url('${logos[0]?.data || ''}') center/cover; opacity: 0.15;"></div>
            <div style="position: absolute; inset: 0; background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.7) 100%);"></div>
            <div style="position: relative; text-align: center; z-index: 1; max-width: 100%;">
                <div style="font-size: 11px; text-transform: uppercase; letter-spacing: 4px; color: ${client.colors[0]}; margin-bottom: 16px; font-weight: 600;">${client.industry || 'Brand Identity'}</div>
                <h2 style="font-size: clamp(32px, 7vw, 80px); font-weight: 900; text-transform: uppercase; letter-spacing: -2px; line-height: 1; color: #fff;">${client.name}</h2>
                <p style="color: rgba(255,255,255,0.5); font-size: 15px; margin-top: 20px; max-width: 550px; margin-left: auto; margin-right: auto; line-height: 1.6;">Complete Brand Identity & Digital Presence</p>
            </div>
            <div style="position: absolute; bottom: 24px; left: 50%; transform: translateX(-50%); display: flex; gap: 6px;">
                ${client.colors.map(c => '<div style="width: 28px; height: 28px; border-radius: 4px; background: ' + c + '; border: 1px solid rgba(255,255,255,0.15);"></div>').join('')}
            </div>
        </div>

        <!-- PROOF APPROVAL BAR (for clients) -->
        ${currentUser?.type !== 'admin' ? `
        <div class="proof-approval-bar">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                <div>
                    <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Proof Status</div>
                    <div class="proof-status-badge" style="background: ${brandGuide.status === 'approved' ? '#10b98120' : brandGuide.status === 'pending' ? '#f59e0b20' : brandGuide.status === 'revision_requested' ? '#ef444420' : '#33333350'}; color: ${brandGuide.status === 'approved' ? '#10b981' : brandGuide.status === 'pending' ? '#f59e0b' : brandGuide.status === 'revision_requested' ? '#ef4444' : '#888'};">
                        <span>${brandGuide.status === 'approved' ? 'âœ“' : brandGuide.status === 'pending' ? 'â³' : brandGuide.status === 'revision_requested' ? 'â†»' : 'ðŸ“'}</span>
                        ${brandGuide.status === 'approved' ? 'Approved' : brandGuide.status === 'pending' ? 'Pending Review' : brandGuide.status === 'revision_requested' ? 'Revision Requested' : 'Draft'}
                    </div>
                </div>
                ${brandGuide.status === 'pending' ? `
                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                    <button onclick="showRevisionModal(${client.id})" style="background: transparent; border: 1px solid #ef4444; color: #ef4444; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: inherit;">â†» Request Revision</button>
                    <button onclick="approveClientBrandProof(${client.id})" style="background: #10b981; border: none; color: #fff; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: inherit;">âœ“ Approve Proof</button>
                </div>
                ` : brandGuide.status === 'approved' ? `
                <div style="color: #10b981; font-weight: 600;">
                    ${isPaid ? 'âœ“ Your brand assets are ready for download below!' : 'âš ï¸ Complete payment to download your brand assets'}
                </div>
                ` : ''}
            </div>
            ${brandGuide.proofComments?.length > 0 ? `
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">Revision History</div>
                ${brandGuide.proofComments.slice(-3).map(c => '<div style="background: #0a0a0a; padding: 12px 16px; border-radius: 8px; margin-bottom: 8px;"><div style="font-size: 12px; color: #888; margin-bottom: 4px;">' + new Date(c.date).toLocaleDateString() + ' - ' + c.type + '</div><div style="font-size: 14px;">' + c.comment + '</div></div>').join('')}
            </div>
            ` : ''}
        </div>
        ` : ''}

        <!-- PORTFOLIO-STYLE TABS -->
        <div class="brand-portal-case">
            <div class="brand-portal-tabs">
                <div class="brand-portal-tab active" onclick="switchBrandPortalTab(0, this)">Brand Guide</div>
                <div class="brand-portal-tab" onclick="switchBrandPortalTab(1, this)">Website / Webapp</div>
                <div class="brand-portal-tab" onclick="switchBrandPortalTab(2, this)">Results</div>
                <div class="brand-portal-tab" onclick="switchBrandPortalTab(3, this)">Downloads</div>
            </div>

            <!-- PANEL 0: BRAND GUIDE -->
            <div class="brand-portal-panel active" data-panel="0" style="padding: 48px; background: linear-gradient(180deg, transparent 0%, ${client.colors[1] || client.colors[0]}10 100%);">

                <!-- BRAND VOICE (Slogan & Mission) -->
                ${(client.slogan || client.mission) ? `
                <div class="brand-section">
                    <div class="brand-section-title">Brand Voice</div>
                    <div style="display: grid; grid-template-columns: ${client.slogan && client.mission ? '1fr 1fr' : '1fr'}; gap: 20px;">
                        ${client.slogan ? '<div style="background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; padding: 32px;"><div style="font-size: 10px; color: ' + client.colors[0] + '; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 16px; font-weight: 600;">Slogan</div><div style="font-size: 24px; font-weight: 700; line-height: 1.3; color: #fff;">"' + client.slogan + '"</div></div>' : ''}
                        ${client.mission ? '<div style="background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; padding: 32px;"><div style="font-size: 10px; color: ' + client.colors[0] + '; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 16px; font-weight: 600;">Mission Statement</div><div style="font-size: 16px; line-height: 1.7; color: rgba(255,255,255,0.7);">' + client.mission + '</div></div>' : ''}
                    </div>
                </div>
                ` : ''}

                <!-- LOGO SYSTEM (3-Column Grid) -->
                <div class="brand-section">
                    <div class="brand-section-title">Logo System</div>
                    <div class="logo-grid">
                        <div class="logo-box" style="border-color: ${client.colors[0]}20;">
                            <div class="logo-box-img">${logos[0]?.data ? '<img src="' + logos[0].data + '" alt="Primary Logo">' : '<div class="logo-placeholder">No Logo</div>'}</div>
                            <div class="logo-box-label">Primary Logo</div>
                        </div>
                        <div class="logo-box" style="border-color: ${client.colors[0]}20;">
                            <div class="logo-box-img">${logos[1]?.data ? '<img src="' + logos[1].data + '" alt="Secondary Logo">' : '<div class="logo-placeholder">No Logo</div>'}</div>
                            <div class="logo-box-label">Secondary Logo</div>
                        </div>
                        <div class="logo-box" style="border-color: ${client.colors[0]}20;">
                            <div class="logo-box-img">${logos[2]?.data ? '<img src="' + logos[2].data + '" alt="Icon Mark">' : '<div class="logo-placeholder">No Icon</div>'}</div>
                            <div class="logo-box-label">Icon / Logo Mark</div>
                        </div>
                    </div>
                </div>

                <!-- COLOR PALETTE (4-Column Grid) -->
                <div class="brand-section">
                    <div class="brand-section-title">Color Palette</div>
                    <div class="color-grid">
                        ${client.colors.map((c, idx) => '<div class="color-box" style="background: ' + c + ';"><div class="color-hex">' + c.toUpperCase() + '</div></div>').join('')}
                        ${client.colors.length < 4 ? Array(4 - client.colors.length).fill('<div class="color-box" style="background: #1a1a1a;"><div class="color-hex">â€”</div></div>').join('') : ''}
                    </div>
                </div>

                <!-- FONT SYSTEM (2-Column Grid) -->
                <div class="brand-section">
                    <div class="brand-section-title">Font System</div>
                    <div class="font-grid">
                        <div class="font-box">
                            <div class="font-label">Heading Font</div>
                            <div class="font-name" style="font-family: '${client.fonts?.heading || 'Inter'}', sans-serif;">${client.fonts?.heading || 'Inter'}</div>
                            <div class="font-sample">ABCDEFGHIJKLMNOPQRSTUVWXYZ<br>abcdefghijklmnopqrstuvwxyz<br>0123456789</div>
                        </div>
                        <div class="font-box">
                            <div class="font-label">Body Font</div>
                            <div class="font-name" style="font-family: '${client.fonts?.body || 'Inter'}', sans-serif;">${client.fonts?.body || 'Inter'}</div>
                            <div class="font-sample" style="font-family: '${client.fonts?.body || 'Inter'}', sans-serif;">The quick brown fox jumps over the lazy dog. Pack my box with five dozen liquor jugs.</div>
                        </div>
                    </div>
                </div>

                <!-- BRAND MOCKUPS (Portfolio Layout: 16:9, two 4:5, 16:9) -->
                <div class="brand-section">
                    <div class="brand-section-title">Brand Mockups</div>
                    <div class="mockup-grid">
                        <!-- Top 16:9 -->
                        <div class="mockup-row full">
                            <div class="mockup-box wide" style="border-color: ${client.colors[0]}15;">
                                ${mockups[0]?.data ? '<img src="' + mockups[0].data + '" alt="Mockup">' : '<div class="mockup-placeholder">Image / Video</div>'}
                            </div>
                        </div>
                        <!-- Middle two 4:5 -->
                        <div class="mockup-row split">
                            <div class="mockup-box tall" style="border-color: ${client.colors[0]}15;">
                                ${mockups[1]?.data ? '<img src="' + mockups[1].data + '" alt="Mockup">' : '<div class="mockup-placeholder">Image / Video</div>'}
                            </div>
                            <div class="mockup-box tall" style="border-color: ${client.colors[0]}15;">
                                ${mockups[2]?.data ? '<img src="' + mockups[2].data + '" alt="Mockup">' : '<div class="mockup-placeholder">Image / Video</div>'}
                            </div>
                        </div>
                        <!-- Bottom 16:9 -->
                        <div class="mockup-row full">
                            <div class="mockup-box wide" style="border-color: ${client.colors[0]}15;">
                                ${mockups[3]?.data ? '<img src="' + mockups[3].data + '" alt="Mockup">' : '<div class="mockup-placeholder">Image / Video</div>'}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PANEL 1: WEBSITE / WEBAPP -->
            <div class="brand-portal-panel" data-panel="1" style="padding: 48px; background: linear-gradient(180deg, transparent 0%, ${client.colors[1] || client.colors[0]}10 100%);">
                <div class="website-preview" style="border-color: ${client.colors[0]}20; position: relative; margin-bottom: 32px;">
                    <img src="${client.websiteScreenshot || logos[0]?.data || ''}" alt="${client.name} Website" style="width: 100%; height: 500px; object-fit: cover; background: #0a0a0a;">
                    ${client.websiteUrl ? '<a href="' + client.websiteUrl + '" target="_blank" style="position: absolute; bottom: 24px; right: 24px; background: ' + client.colors[0] + '; color: #fff; padding: 14px 28px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">Visit Site <span style="font-size: 18px;">â†’</span></a>' : ''}
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                    <p style="color: rgba(255,255,255,0.6); line-height: 1.8; font-size: 16px; flex: 1; min-width: 280px;">A fully responsive, high-converting website designed to capture the essence of ${client.name}. The platform features custom functionality, seamless navigation, and is optimized for both desktop and mobile users.</p>
                    ${client.websiteUrl ? '<a href="' + client.websiteUrl + '" target="_blank" style="background: transparent; border: 1px solid ' + client.colors[0] + '; color: ' + client.colors[0] + '; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 13px; white-space: nowrap;">' + (client.websiteUrl.replace('https://', '').replace('http://', '')) + '</a>' : ''}
                </div>
                <!-- Web Mockups Grid -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 32px;">
                    <div style="aspect-ratio: 4/5; background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                        ${client.webMockups?.[0] ? '<img src="' + client.webMockups[0] + '" alt="Web Mockup" style="width:100%;height:100%;object-fit:cover;">' : '<div style="color: rgba(255,255,255,0.12); font-size: 14px;">Image / Video</div>'}
                    </div>
                    <div style="aspect-ratio: 4/5; background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                        ${client.webMockups?.[1] ? '<img src="' + client.webMockups[1] + '" alt="Web Mockup" style="width:100%;height:100%;object-fit:cover;">' : '<div style="color: rgba(255,255,255,0.12); font-size: 14px;">Image / Video</div>'}
                    </div>
                </div>
            </div>

            <!-- PANEL 2: RESULTS -->
            <div class="brand-portal-panel" data-panel="2" style="padding: 48px; background: linear-gradient(180deg, transparent 0%, ${client.colors[1] || client.colors[0]}10 100%);">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 48px;">
                    <div style="background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; padding: 32px;">
                        <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: ${client.colors[0]}; margin-bottom: 16px; font-weight: 600;">Challenge</div>
                        <p style="color: rgba(255,255,255,0.6); line-height: 1.8; font-size: 15px; margin: 0;">${client.problem || 'The client needed a complete brand transformation to better connect with their target audience and stand out in a competitive market.'}</p>
                    </div>
                    <div style="background: #080808; border: 1px solid rgba(255,255,255,0.06); border-radius: 6px; padding: 32px;">
                        <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: ${client.colors[0]}; margin-bottom: 16px; font-weight: 600;">Solution</div>
                        <p style="color: rgba(255,255,255,0.6); line-height: 1.8; font-size: 15px; margin: 0;">${client.solution || 'We developed a comprehensive brand strategy with modern visual identity, responsive web platform, and targeted digital marketing campaigns.'}</p>
                    </div>
                </div>
                <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: ${client.colors[0]}; margin-bottom: 24px; font-weight: 600;">Results</div>
                <div class="results-grid">
                    <div class="result-card"><div class="result-number">${client.results?.revenue || '+45%'}</div><div class="result-label">Revenue Growth</div></div>
                    <div class="result-card"><div class="result-number">${client.results?.traffic || '+120%'}</div><div class="result-label">Web Traffic</div></div>
                    <div class="result-card"><div class="result-number">${client.results?.engagement || '+85%'}</div><div class="result-label">Engagement</div></div>
                </div>
                ${client.testimonial ? `
                <div style="margin-top: 48px;">
                    <div class="testimonial-box">
                        <p>"${client.testimonial.text || 'Working with NUI transformed our brand completely. The attention to detail and creative vision exceeded our expectations.'}"</p>
                        <div class="testimonial-author">
                            <div class="testimonial-avatar">${(client.testimonial.author || client.name).charAt(0)}</div>
                            <div>
                                <div style="font-weight: 700;">${client.testimonial.author || client.contact || 'Client'}</div>
                                <div style="color: rgba(255,255,255,0.5); font-size: 14px;">${client.testimonial.title || 'Owner'}, ${client.name}</div>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
            </div>

            <!-- PANEL 3: DOWNLOADS -->
            <div class="brand-portal-panel" data-panel="3" style="padding: 48px; background: linear-gradient(180deg, transparent 0%, ${client.colors[1] || client.colors[0]}10 100%);">
                ${!isPaid && brandGuide.status !== 'approved' ? `
                <div style="background: #1a0a0a; border: 1px solid #ef4444; border-radius: 12px; padding: 32px; text-align: center; margin-bottom: 32px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">ðŸ”’</div>
                    <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 8px;">Downloads Locked</h3>
                    <p style="color: #888; margin-bottom: 24px;">Please approve your brand proofs and complete payment to unlock downloads.</p>
                </div>
                ` : ''}
                <div class="brand-section-title">Available Downloads</div>
                <div class="download-grid">
                    ${logos.length > 0 ? '<div class="download-card" style="background: linear-gradient(135deg, ' + client.colors[0] + ', ' + (client.colors[1] || client.colors[0]) + ');"><div><h4>Logo Pack</h4><p>' + logos.length + ' logo file(s)</p></div><button class="download-btn" onclick="downloadAsset(' + client.id + ', \'logos\', 0)" ' + (!isPaid ? 'disabled' : '') + '>Download â†“</button></div>' : ''}
                    ${mockups.length > 0 ? '<div class="download-card" style="background: #2563eb;"><div><h4>Brand Mockups</h4><p>' + mockups.length + ' mockup(s)</p></div><button class="download-btn" onclick="downloadAsset(' + client.id + ', \'mockups\', 0)" ' + (!isPaid ? 'disabled' : '') + '>Download â†“</button></div>' : ''}
                    ${videos.length > 0 ? '<div class="download-card" style="background: #dc2626;"><div><h4>Brand Video</h4><p>' + (videos[0]?.size || '1 video') + '</p></div><button class="download-btn" onclick="downloadAsset(' + client.id + ', \'video\', 0)" ' + (!isPaid ? 'disabled' : '') + '>Download â†“</button></div>' : ''}
                    ${social.length > 0 ? '<div class="download-card" style="background: linear-gradient(135deg, #7c3aed, #a855f7);"><div><h4>Social Templates</h4><p>' + social.length + ' template(s)</p></div><button class="download-btn" onclick="downloadAsset(' + client.id + ', \'social\', 0)" ' + (!isPaid ? 'disabled' : '') + '>Download â†“</button></div>' : ''}
                    ${banners.length > 0 ? '<div class="download-card" style="background: #0891b2;"><div><h4>Banners</h4><p>' + banners.length + ' banner(s)</p></div><button class="download-btn" onclick="downloadAsset(' + client.id + ', \'banner\', 0)" ' + (!isPaid ? 'disabled' : '') + '>Download â†“</button></div>' : ''}
                    <div class="download-card" style="background: linear-gradient(135deg, ${client.colors[0]}, ${client.colors[1] || client.colors[0]});"><div><h4>Color Palette</h4><p>${client.colors.join(' â€¢ ')}</p></div><button class="download-btn" onclick="copyColors('${client.colors.join(',')}')">Copy Colors ðŸ“‹</button></div>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <section style="padding: 48px; background: #000; text-align: center; border-top: 1px solid #222;">
            <div style="font-size: 28px; font-weight: 700; margin-bottom: 12px; color: #fff;">${client.name}</div>
            <p style="color: #666; font-size: 14px;">Brand Guidelines â€¢ ${new Date().getFullYear()}</p>
            <p style="color: #333; font-size: 12px; margin-top: 32px;">Powered by NUI Brand Portal</p>
            <button onclick="backToAdmin()" style="margin-top: 24px; padding: 12px 24px; background: transparent; border: 1px solid #333; color: #fff; cursor: pointer; border-radius: 4px; font-family: inherit;">â† Back</button>
        </section>
    `;
}

// Note: checkClientPaymentStatus is defined later in the file (line ~12356) with more comprehensive checking

// Switch brand portal tabs
function switchBrandPortalTab(panelIndex, tabEl) {
    const tabs = document.querySelectorAll('.brand-portal-tab');
    tabs.forEach(t => t.classList.remove('active'));
    tabEl.classList.add('active');
    const panels = document.querySelectorAll('.brand-portal-panel');
    panels.forEach(p => p.classList.remove('active'));
    panels[panelIndex].classList.add('active');
}

// Show revision modal for proof feedback
function showRevisionModal(clientId) {
    const modal = document.createElement('div');
    modal.style.cssText = 'position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px;';
    modal.innerHTML = `
        <div style="background: #111; border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 32px; max-width: 500px; width: 100%;">
            <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: #fff;">Request Revision</h3>
            <p style="color: #888; margin-bottom: 24px;">Please describe what changes you'd like to see.</p>
            <textarea id="revisionComment" placeholder="Describe the changes needed..." style="width: 100%; min-height: 120px; padding: 16px; background: #0a0a0a; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff; font-family: inherit; font-size: 14px; resize: vertical;"></textarea>
            <div style="display: flex; gap: 12px; margin-top: 24px;">
                <button onclick="this.closest('div[style*=fixed]').remove()" style="flex: 1; padding: 14px; background: transparent; border: 1px solid #333; color: #fff; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: inherit;">Cancel</button>
                <button onclick="submitRevision(${clientId})" style="flex: 1; padding: 14px; background: #ef4444; border: none; color: #fff; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: inherit;">Submit Revision</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

// Submit revision request
function submitRevision(clientId) {
    const comment = document.getElementById('revisionComment').value.trim();
    if (!comment) { alert('Please enter your revision comments'); return; }

    const client = clients.find(c => c.id === clientId);
    if (!client.brandGuide) client.brandGuide = { status: 'draft', proofComments: [] };
    client.brandGuide.status = 'revision_requested';
    client.brandGuide.proofComments.push({ type: 'Revision Requested', comment: comment, date: new Date().toISOString() });
    saveClients();

    document.querySelector('div[style*="fixed"][style*="inset"]').remove();
    alert('Revision request submitted! Our team will review and update your proofs.');
    showClientPortal(client);
}

// Approve client brand proof (for client portal)
function approveClientBrandProof(clientId) {
    const client = clients.find(c => c.id === clientId);
    if (!client.brandGuide) client.brandGuide = { status: 'draft', proofComments: [] };

    const isPaid = checkClientPaymentStatus(clientId);
    client.brandGuide.status = 'approved';
    client.brandGuide.proofComments.push({ type: 'Approved', comment: 'Client approved the brand proofs', date: new Date().toISOString() });
    client.brandGuide.approvedAt = new Date().toISOString();
    saveClients();

    if (isPaid) {
        alert('ðŸŽ‰ Proof Approved! Your brand assets are now available for download.');
        // Simulate sending email notification
        console.log('Email sent to ' + client.email + ' with download links');
    } else {
        alert('Proof Approved! Please complete payment to download your brand assets.');
    }
    showClientPortal(client);
}

function downloadAsset(clientId, category, index) {
    const client = clients.find(c => c.id === clientId);
    const asset = client.assets[category][index];
    if (asset?.data) {
        const link = document.createElement('a');
        link.href = asset.data;
        link.download = asset.name;
        link.click();
        alert('Download started: ' + asset.name);
    } else if (asset?.url) {
        window.open(asset.url, '_blank');
    } else {
        alert('Asset not available for download');
    }
}

function copyColors(colors) {
    navigator.clipboard.writeText(colors);
    alert('Colors copied to clipboard: ' + colors);
}

function backToAdmin() {
    if (currentUser?.type === 'admin') {
        document.getElementById('clientPortal').style.display = 'none';
        document.getElementById('adminDashboard').style.display = 'block';
    } else {
        portalLogout();
    }
}

// ==================== MULTI-STEP SERVICE INTAKE SYSTEM ====================
let intakeData = {};
let currentIntakeStep = 1;
let uploadedFiles = [];

// Service-specific intake configurations
const serviceIntakeConfigs = {
    'brand-starter': {
        name: 'Brand Starter',
        price: 1500,
        steps: ['Business Info', 'Brand Vision', 'Preferences', 'Upload', 'Review'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'industry', type: 'text', label: 'Industry/Niche', required: true },
                { id: 'website', type: 'text', label: 'Current Website (if any)', required: false },
                { id: 'targetAudience', type: 'textarea', label: 'Describe your ideal customer', required: true }
            ],
            2: [
                { id: 'brandPersonality', type: 'radio', label: 'Brand Personality', options: [
                    { value: 'bold', title: 'Bold & Edgy', desc: 'Stand out, be different, make a statement' },
                    { value: 'professional', title: 'Professional & Trust', desc: 'Reliable, established, corporate' },
                    { value: 'playful', title: 'Playful & Fun', desc: 'Energetic, youthful, approachable' },
                    { value: 'luxury', title: 'Luxury & Premium', desc: 'High-end, exclusive, sophisticated' }
                ]},
                { id: 'brandValues', type: 'textarea', label: 'What 3 words describe your brand?', required: true }
            ],
            3: [
                { id: 'colorPrefs', type: 'textarea', label: 'Color preferences (or colors to avoid)', required: false },
                { id: 'competitors', type: 'textarea', label: 'List 2-3 competitors you admire', required: false },
                { id: 'inspiration', type: 'textarea', label: 'Links to brands/designs you love', required: false }
            ],
            4: [
                { id: 'files', type: 'file', label: 'Upload reference images, existing logos, or inspiration', accept: 'image/*,.pdf,.ai,.psd', multiple: true }
            ]
        }
    },
    'brand-identity': {
        name: 'Brand Identity Package',
        price: 3500,
        steps: ['Business Info', 'Brand Story', 'Visual Direction', 'Upload', 'Review'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'tagline', type: 'text', label: 'Tagline (if any)', required: false },
                { id: 'industry', type: 'text', label: 'Industry/Niche', required: true },
                { id: 'yearsInBusiness', type: 'select', label: 'Years in Business', options: ['Startup', '1-2 years', '3-5 years', '5+ years'] }
            ],
            2: [
                { id: 'mission', type: 'textarea', label: 'What is your mission statement?', required: true },
                { id: 'uniqueValue', type: 'textarea', label: 'What makes you different from competitors?', required: true },
                { id: 'brandStory', type: 'textarea', label: 'Tell us your brand story in a few sentences', required: true }
            ],
            3: [
                { id: 'brandPersonality', type: 'radio', label: 'Brand Personality', options: [
                    { value: 'bold', title: 'Bold & Edgy', desc: 'Stand out, be different, make a statement' },
                    { value: 'professional', title: 'Professional & Trust', desc: 'Reliable, established, corporate' },
                    { value: 'playful', title: 'Playful & Fun', desc: 'Energetic, youthful, approachable' },
                    { value: 'luxury', title: 'Luxury & Premium', desc: 'High-end, exclusive, sophisticated' }
                ]},
                { id: 'colorPrefs', type: 'textarea', label: 'Color preferences', required: false },
                { id: 'fontStyle', type: 'radio', label: 'Typography Style', options: [
                    { value: 'modern', title: 'Modern Sans-Serif', desc: 'Clean, minimal, contemporary' },
                    { value: 'classic', title: 'Classic Serif', desc: 'Elegant, traditional, timeless' },
                    { value: 'display', title: 'Display/Creative', desc: 'Unique, artistic, memorable' }
                ]}
            ],
            4: [
                { id: 'files', type: 'file', label: 'Upload existing assets, inspiration, or competitor examples', accept: 'image/*,.pdf,.ai,.psd,.doc,.docx', multiple: true }
            ]
        }
    },
    'website-basic': {
        name: 'Website Design',
        price: 2500,
        steps: ['Project Info', 'Content', 'Design', 'Upload', 'Review'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'websiteGoal', type: 'radio', label: 'Primary Website Goal', options: [
                    { value: 'leads', title: 'Generate Leads', desc: 'Contact forms, inquiries, bookings' },
                    { value: 'sales', title: 'Sell Products', desc: 'E-commerce, online store' },
                    { value: 'info', title: 'Provide Information', desc: 'Portfolio, about, services' },
                    { value: 'booking', title: 'Book Appointments', desc: 'Scheduling, reservations' }
                ]},
                { id: 'currentWebsite', type: 'text', label: 'Current Website URL (if any)', required: false }
            ],
            2: [
                { id: 'pages', type: 'textarea', label: 'List the pages you need (Home, About, Services, Contact, etc.)', required: true },
                { id: 'features', type: 'textarea', label: 'Special features needed (booking system, gallery, blog, etc.)', required: false },
                { id: 'contentReady', type: 'radio', label: 'Do you have website content ready?', options: [
                    { value: 'yes', title: 'Yes, all ready', desc: 'Text, images, and copy prepared' },
                    { value: 'partial', title: 'Partially ready', desc: 'Some content needs work' },
                    { value: 'no', title: 'Need help', desc: 'Will need content creation' }
                ]}
            ],
            3: [
                { id: 'designStyle', type: 'radio', label: 'Design Style', options: [
                    { value: 'minimal', title: 'Minimal & Clean', desc: 'Whitespace, simple, modern' },
                    { value: 'bold', title: 'Bold & Dynamic', desc: 'Strong colors, animations, impact' },
                    { value: 'elegant', title: 'Elegant & Refined', desc: 'Sophisticated, premium feel' },
                    { value: 'creative', title: 'Creative & Unique', desc: 'Artistic, unconventional' }
                ]},
                { id: 'websiteInspiration', type: 'textarea', label: 'Links to websites you like', required: false }
            ],
            4: [
                { id: 'files', type: 'file', label: 'Upload logo, brand assets, content, or reference images', accept: 'image/*,.pdf,.doc,.docx,.txt', multiple: true }
            ]
        }
    },
    'website-pro': {
        name: 'Website Pro',
        price: 5000,
        steps: ['Business Info', 'E-Commerce', 'Design', 'Upload', 'Review'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'industry', type: 'text', label: 'Industry', required: true },
                { id: 'currentWebsite', type: 'text', label: 'Current Website URL', required: false },
                { id: 'monthlyVisitors', type: 'select', label: 'Expected Monthly Visitors', options: ['Under 1,000', '1,000 - 10,000', '10,000 - 50,000', '50,000+'] }
            ],
            2: [
                { id: 'productCount', type: 'select', label: 'Number of Products', options: ['1-10', '11-50', '51-200', '200+'] },
                { id: 'paymentMethods', type: 'textarea', label: 'Payment methods needed (Stripe, PayPal, etc.)', required: true },
                { id: 'shippingNeeds', type: 'textarea', label: 'Shipping requirements', required: false },
                { id: 'integrations', type: 'textarea', label: 'Third-party integrations needed', required: false }
            ],
            3: [
                { id: 'designStyle', type: 'radio', label: 'Design Style', options: [
                    { value: 'minimal', title: 'Minimal & Clean', desc: 'Let products speak for themselves' },
                    { value: 'luxury', title: 'Luxury & Premium', desc: 'High-end shopping experience' },
                    { value: 'energetic', title: 'Bold & Energetic', desc: 'Vibrant, engaging, dynamic' }
                ]},
                { id: 'websiteInspiration', type: 'textarea', label: 'E-commerce sites you admire', required: false }
            ],
            4: [
                { id: 'files', type: 'file', label: 'Upload product images, brand assets, or content', accept: 'image/*,.pdf,.csv,.xlsx', multiple: true }
            ]
        }
    },
    'social-starter': {
        name: 'Social Media Starter',
        price: 800,
        steps: ['Business Info', 'Platforms', 'Style', 'Review'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'industry', type: 'text', label: 'Industry', required: true },
                { id: 'socialHandles', type: 'textarea', label: 'Current social media handles', required: false }
            ],
            2: [
                { id: 'platforms', type: 'textarea', label: 'Which platforms do you need graphics for?', required: true, placeholder: 'Instagram, Facebook, Twitter, LinkedIn, TikTok...' },
                { id: 'contentTypes', type: 'textarea', label: 'Types of posts you need (quotes, promos, announcements, etc.)', required: true }
            ],
            3: [
                { id: 'brandColors', type: 'text', label: 'Brand colors (hex codes if known)', required: false },
                { id: 'style', type: 'radio', label: 'Visual Style', options: [
                    { value: 'minimal', title: 'Clean & Minimal', desc: 'Simple, elegant, professional' },
                    { value: 'bold', title: 'Bold & Eye-catching', desc: 'Vibrant colors, strong typography' },
                    { value: 'playful', title: 'Fun & Playful', desc: 'Illustrations, patterns, energy' }
                ]}
            ]
        }
    },
    'social-pro': {
        name: 'Social Media Pro',
        price: 1500,
        steps: ['Business', 'Strategy', 'Content', 'Upload', 'Review'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'industry', type: 'text', label: 'Industry', required: true },
                { id: 'targetAudience', type: 'textarea', label: 'Describe your target audience', required: true }
            ],
            2: [
                { id: 'goals', type: 'textarea', label: 'What are your social media goals?', required: true },
                { id: 'competitors', type: 'textarea', label: 'Competitors with great social presence', required: false },
                { id: 'postFrequency', type: 'select', label: 'Desired posting frequency', options: ['Daily', '3-4x per week', '2-3x per week', 'Weekly'] }
            ],
            3: [
                { id: 'contentPillars', type: 'textarea', label: 'Main content themes/pillars', required: true },
                { id: 'tone', type: 'radio', label: 'Brand Voice', options: [
                    { value: 'professional', title: 'Professional', desc: 'Authoritative, knowledgeable' },
                    { value: 'friendly', title: 'Friendly & Casual', desc: 'Approachable, conversational' },
                    { value: 'bold', title: 'Bold & Provocative', desc: 'Opinionated, attention-grabbing' }
                ]}
            ],
            4: [
                { id: 'files', type: 'file', label: 'Upload brand assets, product photos, or content ideas', accept: 'image/*,.pdf,.doc', multiple: true }
            ]
        }
    },
    'video-promo': {
        name: 'Promo Video',
        price: 1200,
        steps: ['Project Info', 'Video Details', 'Assets', 'Review'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'videoGoal', type: 'radio', label: 'Video Purpose', options: [
                    { value: 'brand', title: 'Brand Introduction', desc: 'Introduce your company/brand' },
                    { value: 'product', title: 'Product Launch', desc: 'Showcase a product or service' },
                    { value: 'promo', title: 'Promotion/Sale', desc: 'Announce offers or events' },
                    { value: 'social', title: 'Social Media Ad', desc: 'Short-form video for ads' }
                ]}
            ],
            2: [
                { id: 'videoDuration', type: 'select', label: 'Preferred Duration', options: ['15 seconds', '30 seconds', '60 seconds', '90 seconds'] },
                { id: 'keyMessage', type: 'textarea', label: 'Main message to convey', required: true },
                { id: 'callToAction', type: 'text', label: 'Call to action (Visit website, Shop now, etc.)', required: true }
            ],
            3: [
                { id: 'files', type: 'file', label: 'Upload logo, product images, video clips, or music preferences', accept: 'image/*,video/*,audio/*,.pdf', multiple: true }
            ]
        }
    },
    'full-rebrand': {
        name: 'Full Rebrand',
        price: 8000,
        steps: ['Current State', 'Vision', 'Scope', 'Assets', 'Review'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'yearsInBusiness', type: 'select', label: 'Years in Business', options: ['1-2 years', '3-5 years', '5-10 years', '10+ years'] },
                { id: 'rebrandReason', type: 'textarea', label: 'Why are you rebranding?', required: true },
                { id: 'currentWebsite', type: 'text', label: 'Current Website', required: false }
            ],
            2: [
                { id: 'newDirection', type: 'textarea', label: 'Describe your new brand direction', required: true },
                { id: 'targetAudience', type: 'textarea', label: 'Target audience for the new brand', required: true },
                { id: 'brandPersonality', type: 'radio', label: 'New Brand Personality', options: [
                    { value: 'bold', title: 'Bold & Disruptive', desc: 'Stand out, challenge norms' },
                    { value: 'premium', title: 'Premium & Exclusive', desc: 'Luxury, high-end feel' },
                    { value: 'approachable', title: 'Friendly & Approachable', desc: 'Warm, welcoming, trustworthy' },
                    { value: 'innovative', title: 'Innovative & Future-forward', desc: 'Tech-savvy, cutting-edge' }
                ]}
            ],
            3: [
                { id: 'scope', type: 'textarea', label: 'What needs to be rebranded? (logo, website, social, signage, etc.)', required: true },
                { id: 'timeline', type: 'select', label: 'Desired Timeline', options: ['ASAP', '1 month', '2-3 months', 'Flexible'] },
                { id: 'keepElements', type: 'textarea', label: 'Any elements to keep from current brand?', required: false }
            ],
            4: [
                { id: 'files', type: 'file', label: 'Upload current brand assets and inspiration for new direction', accept: 'image/*,.pdf,.ai,.psd,.doc', multiple: true }
            ]
        }
    },
    'custom': {
        name: 'Custom Project',
        price: 0,
        steps: ['Project Info', 'Details', 'Budget', 'Upload', 'Review'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: false }
            ],
            2: [
                { id: 'projectType', type: 'textarea', label: 'Describe your project', required: true },
                { id: 'goals', type: 'textarea', label: 'What do you want to achieve?', required: true },
                { id: 'timeline', type: 'select', label: 'Timeline', options: ['ASAP', '2 weeks', '1 month', '2-3 months', 'Flexible'] }
            ],
            3: [
                { id: 'budget', type: 'radio', label: 'Budget Range', options: [
                    { value: '1000-2500', title: '$1,000 - $2,500', desc: 'Small project scope' },
                    { value: '2500-5000', title: '$2,500 - $5,000', desc: 'Medium project scope' },
                    { value: '5000-10000', title: '$5,000 - $10,000', desc: 'Large project scope' },
                    { value: '10000+', title: '$10,000+', desc: 'Enterprise/Complex project' }
                ]}
            ],
            4: [
                { id: 'files', type: 'file', label: 'Upload any relevant files or references', accept: '*', multiple: true }
            ]
        }
    },
    'brand-kit': {
        name: 'Brand Kit',
        price: 1500,
        steps: ['Contact Info', 'Brand Vision', 'Preferences', 'Review & Pay'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true },
                { id: 'industry', type: 'text', label: 'Industry/Niche', required: true }
            ],
            2: [
                { id: 'brandPersonality', type: 'radio', label: 'Brand Personality', options: [
                    { value: 'bold', title: 'Bold & Edgy', desc: 'Stand out, make a statement' },
                    { value: 'professional', title: 'Professional & Trust', desc: 'Reliable, established' },
                    { value: 'playful', title: 'Playful & Fun', desc: 'Energetic, approachable' },
                    { value: 'luxury', title: 'Luxury & Premium', desc: 'High-end, sophisticated' }
                ]},
                { id: 'brandValues', type: 'textarea', label: 'What 3 words describe your brand?', required: true }
            ],
            3: [
                { id: 'colorPrefs', type: 'textarea', label: 'Color preferences (or colors to avoid)', required: false },
                { id: 'competitors', type: 'textarea', label: 'Brands you admire (for inspiration)', required: false },
                { id: 'timeline', type: 'select', label: 'Desired Timeline', options: ['ASAP', '1 week', '2 weeks', 'Flexible'] }
            ]
        }
    },
    'product-brand': {
        name: 'Product Brand Identity',
        price: 4500,
        steps: ['Contact Info', 'Product Details', 'Brand Direction', 'Deliverables', 'Review & Pay'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'productType', type: 'textarea', label: 'What products do you sell?', required: true },
                { id: 'targetMarket', type: 'textarea', label: 'Who is your target customer?', required: true },
                { id: 'salesChannels', type: 'textarea', label: 'Where do you sell? (online, retail, markets, etc.)', required: true }
            ],
            3: [
                { id: 'brandPersonality', type: 'radio', label: 'Brand Personality', options: [
                    { value: 'bold', title: 'Bold & Edgy', desc: 'Stand out on the shelf' },
                    { value: 'artisan', title: 'Artisan & Handcrafted', desc: 'Authentic, handmade feel' },
                    { value: 'modern', title: 'Modern & Clean', desc: 'Minimalist, contemporary' },
                    { value: 'luxury', title: 'Premium & Luxury', desc: 'High-end, exclusive' }
                ]},
                { id: 'colorPrefs', type: 'textarea', label: 'Color preferences', required: false }
            ],
            4: [
                { id: 'packagingNeeds', type: 'textarea', label: 'What packaging do you need? (labels, boxes, bags, etc.)', required: true },
                { id: 'merchNeeds', type: 'textarea', label: 'Merchandise needs (t-shirts, hats, uniforms, etc.)', required: false },
                { id: 'photoNeeds', type: 'radio', label: 'Do you need product photography?', options: [
                    { value: 'yes', title: 'Yes', desc: 'Include photo session' },
                    { value: 'no', title: 'No', desc: 'I have product photos' }
                ]}
            ]
        }
    },
    'service-brand': {
        name: 'Service Brand Identity',
        price: 3500,
        steps: ['Contact Info', 'Business Details', 'Brand Direction', 'Deliverables', 'Review & Pay'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'serviceType', type: 'textarea', label: 'What services do you provide?', required: true },
                { id: 'targetAudience', type: 'textarea', label: 'Who is your ideal client?', required: true },
                { id: 'serviceArea', type: 'text', label: 'Service area (city, state, or national)', required: true }
            ],
            3: [
                { id: 'brandPersonality', type: 'radio', label: 'Brand Personality', options: [
                    { value: 'professional', title: 'Professional & Trusted', desc: 'Established, reliable' },
                    { value: 'friendly', title: 'Friendly & Approachable', desc: 'Warm, welcoming' },
                    { value: 'premium', title: 'Premium & Exclusive', desc: 'High-end service' },
                    { value: 'bold', title: 'Bold & Confident', desc: 'Stand out from competitors' }
                ]},
                { id: 'colorPrefs', type: 'textarea', label: 'Color preferences', required: false }
            ],
            4: [
                { id: 'vehicleNeeds', type: 'radio', label: 'Do you need vehicle graphics?', options: [
                    { value: 'yes', title: 'Yes', desc: 'Car magnets or wraps' },
                    { value: 'no', title: 'No', desc: 'Not needed' }
                ]},
                { id: 'uniformNeeds', type: 'radio', label: 'Do you need uniforms designed?', options: [
                    { value: 'yes', title: 'Yes', desc: 'Polos, shirts, hats' },
                    { value: 'no', title: 'No', desc: 'Not needed' }
                ]},
                { id: 'additionalNeeds', type: 'textarea', label: 'Any other specific needs?', required: false }
            ]
        }
    },
    'landing-page': {
        name: 'Landing Page',
        price: 800,
        steps: ['Contact Info', 'Page Details', 'Design', 'Review & Pay'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'pageGoal', type: 'radio', label: 'Page Goal', options: [
                    { value: 'leads', title: 'Capture Leads', desc: 'Email signups, contact forms' },
                    { value: 'sales', title: 'Sell Product/Service', desc: 'Direct sales page' },
                    { value: 'event', title: 'Event Registration', desc: 'Webinar, workshop, etc.' },
                    { value: 'launch', title: 'Coming Soon', desc: 'Pre-launch page' }
                ]},
                { id: 'headline', type: 'text', label: 'Main headline or offer', required: true },
                { id: 'callToAction', type: 'text', label: 'Call to action (Sign Up, Buy Now, etc.)', required: true }
            ],
            3: [
                { id: 'designStyle', type: 'radio', label: 'Design Style', options: [
                    { value: 'minimal', title: 'Clean & Minimal', desc: 'Simple, focused' },
                    { value: 'bold', title: 'Bold & High-energy', desc: 'Vibrant, attention-grabbing' },
                    { value: 'elegant', title: 'Elegant & Premium', desc: 'Sophisticated look' }
                ]},
                { id: 'inspiration', type: 'textarea', label: 'Links to landing pages you like', required: false }
            ]
        }
    },
    'business-website': {
        name: 'Business Website',
        price: 2500,
        steps: ['Contact Info', 'Website Goals', 'Pages & Features', 'Design', 'Review & Pay'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true },
                { id: 'currentWebsite', type: 'text', label: 'Current Website (if any)', required: false }
            ],
            2: [
                { id: 'websiteGoal', type: 'radio', label: 'Primary Goal', options: [
                    { value: 'leads', title: 'Generate Leads', desc: 'Contact forms, inquiries' },
                    { value: 'info', title: 'Showcase Services', desc: 'Portfolio, about, services' },
                    { value: 'booking', title: 'Book Appointments', desc: 'Scheduling system' },
                    { value: 'brand', title: 'Build Brand Presence', desc: 'Establish credibility' }
                ]},
                { id: 'targetAudience', type: 'textarea', label: 'Who are your website visitors?', required: true }
            ],
            3: [
                { id: 'pages', type: 'textarea', label: 'Pages needed (Home, About, Services, Contact, etc.)', required: true },
                { id: 'features', type: 'textarea', label: 'Special features (booking, gallery, blog, etc.)', required: false },
                { id: 'contentReady', type: 'radio', label: 'Do you have content ready?', options: [
                    { value: 'yes', title: 'Yes', desc: 'Text and images ready' },
                    { value: 'partial', title: 'Partially', desc: 'Some content needs work' },
                    { value: 'no', title: 'Need Help', desc: 'Will need content creation' }
                ]}
            ],
            4: [
                { id: 'designStyle', type: 'radio', label: 'Design Style', options: [
                    { value: 'minimal', title: 'Minimal & Clean', desc: 'Whitespace, simple' },
                    { value: 'bold', title: 'Bold & Dynamic', desc: 'Strong colors, impact' },
                    { value: 'elegant', title: 'Elegant & Refined', desc: 'Sophisticated, premium' }
                ]},
                { id: 'inspiration', type: 'textarea', label: 'Websites you like', required: false }
            ]
        }
    },
    'ecommerce': {
        name: 'E-Commerce Store',
        price: 4000,
        steps: ['Contact Info', 'Store Details', 'Products', 'Features', 'Review & Pay'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business/Store Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'platform', type: 'radio', label: 'Preferred Platform', options: [
                    { value: 'shopify', title: 'Shopify', desc: 'Best for most businesses' },
                    { value: 'woocommerce', title: 'WooCommerce', desc: 'WordPress-based' },
                    { value: 'unsure', title: 'Not Sure', desc: 'Help me decide' }
                ]},
                { id: 'productTypes', type: 'textarea', label: 'What products will you sell?', required: true }
            ],
            3: [
                { id: 'productCount', type: 'select', label: 'Number of Products', options: ['1-10', '11-25', '26-50', '50+'] },
                { id: 'hasProducts', type: 'radio', label: 'Do you have product photos?', options: [
                    { value: 'yes', title: 'Yes', desc: 'Ready to upload' },
                    { value: 'no', title: 'No', desc: 'Need photography' }
                ]}
            ],
            4: [
                { id: 'paymentMethods', type: 'textarea', label: 'Payment methods needed', required: true, placeholder: 'Stripe, PayPal, etc.' },
                { id: 'shippingNeeds', type: 'textarea', label: 'Shipping requirements', required: false },
                { id: 'additionalFeatures', type: 'textarea', label: 'Additional features needed', required: false }
            ]
        }
    },
    'webapp': {
        name: 'Custom Web Application',
        price: 0,
        steps: ['Contact Info', 'Project Overview', 'Features', 'Budget & Timeline', 'Review'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'appType', type: 'radio', label: 'What type of web app?', options: [
                    { value: 'portal', title: 'Client Portal', desc: 'Secure login for clients' },
                    { value: 'booking', title: 'Booking System', desc: 'Appointments & scheduling' },
                    { value: 'dashboard', title: 'Dashboard/CRM', desc: 'Data management' },
                    { value: 'other', title: 'Other', desc: 'Custom application' }
                ]},
                { id: 'appDescription', type: 'textarea', label: 'Describe what you want the app to do', required: true }
            ],
            3: [
                { id: 'userTypes', type: 'textarea', label: 'Who will use this app?', required: true },
                { id: 'keyFeatures', type: 'textarea', label: 'List the key features needed', required: true },
                { id: 'integrations', type: 'textarea', label: 'Third-party integrations needed', required: false }
            ],
            4: [
                { id: 'budget', type: 'radio', label: 'Budget Range', options: [
                    { value: '5000-10000', title: '$5,000 - $10,000', desc: 'Simple web app' },
                    { value: '10000-25000', title: '$10,000 - $25,000', desc: 'Medium complexity' },
                    { value: '25000+', title: '$25,000+', desc: 'Complex application' }
                ]},
                { id: 'timeline', type: 'select', label: 'Desired Timeline', options: ['1-2 months', '2-3 months', '3-6 months', 'Flexible'] }
            ]
        }
    },
    'mvp-app': {
        name: 'MVP Mobile App',
        price: 8000,
        steps: ['Contact Info', 'App Concept', 'Features', 'Design', 'Review & Pay'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business/App Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'appPurpose', type: 'textarea', label: 'What problem does your app solve?', required: true },
                { id: 'targetUsers', type: 'textarea', label: 'Who is your target user?', required: true },
                { id: 'competitors', type: 'textarea', label: 'Similar apps in the market', required: false }
            ],
            3: [
                { id: 'coreFeatures', type: 'textarea', label: 'List 3-5 core features for the MVP', required: true },
                { id: 'platforms', type: 'radio', label: 'Platforms', options: [
                    { value: 'both', title: 'iOS & Android', desc: 'Cross-platform (recommended)' },
                    { value: 'ios', title: 'iOS Only', desc: 'iPhone/iPad' },
                    { value: 'android', title: 'Android Only', desc: 'Android devices' }
                ]}
            ],
            4: [
                { id: 'designStyle', type: 'radio', label: 'Design Style', options: [
                    { value: 'minimal', title: 'Clean & Minimal', desc: 'Simple, intuitive' },
                    { value: 'bold', title: 'Bold & Modern', desc: 'Eye-catching design' },
                    { value: 'playful', title: 'Fun & Playful', desc: 'Engaging, colorful' }
                ]},
                { id: 'inspiration', type: 'textarea', label: 'Apps you like for inspiration', required: false }
            ]
        }
    },
    'custom-app': {
        name: 'Custom Mobile App',
        price: 0,
        steps: ['Contact Info', 'App Vision', 'Features', 'Budget', 'Review'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business/App Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'appVision', type: 'textarea', label: 'Describe your app vision in detail', required: true },
                { id: 'targetUsers', type: 'textarea', label: 'Target users and use cases', required: true },
                { id: 'businessModel', type: 'textarea', label: 'How will the app make money?', required: false }
            ],
            3: [
                { id: 'allFeatures', type: 'textarea', label: 'List all features needed', required: true },
                { id: 'integrations', type: 'textarea', label: 'Third-party integrations', required: false },
                { id: 'platforms', type: 'radio', label: 'Platforms', options: [
                    { value: 'both', title: 'iOS & Android', desc: 'Maximum reach' },
                    { value: 'ios', title: 'iOS Only', desc: 'iPhone/iPad' },
                    { value: 'android', title: 'Android Only', desc: 'Android devices' }
                ]}
            ],
            4: [
                { id: 'budget', type: 'radio', label: 'Budget Range', options: [
                    { value: '15000-30000', title: '$15,000 - $30,000', desc: 'Standard app' },
                    { value: '30000-50000', title: '$30,000 - $50,000', desc: 'Complex app' },
                    { value: '50000+', title: '$50,000+', desc: 'Enterprise solution' }
                ]},
                { id: 'timeline', type: 'select', label: 'Timeline', options: ['2-3 months', '3-6 months', '6+ months', 'Flexible'] }
            ]
        }
    },
    'lead-funnel': {
        name: 'Lead Capture Funnel',
        price: 1200,
        steps: ['Contact Info', 'Funnel Goals', 'Lead Magnet', 'Review & Pay'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'targetAudience', type: 'textarea', label: 'Who are you trying to attract?', required: true },
                { id: 'offer', type: 'textarea', label: 'What do you ultimately want to sell them?', required: true }
            ],
            3: [
                { id: 'leadMagnet', type: 'radio', label: 'Lead Magnet Type', options: [
                    { value: 'ebook', title: 'eBook/Guide', desc: 'PDF download' },
                    { value: 'checklist', title: 'Checklist/Template', desc: 'Quick-win resource' },
                    { value: 'video', title: 'Video Training', desc: 'Video content' },
                    { value: 'discount', title: 'Discount/Coupon', desc: 'Special offer' }
                ]},
                { id: 'leadMagnetTopic', type: 'text', label: 'Lead magnet topic/title', required: true }
            ]
        }
    },
    'sales-funnel': {
        name: 'Full Sales Funnel',
        price: 2500,
        steps: ['Contact Info', 'Offer Details', 'Funnel Structure', 'Review & Pay'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'mainOffer', type: 'textarea', label: 'What is your main offer/product?', required: true },
                { id: 'pricePoint', type: 'text', label: 'Price point', required: true },
                { id: 'targetAudience', type: 'textarea', label: 'Target audience', required: true }
            ],
            3: [
                { id: 'funnelType', type: 'radio', label: 'Funnel Type', options: [
                    { value: 'tripwire', title: 'Tripwire Funnel', desc: 'Low-ticket to high-ticket' },
                    { value: 'webinar', title: 'Webinar Funnel', desc: 'Educate then sell' },
                    { value: 'vsl', title: 'VSL Funnel', desc: 'Video sales letter' },
                    { value: 'product', title: 'Product Launch', desc: 'Launch sequence' }
                ]},
                { id: 'upsells', type: 'textarea', label: 'Upsell/downsell offers (if any)', required: false }
            ]
        }
    },
    'webinar-funnel': {
        name: 'Webinar Funnel',
        price: 3000,
        steps: ['Contact Info', 'Webinar Details', 'Offer', 'Review & Pay'],
        fields: {
            1: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'webinarTopic', type: 'text', label: 'Webinar Topic/Title', required: true },
                { id: 'webinarType', type: 'radio', label: 'Webinar Type', options: [
                    { value: 'live', title: 'Live Webinar', desc: 'Real-time presentation' },
                    { value: 'evergreen', title: 'Evergreen/Automated', desc: 'Pre-recorded, runs automatically' }
                ]},
                { id: 'targetAudience', type: 'textarea', label: 'Who is this webinar for?', required: true }
            ],
            3: [
                { id: 'offer', type: 'textarea', label: 'What will you sell at the end?', required: true },
                { id: 'offerPrice', type: 'text', label: 'Offer price point', required: true },
                { id: 'bonuses', type: 'textarea', label: 'Bonuses to include', required: false }
            ]
        }
    },
    'consultation': {
        name: 'Free Strategy Call',
        price: 0,
        steps: ['Contact Info', 'Business Info', 'Goals', 'Schedule'],
        fields: {
            1: [
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'industry', type: 'text', label: 'Industry', required: true },
                { id: 'website', type: 'text', label: 'Current Website (if any)', required: false }
            ],
            3: [
                { id: 'goals', type: 'textarea', label: 'What do you want to achieve?', required: true },
                { id: 'budget', type: 'radio', label: 'Estimated Budget', options: [
                    { value: '1000-3000', title: '$1,000 - $3,000', desc: '' },
                    { value: '3000-5000', title: '$3,000 - $5,000', desc: '' },
                    { value: '5000-10000', title: '$5,000 - $10,000', desc: '' },
                    { value: '10000+', title: '$10,000+', desc: '' }
                ]},
                { id: 'timeline', type: 'select', label: 'When do you want to start?', options: ['Immediately', 'Within 2 weeks', 'Within 1 month', 'Just exploring'] }
            ]
        }
    },
    'custom-package': {
        name: 'Custom Package',
        price: 0,
        steps: ['Contact Info', 'Business Details', 'Confirm Services', 'Review & Pay'],
        fields: {
            1: [
                { id: 'contactName', type: 'text', label: 'Your Name', required: true },
                { id: 'email', type: 'email', label: 'Email', required: true },
                { id: 'phone', type: 'tel', label: 'Phone', required: true }
            ],
            2: [
                { id: 'businessName', type: 'text', label: 'Business Name', required: true },
                { id: 'industry', type: 'text', label: 'Industry', required: true },
                { id: 'website', type: 'text', label: 'Current Website (if any)', required: false },
                { id: 'additionalNotes', type: 'textarea', label: 'Anything else we should know?', required: false }
            ],
            3: [
                { id: 'servicesConfirm', type: 'custom-services-display', label: 'Your Selected Services' },
                { id: 'timeline', type: 'select', label: 'Desired Timeline', options: ['ASAP', '2-4 weeks', '1-2 months', 'Flexible'] }
            ]
        }
    }
};

// Form submissions storage
let formSubmissions = JSON.parse(localStorage.getItem('nui_submissions')) || [];
function saveSubmissions() { localStorage.setItem('nui_submissions', JSON.stringify(formSubmissions)); }

function startServiceIntake(serviceId) {
    const config = serviceIntakeConfigs[serviceId];
    if (!config) { alert('Service not found'); return; }

    // For custom package, get price from localStorage
    let price = config.price;
    let customServices = [];
    if (serviceId === 'custom-package') {
        price = parseInt(localStorage.getItem('customPackageTotal') || 0);
        customServices = JSON.parse(localStorage.getItem('customPackageServices') || '[]');
    }

    intakeData = { serviceId, serviceName: config.name, price: price, customServices: customServices };
    currentIntakeStep = 1;
    uploadedFiles = [];

    showView('intake');
    renderIntakeWizard(serviceId);
}

function renderIntakeWizard(serviceId) {
    const config = serviceIntakeConfigs[serviceId];
    const totalSteps = config.steps.length;
    const progressPercent = ((currentIntakeStep - 1) / (totalSteps - 1)) * 100;

    let stepsHtml = config.steps.map((step, i) => {
        const stepNum = i + 1;
        let className = 'wizard-step';
        if (stepNum < currentIntakeStep) className += ' completed';
        if (stepNum === currentIntakeStep) className += ' active';
        return `<div class="${className}"><div class="wizard-step-number">${stepNum < currentIntakeStep ? 'âœ“' : stepNum}</div><div class="wizard-step-label">${step}</div></div>`;
    }).join('');

    let panelsHtml = '';
    for (let step = 1; step <= totalSteps; step++) {
        const isReview = step === totalSteps;
        const fields = config.fields[step] || [];

        panelsHtml += `<div class="wizard-panel ${step === currentIntakeStep ? 'active' : ''}" data-step="${step}">`;

        if (isReview) {
            panelsHtml += renderReviewStep(serviceId);
        } else {
            panelsHtml += `<h2 class="wizard-title">${config.steps[step-1]}</h2>`;
            panelsHtml += `<p class="wizard-subtitle">Step ${step} of ${totalSteps}</p>`;
            fields.forEach(field => {
                panelsHtml += renderIntakeField(field);
            });
        }

        panelsHtml += `<div class="wizard-buttons">`;
        if (step > 1) panelsHtml += `<button class="wizard-btn wizard-btn-back" onclick="prevIntakeStep()">â† Back</button>`;
        if (isReview) {
            panelsHtml += `<button class="wizard-btn wizard-btn-submit" onclick="submitIntake()">Submit & Continue to Payment â†’</button>`;
        } else {
            panelsHtml += `<button class="wizard-btn wizard-btn-next" onclick="nextIntakeStep()">Continue â†’</button>`;
        }
        panelsHtml += `</div></div>`;
    }

    const displayPrice = intakeData.price || config.price;

    // Hormozi-style sales copy based on service type
    const salesCopy = {
        'brand-kit': {
            hook: "Stop losing customers to competitors with better branding.",
            problem: "Right now, potential customers are scrolling past your business because your brand looks DIY. They're choosing competitors who look more established â€” even if your product is better.",
            agitate: "Every day without professional branding costs you sales. People judge in 0.05 seconds. A weak brand = weak trust = lost revenue.",
            solution: "Get a complete brand identity that makes you look like the premium choice. Logo, colors, voice, social presence â€” everything you need to command higher prices and close more deals.",
            proof: "50+ Detroit businesses transformed. Average client sees 3x more engagement within 30 days."
        },
        'product-brand': {
            hook: "Your product deserves packaging that sells itself.",
            problem: "Great products fail every day because they look like every other option on the shelf. Customers can't tell you're different if you look the same.",
            agitate: "You're spending money on ads to drive people to products with forgettable packaging. That's like paying for a first date and showing up in pajamas.",
            solution: "Get packaging and branding that stops the scroll, wins the shelf, and turns browsers into buyers. From labels to social content â€” we build brands that print money.",
            proof: "Our product brands average 340% increase in online sales within 90 days."
        },
        'service-brand': {
            hook: "Charge more. Win more. Look like the obvious choice.",
            problem: "You're competing on price because your brand doesn't communicate value. Prospects are haggling with you while paying premium prices to competitors with better presentation.",
            agitate: "Every proposal you send with a generic logo and mismatched colors screams 'small operation.' And small operations get small budgets.",
            solution: "Get the brand presence that commands premium pricing. Vehicle wraps, uniforms, professional collateral â€” look like the company that charges 2x more (then charge 2x more).",
            proof: "Service businesses we brand report 40% higher close rates on proposals."
        },
        'business-website': {
            hook: "Your website is either making you money or costing you money.",
            problem: "Your current site is a digital brochure that does nothing. Visitors come, see nothing compelling, and leave. No calls. No sales. Just a monthly hosting bill.",
            agitate: "You're paying for ads that send traffic to a website that doesn't convert. That's literally paying to lose customers.",
            solution: "Get a website built to convert visitors into customers 24/7. Strategic design, compelling copy, clear calls-to-action â€” every element engineered to generate leads while you sleep.",
            proof: "Average client sees 280% increase in website inquiries within 60 days."
        },
        'landing-page': {
            hook: "One page. One goal. Maximum conversions.",
            problem: "You're sending traffic to pages that confuse visitors. Too many options. No clear path. They leave without taking action.",
            agitate: "Every click you pay for that doesn't convert is money burned. Bad landing pages are the most expensive mistake in marketing.",
            solution: "Get a landing page engineered for one thing: conversions. Clear headline, compelling offer, irresistible call-to-action. Built to turn visitors into leads.",
            proof: "Our landing pages average 3-5x higher conversion rates than industry standard."
        },
        'ecommerce': {
            hook: "Stop losing sales to a clunky checkout process.",
            problem: "Your store looks like it was built in 2015. Customers add to cart then abandon because the experience feels sketchy.",
            agitate: "69% of carts get abandoned. Every friction point in your store is money walking out the door.",
            solution: "Get a store built for conversions. Fast load times, trust signals, seamless checkout â€” every element optimized to turn browsers into buyers.",
            proof: "E-commerce clients see average 40% reduction in cart abandonment within 30 days."
        },
        'lead-funnel': {
            hook: "Build a lead machine that works while you sleep.",
            problem: "You're chasing leads instead of attracting them. Cold calling, networking, hoping someone finds you. That's exhausting and unscalable.",
            agitate: "Your competitors have automated systems generating leads 24/7. You're still trading time for maybe-customers.",
            solution: "Get a lead funnel that captures, nurtures, and qualifies prospects automatically. Wake up to warm leads ready to buy.",
            proof: "Average funnel generates 50+ qualified leads per month on autopilot."
        },
        'sales-funnel': {
            hook: "Turn strangers into customers while you sleep.",
            problem: "You have a great offer but no system to sell it. Every sale requires your time, energy, and manual follow-up.",
            agitate: "You're the bottleneck in your own business. Can't scale what requires your presence to close.",
            solution: "Get a sales funnel that educates, builds trust, and closes deals automatically. A 24/7 salesperson that never takes a day off.",
            proof: "Our sales funnels average $50K+ in automated revenue per client annually."
        },
        'custom-package': {
            hook: "Get exactly what you need. Nothing you don't.",
            problem: "Cookie-cutter packages either give you too much or not enough. You're paying for services you don't need or missing critical pieces.",
            agitate: "One-size-fits-all doesn't fit anyone well. Your business is unique â€” your solution should be too.",
            solution: "Build a custom package with only the services that move your needle. Every dollar invested in exactly what you need.",
            proof: "Custom packages deliver 2x more value because every element is intentional."
        },
        'consultation': {
            hook: "15 minutes that could change your business.",
            problem: "You know something needs to change but you're not sure what. DIY hasn't worked. Generic advice doesn't apply.",
            agitate: "Every month you stay stuck is revenue left on the table. Your competitors aren't waiting.",
            solution: "Get a free strategy call with someone who's helped 50+ businesses break through. No pitch, just clarity on your next best move.",
            proof: "90% of strategy calls end with a clear action plan â€” whether you work with us or not."
        },
        'default': {
            hook: "Ready to stop blending in and start standing out?",
            problem: "Most businesses look exactly like their competitors. Same boring templates. Same forgettable presence. Same struggle to get noticed.",
            agitate: "In a world of infinite scroll, invisible = irrelevant. Every day your brand doesn't demand attention is a day your competitors are winning.",
            solution: "Get bold, strategic design that captures attention and converts it into revenue. We don't make things pretty â€” we make things profitable.",
            proof: "50+ brands elevated. $2M+ in client revenue generated. 100% Detroit-made."
        }
    };

    const copy = salesCopy[serviceId] || salesCopy['default'];

    document.getElementById('intakeView').innerHTML = `
        <div class="intake-view">
            <div class="intake-service-header">
                <div class="intake-service-badge">Service Intake</div>
                <div class="intake-service-name">${config.name}</div>
                <div class="intake-service-price">${displayPrice > 0 ? '$' + displayPrice.toLocaleString() : 'Custom Quote'}</div>
            </div>

            <!-- HORMOZI-STYLE SALES SECTION -->
            <div style="max-width: 700px; margin: 0 auto 40px; padding: 0 20px;">
                <div style="background: linear-gradient(135deg, rgba(255,59,48,0.1) 0%, rgba(0,0,0,0.3) 100%); border: 1px solid rgba(255,59,48,0.2); border-radius: 16px; padding: 32px; margin-bottom: 24px;">
                    <h2 style="font-size: 24px; font-weight: 900; margin-bottom: 16px; line-height: 1.3;">${copy.hook}</h2>
                    <p style="color: rgba(255,255,255,0.7); font-size: 15px; line-height: 1.7; margin-bottom: 16px;">${copy.problem}</p>
                    <p style="color: rgba(255,255,255,0.9); font-size: 15px; line-height: 1.7; margin-bottom: 16px; font-weight: 500;">${copy.agitate}</p>
                    <p style="color: #fff; font-size: 15px; line-height: 1.7; margin-bottom: 20px;"><strong style="color: var(--red);">The Solution:</strong> ${copy.solution}</p>
                    <div style="display: flex; align-items: center; gap: 12px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <span style="font-size: 24px;">ðŸ“ˆ</span>
                        <p style="color: var(--red); font-size: 14px; font-weight: 600; margin: 0;">${copy.proof}</p>
                    </div>
                </div>

                <!-- TRUST BADGES -->
                <div style="display: flex; justify-content: center; gap: 24px; flex-wrap: wrap; margin-bottom: 24px;">
                    <div style="display: flex; align-items: center; gap: 8px; color: rgba(255,255,255,0.6); font-size: 13px;">
                        <span style="color: var(--red);">âœ“</span> 24-48hr Response
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; color: rgba(255,255,255,0.6); font-size: 13px;">
                        <span style="color: var(--red);">âœ“</span> Satisfaction Guaranteed
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; color: rgba(255,255,255,0.6); font-size: 13px;">
                        <span style="color: var(--red);">âœ“</span> Detroit-Based Team
                    </div>
                </div>

                <p style="text-align: center; color: rgba(255,255,255,0.5); font-size: 13px;">Complete this quick form and we'll get back to you within 24 hours with next steps.</p>
            </div>

            <div class="intake-wizard">
                <div class="wizard-progress">
                    <div class="wizard-progress-fill" style="width: ${progressPercent}%"></div>
                    ${stepsHtml}
                </div>
                <div class="wizard-content">
                    ${panelsHtml}
                </div>
            </div>

            <!-- BOTTOM CLOSER -->
            <div style="max-width: 600px; margin: 40px auto 0; padding: 24px; text-align: center; border-top: 1px solid rgba(255,255,255,0.06);">
                <p style="color: rgba(255,255,255,0.5); font-size: 13px; margin-bottom: 8px;">Still have questions?</p>
                <p style="color: rgba(255,255,255,0.8); font-size: 14px;">Call or text: <a href="tel:3135551234" style="color: var(--red); text-decoration: none; font-weight: 600;">(313) 555-1234</a></p>
            </div>
        </div>
    `;

    // Restore saved data
    Object.keys(intakeData).forEach(key => {
        const input = document.getElementById(key);
        if (input && intakeData[key]) {
            if (input.type === 'radio') {
                document.querySelector(`input[name="${key}"][value="${intakeData[key]}"]`)?.click();
            } else {
                input.value = intakeData[key];
            }
        }
    });
}

function renderIntakeField(field) {
    let html = `<div class="wizard-field">`;
    html += `<label class="wizard-label">${field.label}${field.required ? ' *' : ''}</label>`;

    switch(field.type) {
        case 'text':
        case 'email':
        case 'tel':
            html += `<input type="${field.type}" id="${field.id}" class="wizard-input" ${field.required ? 'required' : ''} onchange="saveIntakeField('${field.id}', this.value)">`;
            break;
        case 'textarea':
            html += `<textarea id="${field.id}" class="wizard-textarea" ${field.required ? 'required' : ''} placeholder="${field.placeholder || ''}" onchange="saveIntakeField('${field.id}', this.value)"></textarea>`;
            break;
        case 'select':
            html += `<select id="${field.id}" class="wizard-select" onchange="saveIntakeField('${field.id}', this.value)">
                <option value="">Select...</option>
                ${field.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
            </select>`;
            break;
        case 'radio':
            html += `<div class="wizard-radio-group">`;
            field.options.forEach(opt => {
                html += `<label class="wizard-radio" onclick="selectRadio(this, '${field.id}', '${opt.value}')">
                    <input type="radio" name="${field.id}" value="${opt.value}">
                    <div class="wizard-radio-check"></div>
                    <div class="wizard-radio-content">
                        <h4>${opt.title}</h4>
                        <p>${opt.desc}</p>
                    </div>
                </label>`;
            });
            html += `</div>`;
            break;
        case 'file':
            html += `<div class="file-upload-zone" onclick="document.getElementById('${field.id}').click()" ondragover="event.preventDefault(); this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')" ondrop="handleFileDrop(event, '${field.id}')">
                <div class="file-upload-icon">ðŸ“</div>
                <div class="file-upload-text">Click to upload or drag & drop</div>
                <div class="file-upload-hint">Supports: ${field.accept}</div>
                <input type="file" id="${field.id}" class="file-upload-input" ${field.multiple ? 'multiple' : ''} accept="${field.accept}" onchange="handleFileSelect(this)">
            </div>
            <div class="uploaded-files" id="${field.id}-list"></div>`;
            break;
        case 'custom-services-display':
            const savedServices = JSON.parse(localStorage.getItem('customPackageServices') || '[]');
            const savedTotal = localStorage.getItem('customPackageTotal') || 0;
            html += `<div class="custom-services-review" style="background: #0a0a0a; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 24px;">
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
                    ${savedServices.map(s => `<span style="background: rgba(255,59,48,0.15); border: 1px solid rgba(255,59,48,0.3); color: #fff; font-size: 12px; padding: 8px 14px; border-radius: 6px; font-weight: 600;">${s}</span>`).join('')}
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.06);">
                    <span style="color: var(--gray); font-size: 14px;">${savedServices.length} services selected</span>
                    <span style="font-size: 28px; font-weight: 900; color: var(--red);">$${parseInt(savedTotal).toLocaleString()}</span>
                </div>
            </div>`;
            break;
    }

    html += `</div>`;
    return html;
}

function selectRadio(el, fieldId, value) {
    document.querySelectorAll(`[name="${fieldId}"]`).forEach(r => r.closest('.wizard-radio').classList.remove('selected'));
    el.classList.add('selected');
    el.querySelector('input').checked = true;
    saveIntakeField(fieldId, value);
}

function saveIntakeField(fieldId, value) {
    intakeData[fieldId] = value;
}

function handleFileSelect(input) {
    Array.from(input.files).forEach(file => {
        uploadedFiles.push(file);
        renderUploadedFiles(input.id);
    });
}

function handleFileDrop(event, inputId) {
    event.preventDefault();
    event.target.classList.remove('dragover');
    Array.from(event.dataTransfer.files).forEach(file => {
        uploadedFiles.push(file);
    });
    renderUploadedFiles(inputId);
}

function renderUploadedFiles(inputId) {
    const container = document.getElementById(inputId + '-list');
    if (!container) return;
    container.innerHTML = uploadedFiles.map((file, i) =>
        `<div class="uploaded-file"><span>${file.name}</span><span class="uploaded-file-remove" onclick="removeFile(${i}, '${inputId}')">Ã—</span></div>`
    ).join('');
}

function removeFile(index, inputId) {
    uploadedFiles.splice(index, 1);
    renderUploadedFiles(inputId);
}

function nextIntakeStep() {
    const config = serviceIntakeConfigs[intakeData.serviceId];
    if (currentIntakeStep < config.steps.length) {
        currentIntakeStep++;
        renderIntakeWizard(intakeData.serviceId);
    }
}

function prevIntakeStep() {
    if (currentIntakeStep > 1) {
        currentIntakeStep--;
        renderIntakeWizard(intakeData.serviceId);
    }
}

function renderReviewStep(serviceId) {
    const config = serviceIntakeConfigs[serviceId];
    const displayPrice = intakeData.price || config.price;

    // Service descriptions for each package
    const serviceDescriptions = {
        'brand-kit': {
            title: 'Brand Kit Package',
            description: 'Complete brand identity foundation including logo design, brand voice guidelines, target market identifier, social media banners, and logo-in-action images.',
            deliverables: ['Logo (multiple formats)', 'Brand Voice Document', 'Target Market Profile', 'Social Media Banners', 'Logo In Action Images'],
            timeline: '7-10 business days'
        },
        'product-brand': {
            title: 'Product Brand Identity',
            description: 'Premium branding for physical products including packaging design, product photography direction, label design, and complete visual identity system.',
            deliverables: ['Full Brand Kit', 'Packaging Design', 'Product Label Design', 'Photography Guidelines', 'Marketing Collateral'],
            timeline: '14-21 business days'
        },
        'service-brand': {
            title: 'Service Brand Identity',
            description: 'Professional brand identity for service-based businesses including digital presence optimization, proposal templates, and client-facing materials.',
            deliverables: ['Full Brand Kit', 'Business Card Design', 'Proposal Templates', 'Email Signature', 'Social Media Kit'],
            timeline: '10-14 business days'
        },
        'landing-page': {
            title: 'Landing Page Website',
            description: 'High-converting single-page website optimized for lead generation with mobile responsiveness and basic SEO setup.',
            deliverables: ['Custom Landing Page', 'Mobile Optimization', 'Contact Form', 'Basic SEO', 'Analytics Setup'],
            timeline: '5-7 business days'
        },
        'business-website': {
            title: 'Business Website',
            description: 'Professional multi-page website with up to 5 pages, CMS integration, and full SEO optimization for established businesses.',
            deliverables: ['5-Page Website', 'CMS Dashboard', 'SEO Optimization', 'Contact Forms', 'Blog Setup'],
            timeline: '14-21 business days'
        },
        'ecommerce': {
            title: 'E-Commerce Website',
            description: 'Full-featured online store with product management, secure payments, inventory tracking, and marketing integrations.',
            deliverables: ['Online Store', 'Payment Gateway', 'Product Management', 'Order Tracking', 'Marketing Tools'],
            timeline: '21-30 business days'
        },
        'lead-funnel': {
            title: 'Lead Generation Funnel',
            description: 'Strategic sales funnel designed to capture and nurture leads with automated email sequences and tracking.',
            deliverables: ['Landing Page', 'Lead Magnet', 'Email Sequence (5)', 'Thank You Page', 'Analytics Dashboard'],
            timeline: '7-10 business days'
        },
        'sales-funnel': {
            title: 'Full Sales Funnel',
            description: 'Complete sales system with multiple touchpoints, upsells, downsells, and comprehensive automation for maximum conversions.',
            deliverables: ['Multi-Page Funnel', 'Upsell/Downsell Pages', 'Email Sequence (10+)', 'Payment Integration', 'A/B Testing'],
            timeline: '14-21 business days'
        },
        'custom-package': {
            title: 'Custom Package',
            description: 'Tailored solution built from our service catalog to match your exact business needs and budget.',
            deliverables: intakeData.customServices || ['Custom deliverables based on selection'],
            timeline: 'Varies by scope'
        },
        'consultation': {
            title: 'Free Strategy Call',
            description: 'No-obligation discovery call to discuss your business goals and find the perfect solution for your needs.',
            deliverables: ['30-Minute Call', 'Needs Assessment', 'Custom Recommendations', 'Project Roadmap'],
            timeline: 'Scheduled within 48 hours'
        }
    };

    const serviceInfo = serviceDescriptions[serviceId] || {
        title: config.name,
        description: 'Professional creative services from New Urban Influence.',
        deliverables: ['Custom deliverables'],
        timeline: 'To be determined'
    };

    let html = `<h2 class="wizard-title">Review Your Information</h2>`;
    html += `<p class="wizard-subtitle">Please review before submitting</p>`;

    // SERVICE DESCRIPTION BOX
    html += `<div style="background: linear-gradient(135deg, rgba(255,59,48,0.08) 0%, rgba(0,0,0,0.2) 100%); border: 1px solid rgba(255,59,48,0.15); border-radius: 20px; padding: 28px; margin-bottom: 24px;">`;
    html += `<div style="background: linear-gradient(135deg, var(--red) 0%, #ff6b6b 100%); border-radius: 14px; padding: 18px 24px; margin-bottom: 24px; box-shadow: 0 10px 35px rgba(255,59,48,0.35);">
        <div style="display: flex; align-items: center; gap: 14px;">
            <span style="font-size: 26px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">ðŸŽ¯</span>
            <h3 style="font-size: 24px; font-weight: 900; color: #fff; margin: 0; text-shadow: 0 2px 10px rgba(0,0,0,0.25); letter-spacing: -0.5px;">${serviceInfo.title}</h3>
        </div>
    </div>`;
    html += `<p style="color: rgba(255,255,255,0.7); font-size: 14px; line-height: 1.6; margin-bottom: 20px;">${serviceInfo.description}</p>`;

    // Deliverables list
    html += `<div style="margin-bottom: 16px;">
        <p style="color: rgba(255,255,255,0.5); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;">What You'll Get:</p>
        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
            ${serviceInfo.deliverables.map(d => `<span style="background: rgba(255,255,255,0.1); color: #fff; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; border: 1px solid rgba(255,255,255,0.1);">${d}</span>`).join('')}
        </div>
    </div>`;

    html += `<div style="display: flex; align-items: center; gap: 8px; color: rgba(255,255,255,0.6); font-size: 13px;">
        <span>â±ï¸</span> Expected Timeline: <strong style="color: #fff;">${serviceInfo.timeline}</strong>
    </div>`;
    html += `</div>`;

    // YOUR DETAILS BOX
    html += `<div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 24px; margin-bottom: 24px;">`;
    html += `<p style="color: rgba(255,255,255,0.5); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px;">Your Details</p>`;

    html += `<div style="display: flex; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,0.08);">
        <span style="color: rgba(255,255,255,0.5);">Service</span>
        <span style="font-weight: 600; color: #fff;">${config.name}</span>
    </div>`;

    // Show custom services if this is a custom package
    if (serviceId === 'custom-package' && intakeData.customServices && intakeData.customServices.length > 0) {
        html += `<div style="padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,0.08);">
            <span style="color: rgba(255,255,255,0.5); display: block; margin-bottom: 10px;">Selected Services (${intakeData.customServices.length})</span>
            <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                ${intakeData.customServices.map(s => `<span style="background: rgba(255,255,255,0.1); color: #fff; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500;">${s}</span>`).join('')}
            </div>
        </div>`;
    }

    html += `<div style="display: flex; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,0.08);">
        <span style="color: rgba(255,255,255,0.5);">Investment</span>
        <span style="font-weight: 700; color: var(--red); font-size: 18px;">${displayPrice > 0 ? '$' + displayPrice.toLocaleString() : 'Custom Quote'}</span>
    </div>`;

    Object.keys(intakeData).forEach(key => {
        if (key !== 'serviceId' && key !== 'serviceName' && key !== 'price' && key !== 'customServices' && intakeData[key]) {
            const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
            let value = intakeData[key];
            if (Array.isArray(value)) return; // Skip arrays (shown separately)
            html += `<div style="display: flex; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,0.08);">
                <span style="color: rgba(255,255,255,0.5);">${label}</span>
                <span style="font-weight: 500; color: #fff; max-width: 60%; text-align: right;">${value}</span>
            </div>`;
        }
    });

    if (uploadedFiles.length > 0) {
        html += `<div style="padding: 14px 0;">
            <span style="color: rgba(255,255,255,0.5);">Files Attached</span>
            <div style="margin-top: 10px;">${uploadedFiles.map(f => `<span style="display: inline-block; background: rgba(255,255,255,0.1); color: #fff; padding: 6px 14px; border-radius: 6px; margin: 4px; font-size: 13px;">ðŸ“Ž ${f.name}</span>`).join('')}</div>
        </div>`;
    }

    html += `</div>`;

    // WHAT HAPPENS NEXT BOX - Different messaging based on service type
    if (serviceId === 'consultation') {
        html += `<div style="background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.3); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
            <strong style="color: var(--green); display: flex; align-items: center; gap: 8px;"><span>âœ¨</span> What happens next?</strong>
            <p style="color: rgba(255,255,255,0.7); margin-top: 10px; font-size: 14px; line-height: 1.6;">After submitting, you'll receive an email with a link to schedule your free strategy call. We'll discuss your project and find the perfect solution for your business.</p>
        </div>`;
    } else if (displayPrice > 0) {
        html += `<div style="background: rgba(255,59,48,0.1); border: 1px solid rgba(255,59,48,0.2); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
            <strong style="color: var(--red); display: flex; align-items: center; gap: 8px;"><span>ðŸš€</span> What happens next?</strong>
            <p style="color: rgba(255,255,255,0.7); margin-top: 10px; font-size: 14px; line-height: 1.6;">After submitting, you'll be redirected to complete your payment. Once payment is received, our team will review your submission and reach out within 24-48 hours to kick off your project.</p>
        </div>`;
    } else {
        html += `<div style="background: rgba(234,179,8,0.1); border: 1px solid rgba(234,179,8,0.3); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
            <strong style="color: #fbbf24; display: flex; align-items: center; gap: 8px;"><span>ðŸ“‹</span> What happens next?</strong>
            <p style="color: rgba(255,255,255,0.7); margin-top: 10px; font-size: 14px; line-height: 1.6;">After submitting, our team will review your requirements and send you a custom quote within 24-48 hours. We'll then schedule a call to discuss your project in detail.</p>
        </div>`;
    }

    return html;
}

function submitIntake() {
    const config = serviceIntakeConfigs[intakeData.serviceId];
    const submission = {
        id: Date.now(),
        ...intakeData,
        files: uploadedFiles.map(f => f.name),
        submittedAt: new Date().toISOString(),
        status: 'pending_payment'
    };

    formSubmissions.push(submission);
    saveSubmissions();

    // Create lead from submission
    const newLead = {
        id: Date.now() + 1,
        name: intakeData.contactName || intakeData.businessName,
        email: intakeData.email || '',
        phone: intakeData.phone || '',
        business: intakeData.businessName,
        service: config.name,
        budget: config.price > 0 ? '$' + config.price.toLocaleString() : 'Custom',
        message: intakeData.projectType || intakeData.brandStory || '',
        status: 'new',
        createdAt: new Date().toISOString()
    };
    leads.push(newLead);
    saveLeads();

    // Trigger workflow: Add to pipeline and email subscribers
    triggerNewLead(newLead.id);

    // Simulate sending confirmation email
    console.log('Confirmation email sent to:', intakeData.email);

    // Show success and redirect to payment
    showPaymentPage(submission);
}

function showPaymentPage(submission) {
    const config = serviceIntakeConfigs[submission.serviceId];

    document.getElementById('intakeView').innerHTML = `
        <div class="intake-view" style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
            <div class="wizard-content" style="max-width: 600px; text-align: center;">
                <div class="success-icon" style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--green), #34d399); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 48px; color: white; box-shadow: 0 20px 60px rgba(16,185,129,0.4);">âœ“</div>
                <h1 class="success-title">Submission Received!</h1>
                <p class="success-message">Thank you for choosing New Urban Influence. A confirmation email has been sent with your project details.</p>

                <div class="success-details">
                    <div class="success-detail">
                        <span class="success-detail-label">Service</span>
                        <span class="success-detail-value">${config.name}</span>
                    </div>
                    <div class="success-detail">
                        <span class="success-detail-label">Reference #</span>
                        <span class="success-detail-value">NUI-${submission.id}</span>
                    </div>
                    <div class="success-detail">
                        <span class="success-detail-label">Amount Due</span>
                        <span class="success-detail-value" style="color: var(--red);">${config.price > 0 ? '$' + config.price.toLocaleString() : 'Quote Pending'}</span>
                    </div>
                </div>

                ${config.price > 0 ? `
                <div style="margin-bottom: 32px;">
                    <p style="color: rgba(255,255,255,0.6); margin-bottom: 20px; font-size: 15px;">Complete your payment to start your project:</p>
                    <a href="https://buy.stripe.com/test" target="_blank" class="btn-cta" style="padding: 20px 48px; font-size: 18px; display: inline-flex; background: linear-gradient(135deg, var(--green) 0%, #34d399 100%); box-shadow: 0 8px 30px rgba(16,185,129,0.4);">
                        Pay $${config.price.toLocaleString()} with Stripe â†’
                    </a>
                    <p style="color: rgba(255,255,255,0.4); font-size: 13px; margin-top: 16px;">ðŸ”’ Secure payment powered by Stripe</p>
                </div>
                ` : `
                <div style="margin-bottom: 32px;">
                    <p style="color: rgba(255,255,255,0.6); margin-bottom: 16px; font-size: 15px;">Our team will prepare a custom quote and contact you within 24 hours.</p>
                </div>
                `}

                <div style="padding-top: 28px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <p style="color: rgba(255,255,255,0.5); font-size: 14px; margin-bottom: 20px; line-height: 1.8;">
                        <strong style="color: #fff;">Next Steps:</strong><br>
                        1. Complete payment (if applicable)<br>
                        2. Receive project kickoff email<br>
                        3. Schedule strategy call with your creative team
                    </p>
                    <button onclick="showView('home')" class="btn-outline" style="color: #fff; border-color: rgba(255,255,255,0.3); padding: 16px 32px;">Back to Home</button>
                </div>
            </div>
        </div>
    `;
}

// ==================== ENHANCED BRAND PORTAL ====================
function loadEnhancedBrandPortal(client) {
    const primaryColor = client.colors?.[0] || '#ff0000';
    const secondaryColor = client.colors?.[1] || '#000000';

    document.getElementById('clientPortal').style.setProperty('--client-primary', primaryColor);
    document.getElementById('clientPortal').style.setProperty('--client-secondary', secondaryColor);

    document.getElementById('clientPortal').innerHTML = `
        <!-- Back Navigation Bar -->
        <div class="portal-nav-bar" style="background: rgba(0,0,0,0.9); padding: 12px 24px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100;">
            <button onclick="goBackFromPortal()" class="portal-back-btn" style="display: flex; align-items: center; gap: 8px; background: none; border: none; color: #fff; cursor: pointer; font-size: 16px; padding: 8px 16px; border-radius: 8px; transition: background 0.2s;">
                <span style="font-size: 20px;">â†</span> Back
            </button>
            <span style="color: #888; font-size: 14px;">${client.name} Brand Portal</span>
            ${currentUser?.type === 'admin' ? `<button onclick="backToAdmin()" style="background: var(--accent); color: #000; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">Admin Dashboard</button>` : '<div></div>'}
        </div>

        <div class="brand-portal-header" style="background: linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%);">
            ${client.logo ? `<img src="${client.logo}" class="brand-portal-logo" alt="${client.name}">` : `<div style="font-size: 48px; font-weight: 900;">${client.name}</div>`}
            <h1 class="brand-portal-title">${client.name} Brand Portal</h1>
            <p class="brand-portal-subtitle">Your complete brand identity system</p>
        </div>

        <!-- LOGO SECTION -->
        <div class="brand-section">
            <div class="brand-section-header">
                <h2 class="brand-section-title">Logo Suite</h2>
                <button class="brand-download-all" onclick="downloadAllLogos()">ðŸ“¥ Download All</button>
            </div>
            <div class="logo-grid">
                ${renderLogoCards(client)}
            </div>
        </div>

        <!-- COLOR PALETTE -->
        <div class="brand-section">
            <div class="brand-section-header">
                <h2 class="brand-section-title">Color Palette</h2>
            </div>
            <div class="color-palette">
                ${renderColorSwatches(client)}
            </div>
        </div>

        <!-- TYPOGRAPHY -->
        <div class="brand-section">
            <div class="brand-section-header">
                <h2 class="brand-section-title">Typography</h2>
            </div>
            <div class="typography-showcase">
                ${renderTypography(client)}
            </div>
        </div>

        <!-- BRAND ELEMENTS -->
        <div class="brand-section">
            <div class="brand-section-header">
                <h2 class="brand-section-title">Brand Elements</h2>
            </div>
            <div class="elements-grid">
                ${renderBrandElements(client)}
            </div>
        </div>

        <!-- MOCKUPS -->
        <div class="brand-section">
            <div class="brand-section-header">
                <h2 class="brand-section-title">Brand Mockups</h2>
            </div>
            <div class="mockups-grid">
                ${renderMockups(client)}
            </div>
        </div>

        <div style="padding: 40px; text-align: center; background: #f5f5f5;">
            <p style="color: #888; margin-bottom: 16px;">Need updates to your brand assets?</p>
            <button onclick="showView('home'); setTimeout(() => scrollToContact(), 100);" class="btn-cta">Contact NUI</button>
            ${currentUser?.type === 'admin' ? `<button onclick="backToAdmin()" class="btn-outline" style="margin-left: 16px; color: #000; border-color: #000;">Back to Admin</button>` : ''}
        </div>
    `;
}

function renderLogoCards(client) {
    const logoVariants = [
        { name: 'Primary Logo', bg: 'light-bg', desc: 'Full color on light' },
        { name: 'Dark Background', bg: 'dark-bg', desc: 'For dark backgrounds' },
        { name: 'On Brand Color', bg: 'color-bg', desc: 'White on brand color' },
        { name: 'Icon Only', bg: 'light-bg', desc: 'Symbol/mark only' }
    ];

    return logoVariants.map(variant => `
        <div class="logo-card">
            <div class="logo-preview ${variant.bg}">
                ${client.logo ? `<img src="${client.logo}" alt="${variant.name}">` : `<div style="font-size: 36px; font-weight: 900; color: ${variant.bg === 'dark-bg' ? '#fff' : '#000'};">${client.name}</div>`}
            </div>
            <div class="logo-info">
                <div>
                    <div class="logo-name">${variant.name}</div>
                    <div class="logo-format">${variant.desc}</div>
                </div>
                <button class="logo-download" onclick="alert('Download ${variant.name}')">â†“ PNG</button>
            </div>
        </div>
    `).join('');
}

function renderColorSwatches(client) {
    const colors = client.colors || ['#ff0000', '#000000', '#ffffff'];
    const colorNames = ['Primary', 'Secondary', 'Accent', 'Background', 'Text'];

    return colors.map((color, i) => `
        <div class="color-swatch" style="background: ${color};">
            <button class="color-copy" onclick="copyColor('${color}')">Copy</button>
            <div class="color-info">
                <div class="color-name">${colorNames[i] || 'Color ' + (i+1)}</div>
                <div class="color-hex">${color.toUpperCase()}</div>
            </div>
        </div>
    `).join('');
}

function copyColor(hex) {
    navigator.clipboard.writeText(hex);
    alert('Copied: ' + hex);
}

function renderTypography(client) {
    const headingFont = client.fonts?.heading || 'Inter';
    const bodyFont = client.fonts?.body || 'Inter';

    return `
        <div class="typography-card">
            <div class="typography-label">Heading Font</div>
            <div class="typography-preview" style="font-family: '${headingFont}', sans-serif;">
                <h2>Aa Bb Cc</h2>
                <p style="font-size: 14px; margin-top: 8px;">${headingFont}</p>
            </div>
            <div class="typography-specimen">
                <span>ABCDEFGHIJKLMNOPQRSTUVWXYZ</span>
                <span>abcdefghijklmnopqrstuvwxyz</span>
                <span>0123456789</span>
            </div>
            <div class="typography-download">
                <span style="flex: 1;">${headingFont} Font Family</span>
                <button class="typography-download-btn" onclick="alert('Download font files')">Download</button>
            </div>
        </div>
        <div class="typography-card">
            <div class="typography-label">Body Font</div>
            <div class="typography-preview" style="font-family: '${bodyFont}', sans-serif;">
                <p>The quick brown fox jumps over the lazy dog. Pack my box with five dozen liquor jugs.</p>
            </div>
            <div class="typography-specimen">
                <span>Regular 400</span>
                <span>Medium 500</span>
                <span>Semibold 600</span>
                <span>Bold 700</span>
            </div>
            <div class="typography-download">
                <span style="flex: 1;">${bodyFont} Font Family</span>
                <button class="typography-download-btn" onclick="alert('Download font files')">Download</button>
            </div>
        </div>
    `;
}

function renderBrandElements(client) {
    const elements = ['Pattern', 'Icon Set', 'Texture', 'Divider', 'Badge', 'Stamp'];
    return elements.map(el => `
        <div class="element-card">
            <div class="element-preview">
                <div style="color: #888; font-size: 32px;">â—‡</div>
            </div>
            <div class="element-info">
                <div class="element-name">${el}</div>
                <div class="element-actions">
                    <button class="element-btn" onclick="alert('Download ${el}')">PNG</button>
                    <button class="element-btn" onclick="alert('Download ${el}')">SVG</button>
                </div>
            </div>
        </div>
    `).join('');
}

function renderMockups(client) {
    const mockups = [
        { name: 'Business Card', img: 'https://via.placeholder.com/400x240/1a1a1a/ffffff?text=Business+Card' },
        { name: 'Letterhead', img: 'https://via.placeholder.com/400x240/1a1a1a/ffffff?text=Letterhead' },
        { name: 'Social Media', img: 'https://via.placeholder.com/400x240/1a1a1a/ffffff?text=Social+Media' },
        { name: 'Website Preview', img: 'https://via.placeholder.com/400x240/1a1a1a/ffffff?text=Website' }
    ];

    return mockups.map(m => `
        <div class="mockup-card">
            <img src="${m.img}" class="mockup-image" alt="${m.name}">
            <div class="mockup-info">
                <span class="mockup-name">${m.name}</span>
                <button class="mockup-download" onclick="alert('Download ${m.name}')">Download</button>
            </div>
        </div>
    `).join('');
}

function downloadAllLogos() {
    alert('Downloading all logo files as ZIP...');
}

// Navigation history for back buttons
let navigationHistory = [];

function goBackFromPortal() {
    if (navigationHistory.length > 0) {
        const prevView = navigationHistory.pop();
        showView(prevView, true);
    } else if (currentUser?.type === 'admin') {
        showView('admin', true);
    } else {
        showView('home', true);
    }
}

function trackNavigation(viewName) {
    if (navigationHistory[navigationHistory.length - 1] !== viewName) {
        navigationHistory.push(viewName);
        if (navigationHistory.length > 10) navigationHistory.shift();
    }
}

// ==================== ADMIN SUBMISSIONS PANEL ====================
function loadAdminSubmissionsPanel(searchTerm = '') {
    const filtered = searchTerm
        ? formSubmissions.filter(s =>
            (s.businessName || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
            (s.contactName || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
            (s.email || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
            (s.serviceName || '').toLowerCase().includes(searchTerm.toLowerCase())
          )
        : formSubmissions;

    document.getElementById('adminSubmissionsPanel').innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <h1 style="font-size: 28px; font-weight: 700;">Form Submissions</h1>
            <span style="color: #888;">${filtered.length} of ${formSubmissions.length} submissions</span>
        </div>
        <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; align-items: center;">
            <input type="text" id="submissionSearch" placeholder="Search submissions..." value="${searchTerm}"
                oninput="loadAdminSubmissionsPanel(this.value)"
                style="flex: 1; min-width: 200px; padding: 12px 16px; border: 1px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
            <button onclick="selectAllSubmissions()" style="padding: 10px 16px; background: #f3f4f6; border: 1px solid #e5e5e5; border-radius: 8px; cursor: pointer;">Select All</button>
            <button onclick="deleteSelectedSubmissions()" style="padding: 10px 16px; background: #fee2e2; color: #dc2626; border: none; border-radius: 8px; cursor: pointer;">Delete Selected</button>
            <button onclick="exportSubmissionsCSV()" style="padding: 10px 16px; background: #000; color: #fff; border: none; border-radius: 8px; cursor: pointer;">Export CSV</button>
        </div>
        ${filtered.length > 0 ? `
        <div style="display: flex; flex-direction: column; gap: 16px;">
            ${filtered.slice().reverse().map(sub => `
                <div style="background: #fff; border: 1px solid #e5e5e5; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <input type="checkbox" class="submission-checkbox" data-id="${sub.id}" style="width: 18px; height: 18px; cursor: pointer;">
                            <strong style="font-size: 18px;">${sub.businessName || sub.contactName || 'Unknown'}</strong>
                            <span style="background: ${sub.status === 'pending_payment' ? '#fef3c7' : '#d1fae5'}; color: ${sub.status === 'pending_payment' ? '#92400e' : '#065f46'}; padding: 4px 12px; border-radius: 12px; font-size: 12px;">${sub.status}</span>
                        </div>
                        <span style="color: #888; font-size: 13px;">${new Date(sub.submittedAt).toLocaleDateString()}</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; color: #666; font-size: 14px; margin-left: 30px;">
                        <div><strong>Service:</strong> ${sub.serviceName}</div>
                        <div><strong>Price:</strong> ${sub.price > 0 ? '$' + sub.price : 'Custom'}</div>
                        <div><strong>Ref:</strong> NUI-${sub.id}</div>
                    </div>
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e5e5e5; display: flex; gap: 8px; flex-wrap: wrap; margin-left: 30px;">
                        <button onclick="viewSubmissionDetails(${sub.id})" style="padding: 8px 16px; background: #000; color: #fff; border: none; border-radius: 6px; cursor: pointer;">View Details</button>
                        <button onclick="convertSubmissionToOrder(${sub.id})" style="padding: 8px 16px; background: var(--green); color: #fff; border: none; border-radius: 6px; cursor: pointer;">Convert to Order</button>
                        <button onclick="deleteSubmission(${sub.id})" style="padding: 8px 16px; background: #fee2e2; color: #dc2626; border: none; border-radius: 6px; cursor: pointer;">Delete</button>
                    </div>
                </div>
            `).join('')}
        </div>
        ` : '<p style="color: #888; text-align: center; padding: 40px;">No submissions found.</p>'}
    `;
}

// Bulk selection for submissions
function selectAllSubmissions() {
    const checkboxes = document.querySelectorAll('.submission-checkbox');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
    checkboxes.forEach(cb => cb.checked = !allChecked);
}

// Bulk delete submissions
function deleteSelectedSubmissions() {
    const checkboxes = document.querySelectorAll('.submission-checkbox:checked');
    if (checkboxes.length === 0) {
        alert('Please select at least one submission to delete.');
        return;
    }

    if (!confirm('Are you sure you want to delete ' + checkboxes.length + ' submission(s)? This cannot be undone.')) return;

    const idsToDelete = Array.from(checkboxes).map(cb => parseInt(cb.dataset.id));
    formSubmissions = formSubmissions.filter(s => !idsToDelete.includes(s.id));
    saveSubmissions();
    loadAdminSubmissionsPanel(document.getElementById('submissionSearch')?.value || '');
    alert(idsToDelete.length + ' submission(s) deleted successfully.');
}

// Export submissions to CSV
function exportSubmissionsCSV() {
    if (formSubmissions.length === 0) {
        alert('No submissions to export.');
        return;
    }

    const headers = ['ID', 'Business Name', 'Contact Name', 'Email', 'Phone', 'Service', 'Price', 'Status', 'Date'];
    const rows = formSubmissions.map(s => [
        s.id,
        s.businessName || '',
        s.contactName || '',
        s.email || '',
        s.phone || '',
        s.serviceName || '',
        s.price || 0,
        s.status || '',
        s.submittedAt || ''
    ]);

    const csv = [headers.join(','), ...rows.map(r => r.map(v => '"' + String(v).replace(/"/g, '""') + '"').join(','))].join('\n');
    downloadCSV(csv, 'nui-submissions-' + new Date().toISOString().split('T')[0] + '.csv');
}

// Helper to download CSV
function downloadCSV(content, filename) {
    const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    link.click();
    URL.revokeObjectURL(link.href);
}

function viewSubmissionDetails(subId) {
    const sub = formSubmissions.find(s => s.id === subId);
    if (!sub) return;

    let details = Object.entries(sub).map(([key, value]) =>
        `<div style="padding: 8px 0; border-bottom: 1px solid #e5e5e5;"><strong>${key}:</strong> ${JSON.stringify(value)}</div>`
    ).join('');

    alert('Submission Details:\n\n' + JSON.stringify(sub, null, 2));
}

function convertSubmissionToOrder(subId) {
    const sub = formSubmissions.find(s => s.id === subId);
    if (!sub) return;

    // Create or find client
    let client = clients.find(c => c.name === sub.businessName);
    if (!client) {
        client = {
            id: Date.now(),
            name: sub.businessName || 'New Client',
            email: sub.email || '',
            password: 'client' + Math.random().toString(36).substring(7),
            industry: sub.industry || '',
            colors: ['#ff0000', '#000000', '#ffffff'],
            fonts: { heading: 'Inter', body: 'Inter' },
            assets: { logos: [], mockups: [], social: [], video: [], banner: [], fonts: [], patterns: [], package: [] }
        };
        clients.push(client);
        saveClients();
    }

    // Create order
    const order = {
        id: Date.now(),
        clientId: client.id,
        project: sub.serviceName,
        status: 'pending',
        estimate: sub.price,
        dueDate: new Date(Date.now() + 14*24*60*60*1000).toISOString().split('T')[0],
        deliverables: []
    };
    orders.push(order);
    saveOrders();

    // Update submission status
    sub.status = 'converted';
    saveSubmissions();

    alert('Order created for ' + client.name + '!\nPassword: ' + client.password);
    loadAdminSubmissionsPanel();
}

function deleteSubmission(subId) {
    if (!confirm('Are you sure you want to delete this submission?')) return;
    formSubmissions = formSubmissions.filter(s => s.id !== subId);
    saveSubmissions();
    loadAdminSubmissionsPanel();
}

// Add intake view to HTML structure
if (!document.getElementById('intakeView')) {
    const intakeDiv = document.createElement('div');
    intakeDiv.className = 'view';
    intakeDiv.id = 'intakeView';
    document.body.insertBefore(intakeDiv, document.querySelector('script'));
}

// Update services page to link to intake
function updateServicesWithIntake() {
    const servicesView = document.getElementById('servicesView');
    if (servicesView && servicesView.innerHTML) {
        // Services are already loaded, we can enhance them
    }
}

// ==================== DESIGNER DASHBOARD ====================
function loadDesignerDashboard(designer) {
    // Update header to show designer name
    document.querySelector('.admin-header span').textContent = 'Designer: ' + designer.name;

    // Show only permitted panels
    document.querySelectorAll('.admin-nav-link').forEach(link => {
        const panel = link.getAttribute('data-panel');
        const permitted = ['dashboard'];
        if (designer.permissions.includes('projects')) permitted.push('projects');
        if (designer.permissions.includes('proofs')) permitted.push('proofs');
        if (designer.permissions.includes('assets')) permitted.push('assets');
        if (designer.permissions.includes('clients')) permitted.push('clients');

        if (!permitted.includes(panel)) {
            link.style.display = 'none';
        }
    });

    // Hide nav groups that have no visible items
    document.querySelectorAll('.admin-nav-group').forEach(group => {
        const visibleLinks = group.querySelectorAll('.admin-nav-link:not([style*="display: none"])');
        if (visibleLinks.length === 0) {
            group.style.display = 'none';
        }
    });

    loadAdminDashboardPanel();
}

// ==================== CRM PANEL (GoHighLevel Style) ====================
let crmActiveTab = 'pipeline';
let crmSmartGroups = JSON.parse(localStorage.getItem('nui_smart_groups')) || [
    { id: 1, name: 'All Contacts', filter: { type: 'all' }, color: '#3b82f6' },
    { id: 2, name: 'New Leads (7 days)', filter: { type: 'date', days: 7, status: 'new' }, color: '#10b981' },
    { id: 3, name: 'High Value ($5k+)', filter: { type: 'value', min: 5000 }, color: '#f59e0b' },
    { id: 4, name: 'Needs Follow-up', filter: { type: 'stage', stages: [1, 2] }, color: '#ef4444' },
    { id: 5, name: 'Won Deals', filter: { type: 'stage', stages: [5] }, color: '#8b5cf6' }
];
function saveSmartGroups() { localStorage.setItem('nui_smart_groups', JSON.stringify(crmSmartGroups)); }

function loadAdminCrmPanel() {
    // Merge clients into contacts if not already
    clients.forEach(client => {
        if (!crmData.contacts.find(c => c.email === client.email)) {
            crmData.contacts.push({
                id: client.id,
                name: client.contact || client.name,
                email: client.email,
                phone: client.phone || '',
                company: client.name,
                value: orders.filter(o => o.clientId === client.id).reduce((s, o) => s + (o.estimate || 0), 0),
                stage: 5,
                clientId: client.id,
                createdAt: client.createdAt || new Date().toISOString()
            });
        }
    });

    const contactsByStage = {};
    crmData.pipelines.forEach(p => { contactsByStage[p.id] = crmData.contacts.filter(c => c.stage === p.id); });
    const totalValue = crmData.contacts.reduce((sum, c) => sum + (c.value || 0), 0);
    const wonValue = (contactsByStage[5] || []).reduce((sum, c) => sum + (c.value || 0), 0);

    document.getElementById('adminCrmPanel').innerHTML = `
        <style>
            .crm-tabs { display: flex; gap: 4px; background: #111; padding: 4px; border-radius: 8px; margin-bottom: 24px; }
            .crm-tab { padding: 12px 24px; background: transparent; border: none; color: rgba(255,255,255,0.5); cursor: pointer; border-radius: 6px; font-weight: 600; font-family: inherit; transition: all 0.2s; }
            .crm-tab:hover { color: #fff; background: rgba(255,255,255,0.05); }
            .crm-tab.active { background: var(--red); color: #fff; }
            .crm-content { display: none; }
            .crm-content.active { display: block; }
            .pipeline-board-ghl { display: flex; gap: 16px; overflow-x: auto; padding-bottom: 16px; min-height: 500px; }
            .pipeline-col { min-width: 280px; max-width: 280px; background: #111; border-radius: 12px; display: flex; flex-direction: column; }
            .pipeline-col-header { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
            .pipeline-col-title { font-weight: 700; font-size: 14px; display: flex; align-items: center; gap: 8px; }
            .pipeline-col-count { background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 100px; font-size: 12px; font-weight: 600; }
            .pipeline-col-body { flex: 1; padding: 12px; overflow-y: auto; min-height: 200px; }
            .pipeline-col-body.drag-over { background: rgba(255,255,255,0.05); border: 2px dashed rgba(255,255,255,0.2); }
            .contact-card { background: #1a1a1a; border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; padding: 16px; margin-bottom: 12px; cursor: grab; transition: all 0.2s; }
            .contact-card:hover { border-color: rgba(255,255,255,0.2); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
            .contact-card.dragging { opacity: 0.5; transform: rotate(3deg); }
            .contact-card-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
            .contact-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; }
            .contact-info h4 { font-size: 14px; font-weight: 600; margin-bottom: 2px; }
            .contact-info p { font-size: 12px; color: rgba(255,255,255,0.5); }
            .contact-value { font-size: 16px; font-weight: 700; color: #10b981; }
            .contact-meta { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
            .contact-tag { font-size: 10px; padding: 4px 8px; border-radius: 4px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7); }
            .contact-actions { display: flex; gap: 8px; border-top: 1px solid rgba(255,255,255,0.08); padding-top: 12px; }
            .contact-action-btn { flex: 1; padding: 8px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 4px; }
            .contact-action-btn.sms { background: #10b981; color: #fff; }
            .contact-action-btn.email { background: #3b82f6; color: #fff; }
            .contact-action-btn.call { background: #8b5cf6; color: #fff; }
            .contact-action-btn.more { background: rgba(255,255,255,0.1); color: #fff; }
            .contact-action-btn:hover { transform: scale(1.05); }
            .smart-group-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 16px; margin-bottom: 32px; }
            .smart-group-card { background: #111; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s; }
            .smart-group-card:hover { border-color: rgba(255,255,255,0.3); transform: translateY(-2px); }
            .smart-group-card.selected { border-color: var(--red); background: rgba(255,0,0,0.1); }
            .smart-group-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
            .smart-group-name { font-weight: 600; font-size: 16px; }
            .smart-group-count { background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 100px; font-size: 13px; }
            .bulk-actions { background: #111; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 24px; margin-bottom: 24px; }
            .bulk-actions h3 { font-size: 16px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
            .bulk-btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: inherit; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s; }
            .bulk-btn.sms { background: #10b981; color: #fff; }
            .bulk-btn.email { background: #3b82f6; color: #fff; }
            .bulk-btn:hover { transform: translateY(-2px); }
            .contact-table { width: 100%; border-collapse: collapse; }
            .contact-table th { text-align: left; padding: 12px 16px; background: #111; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.5); }
            .contact-table td { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.05); }
            .contact-table tr:hover td { background: rgba(255,255,255,0.02); }
            .contact-table input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
            .stage-move-btns { display: flex; gap: 4px; margin-top: 8px; }
            .stage-move-btn { padding: 4px 8px; font-size: 10px; border: none; border-radius: 4px; cursor: pointer; background: rgba(255,255,255,0.1); color: #fff; }
            .stage-move-btn:hover { background: rgba(255,255,255,0.2); }
        </style>

        <div class="panel-header">
            <h1 class="panel-title">ðŸ’¼ CRM Pipeline</h1>
            <p class="panel-subtitle">Manage your sales pipeline, contacts, and communications</p>
        </div>

        <!-- CRM Tabs -->
        <div class="crm-tabs">
            <button class="crm-tab ${crmActiveTab === 'pipeline' ? 'active' : ''}" onclick="switchCrmTab('pipeline')">ðŸ“Š Pipeline</button>
            <button class="crm-tab ${crmActiveTab === 'conversations' ? 'active' : ''}" onclick="switchCrmTab('conversations')">ðŸ’¬ Conversations</button>
            <button class="crm-tab ${crmActiveTab === 'contacts' ? 'active' : ''}" onclick="switchCrmTab('contacts')">ðŸ‘¥ All Contacts</button>
            <button class="crm-tab ${crmActiveTab === 'smartgroups' ? 'active' : ''}" onclick="switchCrmTab('smartgroups')">ðŸŽ¯ Smart Groups</button>
            <button class="crm-tab ${crmActiveTab === 'bulk' ? 'active' : ''}" onclick="switchCrmTab('bulk')">ðŸ“¤ Bulk Actions</button>
        </div>

        <!-- Stats Bar -->
        <div class="stat-cards" style="margin-bottom: 24px;">
            <div class="stat-card"><div class="num">${crmData.contacts.length}</div><div class="lbl">Total Contacts</div></div>
            <div class="stat-card"><div class="num" style="color: #3b82f6;">${(contactsByStage[1] || []).length + (contactsByStage[2] || []).length}</div><div class="lbl">Active Leads</div></div>
            <div class="stat-card highlight"><div class="num">$${totalValue.toLocaleString()}</div><div class="lbl">Pipeline Value</div></div>
            <div class="stat-card"><div class="num" style="color: #10b981;">$${wonValue.toLocaleString()}</div><div class="lbl">Won Deals</div></div>
        </div>

        <!-- PIPELINE TAB -->
        <div class="crm-content ${crmActiveTab === 'pipeline' ? 'active' : ''}" id="crmPipelineTab">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <p style="color: rgba(255,255,255,0.5); font-size: 13px;">Drag contacts between stages to update their status</p>
                <button class="btn-admin primary" onclick="showAddContactModal()">+ Add Contact</button>
            </div>
            <div class="pipeline-board-ghl">
                ${crmData.pipelines.map(stage => {
                    const stageContacts = contactsByStage[stage.id] || [];
                    const stageValue = stageContacts.reduce((s, c) => s + (c.value || 0), 0);
                    return `
                    <div class="pipeline-col" data-stage="${stage.id}">
                        <div class="pipeline-col-header" style="border-left: 3px solid ${stage.color};">
                            <div class="pipeline-col-title"><span style="color: ${stage.color};">â—</span> ${stage.name}</div>
                            <div class="pipeline-col-count">${stageContacts.length} Â· $${stageValue.toLocaleString()}</div>
                        </div>
                        <div class="pipeline-col-body" ondragover="handleDragOver(event)" ondrop="handleDrop(event, ${stage.id})" ondragleave="handleDragLeave(event)">
                            ${stageContacts.map(contact => renderContactCard(contact, stage.color)).join('') || '<p style="color: rgba(255,255,255,0.2); font-size: 12px; text-align: center; padding: 40px 20px;">Drop contacts here</p>'}
                        </div>
                    </div>`;
                }).join('')}
            </div>
        </div>

        <!-- CONVERSATIONS TAB -->
        <div class="crm-content ${crmActiveTab === 'conversations' ? 'active' : ''}" id="crmConversationsTab">
            ${renderConversationsHub()}
        </div>

        <!-- ALL CONTACTS TAB -->
        <div class="crm-content ${crmActiveTab === 'contacts' ? 'active' : ''}" id="crmContactsTab">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <input type="text" placeholder="Search contacts..." oninput="filterCrmContacts(this.value)" style="padding: 10px 16px; background: #111; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #fff; width: 300px;">
                <button class="btn-admin primary" onclick="showAddContactModal()">+ Add Contact</button>
            </div>
            <table class="contact-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" onchange="toggleAllContacts(this.checked)"></th>
                        <th>Contact</th>
                        <th>Company</th>
                        <th>Stage</th>
                        <th>Value</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="crmContactsTableBody">
                    ${crmData.contacts.map(contact => {
                        const stage = crmData.pipelines.find(p => p.id === contact.stage);
                        return `
                        <tr>
                            <td><input type="checkbox" class="contact-checkbox" data-id="${contact.id}"></td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div class="contact-avatar" style="background: ${stage?.color || '#666'}; width: 36px; height: 36px; font-size: 14px;">${contact.name?.charAt(0) || '?'}</div>
                                    <div>
                                        <div style="font-weight: 600;">${contact.name}</div>
                                        <div style="font-size: 12px; color: rgba(255,255,255,0.5);">${contact.email || 'No email'}</div>
                                    </div>
                                </div>
                            </td>
                            <td>${contact.company || 'â€”'}</td>
                            <td><span style="background: ${stage?.color || '#666'}20; color: ${stage?.color || '#666'}; padding: 4px 12px; border-radius: 100px; font-size: 12px; font-weight: 600;">${stage?.name || 'Unknown'}</span></td>
                            <td style="font-weight: 600; color: #10b981;">$${(contact.value || 0).toLocaleString()}</td>
                            <td>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="quickSms(${contact.id})" style="padding: 6px 12px; background: #10b981; border: none; border-radius: 4px; cursor: pointer; color: #fff; font-size: 12px;">ðŸ’¬ SMS</button>
                                    <button onclick="quickEmail(${contact.id})" style="padding: 6px 12px; background: #3b82f6; border: none; border-radius: 4px; cursor: pointer; color: #fff; font-size: 12px;">ðŸ“§ Email</button>
                                    <button onclick="quickCall(${contact.id})" style="padding: 6px 12px; background: #8b5cf6; border: none; border-radius: 4px; cursor: pointer; color: #fff; font-size: 12px;">ðŸ“ž Call</button>
                                    <button onclick="editContact(${contact.id})" style="padding: 6px 12px; background: rgba(255,255,255,0.1); border: none; border-radius: 4px; cursor: pointer; color: #fff; font-size: 12px;">âœï¸</button>
                                </div>
                            </td>
                        </tr>`;
                    }).join('')}
                </tbody>
            </table>
        </div>

        <!-- SMART GROUPS TAB -->
        <div class="crm-content ${crmActiveTab === 'smartgroups' ? 'active' : ''}" id="crmSmartGroupsTab">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <p style="color: rgba(255,255,255,0.5);">Create smart groups to segment contacts for targeted messaging</p>
                <button class="btn-admin primary" onclick="showCreateSmartGroupModal()">+ Create Smart Group</button>
            </div>
            <div class="smart-group-list">
                ${crmSmartGroups.map(group => {
                    const groupContacts = getSmartGroupContacts(group);
                    return `
                    <div class="smart-group-card" onclick="selectSmartGroup(${group.id})" data-group="${group.id}">
                        <div class="smart-group-header">
                            <div class="smart-group-name" style="display: flex; align-items: center; gap: 8px;"><span style="color: ${group.color};">â—</span> ${group.name}</div>
                            <div class="smart-group-count">${groupContacts.length}</div>
                        </div>
                        <p style="font-size: 12px; color: rgba(255,255,255,0.5); margin-bottom: 12px;">${getSmartGroupDescription(group)}</p>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="event.stopPropagation(); bulkSmsGroup(${group.id})" class="bulk-btn sms" style="flex: 1; padding: 8px; font-size: 12px;">ðŸ’¬ SMS All</button>
                            <button onclick="event.stopPropagation(); bulkEmailGroup(${group.id})" class="bulk-btn email" style="flex: 1; padding: 8px; font-size: 12px;">ðŸ“§ Email All</button>
                        </div>
                    </div>`;
                }).join('')}
            </div>
        </div>

        <!-- BULK ACTIONS TAB -->
        <div class="crm-content ${crmActiveTab === 'bulk' ? 'active' : ''}" id="crmBulkTab">
            <div class="bulk-actions">
                <h3>ðŸ“¤ Bulk Messaging</h3>
                <p style="color: rgba(255,255,255,0.5); margin-bottom: 20px;">Select a smart group or manually select contacts to send bulk messages</p>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <!-- SMS Blast -->
                    <div style="background: #0a0a0a; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 24px;">
                        <h4 style="font-size: 16px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;"><span style="font-size: 24px;">ðŸ’¬</span> SMS Blast</h4>
                        <div class="form-group">
                            <label class="form-label">Select Recipients</label>
                            <select id="bulkSmsGroup" class="form-select">
                                ${crmSmartGroups.map(g => `<option value="${g.id}">${g.name} (${getSmartGroupContacts(g).length})</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Message Template</label>
                            <select id="bulkSmsTemplate" class="form-select" onchange="loadSmsTemplate(this.value)">
                                <option value="">-- Select Template --</option>
                                ${smsSystem.templates.map(t => `<option value="${t.id}">${t.name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Message</label>
                            <textarea id="bulkSmsMessage" class="form-textarea" placeholder="Hi {name}, ..." rows="4"></textarea>
                            <p style="font-size: 11px; color: rgba(255,255,255,0.4); margin-top: 4px;">Use {name}, {company} for personalization</p>
                        </div>
                        <button onclick="sendBulkSms()" class="bulk-btn sms" style="width: 100%;">ðŸ’¬ Send SMS Blast</button>
                    </div>

                    <!-- Email Blast -->
                    <div style="background: #0a0a0a; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 24px;">
                        <h4 style="font-size: 16px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;"><span style="font-size: 24px;">ðŸ“§</span> Email Blast</h4>
                        <div class="form-group">
                            <label class="form-label">Select Recipients</label>
                            <select id="bulkEmailGroup" class="form-select">
                                ${crmSmartGroups.map(g => `<option value="${g.id}">${g.name} (${getSmartGroupContacts(g).length})</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email Template</label>
                            <select id="bulkEmailTemplate" class="form-select" onchange="loadEmailTemplate(this.value)">
                                <option value="">-- Select Template --</option>
                                ${emailMarketing.templates.map(t => `<option value="${t.id}">${t.name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Subject</label>
                            <input type="text" id="bulkEmailSubject" class="form-input" placeholder="Email subject...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Message</label>
                            <textarea id="bulkEmailMessage" class="form-textarea" placeholder="Hi {name}, ..." rows="4"></textarea>
                        </div>
                        <button onclick="sendBulkEmail()" class="bulk-btn email" style="width: 100%;">ðŸ“§ Send Email Blast</button>
                    </div>
                </div>
            </div>

            <!-- Recent Bulk Messages -->
            <div style="background: #111; border-radius: 12px; padding: 24px;">
                <h3 style="font-size: 16px; margin-bottom: 16px;">ðŸ“Š Recent Campaigns</h3>
                <table class="contact-table">
                    <thead><tr><th>Date</th><th>Type</th><th>Group</th><th>Recipients</th><th>Status</th></tr></thead>
                    <tbody>
                        ${(crmData.bulkMessages || []).slice(-5).reverse().map(msg => `
                            <tr>
                                <td>${new Date(msg.sentAt).toLocaleDateString()}</td>
                                <td><span style="background: ${msg.type === 'sms' ? '#10b981' : '#3b82f6'}20; color: ${msg.type === 'sms' ? '#10b981' : '#3b82f6'}; padding: 4px 12px; border-radius: 4px; font-size: 12px;">${msg.type.toUpperCase()}</span></td>
                                <td>${msg.groupName}</td>
                                <td>${msg.recipients}</td>
                                <td style="color: #10b981;">âœ“ Sent</td>
                            </tr>
                        `).join('') || '<tr><td colspan="5" style="text-align: center; color: rgba(255,255,255,0.3);">No campaigns yet</td></tr>'}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function renderContactCard(contact, stageColor) {
    const stage = crmData.pipelines.find(p => p.id === contact.stage);
    return `
        <div class="contact-card" draggable="true" ondragstart="handleDragStart(event, ${contact.id})" ondragend="handleDragEnd(event)" data-contact="${contact.id}">
            <div class="contact-card-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div class="contact-avatar" style="background: ${stageColor};">${contact.name?.charAt(0) || '?'}</div>
                    <div class="contact-info">
                        <h4>${contact.name}</h4>
                        <p>${contact.company || contact.email || 'No info'}</p>
                    </div>
                </div>
                <div class="contact-value">$${(contact.value || 0).toLocaleString()}</div>
            </div>
            <div class="contact-meta">
                ${contact.phone ? '<span class="contact-tag">ðŸ“ž ' + contact.phone + '</span>' : ''}
                ${contact.email ? '<span class="contact-tag">ðŸ“§ Has Email</span>' : ''}
            </div>
            <div class="contact-actions">
                <button class="contact-action-btn sms" onclick="event.stopPropagation(); quickSms(${contact.id})" title="Send SMS">ðŸ’¬</button>
                <button class="contact-action-btn email" onclick="event.stopPropagation(); quickEmail(${contact.id})" title="Send Email">ðŸ“§</button>
                <button class="contact-action-btn call" onclick="event.stopPropagation(); quickCall(${contact.id})" title="Call">ðŸ“ž</button>
                <button class="contact-action-btn more" onclick="event.stopPropagation(); editContact(${contact.id})" title="Edit">â‹¯</button>
            </div>
            <div class="stage-move-btns">
                ${contact.stage > 1 ? '<button class="stage-move-btn" onclick="event.stopPropagation(); moveContactStage(' + contact.id + ', ' + (contact.stage - 1) + ')">â† Prev</button>' : ''}
                ${contact.stage < 6 ? '<button class="stage-move-btn" onclick="event.stopPropagation(); moveContactStage(' + contact.id + ', ' + (contact.stage + 1) + ')">Next â†’</button>' : ''}
            </div>
        </div>`;
}

function switchCrmTab(tab) {
    crmActiveTab = tab;
    document.querySelectorAll('.crm-tab').forEach(t => t.classList.remove('active'));
    document.querySelector(`.crm-tab[onclick*="${tab}"]`)?.classList.add('active');
    document.querySelectorAll('.crm-content').forEach(c => c.classList.remove('active'));
    document.getElementById('crm' + tab.charAt(0).toUpperCase() + tab.slice(1) + 'Tab')?.classList.add('active');
}

// Conversations Hub - All Customer Communications
let conversationFilter = 'all';
let selectedConversationContact = null;

function renderConversationsHub() {
    // Get all communications from various sources
    const allComms = getAllCommunications();
    const filteredComms = conversationFilter === 'all' ? allComms : allComms.filter(c => c.channel === conversationFilter);

    // Group by contact
    const contactComms = {};
    filteredComms.forEach(comm => {
        const contactId = comm.clientId || comm.contactId || 'unknown';
        if (!contactComms[contactId]) {
            contactComms[contactId] = { contact: getContactInfo(contactId), messages: [] };
        }
        contactComms[contactId].messages.push(comm);
    });

    // Sort by latest message
    const sortedContacts = Object.values(contactComms).sort((a, b) => {
        const aLatest = a.messages[a.messages.length - 1]?.createdAt || '';
        const bLatest = b.messages[b.messages.length - 1]?.createdAt || '';
        return new Date(bLatest) - new Date(aLatest);
    });

    const unreadCount = allComms.filter(c => !c.read).length;

    return `
        <style>
            .conv-container { display: flex; gap: 0; height: 600px; background: #111; border-radius: 12px; overflow: hidden; }
            .conv-sidebar { width: 320px; border-right: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; }
            .conv-main { flex: 1; display: flex; flex-direction: column; }
            .conv-header { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); }
            .conv-filters { display: flex; gap: 8px; padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.05); overflow-x: auto; }
            .conv-filter { padding: 6px 12px; background: rgba(255,255,255,0.05); border: none; border-radius: 100px; color: rgba(255,255,255,0.6); cursor: pointer; font-size: 12px; white-space: nowrap; }
            .conv-filter.active { background: var(--red); color: #fff; }
            .conv-list { flex: 1; overflow-y: auto; }
            .conv-item { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: background 0.2s; }
            .conv-item:hover { background: rgba(255,255,255,0.03); }
            .conv-item.active { background: rgba(225,29,72,0.1); border-left: 3px solid var(--red); }
            .conv-item.unread { background: rgba(59,130,246,0.1); }
            .conv-avatar { width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; }
            .conv-item-header { display: flex; justify-content: space-between; margin-bottom: 4px; }
            .conv-item-name { font-weight: 600; font-size: 14px; }
            .conv-item-time { font-size: 11px; color: rgba(255,255,255,0.4); }
            .conv-item-preview { font-size: 13px; color: rgba(255,255,255,0.5); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
            .conv-item-badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 4px; font-size: 10px; margin-top: 8px; }
            .conv-empty { flex: 1; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.3); }
            .conv-messages { flex: 1; overflow-y: auto; padding: 20px; }
            .conv-message { margin-bottom: 16px; max-width: 80%; }
            .conv-message.inbound { margin-right: auto; }
            .conv-message.outbound { margin-left: auto; }
            .conv-message-bubble { padding: 12px 16px; border-radius: 16px; font-size: 14px; line-height: 1.5; }
            .conv-message.inbound .conv-message-bubble { background: #252525; border-bottom-left-radius: 4px; }
            .conv-message.outbound .conv-message-bubble { background: var(--red); border-bottom-right-radius: 4px; }
            .conv-message-meta { font-size: 11px; color: rgba(255,255,255,0.4); margin-top: 4px; display: flex; align-items: center; gap: 8px; }
            .conv-input { padding: 16px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; gap: 12px; }
            .conv-input input { flex: 1; padding: 12px 16px; background: #1a1a1a; border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; color: #fff; }
            .conv-input select { padding: 12px; background: #1a1a1a; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #fff; }
            .conv-input button { padding: 12px 24px; background: var(--red); border: none; color: #fff; border-radius: 24px; cursor: pointer; font-weight: 600; }
        </style>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <div>
                <h3 style="font-size: 18px; margin-bottom: 4px;">ðŸ’¬ All Conversations</h3>
                <p style="color: rgba(255,255,255,0.5); font-size: 13px;">Unified inbox for all customer communications</p>
            </div>
            <div style="display: flex; gap: 8px;">
                <span style="background: #ef4444; color: #fff; padding: 6px 12px; border-radius: 100px; font-size: 12px; font-weight: 600;">${unreadCount} Unread</span>
                <button onclick="composeNewMessage()" style="padding: 8px 16px; background: var(--red); border: none; color: #fff; border-radius: 8px; cursor: pointer; font-weight: 600;">âœ‰ï¸ Compose</button>
            </div>
        </div>

        <div class="conv-container">
            <!-- Sidebar: Contact List -->
            <div class="conv-sidebar">
                <div class="conv-filters">
                    <button class="conv-filter ${conversationFilter === 'all' ? 'active' : ''}" onclick="setConversationFilter('all')">All</button>
                    <button class="conv-filter ${conversationFilter === 'sms' ? 'active' : ''}" onclick="setConversationFilter('sms')">ðŸ“± SMS</button>
                    <button class="conv-filter ${conversationFilter === 'email' ? 'active' : ''}" onclick="setConversationFilter('email')">âœ‰ï¸ Email</button>
                    <button class="conv-filter ${conversationFilter === 'call' ? 'active' : ''}" onclick="setConversationFilter('call')">ðŸ“ž Calls</button>
                    <button class="conv-filter ${conversationFilter === 'proof_system' ? 'active' : ''}" onclick="setConversationFilter('proof_system')">âœ… Proofs</button>
                    <button class="conv-filter ${conversationFilter === 'social' ? 'active' : ''}" onclick="setConversationFilter('social')">ðŸ’¬ Social</button>
                </div>
                <div class="conv-list">
                    ${sortedContacts.length === 0 ? `
                        <div style="padding: 40px; text-align: center; color: rgba(255,255,255,0.3);">
                            <div style="font-size: 32px; margin-bottom: 8px;">ðŸ’¬</div>
                            <div>No conversations yet</div>
                        </div>
                    ` : sortedContacts.map(item => {
                        const latestMsg = item.messages[item.messages.length - 1];
                        const unread = item.messages.some(m => !m.read);
                        const isActive = selectedConversationContact === (item.contact?.id || item.contact?.clientId);
                        return `
                            <div class="conv-item ${isActive ? 'active' : ''} ${unread ? 'unread' : ''}" onclick="selectConversation(${item.contact?.id || item.contact?.clientId || 0})">
                                <div style="display: flex; gap: 12px;">
                                    <div class="conv-avatar" style="background: ${getChannelColor(latestMsg?.channel)};">${(item.contact?.name || 'U').charAt(0)}</div>
                                    <div style="flex: 1; min-width: 0;">
                                        <div class="conv-item-header">
                                            <span class="conv-item-name">${item.contact?.name || 'Unknown'}</span>
                                            <span class="conv-item-time">${formatRelativeTime(latestMsg?.createdAt)}</span>
                                        </div>
                                        <div class="conv-item-preview">${latestMsg?.message || latestMsg?.text || 'No messages'}</div>
                                        <div class="conv-item-badge" style="background: ${getChannelColor(latestMsg?.channel)}20; color: ${getChannelColor(latestMsg?.channel)};">
                                            ${getChannelIcon(latestMsg?.channel)} ${latestMsg?.channel || 'message'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>

            <!-- Main: Conversation View -->
            <div class="conv-main">
                ${selectedConversationContact ? renderConversationDetail(selectedConversationContact) : `
                    <div class="conv-empty">
                        <div style="text-align: center;">
                            <div style="font-size: 64px; margin-bottom: 16px;">ðŸ’¬</div>
                            <div style="font-size: 18px; margin-bottom: 8px;">Select a conversation</div>
                            <div style="font-size: 14px; color: rgba(255,255,255,0.4);">Choose a contact from the list to view messages</div>
                        </div>
                    </div>
                `}
            </div>
        </div>
    `;
}

function getAllCommunications() {
    const comms = [];

    // Get stored communications
    const storedComms = JSON.parse(localStorage.getItem('nui_crm_communications')) || [];
    comms.push(...storedComms);

    // Get SMS conversations
    const smsConvos = JSON.parse(localStorage.getItem('nui_sms_conversations')) || [];
    smsConvos.forEach(convo => {
        (convo.messages || []).forEach(msg => {
            comms.push({
                id: msg.id || Date.now(),
                clientId: convo.clientId,
                contactId: convo.clientId,
                channel: 'sms',
                message: msg.text,
                direction: msg.direction || (msg.from === 'client' ? 'inbound' : 'outbound'),
                createdAt: msg.time || msg.createdAt,
                read: true
            });
        });
    });

    // Get email campaigns/interactions
    const emailCampaigns = JSON.parse(localStorage.getItem('nui_email_campaigns')) || [];
    emailCampaigns.forEach(campaign => {
        if (campaign.sentAt) {
            comms.push({
                id: campaign.id,
                channel: 'email',
                message: `Campaign: ${campaign.name} - ${campaign.subject}`,
                direction: 'outbound',
                createdAt: campaign.sentAt,
                read: true,
                isCampaign: true
            });
        }
    });

    // Get proof comments
    proofs.forEach(proof => {
        (proof.comments || []).forEach(comment => {
            comms.push({
                id: Date.now() + Math.random(),
                clientId: proof.clientId,
                channel: 'proof_system',
                message: `[${proof.name}] ${comment.text}`,
                direction: comment.author === 'Admin' ? 'outbound' : 'inbound',
                createdAt: comment.createdAt,
                read: true,
                proofId: proof.id
            });
        });
    });

    // Get social DM conversations
    const socialDMs = JSON.parse(localStorage.getItem('nui_social_dms')) || [];
    socialDMs.forEach(dm => {
        (dm.messages || []).forEach(msg => {
            comms.push({
                id: msg.id || Date.now(),
                contactId: dm.contactId,
                contactName: dm.contactName,
                channel: 'social',
                platform: dm.platform,
                message: msg.text,
                direction: msg.from === 'them' ? 'inbound' : 'outbound',
                createdAt: msg.time,
                read: true
            });
        });
    });

    // Sort by date
    return comms.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
}

function getContactInfo(contactId) {
    const client = clients.find(c => c.id === contactId);
    if (client) return { id: client.id, name: client.name, email: client.email, phone: client.phone };

    const contact = crmData.contacts.find(c => c.id === contactId);
    if (contact) return contact;

    return { id: contactId, name: 'Unknown', email: '' };
}

function getChannelColor(channel) {
    const colors = { sms: '#10b981', email: '#3b82f6', call: '#8b5cf6', proof_system: '#f59e0b', social: '#ec4899' };
    return colors[channel] || '#666';
}

function getChannelIcon(channel) {
    const icons = { sms: 'ðŸ“±', email: 'âœ‰ï¸', call: 'ðŸ“ž', proof_system: 'âœ…', social: 'ðŸ’¬' };
    return icons[channel] || 'ðŸ’¬';
}

function formatRelativeTime(dateStr) {
    if (!dateStr) return '';
    const date = new Date(dateStr);
    const now = new Date();
    const diff = now - date;
    const mins = Math.floor(diff / 60000);
    const hours = Math.floor(diff / 3600000);
    const days = Math.floor(diff / 86400000);

    if (mins < 1) return 'Just now';
    if (mins < 60) return mins + 'm ago';
    if (hours < 24) return hours + 'h ago';
    if (days < 7) return days + 'd ago';
    return date.toLocaleDateString();
}

function setConversationFilter(filter) {
    conversationFilter = filter;
    loadAdminCrmPanel();
}

function selectConversation(contactId) {
    selectedConversationContact = contactId;
    // Mark messages as read
    const comms = JSON.parse(localStorage.getItem('nui_crm_communications')) || [];
    comms.forEach(c => {
        if (c.clientId === contactId || c.contactId === contactId) c.read = true;
    });
    localStorage.setItem('nui_crm_communications', JSON.stringify(comms));
    loadAdminCrmPanel();
}

function renderConversationDetail(contactId) {
    const contact = getContactInfo(contactId);
    const allComms = getAllCommunications();
    const contactComms = allComms.filter(c => c.clientId === contactId || c.contactId === contactId);

    return `
        <div class="conv-header" style="display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div class="conv-avatar" style="background: var(--red);">${(contact.name || 'U').charAt(0)}</div>
                <div>
                    <div style="font-weight: 600; font-size: 16px;">${contact.name || 'Unknown'}</div>
                    <div style="font-size: 13px; color: rgba(255,255,255,0.5);">${contact.email || contact.phone || ''}</div>
                </div>
            </div>
            <div style="display: flex; gap: 8px;">
                <button onclick="quickSms(${contactId})" style="padding: 8px 12px; background: #10b981; border: none; color: #fff; border-radius: 6px; cursor: pointer;">ðŸ“± SMS</button>
                <button onclick="quickEmail(${contactId})" style="padding: 8px 12px; background: #3b82f6; border: none; color: #fff; border-radius: 6px; cursor: pointer;">âœ‰ï¸ Email</button>
                <button onclick="quickCall(${contactId})" style="padding: 8px 12px; background: #8b5cf6; border: none; color: #fff; border-radius: 6px; cursor: pointer;">ðŸ“ž Call</button>
            </div>
        </div>

        <div class="conv-messages">
            ${contactComms.reverse().map(msg => `
                <div class="conv-message ${msg.direction}">
                    <div class="conv-message-bubble">${msg.message || msg.text}</div>
                    <div class="conv-message-meta">
                        <span>${getChannelIcon(msg.channel)} ${msg.channel}</span>
                        <span>${new Date(msg.createdAt).toLocaleString()}</span>
                    </div>
                </div>
            `).join('') || '<div style="text-align: center; color: rgba(255,255,255,0.3); padding: 40px;">No messages with this contact</div>'}
        </div>

        <div class="conv-input">
            <select id="messageChannel" style="width: 100px;">
                <option value="sms">ðŸ“± SMS</option>
                <option value="email">âœ‰ï¸ Email</option>
            </select>
            <input type="text" id="newMessageInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendConversationMessage(${contactId})">
            <button onclick="sendConversationMessage(${contactId})">Send</button>
        </div>
    `;
}

function sendConversationMessage(contactId) {
    const channel = document.getElementById('messageChannel').value;
    const message = document.getElementById('newMessageInput').value.trim();

    if (!message) return;

    const comms = JSON.parse(localStorage.getItem('nui_crm_communications')) || [];
    comms.push({
        id: Date.now(),
        clientId: contactId,
        contactId: contactId,
        channel: channel,
        message: message,
        direction: 'outbound',
        createdAt: new Date().toISOString(),
        read: true
    });
    localStorage.setItem('nui_crm_communications', JSON.stringify(comms));

    document.getElementById('newMessageInput').value = '';
    loadAdminCrmPanel();
}

function composeNewMessage() {
    const modal = document.createElement('div');
    modal.id = 'composeModal';
    modal.innerHTML = `
        <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999;">
            <div style="background: #1a1a1a; border-radius: 16px; padding: 32px; max-width: 500px; width: 100%;">
                <h2 style="font-size: 20px; margin-bottom: 24px;">âœ‰ï¸ Compose Message</h2>

                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 14px; margin-bottom: 8px;">To</label>
                    <select id="composeRecipient" style="width: 100%; padding: 12px; background: #252525; border: 1px solid #333; border-radius: 8px; color: #fff;">
                        <option value="">Select contact...</option>
                        ${clients.map(c => `<option value="${c.id}">${c.name} (${c.email})</option>`).join('')}
                    </select>
                </div>

                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 14px; margin-bottom: 8px;">Channel</label>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="setComposeChannel('sms')" id="ch_sms" style="flex: 1; padding: 12px; background: #10b981; border: none; color: #fff; border-radius: 8px; cursor: pointer;">ðŸ“± SMS</button>
                        <button onclick="setComposeChannel('email')" id="ch_email" style="flex: 1; padding: 12px; background: #333; border: none; color: #fff; border-radius: 8px; cursor: pointer;">âœ‰ï¸ Email</button>
                    </div>
                </div>

                <div id="emailSubjectField" style="display: none; margin-bottom: 16px;">
                    <label style="display: block; font-size: 14px; margin-bottom: 8px;">Subject</label>
                    <input type="text" id="composeSubject" placeholder="Email subject..." style="width: 100%; padding: 12px; background: #252525; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>

                <div style="margin-bottom: 24px;">
                    <label style="display: block; font-size: 14px; margin-bottom: 8px;">Message</label>
                    <textarea id="composeMessage" rows="4" placeholder="Type your message..." style="width: 100%; padding: 12px; background: #252525; border: 1px solid #333; border-radius: 8px; color: #fff; resize: none;"></textarea>
                </div>

                <div style="display: flex; gap: 12px;">
                    <button onclick="document.getElementById('composeModal').remove()" style="flex: 1; padding: 12px; background: #333; border: none; color: #fff; border-radius: 8px; cursor: pointer;">Cancel</button>
                    <button onclick="sendComposedMessage()" style="flex: 1; padding: 12px; background: var(--red); border: none; color: #fff; border-radius: 8px; cursor: pointer; font-weight: 600;">Send Message</button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

let composeChannel = 'sms';

function setComposeChannel(channel) {
    composeChannel = channel;
    document.getElementById('ch_sms').style.background = channel === 'sms' ? '#10b981' : '#333';
    document.getElementById('ch_email').style.background = channel === 'email' ? '#3b82f6' : '#333';
    document.getElementById('emailSubjectField').style.display = channel === 'email' ? 'block' : 'none';
}

function sendComposedMessage() {
    const recipientId = parseInt(document.getElementById('composeRecipient').value);
    const message = document.getElementById('composeMessage').value.trim();
    const subject = document.getElementById('composeSubject')?.value.trim() || '';

    if (!recipientId) { alert('Please select a recipient.'); return; }
    if (!message) { alert('Please enter a message.'); return; }

    const comms = JSON.parse(localStorage.getItem('nui_crm_communications')) || [];
    comms.push({
        id: Date.now(),
        clientId: recipientId,
        contactId: recipientId,
        channel: composeChannel,
        message: composeChannel === 'email' && subject ? `[${subject}] ${message}` : message,
        direction: 'outbound',
        createdAt: new Date().toISOString(),
        read: true
    });
    localStorage.setItem('nui_crm_communications', JSON.stringify(comms));

    document.getElementById('composeModal').remove();
    selectedConversationContact = recipientId;
    loadAdminCrmPanel();

    alert(`âœ… ${composeChannel === 'sms' ? 'SMS' : 'Email'} sent!`);
}

// Drag and Drop for Pipeline
let draggedContactId = null;

function handleDragStart(e, contactId) {
    draggedContactId = contactId;
    e.target.classList.add('dragging');
    e.dataTransfer.effectAllowed = 'move';
}

function handleDragEnd(e) {
    e.target.classList.remove('dragging');
    document.querySelectorAll('.pipeline-col-body').forEach(col => col.classList.remove('drag-over'));
}

function handleDragOver(e) {
    e.preventDefault();
    e.currentTarget.classList.add('drag-over');
}

function handleDragLeave(e) {
    e.currentTarget.classList.remove('drag-over');
}

function handleDrop(e, stageId) {
    e.preventDefault();
    e.currentTarget.classList.remove('drag-over');
    if (draggedContactId) {
        moveContactStage(draggedContactId, stageId);
        draggedContactId = null;
    }
}

function moveContactStage(contactId, newStage) {
    const contact = crmData.contacts.find(c => c.id === contactId);
    if (contact) {
        const oldStage = crmData.pipelines.find(p => p.id === contact.stage)?.name;
        const newStageName = crmData.pipelines.find(p => p.id === newStage)?.name;
        contact.stage = newStage;
        contact.lastActivity = new Date().toISOString();

        // Log the stage change
        if (!crmData.activityLog) crmData.activityLog = [];
        crmData.activityLog.push({
            id: Date.now(),
            contactId: contactId,
            type: 'stage_change',
            from: oldStage,
            to: newStageName,
            timestamp: new Date().toISOString()
        });

        saveCrm();
        loadAdminCrmPanel();
        console.log('âœ… Contact moved: ' + contact.name + ' â†’ ' + newStageName);
    }
}

// Quick Actions
function quickSms(contactId) {
    const contact = crmData.contacts.find(c => c.id === contactId);
    if (!contact?.phone) { alert('No phone number for this contact'); return; }

    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'quickSmsModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header"><h3 class="modal-title">ðŸ’¬ Send SMS to ${contact.name}</h3><button class="modal-close" onclick="document.getElementById('quickSmsModal').remove()">Ã—</button></div>
            <div class="modal-body">
                <p style="color: rgba(255,255,255,0.5); margin-bottom: 16px;">To: ${contact.phone}</p>
                <div class="form-group">
                    <label class="form-label">Template</label>
                    <select class="form-select" onchange="document.getElementById('quickSmsText').value = this.options[this.selectedIndex].dataset.msg || ''">
                        <option value="">-- Select Template --</option>
                        ${smsSystem.templates.map(t => '<option data-msg="' + t.message.replace(/{name}/g, contact.name) + '">' + t.name + '</option>').join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Message</label>
                    <textarea id="quickSmsText" class="form-textarea" rows="4" placeholder="Type your message..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-admin secondary" onclick="document.getElementById('quickSmsModal').remove()">Cancel</button>
                <button class="btn-admin primary" onclick="sendQuickSms(${contactId})" style="background: #10b981;">Send SMS</button>
            </div>
        </div>`;
    document.body.appendChild(modal);
}

function sendQuickSms(contactId) {
    const contact = crmData.contacts.find(c => c.id === contactId);
    const message = document.getElementById('quickSmsText').value;
    if (!message) { alert('Please enter a message'); return; }

    // Add to SMS conversations
    let convo = smsSystem.conversations.find(c => c.clientId === contactId || c.phone === contact.phone);
    if (!convo) {
        convo = { id: Date.now(), clientId: contactId, clientName: contact.name, phone: contact.phone, messages: [], lastMessage: null, unread: 0 };
        smsSystem.conversations.push(convo);
    }
    convo.messages.push({ id: Date.now(), direction: 'outbound', text: message, timestamp: new Date().toISOString(), status: 'sent' });
    convo.lastMessage = new Date().toISOString();
    saveSms();

    // Log activity
    logContactActivity(contactId, 'sms', message);

    document.getElementById('quickSmsModal').remove();
    alert('SMS sent to ' + contact.name + '!');
}

function quickEmail(contactId) {
    const contact = crmData.contacts.find(c => c.id === contactId);
    if (!contact?.email) { alert('No email for this contact'); return; }

    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'quickEmailModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header"><h3 class="modal-title">ðŸ“§ Send Email to ${contact.name}</h3><button class="modal-close" onclick="document.getElementById('quickEmailModal').remove()">Ã—</button></div>
            <div class="modal-body">
                <p style="color: rgba(255,255,255,0.5); margin-bottom: 16px;">To: ${contact.email}</p>
                <div class="form-group">
                    <label class="form-label">Subject</label>
                    <input type="text" id="quickEmailSubject" class="form-input" placeholder="Email subject...">
                </div>
                <div class="form-group">
                    <label class="form-label">Message</label>
                    <textarea id="quickEmailText" class="form-textarea" rows="6" placeholder="Hi ${contact.name},\n\n"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-admin secondary" onclick="document.getElementById('quickEmailModal').remove()">Cancel</button>
                <button class="btn-admin primary" onclick="sendQuickEmail(${contactId})" style="background: #3b82f6;">Send Email</button>
            </div>
        </div>`;
    document.body.appendChild(modal);
}

function sendQuickEmail(contactId) {
    const contact = crmData.contacts.find(c => c.id === contactId);
    const subject = document.getElementById('quickEmailSubject').value;
    const message = document.getElementById('quickEmailText').value;
    if (!subject || !message) { alert('Please enter subject and message'); return; }

    // Log activity
    logContactActivity(contactId, 'email', subject + ': ' + message.substring(0, 100));

    // Simulate sending
    simulateEmailNotification(contact.email, subject, message);

    document.getElementById('quickEmailModal').remove();
    alert('Email sent to ' + contact.name + '!');
}

function quickCall(contactId) {
    const contact = crmData.contacts.find(c => c.id === contactId);
    if (!contact?.phone) { alert('No phone number for this contact'); return; }

    // Log call attempt
    logContactActivity(contactId, 'call', 'Called ' + contact.phone);

    // Open phone dialer
    window.open('tel:' + contact.phone, '_self');
}

function logContactActivity(contactId, type, details) {
    if (!crmData.activityLog) crmData.activityLog = [];
    crmData.activityLog.push({
        id: Date.now(),
        contactId: contactId,
        type: type,
        details: details,
        timestamp: new Date().toISOString()
    });
    saveCrm();
}

// Smart Groups
function getSmartGroupContacts(group) {
    const filter = group.filter;
    let contacts = [...crmData.contacts];

    if (filter.type === 'all') return contacts;
    if (filter.type === 'stage') {
        contacts = contacts.filter(c => filter.stages.includes(c.stage));
    }
    if (filter.type === 'value') {
        contacts = contacts.filter(c => (c.value || 0) >= (filter.min || 0));
    }
    if (filter.type === 'date') {
        const cutoff = new Date(Date.now() - (filter.days || 7) * 24 * 60 * 60 * 1000);
        contacts = contacts.filter(c => new Date(c.createdAt) >= cutoff);
    }
    if (filter.hasPhone) {
        contacts = contacts.filter(c => c.phone);
    }
    if (filter.hasEmail) {
        contacts = contacts.filter(c => c.email);
    }
    return contacts;
}

function getSmartGroupDescription(group) {
    const filter = group.filter;
    if (filter.type === 'all') return 'All contacts in your CRM';
    if (filter.type === 'stage') return 'Contacts in ' + filter.stages.map(s => crmData.pipelines.find(p => p.id === s)?.name).join(', ');
    if (filter.type === 'value') return 'Contacts with deals $' + (filter.min || 0).toLocaleString() + '+';
    if (filter.type === 'date') return 'Added in last ' + filter.days + ' days';
    return 'Custom filter';
}

function showCreateSmartGroupModal() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'smartGroupModal';
    modal.innerHTML = `
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">Create Smart Group</h3><button class="modal-close" onclick="document.getElementById('smartGroupModal').remove()">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Group Name</label><input type="text" id="sgName" class="form-input" placeholder="e.g., Hot Leads"></div>
                <div class="form-group"><label class="form-label">Filter Type</label>
                    <select id="sgFilterType" class="form-select" onchange="updateSmartGroupFilter()">
                        <option value="all">All Contacts</option>
                        <option value="stage">By Pipeline Stage</option>
                        <option value="value">By Deal Value</option>
                        <option value="date">By Date Added</option>
                    </select>
                </div>
                <div id="sgFilterOptions"></div>
                <div class="form-group"><label class="form-label">Color</label>
                    <div style="display: flex; gap: 8px;">
                        ${['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'].map(c => '<div onclick="document.getElementById(\'sgColor\').value=\'' + c + '\'; this.parentElement.querySelectorAll(\'div\').forEach(d=>d.style.border=\'2px solid transparent\'); this.style.border=\'2px solid #fff\';" style="width: 32px; height: 32px; background: ' + c + '; border-radius: 6px; cursor: pointer; border: 2px solid transparent;"></div>').join('')}
                    </div>
                    <input type="hidden" id="sgColor" value="#3b82f6">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-admin secondary" onclick="document.getElementById('smartGroupModal').remove()">Cancel</button>
                <button class="btn-admin primary" onclick="createSmartGroup()">Create Group</button>
            </div>
        </div>`;
    document.body.appendChild(modal);
}

function updateSmartGroupFilter() {
    const type = document.getElementById('sgFilterType').value;
    const container = document.getElementById('sgFilterOptions');

    if (type === 'stage') {
        container.innerHTML = '<div class="form-group"><label class="form-label">Select Stages</label>' + crmData.pipelines.map(p => '<label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;"><input type="checkbox" class="sg-stage" value="' + p.id + '"> ' + p.name + '</label>').join('') + '</div>';
    } else if (type === 'value') {
        container.innerHTML = '<div class="form-group"><label class="form-label">Minimum Value ($)</label><input type="number" id="sgMinValue" class="form-input" placeholder="5000"></div>';
    } else if (type === 'date') {
        container.innerHTML = '<div class="form-group"><label class="form-label">Added within last X days</label><input type="number" id="sgDays" class="form-input" placeholder="7"></div>';
    } else {
        container.innerHTML = '';
    }
}

function createSmartGroup() {
    const name = document.getElementById('sgName').value;
    if (!name) { alert('Please enter a group name'); return; }

    const type = document.getElementById('sgFilterType').value;
    const color = document.getElementById('sgColor').value;

    const filter = { type };
    if (type === 'stage') {
        filter.stages = [...document.querySelectorAll('.sg-stage:checked')].map(cb => parseInt(cb.value));
    } else if (type === 'value') {
        filter.min = parseInt(document.getElementById('sgMinValue').value) || 0;
    } else if (type === 'date') {
        filter.days = parseInt(document.getElementById('sgDays').value) || 7;
    }

    crmSmartGroups.push({ id: Date.now(), name, filter, color });
    saveSmartGroups();
    document.getElementById('smartGroupModal').remove();
    loadAdminCrmPanel();
}

// Bulk Messaging
function bulkSmsGroup(groupId) {
    const group = crmSmartGroups.find(g => g.id === groupId);
    const contacts = getSmartGroupContacts(group).filter(c => c.phone);

    if (contacts.length === 0) { alert('No contacts with phone numbers in this group'); return; }

    switchCrmTab('bulk');
    document.getElementById('bulkSmsGroup').value = groupId;
    alert('Ready to send SMS to ' + contacts.length + ' contacts in "' + group.name + '"');
}

function bulkEmailGroup(groupId) {
    const group = crmSmartGroups.find(g => g.id === groupId);
    const contacts = getSmartGroupContacts(group).filter(c => c.email);

    if (contacts.length === 0) { alert('No contacts with email in this group'); return; }

    switchCrmTab('bulk');
    document.getElementById('bulkEmailGroup').value = groupId;
    alert('Ready to send Email to ' + contacts.length + ' contacts in "' + group.name + '"');
}

function loadSmsTemplate(templateId) {
    const template = smsSystem.templates.find(t => t.id == templateId);
    if (template) document.getElementById('bulkSmsMessage').value = template.message;
}

function loadEmailTemplate(templateId) {
    const template = emailMarketing.templates.find(t => t.id == templateId);
    if (template) {
        document.getElementById('bulkEmailSubject').value = template.subject;
        document.getElementById('bulkEmailMessage').value = template.content || '';
    }
}

function sendBulkSms() {
    const groupId = parseInt(document.getElementById('bulkSmsGroup').value);
    const message = document.getElementById('bulkSmsMessage').value;
    if (!message) { alert('Please enter a message'); return; }

    const group = crmSmartGroups.find(g => g.id === groupId);
    const contacts = getSmartGroupContacts(group).filter(c => c.phone);

    if (contacts.length === 0) { alert('No contacts with phone numbers'); return; }
    if (!confirm('Send SMS to ' + contacts.length + ' contacts?')) return;

    // Simulate sending
    contacts.forEach(contact => {
        const personalizedMsg = message.replace(/{name}/g, contact.name).replace(/{company}/g, contact.company || '');
        console.log('SMS to ' + contact.phone + ': ' + personalizedMsg);
    });

    // Log bulk message
    if (!crmData.bulkMessages) crmData.bulkMessages = [];
    crmData.bulkMessages.push({
        id: Date.now(),
        type: 'sms',
        groupId: groupId,
        groupName: group.name,
        recipients: contacts.length,
        message: message,
        sentAt: new Date().toISOString()
    });
    saveCrm();

    alert('âœ… SMS blast sent to ' + contacts.length + ' contacts!');
    loadAdminCrmPanel();
}

function sendBulkEmail() {
    const groupId = parseInt(document.getElementById('bulkEmailGroup').value);
    const subject = document.getElementById('bulkEmailSubject').value;
    const message = document.getElementById('bulkEmailMessage').value;
    if (!subject || !message) { alert('Please enter subject and message'); return; }

    const group = crmSmartGroups.find(g => g.id === groupId);
    const contacts = getSmartGroupContacts(group).filter(c => c.email);

    if (contacts.length === 0) { alert('No contacts with email'); return; }
    if (!confirm('Send email to ' + contacts.length + ' contacts?')) return;

    // Create email campaign
    emailMarketing.campaigns.push({
        id: Date.now(),
        name: 'CRM Blast: ' + group.name,
        status: 'sent',
        sentAt: new Date().toISOString(),
        recipients: contacts.length,
        opened: 0,
        clicked: 0,
        createdAt: new Date().toISOString()
    });
    saveEmailMarketing();

    // Log bulk message
    if (!crmData.bulkMessages) crmData.bulkMessages = [];
    crmData.bulkMessages.push({
        id: Date.now(),
        type: 'email',
        groupId: groupId,
        groupName: group.name,
        recipients: contacts.length,
        subject: subject,
        sentAt: new Date().toISOString()
    });
    saveCrm();

    alert('âœ… Email blast sent to ' + contacts.length + ' contacts!');
    loadAdminCrmPanel();
}

function filterCrmContacts(query) {
    const rows = document.querySelectorAll('#crmContactsTableBody tr');
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(query.toLowerCase()) ? '' : 'none';
    });
}

function toggleAllContacts(checked) {
    document.querySelectorAll('.contact-checkbox').forEach(cb => cb.checked = checked);
}

function showAddContactModal() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'contactModal';
    modal.innerHTML = `
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">Add Contact</h3><button class="modal-close" onclick="document.getElementById('contactModal').remove()">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Name *</label><input type="text" id="contactName" class="form-input" placeholder="John Doe"></div>
                <div class="form-group"><label class="form-label">Email</label><input type="email" id="contactEmail" class="form-input" placeholder="john@company.com"></div>
                <div class="form-group"><label class="form-label">Company</label><input type="text" id="contactCompany" class="form-input" placeholder="Company Name"></div>
                <div class="form-group"><label class="form-label">Phone</label><input type="tel" id="contactPhone" class="form-input" placeholder="(313) 555-0100"></div>
                <div class="form-group"><label class="form-label">Deal Value ($)</label><input type="number" id="contactValue" class="form-input" placeholder="5000"></div>
                <div class="form-group"><label class="form-label">Stage</label><select id="contactStage" class="form-select">${crmData.pipelines.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}</select></div>
                <div class="form-group"><label class="form-label">Notes</label><textarea id="contactNotes" class="form-textarea" placeholder="Additional notes..."></textarea></div>
            </div>
            <div class="modal-footer"><button class="btn-admin secondary" onclick="document.getElementById('contactModal').remove()">Cancel</button><button class="btn-admin primary" onclick="saveContact()">Save Contact</button></div>
        </div>
    `;
    document.body.appendChild(modal);
}

function saveContact() {
    const contact = {
        id: Date.now(),
        name: document.getElementById('contactName').value,
        email: document.getElementById('contactEmail').value,
        company: document.getElementById('contactCompany').value,
        phone: document.getElementById('contactPhone').value,
        value: parseInt(document.getElementById('contactValue').value) || 0,
        stage: parseInt(document.getElementById('contactStage').value),
        notes: document.getElementById('contactNotes').value,
        createdAt: new Date().toISOString()
    };
    crmData.contacts.push(contact);
    saveCrm();
    document.getElementById('contactModal').remove();
    loadAdminCrmPanel();
}

function editContact(id) {
    const contact = crmData.contacts.find(c => c.id === id);
    if (!contact) return;
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'contactModal';
    modal.innerHTML = `
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">Edit Contact</h3><button class="modal-close" onclick="document.getElementById('contactModal').remove()">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Name *</label><input type="text" id="contactName" class="form-input" value="${contact.name}"></div>
                <div class="form-group"><label class="form-label">Email</label><input type="email" id="contactEmail" class="form-input" value="${contact.email || ''}"></div>
                <div class="form-group"><label class="form-label">Company</label><input type="text" id="contactCompany" class="form-input" value="${contact.company || ''}"></div>
                <div class="form-group"><label class="form-label">Phone</label><input type="tel" id="contactPhone" class="form-input" value="${contact.phone || ''}"></div>
                <div class="form-group"><label class="form-label">Deal Value ($)</label><input type="number" id="contactValue" class="form-input" value="${contact.value || 0}"></div>
                <div class="form-group"><label class="form-label">Stage</label><select id="contactStage" class="form-select">${crmData.pipelines.map(p => `<option value="${p.id}" ${contact.stage === p.id ? 'selected' : ''}>${p.name}</option>`).join('')}</select></div>
                <div class="form-group"><label class="form-label">Notes</label><textarea id="contactNotes" class="form-textarea">${contact.notes || ''}</textarea></div>
            </div>
            <div class="modal-footer"><button class="btn-admin danger" onclick="deleteContact(${id})">Delete</button><button class="btn-admin secondary" onclick="document.getElementById('contactModal').remove()">Cancel</button><button class="btn-admin primary" onclick="updateContact(${id})">Update</button></div>
        </div>
    `;
    document.body.appendChild(modal);
}

function updateContact(id) {
    const idx = crmData.contacts.findIndex(c => c.id === id);
    if (idx === -1) return;
    crmData.contacts[idx] = { ...crmData.contacts[idx], name: document.getElementById('contactName').value, email: document.getElementById('contactEmail').value, company: document.getElementById('contactCompany').value, phone: document.getElementById('contactPhone').value, value: parseInt(document.getElementById('contactValue').value) || 0, stage: parseInt(document.getElementById('contactStage').value), notes: document.getElementById('contactNotes').value };
    saveCrm();
    document.getElementById('contactModal').remove();
    loadAdminCrmPanel();
}

function deleteContact(id) {
    if (!confirm('Delete this contact?')) return;
    crmData.contacts = crmData.contacts.filter(c => c.id !== id);
    saveCrm();
    document.getElementById('contactModal').remove();
    loadAdminCrmPanel();
}

// ==================== PROJECTS PANEL ====================
function loadAdminProjectsPanel() {
    const projectStages = ['Discovery', 'Design', 'Development', 'Review', 'Delivery', 'Complete'];
    document.getElementById('adminProjectsPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ“‚ Project Tracker</h1>
            <p class="panel-subtitle">Track project progress, timers, and payments</p>
        </div>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Active Projects</div>
                <div class="stat-value">${projects.filter(p => p.stage !== 'Complete').length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Completed</div>
                <div class="stat-value" style="color: #2a9d8f;">${projects.filter(p => p.stage === 'Complete').length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Value</div>
                <div class="stat-value">$${projects.reduce((s, p) => s + (p.totalAmount || 0), 0).toLocaleString()}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">This Month</div>
                <div class="stat-value">${projects.filter(p => new Date(p.createdAt).getMonth() === new Date().getMonth()).length}</div>
            </div>
        </div>

        <div style="display: flex; justify-content: flex-end; margin-bottom: 24px;">
            <button class="btn-admin primary" onclick="showAddProjectModal()">+ New Project</button>
        </div>
        ${projects.length === 0 ? '<div class="form-section" style="text-align: center; padding: 60px;"><p style="color: rgba(255,255,255,0.5);">No projects yet. Create your first project!</p></div>' : projects.map(project => {
            const client = crmData.clients?.find(c => c.id === project.clientId) || clients.find(c => c.id === project.clientId) || { name: 'Unknown' };
            const stageIdx = projectStages.indexOf(project.stage || 'Discovery');
            const progress = Math.round(((stageIdx + 1) / projectStages.length) * 100);
            const timeTracked = project.timeTracked || 0;
            const hours = Math.floor(timeTracked / 3600);
            const mins = Math.floor((timeTracked % 3600) / 60);
            const pkg = servicePackages.find(p => p.id === project.packageId) || { name: project.type || 'Custom' };
            const plan = paymentPlans[project.paymentPlan] || { name: 'Full Payment' };

            return `
                <div class="order-card" style="position: relative;">
                    <!-- Timer Badge -->
                    <div style="position: absolute; top: 16px; right: 16px; background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 20px; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 12px; opacity: 0.7;">â±ï¸</span>
                        <span id="timer-${project.id}" style="font-family: monospace; font-size: 14px;">${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}:00</span>
                        <button class="timer-btn ${project.timerRunning ? 'active' : ''}" onclick="toggleProjectTimer(${project.id})" style="background: ${project.timerRunning ? 'var(--red)' : 'rgba(255,255,255,0.2)'}; border: none; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; color: #fff; font-size: 12px;">
                            ${project.timerRunning ? 'â¸' : 'â–¶'}
                        </button>
                    </div>

                    <div class="order-header">
                        <div>
                            <div class="order-title">${project.name}</div>
                            <div class="order-client">${client.name}</div>
                            <div style="margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap;">
                                <span class="tag">${pkg.name}</span>
                                ${project.totalAmount ? `<span class="tag" style="background: rgba(42, 157, 143, 0.2); color: #2a9d8f;">$${project.totalAmount.toLocaleString()}</span>` : ''}
                                <span class="tag" style="background: rgba(230, 57, 70, 0.2);">${plan.name}</span>
                            </div>
                        </div>
                        <span class="order-status ${project.stage === 'Complete' ? 'approved' : 'in_progress'}">${project.stage || 'Discovery'}</span>
                    </div>
                    <div class="project-stages">
                        ${projectStages.map((stage, i) => `<div class="project-stage ${i <= stageIdx ? (i < stageIdx ? 'completed' : 'active') : ''}">${stage}</div>`).join('')}
                    </div>
                    <div style="margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 13px; color: rgba(255,255,255,0.5);">Progress</span>
                            <span style="font-size: 13px; font-weight: 600;">${progress}%</span>
                        </div>
                        <div class="progress-bar"><div class="progress-fill" style="width: ${progress}%"></div></div>
                    </div>

                    <!-- Payment Progress -->
                    ${project.paymentPlan && project.paymentPlan !== 'full' ? `
                    <div style="margin-bottom: 16px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 12px; opacity: 0.7;">ðŸ’³ Payment Progress</span>
                            <span style="font-size: 12px;">${project.paidInstallments || 0}/${paymentPlans[project.paymentPlan]?.installments || 3} paid</span>
                        </div>
                        <div style="display: flex; gap: 4px;">
                            ${paymentPlans[project.paymentPlan]?.schedule?.map((pct, i) => `
                                <div style="flex: ${pct}; height: 6px; background: ${i < (project.paidInstallments || 0) ? '#2a9d8f' : 'rgba(255,255,255,0.1)'}; border-radius: 3px;"></div>
                            `).join('') || ''}
                        </div>
                    </div>
                    ` : ''}

                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="btn-admin secondary" onclick="editProject(${project.id})">Edit</button>
                        <button class="btn-admin secondary" onclick="viewProjectDetails(${project.id})">ðŸ“Š Details</button>
                        <button class="btn-admin primary" onclick="advanceProject(${project.id})">Advance Stage â†’</button>
                    </div>
                </div>
            `;
        }).join('')}
    `;

    // Start running timers
    projects.filter(p => p.timerRunning).forEach(p => startTimerInterval(p.id));
}

function showAddProjectModal() {
    const allClients = [...(crmData.clients || []), ...clients];
    const uniqueClients = allClients.filter((c, i, arr) => arr.findIndex(x => x.id === c.id) === i);

    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'projectModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header"><h3 class="modal-title">New Project</h3><button class="modal-close" onclick="document.getElementById('projectModal').remove()">Ã—</button></div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Project Name *</label>
                        <input type="text" id="projectName" class="form-input" placeholder="Brand Identity Package">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Client *</label>
                        <select id="projectClient" class="form-select">
                            <option value="">Select client...</option>
                            ${uniqueClients.map(c => `<option value="${c.id}">${c.name} ${c.company ? '- ' + c.company : ''}</option>`).join('')}
                        </select>
                    </div>
                </div>

                <!-- Package Selection -->
                <div class="form-section" style="margin-top: 16px;">
                    <div class="form-section-title">ðŸ“¦ Select Package</div>
                    <div class="form-group">
                        <label class="form-label">Service Package</label>
                        <select id="projectPackage" class="form-select" onchange="updateProjectPrice()">
                            <option value="">-- Select Package --</option>
                            ${servicePackages.map(pkg => `
                                <option value="${pkg.id}" data-price="${pkg.price}" data-turnaround="${pkg.turnaround}">
                                    ${pkg.name} - $${pkg.price.toLocaleString()} (${pkg.turnaround})
                                </option>
                            `).join('')}
                            <option value="custom">Custom / Individual Services</option>
                        </select>
                    </div>
                    <div id="packageInfo" style="display: none; padding: 12px; background: rgba(42, 157, 143, 0.1); border-radius: 8px; margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong id="selectedPackageName"></strong>
                                <p id="selectedPackageDesc" style="font-size: 13px; opacity: 0.7; margin-top: 4px;"></p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 24px; font-weight: 600; color: #2a9d8f;">$<span id="selectedPackagePrice">0</span></div>
                                <div style="font-size: 12px; opacity: 0.7;" id="selectedPackageTurnaround"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Individual Services (shown when custom selected) -->
                <div id="individualServicesSection" style="display: none;" class="form-section">
                    <div class="form-section-title">ðŸ› ï¸ Individual Services</div>
                    <p style="font-size: 13px; color: rgba(255,255,255,0.5); margin-bottom: 16px;">Select individual services to add to this project:</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        ${individualServices.map(service => `
                            <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='rgba(255,255,255,0.05)'">
                                <input type="checkbox" class="service-checkbox" data-id="${service.id}" data-price="${service.price}" data-name="${service.name}" onchange="updateProjectPrice()">
                                <div style="flex: 1;">
                                    <div style="font-size: 14px;">${service.name}</div>
                                    <div style="font-size: 12px; opacity: 0.7;">${service.category}</div>
                                </div>
                                <span style="font-weight: 600; color: #2a9d8f;">$${service.price}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>

                <!-- Custom Amount Override -->
                <div class="form-group" style="margin-top: 16px;">
                    <label class="form-label">Custom Price Override (optional)</label>
                    <input type="number" id="projectCustomPrice" class="form-input" placeholder="Leave blank to use package/service price" onchange="updateProjectPrice()">
                </div>

                <!-- Payment Plan Selection -->
                <div class="form-section" style="margin-top: 16px;">
                    <div class="form-section-title">ðŸ’³ Payment Plan</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        ${Object.entries(paymentPlans).map(([key, plan]) => `
                            <label style="display: block; padding: 16px; background: rgba(255,255,255,0.05); border-radius: 12px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s;" id="plan-${key}" onclick="selectPaymentPlan('${key}')">
                                <input type="radio" name="paymentPlan" value="${key}" style="display: none;" ${key === 'standard' ? 'checked' : ''}>
                                <div style="font-weight: 600; margin-bottom: 4px;">${plan.name}</div>
                                ${plan.discount > 0 ? `<div style="font-size: 12px; color: #2a9d8f;">Save ${plan.discount}%</div>` : ''}
                                <div style="font-size: 12px; opacity: 0.7; margin-top: 8px;">${plan.schedule.join('% â†’ ')}%</div>
                                ${plan.triggers ? `<div style="font-size: 11px; opacity: 0.5; margin-top: 4px;">${plan.triggers.join(' â†’ ')}</div>` : ''}
                            </label>
                        `).join('')}
                    </div>
                </div>

                <!-- Total Summary -->
                <div style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, rgba(230, 57, 70, 0.1), rgba(29, 53, 87, 0.1)); border-radius: 12px; border: 1px solid rgba(230, 57, 70, 0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 14px; opacity: 0.7;">Project Total</div>
                            <div style="font-size: 11px; opacity: 0.5;" id="paymentBreakdown">50% deposit â†’ 25% on approval â†’ 25% before download</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 32px; font-weight: 700; color: var(--red);">$<span id="projectTotalAmount">0</span></div>
                            <div style="font-size: 12px; opacity: 0.7;" id="discountNote"></div>
                        </div>
                    </div>
                </div>

                <div class="form-row" style="margin-top: 16px;">
                    <div class="form-group">
                        <label class="form-label">Start Date</label>
                        <input type="date" id="projectStart" class="form-input" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="date" id="projectDue" class="form-input">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea id="projectNotes" class="form-textarea" placeholder="Project details, special requirements..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-admin secondary" onclick="document.getElementById('projectModal').remove()">Cancel</button>
                <button class="btn-admin primary" onclick="saveProject()">Create Project</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);

    // Initialize payment plan selection
    selectPaymentPlan('standard');
}

function selectPaymentPlan(planKey) {
    // Update visual selection
    Object.keys(paymentPlans).forEach(key => {
        const el = document.getElementById('plan-' + key);
        if (el) {
            el.style.borderColor = key === planKey ? 'var(--red)' : 'transparent';
            el.style.background = key === planKey ? 'rgba(230, 57, 70, 0.15)' : 'rgba(255,255,255,0.05)';
            el.querySelector('input').checked = key === planKey;
        }
    });

    // Update breakdown text
    const plan = paymentPlans[planKey];
    const breakdown = document.getElementById('paymentBreakdown');
    if (breakdown && plan.triggers) {
        breakdown.textContent = plan.schedule.map((pct, i) => `${pct}% ${plan.triggers[i]}`).join(' â†’ ');
    } else if (breakdown) {
        breakdown.textContent = plan.name;
    }

    updateProjectPrice();
}

function updateProjectPrice() {
    const packageSelect = document.getElementById('projectPackage');
    const customPrice = document.getElementById('projectCustomPrice');
    const totalEl = document.getElementById('projectTotalAmount');
    const packageInfo = document.getElementById('packageInfo');
    const servicesSection = document.getElementById('individualServicesSection');
    const discountNote = document.getElementById('discountNote');

    let total = 0;

    if (packageSelect.value === 'custom') {
        // Show individual services
        servicesSection.style.display = 'block';
        packageInfo.style.display = 'none';

        // Calculate from selected services
        document.querySelectorAll('.service-checkbox:checked').forEach(cb => {
            total += parseFloat(cb.dataset.price) || 0;
        });
    } else if (packageSelect.value) {
        // Show package info
        servicesSection.style.display = 'none';
        packageInfo.style.display = 'block';

        const pkg = servicePackages.find(p => p.id === packageSelect.value);
        if (pkg) {
            document.getElementById('selectedPackageName').textContent = pkg.name;
            document.getElementById('selectedPackageDesc').textContent = pkg.desc;
            document.getElementById('selectedPackagePrice').textContent = pkg.price.toLocaleString();
            document.getElementById('selectedPackageTurnaround').textContent = pkg.turnaround;
            total = pkg.price;
        }
    } else {
        servicesSection.style.display = 'none';
        packageInfo.style.display = 'none';
    }

    // Override with custom price if provided
    if (customPrice.value) {
        total = parseFloat(customPrice.value);
    }

    // Apply discount based on payment plan
    const selectedPlan = document.querySelector('input[name="paymentPlan"]:checked')?.value;
    const plan = paymentPlans[selectedPlan];
    if (plan && plan.discount > 0) {
        const discount = total * (plan.discount / 100);
        total = total - discount;
        discountNote.textContent = `${plan.discount}% discount applied`;
    } else {
        discountNote.textContent = '';
    }

    totalEl.textContent = total.toLocaleString();
}

function saveProject() {
    const packageSelect = document.getElementById('projectPackage');
    const pkg = servicePackages.find(p => p.id === packageSelect.value);
    const selectedPlan = document.querySelector('input[name="paymentPlan"]:checked')?.value || 'standard';
    const customPrice = parseFloat(document.getElementById('projectCustomPrice').value);

    // Get selected services if custom
    const selectedServices = [];
    if (packageSelect.value === 'custom') {
        document.querySelectorAll('.service-checkbox:checked').forEach(cb => {
            selectedServices.push({
                id: cb.dataset.id,
                name: cb.dataset.name,
                price: parseFloat(cb.dataset.price)
            });
        });
    }

    // Calculate total
    let totalAmount = 0;
    if (customPrice) {
        totalAmount = customPrice;
    } else if (pkg) {
        totalAmount = pkg.price;
    } else {
        totalAmount = selectedServices.reduce((sum, s) => sum + s.price, 0);
    }

    // Apply discount
    const plan = paymentPlans[selectedPlan];
    if (plan && plan.discount > 0) {
        totalAmount = totalAmount - (totalAmount * (plan.discount / 100));
    }

    const project = {
        id: Date.now(),
        name: document.getElementById('projectName').value,
        clientId: parseInt(document.getElementById('projectClient').value) || null,
        packageId: packageSelect.value !== 'custom' ? packageSelect.value : null,
        package: pkg ? pkg.name : 'Custom',
        type: pkg ? pkg.category : 'Custom',
        services: selectedServices,
        paymentPlan: selectedPlan,
        totalAmount: totalAmount,
        paidInstallments: 0,
        stage: 'Discovery',
        startDate: document.getElementById('projectStart').value,
        dueDate: document.getElementById('projectDue').value,
        notes: document.getElementById('projectNotes').value,
        timeTracked: 0,
        timerRunning: false,
        timerStartedAt: null,
        activityLog: [{
            action: 'Project created',
            timestamp: new Date().toISOString(),
            stage: 'Discovery'
        }],
        createdAt: new Date().toISOString()
    };
    projects.push(project);
    saveProjects();
    document.getElementById('projectModal').remove();
    loadAdminProjectsPanel();
    alert('Project created successfully! Total: $' + totalAmount.toLocaleString());
}

// Timer functionality
let timerIntervals = {};

function toggleProjectTimer(projectId) {
    const project = projects.find(p => p.id === projectId);
    if (!project) return;

    if (project.timerRunning) {
        // Stop timer
        stopProjectTimer(projectId);
    } else {
        // Start timer
        startProjectTimer(projectId);
    }
}

function startProjectTimer(projectId) {
    const project = projects.find(p => p.id === projectId);
    if (!project) return;

    project.timerRunning = true;
    project.timerStartedAt = Date.now();
    saveProjects();

    startTimerInterval(projectId);
    loadAdminProjectsPanel();
}

function stopProjectTimer(projectId) {
    const project = projects.find(p => p.id === projectId);
    if (!project) return;

    // Calculate elapsed time
    if (project.timerStartedAt) {
        const elapsed = Math.floor((Date.now() - project.timerStartedAt) / 1000);
        project.timeTracked = (project.timeTracked || 0) + elapsed;
    }

    project.timerRunning = false;
    project.timerStartedAt = null;

    // Clear interval
    if (timerIntervals[projectId]) {
        clearInterval(timerIntervals[projectId]);
        delete timerIntervals[projectId];
    }

    // Log activity
    project.activityLog = project.activityLog || [];
    project.activityLog.push({
        action: 'Timer stopped',
        timestamp: new Date().toISOString(),
        duration: project.timeTracked
    });

    saveProjects();
    loadAdminProjectsPanel();
}

function startTimerInterval(projectId) {
    if (timerIntervals[projectId]) return;

    timerIntervals[projectId] = setInterval(() => {
        const project = projects.find(p => p.id === projectId);
        if (!project || !project.timerRunning) {
            clearInterval(timerIntervals[projectId]);
            delete timerIntervals[projectId];
            return;
        }

        const elapsed = project.timerStartedAt ? Math.floor((Date.now() - project.timerStartedAt) / 1000) : 0;
        const totalSeconds = (project.timeTracked || 0) + elapsed;
        const hours = Math.floor(totalSeconds / 3600);
        const mins = Math.floor((totalSeconds % 3600) / 60);
        const secs = totalSeconds % 60;

        const timerEl = document.getElementById('timer-' + projectId);
        if (timerEl) {
            timerEl.textContent = `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }
    }, 1000);
}

function viewProjectDetails(projectId) {
    const project = projects.find(p => p.id === projectId);
    if (!project) return;

    const client = crmData.clients?.find(c => c.id === project.clientId) || clients.find(c => c.id === project.clientId) || { name: 'Unknown' };
    const pkg = servicePackages.find(p => p.id === project.packageId) || { name: project.package || 'Custom' };
    const plan = paymentPlans[project.paymentPlan] || { name: 'Full Payment', schedule: [100] };
    const timeTracked = project.timeTracked || 0;
    const hours = Math.floor(timeTracked / 3600);
    const mins = Math.floor((timeTracked % 3600) / 60);

    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'projectDetailsModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header" style="background: var(--red);">
                <h3 class="modal-title" style="color: #fff;">ðŸ“Š ${project.name}</h3>
                <button class="modal-close" onclick="document.getElementById('projectDetailsModal').remove()" style="color: #fff;">Ã—</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <!-- Overview Cards -->
                <div class="stats-grid" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-label">Client</div>
                        <div class="stat-value" style="font-size: 18px;">${client.name}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Package</div>
                        <div class="stat-value" style="font-size: 18px;">${pkg.name}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Value</div>
                        <div class="stat-value" style="color: #2a9d8f;">$${(project.totalAmount || 0).toLocaleString()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Time Tracked</div>
                        <div class="stat-value" style="font-family: monospace;">${hours}h ${mins}m</div>
                    </div>
                </div>

                <!-- Project Timeline -->
                <div class="form-section">
                    <div class="form-section-title">ðŸ“… Timeline</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                        <div style="padding: 16px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 12px; opacity: 0.6;">Start Date</div>
                            <div style="font-size: 16px;">${project.startDate ? new Date(project.startDate).toLocaleDateString() : 'Not set'}</div>
                        </div>
                        <div style="padding: 16px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 12px; opacity: 0.6;">Due Date</div>
                            <div style="font-size: 16px;">${project.dueDate ? new Date(project.dueDate).toLocaleDateString() : 'Not set'}</div>
                        </div>
                        <div style="padding: 16px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 12px; opacity: 0.6;">Current Stage</div>
                            <div style="font-size: 16px;">${project.stage || 'Discovery'}</div>
                        </div>
                    </div>
                </div>

                <!-- Payment Progress -->
                <div class="form-section">
                    <div class="form-section-title">ðŸ’³ Payment Schedule (${plan.name})</div>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        ${plan.schedule.map((pct, i) => {
                            const isPaid = i < (project.paidInstallments || 0);
                            const amount = Math.round((project.totalAmount || 0) * pct / 100);
                            return `
                                <div style="flex: 1; min-width: 150px; padding: 16px; background: ${isPaid ? 'rgba(42, 157, 143, 0.2)' : 'rgba(255,255,255,0.05)'}; border-radius: 12px; border: 2px solid ${isPaid ? '#2a9d8f' : 'transparent'};">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <span style="font-size: 12px; opacity: 0.7;">${plan.triggers?.[i] || `Payment ${i + 1}`}</span>
                                        ${isPaid ? '<span style="color: #2a9d8f;">âœ“</span>' : ''}
                                    </div>
                                    <div style="font-size: 20px; font-weight: 600;">$${amount.toLocaleString()}</div>
                                    <div style="font-size: 12px; opacity: 0.5;">${pct}%</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    ${project.paidInstallments < plan.schedule.length ? `
                        <button class="btn-admin primary" style="margin-top: 16px;" onclick="recordProjectPayment(${project.id})">
                            ðŸ’³ Record Next Payment ($${Math.round((project.totalAmount || 0) * plan.schedule[project.paidInstallments || 0] / 100).toLocaleString()})
                        </button>
                    ` : '<p style="color: #2a9d8f; margin-top: 16px;">âœ“ All payments received!</p>'}
                </div>

                <!-- Services Included -->
                ${project.services && project.services.length > 0 ? `
                <div class="form-section">
                    <div class="form-section-title">ðŸ› ï¸ Services Included</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        ${project.services.map(s => `<span class="tag">${s.name} - $${s.price}</span>`).join('')}
                    </div>
                </div>
                ` : ''}

                <!-- Activity Log -->
                <div class="form-section">
                    <div class="form-section-title">ðŸ“‹ Activity Log</div>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${(project.activityLog || []).slice().reverse().map(log => `
                            <div style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between;">
                                <span>${log.action}</span>
                                <span style="font-size: 12px; opacity: 0.5;">${new Date(log.timestamp).toLocaleString()}</span>
                            </div>
                        `).join('') || '<p style="opacity: 0.5;">No activity logged yet</p>'}
                    </div>
                </div>

                <!-- Notes -->
                ${project.notes ? `
                <div class="form-section">
                    <div class="form-section-title">ðŸ“ Notes</div>
                    <p style="line-height: 1.7;">${project.notes}</p>
                </div>
                ` : ''}
            </div>
            <div class="modal-footer">
                <button class="btn-admin secondary" onclick="document.getElementById('projectDetailsModal').remove()">Close</button>
                <button class="btn-admin secondary" onclick="createInvoiceForProject(${project.id})">ðŸ“„ Create Invoice</button>
                <button class="btn-admin primary" onclick="editProject(${project.id}); document.getElementById('projectDetailsModal').remove();">Edit Project</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function recordProjectPayment(projectId) {
    const project = projects.find(p => p.id === projectId);
    if (!project) return;

    const plan = paymentPlans[project.paymentPlan] || { schedule: [100] };
    const installmentIndex = project.paidInstallments || 0;
    const amount = Math.round((project.totalAmount || 0) * plan.schedule[installmentIndex] / 100);

    const client = crmData.clients?.find(c => c.id === project.clientId) || { name: 'Unknown' };

    // Record the payment
    const payment = {
        id: Date.now(),
        clientId: project.clientId,
        clientName: client.name,
        projectId: project.id,
        projectName: project.name,
        amount: amount,
        type: plan.triggers?.[installmentIndex] || 'installment',
        date: new Date().toISOString().split('T')[0],
        notes: `${plan.triggers?.[installmentIndex] || 'Installment'} payment for ${project.name}`,
        status: 'completed',
        createdAt: new Date().toISOString()
    };
    payments.push(payment);
    savePayments();

    // Update project
    project.paidInstallments = (project.paidInstallments || 0) + 1;
    project.activityLog = project.activityLog || [];
    project.activityLog.push({
        action: `Payment received: $${amount.toLocaleString()} (${plan.triggers?.[installmentIndex] || 'installment'})`,
        timestamp: new Date().toISOString()
    });
    saveProjects();

    // Close modal and refresh
    if (document.getElementById('projectDetailsModal')) {
        document.getElementById('projectDetailsModal').remove();
    }
    loadAdminProjectsPanel();
    alert(`Payment of $${amount.toLocaleString()} recorded successfully!`);
}

function createInvoiceForProject(projectId) {
    const project = projects.find(p => p.id === projectId);
    if (!project) return;

    // Close details modal
    if (document.getElementById('projectDetailsModal')) {
        document.getElementById('projectDetailsModal').remove();
    }

    // Open invoice panel and show create modal
    showAdminPanel('invoices');
    setTimeout(() => {
        showCreateInvoiceModal();
        // Pre-fill with project info
        setTimeout(() => {
            const clientSelect = document.getElementById('invoiceClient');
            if (clientSelect && project.clientId) {
                clientSelect.value = project.clientId;
                loadInvoiceClientProjects(project.clientId);
                setTimeout(() => {
                    const projectSelect = document.getElementById('invoiceProject');
                    if (projectSelect) {
                        projectSelect.value = project.id;
                        populateInvoiceFromProject(project.id);
                    }
                }, 100);
            }
        }, 100);
    }, 100);
}

function advanceProject(id) {
    const stages = ['Discovery', 'Design', 'Development', 'Review', 'Delivery', 'Complete'];
    const project = projects.find(p => p.id === id);
    if (!project) return;
    const currentIdx = stages.indexOf(project.stage || 'Discovery');
    if (currentIdx < stages.length - 1) {
        const newStage = stages[currentIdx + 1];
        project.stage = newStage;

        // Log activity
        project.activityLog = project.activityLog || [];
        project.activityLog.push({
            action: `Stage advanced to ${newStage}`,
            timestamp: new Date().toISOString(),
            stage: newStage
        });

        // Check for auto-pay triggers
        const plan = paymentPlans[project.paymentPlan];
        if (plan && plan.triggers) {
            // Approval trigger
            if (newStage === 'Review' && plan.triggers.includes('approval') && (project.paidInstallments || 0) === 1) {
                alert(`Payment reminder: ${plan.name} - Next payment (25%) is due on approval.`);
            }
            // Delivery trigger
            if (newStage === 'Delivery' && plan.triggers.includes('delivery') && (project.paidInstallments || 0) === 2) {
                alert(`Payment reminder: ${plan.name} - Final payment (25%) is due before download.`);
            }
        }

        saveProjects();
        loadAdminProjectsPanel();
    } else {
        alert('Project is already complete!');
    }
}

function editProject(id) {
    const project = projects.find(p => p.id === id);
    if (!project) return;
    const stages = ['Discovery', 'Design', 'Development', 'Review', 'Delivery', 'Complete'];
    const allClients = [...(crmData.clients || []), ...clients];
    const uniqueClients = allClients.filter((c, i, arr) => arr.findIndex(x => x.id === c.id) === i);

    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'projectModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header"><h3 class="modal-title">Edit Project</h3><button class="modal-close" onclick="document.getElementById('projectModal').remove()">Ã—</button></div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div class="form-group">
                    <label class="form-label">Project Name</label>
                    <input type="text" id="projectName" class="form-input" value="${project.name}">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Client</label>
                        <select id="projectClient" class="form-select">
                            <option value="">Select client...</option>
                            ${uniqueClients.map(c => `<option value="${c.id}" ${c.id == project.clientId ? 'selected' : ''}>${c.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Stage</label>
                        <select id="projectStage" class="form-select">
                            ${stages.map(s => `<option value="${s}" ${project.stage === s ? 'selected' : ''}>${s}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Package</label>
                        <select id="projectPackageEdit" class="form-select">
                            <option value="">Custom</option>
                            ${servicePackages.map(pkg => `<option value="${pkg.id}" ${pkg.id === project.packageId ? 'selected' : ''}>${pkg.name} - $${pkg.price}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Amount</label>
                        <input type="number" id="projectAmount" class="form-input" value="${project.totalAmount || 0}" step="0.01">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Payment Plan</label>
                        <select id="projectPlanEdit" class="form-select">
                            ${Object.entries(paymentPlans).map(([key, plan]) => `<option value="${key}" ${key === project.paymentPlan ? 'selected' : ''}>${plan.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payments Made</label>
                        <select id="projectPaidInstallments" class="form-select">
                            <option value="0" ${(project.paidInstallments || 0) === 0 ? 'selected' : ''}>0 payments</option>
                            <option value="1" ${project.paidInstallments === 1 ? 'selected' : ''}>1 payment</option>
                            <option value="2" ${project.paidInstallments === 2 ? 'selected' : ''}>2 payments</option>
                            <option value="3" ${project.paidInstallments === 3 ? 'selected' : ''}>3 payments</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Start Date</label>
                        <input type="date" id="projectStart" class="form-input" value="${project.startDate || ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="date" id="projectDue" class="form-input" value="${project.dueDate || ''}">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Time Tracked (seconds)</label>
                    <input type="number" id="projectTimeTracked" class="form-input" value="${project.timeTracked || 0}">
                    <p style="font-size: 11px; opacity: 0.5; margin-top: 4px;">Current: ${Math.floor((project.timeTracked || 0) / 3600)}h ${Math.floor(((project.timeTracked || 0) % 3600) / 60)}m</p>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea id="projectNotes" class="form-textarea" rows="3">${project.notes || ''}</textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-admin danger" onclick="deleteProject(${id})">Delete</button>
                <button class="btn-admin secondary" onclick="document.getElementById('projectModal').remove()">Cancel</button>
                <button class="btn-admin primary" onclick="updateProject(${id})">Update</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function updateProject(id) {
    const project = projects.find(p => p.id === id);
    if (!project) return;

    const oldStage = project.stage;
    const newStage = document.getElementById('projectStage').value;

    project.name = document.getElementById('projectName').value;
    project.clientId = parseInt(document.getElementById('projectClient').value) || null;
    project.stage = newStage;
    project.packageId = document.getElementById('projectPackageEdit').value || null;
    project.package = servicePackages.find(p => p.id === project.packageId)?.name || 'Custom';
    project.totalAmount = parseFloat(document.getElementById('projectAmount').value) || 0;
    project.paymentPlan = document.getElementById('projectPlanEdit').value;
    project.paidInstallments = parseInt(document.getElementById('projectPaidInstallments').value) || 0;
    project.startDate = document.getElementById('projectStart').value;
    project.dueDate = document.getElementById('projectDue').value;
    project.timeTracked = parseInt(document.getElementById('projectTimeTracked').value) || 0;
    project.notes = document.getElementById('projectNotes').value;

    // Log stage change
    if (oldStage !== newStage) {
        project.activityLog = project.activityLog || [];
        project.activityLog.push({
            action: `Stage changed from ${oldStage} to ${newStage}`,
            timestamp: new Date().toISOString(),
            stage: newStage
        });
    }

    saveProjects();
    document.getElementById('projectModal').remove();
    loadAdminProjectsPanel();
}

function deleteProject(id) {
    if (!confirm('Delete this project?')) return;
    projects = projects.filter(p => p.id !== id);
    saveProjects();
    document.getElementById('projectModal').remove();
    loadAdminProjectsPanel();
}

// ==================== PROOFS PANEL ====================

// Proof Categories and Types with Sizes
const PROOF_CATEGORIES = {
    print: {
        name: 'Print Materials',
        icon: 'ðŸ–¨ï¸',
        types: [
            { id: 'business_card_front', name: 'Business Card - Front', size: '3.5" x 2"', category: 'print' },
            { id: 'business_card_back', name: 'Business Card - Back', size: '3.5" x 2"', category: 'print' },
            { id: 'business_card_set', name: 'Business Card - Full Set', size: '3.5" x 2" (Front & Back)', category: 'print' },
            { id: 'flyer_letter', name: 'Flyer - Letter', size: '8.5" x 11"', category: 'print' },
            { id: 'flyer_half', name: 'Flyer - Half Page', size: '5.5" x 8.5"', category: 'print' },
            { id: 'postcard_4x6', name: 'Postcard/Mailer', size: '4" x 6"', category: 'print' },
            { id: 'postcard_5x7', name: 'Postcard/Mailer', size: '5" x 7"', category: 'print' },
            { id: 'postcard_6x9', name: 'Postcard/Mailer', size: '6" x 9"', category: 'print' },
            { id: 'rack_card', name: 'Rack Card', size: '4" x 9"', category: 'print' },
            { id: 'brochure_trifold_outside', name: 'Brochure Tri-fold - Outside', size: '8.5" x 11" (folded)', category: 'print' },
            { id: 'brochure_trifold_inside', name: 'Brochure Tri-fold - Inside', size: '8.5" x 11" (folded)', category: 'print' },
            { id: 'brochure_bifold_outside', name: 'Brochure Bi-fold - Outside', size: '8.5" x 11" (folded)', category: 'print' },
            { id: 'brochure_bifold_inside', name: 'Brochure Bi-fold - Inside', size: '8.5" x 11" (folded)', category: 'print' },
            { id: 'door_hanger', name: 'Door Hanger', size: '4.25" x 11"', category: 'print' },
            { id: 'bookmark', name: 'Bookmark', size: '2" x 6"', category: 'print' }
        ]
    },
    labels: {
        name: 'Labels & Packaging',
        icon: 'ðŸ·ï¸',
        types: [
            { id: 'label_circle_2', name: 'Circle Label', size: '2" diameter', category: 'labels' },
            { id: 'label_circle_3', name: 'Circle Label', size: '3" diameter', category: 'labels' },
            { id: 'label_square_2', name: 'Square Label', size: '2" x 2"', category: 'labels' },
            { id: 'label_rect_2x3', name: 'Rectangle Label', size: '2" x 3"', category: 'labels' },
            { id: 'label_rect_3x4', name: 'Rectangle Label', size: '3" x 4"', category: 'labels' },
            { id: 'product_label', name: 'Product Label - Custom', size: 'Custom size', category: 'labels' },
            { id: 'bottle_label', name: 'Bottle/Jar Label', size: 'Wrap-around', category: 'labels' },
            { id: 'box_packaging', name: 'Box/Packaging Design', size: 'Custom', category: 'labels' },
            { id: 'hang_tag', name: 'Hang Tag', size: '2" x 3.5"', category: 'labels' }
        ]
    },
    banners: {
        name: 'Banners & Signage',
        icon: 'ðŸš©',
        types: [
            { id: 'banner_stand_24x63', name: 'Retractable Banner Stand', size: '24" x 63"', category: 'banners' },
            { id: 'banner_stand_33x81', name: 'Retractable Banner Stand', size: '33" x 81"', category: 'banners' },
            { id: 'banner_stand_36x92', name: 'Retractable Banner Stand', size: '36" x 92"', category: 'banners' },
            { id: 'vinyl_banner_3x6', name: 'Vinyl Banner', size: '3\' x 6\'', category: 'banners' },
            { id: 'vinyl_banner_4x8', name: 'Vinyl Banner', size: '4\' x 8\'', category: 'banners' },
            { id: 'vinyl_banner_custom', name: 'Vinyl Banner - Custom', size: 'Custom size', category: 'banners' },
            { id: 'yard_sign_18x24', name: 'Yard Sign', size: '18" x 24"', category: 'banners' },
            { id: 'yard_sign_24x36', name: 'Yard Sign', size: '24" x 36"', category: 'banners' },
            { id: 'a_frame', name: 'A-Frame Sign', size: '24" x 36"', category: 'banners' },
            { id: 'window_cling', name: 'Window Cling/Decal', size: 'Custom', category: 'banners' },
            { id: 'vehicle_wrap', name: 'Vehicle Wrap Design', size: 'Full/Partial', category: 'banners' },
            { id: 'wall_graphic', name: 'Wall Graphic/Mural', size: 'Custom', category: 'banners' }
        ]
    },
    posters: {
        name: 'Posters & Large Format',
        icon: 'ðŸ–¼ï¸',
        types: [
            { id: 'poster_11x17', name: 'Poster - Tabloid', size: '11" x 17"', category: 'posters' },
            { id: 'poster_18x24', name: 'Poster - Small', size: '18" x 24"', category: 'posters' },
            { id: 'poster_24x36', name: 'Poster - Medium', size: '24" x 36"', category: 'posters' },
            { id: 'poster_27x40', name: 'Poster - Movie Size', size: '27" x 40"', category: 'posters' },
            { id: 'poster_36x48', name: 'Poster - Large', size: '36" x 48"', category: 'posters' },
            { id: 'canvas_16x20', name: 'Canvas Print', size: '16" x 20"', category: 'posters' },
            { id: 'canvas_24x36', name: 'Canvas Print', size: '24" x 36"', category: 'posters' },
            { id: 'foam_board', name: 'Foam Board Display', size: 'Custom', category: 'posters' }
        ]
    },
    digital: {
        name: 'Digital & Web',
        icon: 'ðŸ’»',
        types: [
            { id: 'web_banner_728x90', name: 'Leaderboard Banner', size: '728 x 90 px', category: 'digital' },
            { id: 'web_banner_300x250', name: 'Medium Rectangle', size: '300 x 250 px', category: 'digital' },
            { id: 'web_banner_160x600', name: 'Wide Skyscraper', size: '160 x 600 px', category: 'digital' },
            { id: 'web_banner_300x600', name: 'Half Page', size: '300 x 600 px', category: 'digital' },
            { id: 'social_fb_cover', name: 'Facebook Cover', size: '820 x 312 px', category: 'digital' },
            { id: 'social_fb_post', name: 'Facebook Post', size: '1200 x 630 px', category: 'digital' },
            { id: 'social_ig_post', name: 'Instagram Post', size: '1080 x 1080 px', category: 'digital' },
            { id: 'social_ig_story', name: 'Instagram Story', size: '1080 x 1920 px', category: 'digital' },
            { id: 'social_linkedin', name: 'LinkedIn Banner', size: '1584 x 396 px', category: 'digital' },
            { id: 'social_twitter', name: 'Twitter/X Header', size: '1500 x 500 px', category: 'digital' },
            { id: 'social_youtube', name: 'YouTube Thumbnail', size: '1280 x 720 px', category: 'digital' },
            { id: 'email_header', name: 'Email Header', size: '600 x 200 px', category: 'digital' },
            { id: 'email_template', name: 'Email Template', size: '600 px wide', category: 'digital' }
        ]
    },
    video: {
        name: 'Video Content',
        icon: 'ðŸŽ¬',
        types: [
            { id: 'video_reel', name: 'Instagram/TikTok Reel', size: '1080 x 1920 px (9:16)', category: 'video', isVideo: true },
            { id: 'video_story', name: 'Story Video', size: '1080 x 1920 px (9:16)', category: 'video', isVideo: true },
            { id: 'video_square', name: 'Square Video (Feed)', size: '1080 x 1080 px (1:1)', category: 'video', isVideo: true },
            { id: 'video_landscape', name: 'Landscape Video', size: '1920 x 1080 px (16:9)', category: 'video', isVideo: true },
            { id: 'video_brand', name: 'Brand Video', size: '1920 x 1080 px (16:9)', category: 'video', isVideo: true },
            { id: 'video_promo', name: 'Promo/Ad Video', size: 'Various', category: 'video', isVideo: true },
            { id: 'video_logo_animation', name: 'Logo Animation', size: 'Various', category: 'video', isVideo: true },
            { id: 'video_intro_outro', name: 'Intro/Outro', size: '1920 x 1080 px', category: 'video', isVideo: true }
        ]
    },
    branding: {
        name: 'Brand Identity',
        icon: 'âœ¨',
        types: [
            { id: 'logo_primary', name: 'Logo - Primary', size: 'Vector/High-res', category: 'branding' },
            { id: 'logo_secondary', name: 'Logo - Secondary', size: 'Vector/High-res', category: 'branding' },
            { id: 'logo_icon', name: 'Logo Icon/Mark', size: 'Vector/High-res', category: 'branding' },
            { id: 'logo_wordmark', name: 'Logo Wordmark', size: 'Vector/High-res', category: 'branding' },
            { id: 'logo_variations', name: 'Logo Color Variations', size: 'Multiple', category: 'branding' },
            { id: 'brand_pattern', name: 'Brand Pattern', size: 'Seamless tile', category: 'branding' },
            { id: 'brand_icons', name: 'Custom Icon Set', size: 'Various', category: 'branding' },
            { id: 'letterhead', name: 'Letterhead Design', size: '8.5" x 11"', category: 'branding' },
            { id: 'envelope', name: 'Envelope Design', size: '#10 (4.125" x 9.5")', category: 'branding' },
            { id: 'presentation_template', name: 'Presentation Template', size: '16:9', category: 'branding' }
        ]
    },
    website: {
        name: 'Website & App',
        icon: 'ðŸŒ',
        types: [
            { id: 'website_full', name: 'Full Website', size: 'Responsive', category: 'website', isLink: true },
            { id: 'website_homepage', name: 'Homepage Design', size: 'Desktop & Mobile', category: 'website', isLink: true },
            { id: 'website_landing', name: 'Landing Page', size: 'Responsive', category: 'website', isLink: true },
            { id: 'website_inner', name: 'Inner Page', size: 'Responsive', category: 'website', isLink: true },
            { id: 'webapp_dashboard', name: 'Web App Dashboard', size: 'Desktop', category: 'website', isLink: true },
            { id: 'webapp_mobile', name: 'Mobile App Screen', size: 'Mobile', category: 'website', isLink: true },
            { id: 'webapp_feature', name: 'App Feature/Flow', size: 'Various', category: 'website', isLink: true },
            { id: 'ecommerce_product', name: 'E-commerce Product Page', size: 'Responsive', category: 'website', isLink: true },
            { id: 'ecommerce_checkout', name: 'Checkout Flow', size: 'Responsive', category: 'website', isLink: true },
            { id: 'prototype_figma', name: 'Figma Prototype', size: 'Interactive', category: 'website', isLink: true },
            { id: 'prototype_xd', name: 'Adobe XD Prototype', size: 'Interactive', category: 'website', isLink: true },
            { id: 'staging_site', name: 'Staging/Dev Site', size: 'Full Site', category: 'website', isLink: true }
        ]
    }
};

let proofFilterCategory = 'all';
let proofFilterStatus = 'all';

function loadAdminProofsPanel() {
    const filteredProofs = proofs.filter(p => {
        const categoryMatch = proofFilterCategory === 'all' || p.category === proofFilterCategory;
        const statusMatch = proofFilterStatus === 'all' || p.status === proofFilterStatus;
        return categoryMatch && statusMatch;
    });

    const pendingCount = proofs.filter(p => p.status === 'pending').length;
    const approvedCount = proofs.filter(p => p.status === 'approved').length;
    const revisionCount = proofs.filter(p => p.status === 'revision').length;

    document.getElementById('adminProofsPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">âœ… Proof Approval Center</h1>
            <p class="panel-subtitle">Create, manage, and approve design proofs across all formats</p>
        </div>

        <!-- Stats Row -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
            <div style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); padding: 20px; border-radius: 12px; color: #fff;">
                <div style="font-size: 32px; font-weight: 700;">${proofs.length}</div>
                <div style="font-size: 14px; opacity: 0.9;">Total Proofs</div>
            </div>
            <div style="background: linear-gradient(135deg, #f59e0b, #d97706); padding: 20px; border-radius: 12px; color: #fff;">
                <div style="font-size: 32px; font-weight: 700;">${pendingCount}</div>
                <div style="font-size: 14px; opacity: 0.9;">Pending Review</div>
            </div>
            <div style="background: linear-gradient(135deg, #10b981, #059669); padding: 20px; border-radius: 12px; color: #fff;">
                <div style="font-size: 32px; font-weight: 700;">${approvedCount}</div>
                <div style="font-size: 14px; opacity: 0.9;">Approved</div>
            </div>
            <div style="background: linear-gradient(135deg, #ef4444, #dc2626); padding: 20px; border-radius: 12px; color: #fff;">
                <div style="font-size: 32px; font-weight: 700;">${revisionCount}</div>
                <div style="font-size: 14px; opacity: 0.9;">Needs Revision</div>
            </div>
        </div>

        <!-- Storage Indicator -->
        <div style="background: #252525; border-radius: 12px; padding: 12px 20px; margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
            <div style="display: flex; align-items: center; gap: 16px;">
                <span style="color: #888; font-size: 13px;">ðŸ’¾ Storage:</span>
                <span id="storageUsage" style="font-weight: 600; font-size: 13px;">${getStorageUsage().used} / ~5 MB</span>
                <div style="width: 100px; height: 6px; background: #333; border-radius: 3px; overflow: hidden;">
                    <div style="width: ${Math.min((getStorageUsage().usedBytes / 5000000) * 100, 100)}%; height: 100%; background: ${(getStorageUsage().usedBytes / 5000000) > 0.8 ? '#ef4444' : '#10b981'}; border-radius: 3px;"></div>
                </div>
            </div>
            <div style="display: flex; gap: 8px;">
                <button onclick="showStorageManager()" style="padding: 6px 12px; background: #333; border: none; color: #fff; border-radius: 6px; cursor: pointer; font-size: 12px;">
                    ðŸ—‘ï¸ Manage Storage
                </button>
            </div>
        </div>

        <!-- Actions & Filters -->
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; margin-bottom: 24px;">
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <select onchange="proofFilterCategory = this.value; loadAdminProofsPanel();" style="padding: 10px 16px; border: 1px solid #333; border-radius: 8px; background: #1a1a1a; color: #fff;">
                    <option value="all" ${proofFilterCategory === 'all' ? 'selected' : ''}>All Categories</option>
                    ${Object.entries(PROOF_CATEGORIES).map(([key, cat]) => `<option value="${key}" ${proofFilterCategory === key ? 'selected' : ''}>${cat.icon} ${cat.name}</option>`).join('')}
                </select>
                <select onchange="proofFilterStatus = this.value; loadAdminProofsPanel();" style="padding: 10px 16px; border: 1px solid #333; border-radius: 8px; background: #1a1a1a; color: #fff;">
                    <option value="all" ${proofFilterStatus === 'all' ? 'selected' : ''}>All Statuses</option>
                    <option value="pending" ${proofFilterStatus === 'pending' ? 'selected' : ''}>â³ Pending</option>
                    <option value="approved" ${proofFilterStatus === 'approved' ? 'selected' : ''}>âœ… Approved</option>
                    <option value="revision" ${proofFilterStatus === 'revision' ? 'selected' : ''}>ðŸ”„ Revision</option>
                </select>
            </div>
            <button class="btn-cta" onclick="showCreateProofModal()" style="padding: 12px 24px;">
                + Create New Proof
            </button>
        </div>

        <!-- Proofs Grid -->
        ${filteredProofs.length === 0 ? `
            <div style="background: #1a1a1a; border-radius: 16px; padding: 60px; text-align: center;">
                <div style="font-size: 64px; margin-bottom: 16px;">ðŸ“‹</div>
                <h3 style="font-size: 20px; margin-bottom: 8px;">No Proofs Found</h3>
                <p style="color: #888; margin-bottom: 24px;">Create your first proof to get started</p>
                <button class="btn-cta" onclick="showCreateProofModal()">+ Create Proof</button>
            </div>
        ` : `
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;">
                ${filteredProofs.map(proof => renderEnhancedProofCard(proof)).join('')}
            </div>
        `}
    `;
}

function renderEnhancedProofCard(proof) {
    const client = clients.find(c => c.id === proof.clientId) || { name: 'Unknown Client' };
    const proofType = getAllProofTypes().find(t => t.id === proof.proofType) || { name: proof.proofType || 'Custom', size: '', icon: 'ðŸ“„' };
    const categoryData = PROOF_CATEGORIES[proof.category] || { icon: 'ðŸ“„', name: 'Other' };
    const isVideo = proof.isVideo || proofType.isVideo;
    const isLink = proof.isLink || proofType?.isLink;

    const statusColors = {
        pending: { bg: '#fef3c7', text: '#92400e', icon: 'â³' },
        approved: { bg: '#d1fae5', text: '#065f46', icon: 'âœ…' },
        revision: { bg: '#fee2e2', text: '#991b1b', icon: 'ðŸ”„' }
    };
    const status = statusColors[proof.status] || statusColors.pending;

    // Determine preview content
    let previewContent = '';
    if (isLink && proof.previewUrl) {
        previewContent = proof.thumbnail
            ? `<img src="${proof.thumbnail}" style="max-width: 100%; max-height: 100%; object-fit: contain; opacity: 0.8;">`
            : `<div style="text-align: center; color: #3b82f6;">
                <div style="font-size: 48px; margin-bottom: 8px;">ðŸŒ</div>
                <div style="font-size: 12px; word-break: break-all; padding: 0 20px;">${proof.previewUrl.substring(0, 40)}...</div>
               </div>`;
    } else if (isVideo && proof.videoUrl) {
        previewContent = `<video src="${proof.videoUrl}" style="max-width: 100%; max-height: 100%;" controls></video>`;
    } else if (isVideo) {
        previewContent = `<div style="text-align: center; color: #666;"><div style="font-size: 48px; margin-bottom: 8px;">ðŸŽ¬</div><div>Video Proof</div></div>`;
    } else if (proof.image) {
        previewContent = `<img src="${proof.image}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
    } else {
        previewContent = `<div style="text-align: center; color: #666;"><div style="font-size: 48px; margin-bottom: 8px;">${categoryData.icon}</div><div>No Preview</div></div>`;
    }

    return `
        <div style="background: #1a1a1a; border-radius: 16px; overflow: hidden; border: 1px solid #333;">
            <!-- Preview Area -->
            <div style="position: relative; height: 200px; background: #111; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                ${previewContent}
                ${isLink ? `
                    <div style="position: absolute; bottom: 12px; left: 50%; transform: translateX(-50%);">
                        <button onclick="window.open('${proof.previewUrl}', '_blank')" style="padding: 8px 16px; background: #3b82f6; border: none; color: #fff; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">
                            ðŸ”— Open Preview
                        </button>
                    </div>
                ` : ''}
                <!-- Category Badge -->
                <div style="position: absolute; top: 12px; left: 12px; background: rgba(0,0,0,0.7); padding: 6px 12px; border-radius: 20px; font-size: 12px;">
                    ${categoryData.icon} ${proofType.name}
                </div>
                <!-- Status Badge -->
                <div style="position: absolute; top: 12px; right: 12px; background: ${status.bg}; color: ${status.text}; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                    ${status.icon} ${proof.status.charAt(0).toUpperCase() + proof.status.slice(1)}
                </div>
            </div>

            <!-- Info Area -->
            <div style="padding: 20px;">
                <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">${proof.name}</h3>
                <div style="display: flex; gap: 16px; color: #888; font-size: 13px; margin-bottom: 12px; flex-wrap: wrap;">
                    <span>ðŸ‘¤ ${client.name}</span>
                    <span>ðŸ“ ${proofType.size || 'Custom'}</span>
                    ${isLink ? '<span style="color: #3b82f6;">ðŸ”— Link</span>' : ''}
                </div>
                <div style="font-size: 12px; color: #666; margin-bottom: 16px;">
                    Version ${proof.version || 1} â€¢ ${proof.createdAt ? new Date(proof.createdAt).toLocaleDateString() : 'N/A'}
                </div>

                ${proof.comments && proof.comments.length > 0 ? `
                    <div style="background: #252525; padding: 12px; border-radius: 8px; margin-bottom: 16px; max-height: 80px; overflow-y: auto;">
                        <div style="font-size: 11px; color: #888; margin-bottom: 8px;">LATEST FEEDBACK (${proof.comments.length})</div>
                        <div style="font-size: 13px; color: #ccc;">${proof.comments[proof.comments.length - 1].text}</div>
                    </div>
                ` : ''}

                <!-- Action Buttons -->
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    ${isLink ? `<button onclick="openProofPreview(${proof.id})" style="padding: 10px 14px; background: #3b82f6; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">ðŸ”— Preview & Comment</button>` : ''}
                    ${proof.status !== 'approved' ? `
                        <button onclick="approveProof(${proof.id})" style="flex: 1; padding: 10px; background: #10b981; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            âœ“ Approve
                        </button>
                        <button onclick="requestRevisionModal(${proof.id})" style="flex: 1; padding: 10px; background: #ef4444; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            â†» Revision
                        </button>
                    ` : `
                        <button onclick="viewApprovedAsset(${proof.id})" style="flex: 1; padding: 10px; background: #3b82f6; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ðŸ“ View in Brand Guide
                        </button>
                    `}
                    <button onclick="viewProofDetails(${proof.id})" style="padding: 10px 16px; background: #333; color: #fff; border: none; border-radius: 8px; cursor: pointer;">
                        ðŸ‘ï¸
                    </button>
                </div>
            </div>
        </div>
    `;
}

function getAllProofTypes() {
    const allTypes = [];
    Object.values(PROOF_CATEGORIES).forEach(cat => {
        cat.types.forEach(type => allTypes.push(type));
    });
    return allTypes;
}

// Enhanced Create Proof Modal
function showCreateProofModal() {
    const modal = document.createElement('div');
    modal.id = 'createProofModal';
    modal.innerHTML = `
        <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px;">
            <div style="background: #1a1a1a; border-radius: 20px; width: 100%; max-width: 900px; max-height: 90vh; overflow-y: auto;">
                <!-- Header -->
                <div style="padding: 24px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: #1a1a1a; z-index: 10;">
                    <div>
                        <h2 style="font-size: 24px; font-weight: 700;">Create New Proof</h2>
                        <p style="color: #888; font-size: 14px;">Select proof type, upload files, and send to client</p>
                    </div>
                    <button onclick="document.getElementById('createProofModal').remove()" style="background: none; border: none; color: #888; font-size: 28px; cursor: pointer; line-height: 1;">&times;</button>
                </div>

                <!-- Body -->
                <div style="padding: 24px;">
                    <!-- Step 1: Select Client & Project -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">Client *</label>
                            <select id="proofClient" style="width: 100%; padding: 12px; border: 1px solid #333; border-radius: 8px; background: #252525; color: #fff; font-size: 14px;">
                                <option value="">Select client...</option>
                                ${clients.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">Project/Order</label>
                            <select id="proofProject" style="width: 100%; padding: 12px; border: 1px solid #333; border-radius: 8px; background: #252525; color: #fff; font-size: 14px;">
                                <option value="">Select project...</option>
                                ${orders.map(o => `<option value="${o.id}">${o.projectName || o.service}</option>`).join('')}
                            </select>
                        </div>
                    </div>

                    <!-- Step 2: Select Proof Category -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 12px;">Proof Category *</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px;">
                            ${Object.entries(PROOF_CATEGORIES).map(([key, cat]) => `
                                <div onclick="selectProofCategory('${key}')" id="cat_${key}"
                                    style="background: #252525; border: 2px solid #333; border-radius: 12px; padding: 16px; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <div style="font-size: 28px; margin-bottom: 8px;">${cat.icon}</div>
                                    <div style="font-size: 13px; font-weight: 500;">${cat.name}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Step 3: Select Specific Type (shown after category selected) -->
                    <div id="proofTypeSection" style="display: none; margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 12px;">Select Type & Size *</label>
                        <div id="proofTypeList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; max-height: 200px; overflow-y: auto; padding: 4px;"></div>
                    </div>

                    <!-- Step 4: Proof Details -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">Proof Name *</label>
                            <input type="text" id="proofName" placeholder="e.g., Business Card Design v1"
                                style="width: 100%; padding: 12px; border: 1px solid #333; border-radius: 8px; background: #252525; color: #fff; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">Version</label>
                            <input type="number" id="proofVersion" value="1" min="1"
                                style="width: 100%; padding: 12px; border: 1px solid #333; border-radius: 8px; background: #252525; color: #fff; font-size: 14px;">
                        </div>
                    </div>

                    <!-- Step 5: Upload Area (File Upload) -->
                    <div id="proofUploadSection" style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 12px;">Upload Proof File *</label>
                        <div id="proofUploadZone" onclick="document.getElementById('proofFileInput').click()"
                            style="border: 2px dashed #444; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.2s;"
                            ondragover="event.preventDefault(); this.style.borderColor='#e11d48'; this.style.background='rgba(225,29,72,0.1)';"
                            ondragleave="this.style.borderColor='#444'; this.style.background='transparent';"
                            ondrop="handleProofFileDrop(event)">
                            <div style="font-size: 48px; margin-bottom: 12px;">ðŸ“</div>
                            <p style="color: #fff; font-size: 16px; margin-bottom: 8px;">Drop your file here</p>
                            <p style="color: #888; font-size: 14px;">Images: PNG, JPG, PDF â€¢ Videos: MP4, MOV</p>
                        </div>
                        <input type="file" id="proofFileInput" accept="image/*,video/*,.pdf" style="display: none;" onchange="handleProofFileSelect(this)">

                        <!-- Preview Area -->
                        <div id="proofPreviewArea" style="display: none; margin-top: 16px; background: #252525; border-radius: 12px; padding: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span style="font-weight: 600;">Preview</span>
                                <button onclick="clearProofUpload()" style="background: #ef4444; border: none; color: #fff; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Remove</button>
                            </div>
                            <div id="proofPreviewContent" style="text-align: center;"></div>
                        </div>
                    </div>

                    <!-- Step 5b: URL Input (Website/App Proofs) -->
                    <div id="proofUrlSection" style="display: none; margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 12px;">ðŸ”— Website/App Preview URL *</label>
                        <div style="background: #252525; border-radius: 12px; padding: 20px;">
                            <input type="url" id="proofUrl" placeholder="https://example.com or https://figma.com/proto/..."
                                style="width: 100%; padding: 14px 16px; border: 2px solid #444; border-radius: 8px; background: #1a1a1a; color: #fff; font-size: 14px; margin-bottom: 12px;"
                                oninput="validateProofUrl(this.value)">
                            <div id="proofUrlPreview" style="display: none; margin-top: 12px;">
                                <div style="background: #1a1a1a; border-radius: 8px; padding: 16px; text-align: center;">
                                    <div style="font-size: 32px; margin-bottom: 8px;">ðŸŒ</div>
                                    <div id="proofUrlDisplay" style="color: #3b82f6; word-break: break-all;"></div>
                                    <button onclick="window.open(document.getElementById('proofUrl').value, '_blank')"
                                        style="margin-top: 12px; padding: 8px 16px; background: #3b82f6; border: none; color: #fff; border-radius: 6px; cursor: pointer;">
                                        ðŸ”— Test Link
                                    </button>
                                </div>
                            </div>
                            <p style="color: #888; font-size: 12px; margin-top: 12px;">
                                Supported: Live websites, staging sites, Figma prototypes, Adobe XD, InVision, etc.
                            </p>
                        </div>

                        <!-- Optional Screenshot Upload -->
                        <div style="margin-top: 16px;">
                            <label style="display: block; font-size: 13px; color: #888; margin-bottom: 8px;">Optional: Upload a screenshot for preview thumbnail</label>
                            <div onclick="document.getElementById('proofScreenshotInput').click()"
                                style="border: 1px dashed #444; border-radius: 8px; padding: 16px; text-align: center; cursor: pointer;">
                                <span style="color: #888; font-size: 13px;">ðŸ“· Click to add screenshot</span>
                            </div>
                            <input type="file" id="proofScreenshotInput" accept="image/*" style="display: none;" onchange="handleScreenshotUpload(this)">
                            <div id="screenshotPreview" style="display: none; margin-top: 8px; text-align: center;">
                                <img id="screenshotImg" style="max-width: 100%; max-height: 150px; border-radius: 8px;">
                            </div>
                        </div>
                    </div>

                    <!-- Step 6: Notes -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">Notes for Client</label>
                        <textarea id="proofNotes" rows="3" placeholder="Add any notes or instructions for the client..."
                            style="width: 100%; padding: 12px; border: 1px solid #333; border-radius: 8px; background: #252525; color: #fff; font-size: 14px; resize: vertical;"></textarea>
                    </div>

                    <!-- Notification Option -->
                    <div style="background: #252525; border-radius: 12px; padding: 16px; margin-bottom: 24px;">
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="notifyClient" checked style="width: 20px; height: 20px; accent-color: #e11d48;">
                            <div>
                                <div style="font-weight: 600;">Notify Client</div>
                                <div style="font-size: 13px; color: #888;">Send email notification when proof is ready for review</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Footer -->
                <div style="padding: 24px; border-top: 1px solid #333; display: flex; justify-content: flex-end; gap: 12px; position: sticky; bottom: 0; background: #1a1a1a;">
                    <button onclick="document.getElementById('createProofModal').remove()" style="padding: 12px 24px; background: #333; border: none; color: #fff; border-radius: 8px; cursor: pointer; font-size: 14px;">
                        Cancel
                    </button>
                    <button onclick="saveEnhancedProof()" style="padding: 12px 32px; background: linear-gradient(135deg, #e11d48, #be185d); border: none; color: #fff; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        Create Proof & Send to Client
                    </button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

let selectedProofCategory = null;
let selectedProofType = null;
let proofFileData = null;

function selectProofCategory(categoryKey) {
    selectedProofCategory = categoryKey;

    // Update visual selection
    Object.keys(PROOF_CATEGORIES).forEach(key => {
        const el = document.getElementById('cat_' + key);
        if (el) {
            el.style.borderColor = key === categoryKey ? '#e11d48' : '#333';
            el.style.background = key === categoryKey ? 'rgba(225,29,72,0.1)' : '#252525';
        }
    });

    // Show type selection
    const typeSection = document.getElementById('proofTypeSection');
    const typeList = document.getElementById('proofTypeList');
    const category = PROOF_CATEGORIES[categoryKey];

    typeSection.style.display = 'block';
    typeList.innerHTML = category.types.map(type => `
        <div onclick="selectProofType('${type.id}')" id="type_${type.id}"
            style="background: #333; border: 2px solid #444; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.2s;">
            <div style="font-weight: 600; font-size: 13px; margin-bottom: 4px;">${type.name}</div>
            <div style="font-size: 12px; color: #888;">${type.size}</div>
            ${type.isVideo ? '<div style="font-size: 11px; color: #e11d48; margin-top: 4px;">ðŸŽ¬ Video</div>' : ''}
            ${type.isLink ? '<div style="font-size: 11px; color: #3b82f6; margin-top: 4px;">ðŸ”— Link</div>' : ''}
        </div>
    `).join('');

    // Update file input accept based on category
    const fileInput = document.getElementById('proofFileInput');
    const uploadSection = document.getElementById('proofUploadSection');
    const urlSection = document.getElementById('proofUrlSection');

    if (categoryKey === 'website') {
        // Show URL input for website proofs
        if (uploadSection) uploadSection.style.display = 'none';
        if (urlSection) urlSection.style.display = 'block';
    } else {
        // Show file upload for other proofs
        if (uploadSection) uploadSection.style.display = 'block';
        if (urlSection) urlSection.style.display = 'none';

        if (categoryKey === 'video') {
            fileInput.accept = 'video/*';
        } else {
            fileInput.accept = 'image/*,.pdf';
        }
    }
}

function selectProofType(typeId) {
    selectedProofType = typeId;
    const type = getAllProofTypes().find(t => t.id === typeId);

    // Update visual selection
    getAllProofTypes().forEach(t => {
        const el = document.getElementById('type_' + t.id);
        if (el) {
            el.style.borderColor = t.id === typeId ? '#e11d48' : '#444';
            el.style.background = t.id === typeId ? 'rgba(225,29,72,0.2)' : '#333';
        }
    });

    // Toggle between URL and file upload based on type
    const uploadSection = document.getElementById('proofUploadSection');
    const urlSection = document.getElementById('proofUrlSection');

    if (type && type.isLink) {
        if (uploadSection) uploadSection.style.display = 'none';
        if (urlSection) urlSection.style.display = 'block';
    } else if (selectedProofCategory !== 'website') {
        if (uploadSection) uploadSection.style.display = 'block';
        if (urlSection) urlSection.style.display = 'none';
    }

    // Auto-fill proof name if empty
    const nameInput = document.getElementById('proofName');
    if (!nameInput.value && type) {
        nameInput.value = type.name + ' v1';
    }
}

function handleProofFileDrop(event) {
    event.preventDefault();
    event.target.style.borderColor = '#444';
    event.target.style.background = 'transparent';

    const file = event.dataTransfer.files[0];
    if (file) {
        processProofFile(file);
    }
}

function handleProofFileSelect(input) {
    if (input.files && input.files[0]) {
        processProofFile(input.files[0]);
    }
}

function processProofFile(file) {
    const isVideo = file.type.startsWith('video/');
    const isImage = file.type.startsWith('image/');
    const isPDF = file.type === 'application/pdf';

    if (!isVideo && !isImage && !isPDF) {
        alert('Please upload an image, video, or PDF file.');
        return;
    }

    // Check file size - warn if large
    const fileSizeMB = file.size / (1024 * 1024);
    if (fileSizeMB > 5) {
        alert(`âš ï¸ Large file (${fileSizeMB.toFixed(1)}MB). Images will be compressed. Videos will be stored as reference only.`);
    }

    const previewArea = document.getElementById('proofPreviewArea');
    const previewContent = document.getElementById('proofPreviewContent');

    if (isVideo) {
        // For videos, create a thumbnail and store reference (videos too large for localStorage)
        const video = document.createElement('video');
        video.preload = 'metadata';
        video.onloadedmetadata = function() {
            video.currentTime = 1; // Seek to 1 second for thumbnail
        };
        video.onseeked = function() {
            // Create thumbnail from video frame
            const canvas = document.createElement('canvas');
            canvas.width = 320;
            canvas.height = 180;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const thumbnail = canvas.toDataURL('image/jpeg', 0.6);

            proofFileData = {
                data: null, // Don't store full video in localStorage
                thumbnail: thumbnail,
                type: file.type,
                name: file.name,
                isVideo: true,
                videoFile: file, // Keep file reference for display
                duration: video.duration
            };

            previewArea.style.display = 'block';
            previewContent.innerHTML = `
                <div style="position: relative;">
                    <img src="${thumbnail}" style="max-width: 100%; max-height: 300px; border-radius: 8px; opacity: 0.8;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 48px;">â–¶ï¸</div>
                </div>
                <div style="margin-top: 8px; color: #888; font-size: 13px;">ðŸŽ¬ ${file.name} (${fileSizeMB.toFixed(1)}MB)</div>
                <div style="margin-top: 4px; color: #f59e0b; font-size: 11px;">âš ï¸ Video stored as thumbnail reference only</div>
            `;

            URL.revokeObjectURL(video.src);
        };
        video.src = URL.createObjectURL(file);
    } else if (isPDF) {
        // For PDFs, store minimal reference
        proofFileData = {
            data: null,
            type: file.type,
            name: file.name,
            isVideo: false,
            isPDF: true,
            fileSize: fileSizeMB.toFixed(1) + 'MB'
        };

        previewArea.style.display = 'block';
        previewContent.innerHTML = `
            <div style="background: #333; padding: 40px; border-radius: 8px;">
                <div style="font-size: 48px; margin-bottom: 12px;">ðŸ“„</div>
                <div style="font-weight: 600;">${file.name}</div>
                <div style="color: #888; font-size: 13px; margin-top: 4px;">PDF Document (${fileSizeMB.toFixed(1)}MB)</div>
            </div>
            <div style="margin-top: 8px; color: #f59e0b; font-size: 11px;">âš ï¸ PDF stored as reference only</div>
        `;
    } else {
        // For images, compress before storing
        const reader = new FileReader();
        reader.onload = async e => {
            // Compress image
            const compressed = await compressImage(e.target.result, 800, 0.7);
            const compressedSize = (compressed.length * 0.75 / 1024).toFixed(0); // Approximate KB

            proofFileData = {
                data: compressed,
                type: 'image/jpeg',
                name: file.name,
                isVideo: false,
                originalSize: fileSizeMB.toFixed(1) + 'MB',
                compressedSize: compressedSize + 'KB'
            };

            previewArea.style.display = 'block';
            previewContent.innerHTML = `
                <img src="${compressed}" style="max-width: 100%; max-height: 300px; border-radius: 8px;">
                <div style="margin-top: 8px; color: #888; font-size: 13px;">ðŸ–¼ï¸ ${file.name}</div>
                <div style="margin-top: 4px; color: #10b981; font-size: 11px;">âœ“ Compressed: ${fileSizeMB.toFixed(1)}MB â†’ ${compressedSize}KB</div>
            `;
        };
        reader.readAsDataURL(file);
    }
}

function clearProofUpload() {
    proofFileData = null;
    document.getElementById('proofPreviewArea').style.display = 'none';
    document.getElementById('proofFileInput').value = '';
}

// URL validation for website proofs
let proofUrlData = null;
let proofScreenshotData = null;

function validateProofUrl(url) {
    const preview = document.getElementById('proofUrlPreview');
    const display = document.getElementById('proofUrlDisplay');

    if (url && (url.startsWith('http://') || url.startsWith('https://'))) {
        proofUrlData = url;
        preview.style.display = 'block';
        display.textContent = url;
    } else {
        proofUrlData = null;
        preview.style.display = 'none';
    }
}

function handleScreenshotUpload(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = async (e) => {
            // Compress the screenshot
            const compressed = await compressImage(e.target.result, 600, 0.7);
            proofScreenshotData = compressed;

            document.getElementById('screenshotPreview').style.display = 'block';
            document.getElementById('screenshotImg').src = compressed;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function clearUrlProof() {
    proofUrlData = null;
    proofScreenshotData = null;
    document.getElementById('proofUrl').value = '';
    document.getElementById('proofUrlPreview').style.display = 'none';
    document.getElementById('screenshotPreview').style.display = 'none';
    document.getElementById('proofScreenshotInput').value = '';
}

function saveEnhancedProof() {
    const clientId = parseInt(document.getElementById('proofClient').value);
    const projectId = parseInt(document.getElementById('proofProject').value) || null;
    const name = document.getElementById('proofName').value.trim();
    const version = parseInt(document.getElementById('proofVersion').value) || 1;
    const notes = document.getElementById('proofNotes').value.trim();
    const notifyClient = document.getElementById('notifyClient').checked;

    const proofType = getAllProofTypes().find(t => t.id === selectedProofType);
    const isLinkProof = proofType?.isLink || selectedProofCategory === 'website';

    // Validation
    if (!clientId) {
        alert('Please select a client.');
        return;
    }
    if (!selectedProofCategory) {
        alert('Please select a proof category.');
        return;
    }
    if (!selectedProofType) {
        alert('Please select a proof type.');
        return;
    }
    if (!name) {
        alert('Please enter a proof name.');
        return;
    }

    // Check for either file or URL depending on type
    if (isLinkProof) {
        if (!proofUrlData) {
            alert('Please enter a valid URL for this website/app proof.');
            return;
        }
    } else {
        if (!proofFileData) {
            alert('Please upload a proof file.');
            return;
        }
    }

    const proof = {
        id: Date.now(),
        name: name,
        clientId: clientId,
        projectId: projectId,
        orderId: projectId,
        category: selectedProofCategory,
        proofType: selectedProofType,
        proofTypeName: proofType?.name || 'Custom',
        proofSize: proofType?.size || '',
        isLink: isLinkProof,
        isVideo: proofFileData?.isVideo || false,
        // For link proofs
        previewUrl: isLinkProof ? proofUrlData : null,
        thumbnail: isLinkProof ? proofScreenshotData : null,
        // For file proofs
        image: !isLinkProof && proofFileData && !proofFileData.isVideo ? proofFileData.data : null,
        videoUrl: !isLinkProof && proofFileData?.isVideo ? proofFileData.data : null,
        fileName: proofFileData?.name || null,
        fileType: proofFileData?.type || null,
        version: version,
        status: 'pending',
        notes: notes,
        comments: [],
        createdAt: new Date().toISOString(),
        notifyClient: notifyClient
    };

    proofs.push(proof);
    saveProofs();

    // Reset state
    selectedProofCategory = null;
    selectedProofType = null;
    proofFileData = null;

    document.getElementById('createProofModal').remove();
    loadAdminProofsPanel();

    if (notifyClient) {
        const client = clients.find(c => c.id === clientId);
        alert(`âœ… Proof created!\n\nðŸ“§ Notification sent to ${client?.name || 'client'} for review.`);
    } else {
        alert('âœ… Proof created successfully!');
    }
}

// Legacy function for compatibility
function showAddProofModal() {
    showCreateProofModal();
}

function previewProofImage(input) {
    if (input.files && input.files[0]) {
        processProofFile(input.files[0]);
    }
}

function saveProof() {
    saveEnhancedProof();
}

function approveProof(id) {
    const proof = proofs.find(p => p.id === id);
    if (proof) {
        proof.status = 'approved';
        proof.approvedAt = new Date().toISOString();
        saveProofs();

        // Save to client's brand assets
        saveProofToBrandAssets(proof);

        // Trigger workflow: Check payment and enable downloads
        triggerProofApproved(id);
        loadAdminProofsPanel();

        const client = clients.find(c => c.id === proof.clientId);
        alert(`âœ… Proof approved!\n\nAsset saved to ${client?.name || 'client'}'s Brand Guide.`);
    }
}

// Save approved proof to client's brand assets
function saveProofToBrandAssets(proof) {
    const client = clients.find(c => c.id === proof.clientId);
    if (!client) return;

    // Initialize brand assets if needed
    if (!client.brandAssets) {
        client.brandAssets = { logo: '', colors: [], fonts: [], files: [] };
    }
    if (!client.brandAssets.files) {
        client.brandAssets.files = [];
    }

    // Create asset entry
    const asset = {
        id: Date.now(),
        proofId: proof.id,
        name: proof.name,
        category: proof.category,
        type: proof.proofType,
        typeName: proof.proofTypeName,
        size: proof.proofSize,
        isVideo: proof.isVideo,
        image: proof.image,
        videoUrl: proof.videoUrl,
        fileName: proof.fileName,
        fileType: proof.fileType,
        approvedAt: proof.approvedAt,
        version: proof.version
    };

    // Add to brand assets
    client.brandAssets.files.push(asset);

    // If it's a logo, also set as primary logo
    if (proof.proofType && proof.proofType.includes('logo') && proof.image) {
        client.brandAssets.logo = proof.image;
    }

    // Save clients
    localStorage.setItem('nui_clients', JSON.stringify(clients));

    // Also add to brand guide entries
    const brandGuideEntries = JSON.parse(localStorage.getItem('nui_brand_guide_entries')) || [];
    brandGuideEntries.push({
        id: Date.now(),
        clientId: proof.clientId,
        assetType: proof.category,
        assetName: proof.name,
        assetUrl: proof.image || proof.videoUrl,
        proofId: proof.id,
        createdAt: new Date().toISOString()
    });
    localStorage.setItem('nui_brand_guide_entries', JSON.stringify(brandGuideEntries));
}

function requestRevisionModal(id) {
    const proof = proofs.find(p => p.id === id);
    if (!proof) return;

    const modal = document.createElement('div');
    modal.id = 'revisionModal';
    modal.innerHTML = `
        <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px;">
            <div style="background: #1a1a1a; border-radius: 16px; padding: 32px; max-width: 500px; width: 100%;">
                <h2 style="font-size: 20px; margin-bottom: 8px;">ðŸ”„ Request Revision</h2>
                <p style="color: #888; font-size: 14px; margin-bottom: 24px;">Provide feedback for "${proof.name}"</p>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">Revision Feedback *</label>
                    <textarea id="revisionFeedback" rows="4" placeholder="Describe what changes are needed..."
                        style="width: 100%; padding: 12px; border: 1px solid #333; border-radius: 8px; background: #252525; color: #fff; font-size: 14px; resize: vertical;"></textarea>
                </div>

                <div style="margin-bottom: 24px;">
                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 12px;">Quick Feedback Options</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        ${['Color adjustment needed', 'Font change required', 'Layout revision', 'Size/dimension issue', 'Text/copy change', 'Image quality issue'].map(opt => `
                            <button onclick="document.getElementById('revisionFeedback').value += '${opt}. '"
                                style="padding: 8px 12px; background: #333; border: none; color: #fff; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                ${opt}
                            </button>
                        `).join('')}
                    </div>
                </div>

                <div style="display: flex; gap: 12px;">
                    <button onclick="document.getElementById('revisionModal').remove()"
                        style="flex: 1; padding: 12px; background: #333; border: none; color: #fff; border-radius: 8px; cursor: pointer;">
                        Cancel
                    </button>
                    <button onclick="submitProofRevision(${id})"
                        style="flex: 1; padding: 12px; background: #ef4444; border: none; color: #fff; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        Send Revision Request
                    </button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function submitProofRevision(id) {
    const feedback = document.getElementById('revisionFeedback').value.trim();
    if (!feedback) {
        alert('Please provide revision feedback.');
        return;
    }

    const proof = proofs.find(p => p.id === id);
    if (proof) {
        proof.status = 'revision';
        proof.comments = proof.comments || [];
        proof.comments.push({
            author: currentUser?.email || 'Admin',
            text: feedback,
            createdAt: new Date().toISOString()
        });
        saveProofs();

        document.getElementById('revisionModal').remove();
        loadAdminProofsPanel();

        const client = clients.find(c => c.id === proof.clientId);
        alert(`ðŸ”„ Revision requested.\n\nFeedback sent to design team for "${proof.name}".`);
    }
}

function requestRevision(id) {
    requestRevisionModal(id);
}

function viewProofDetails(id) {
    const proof = proofs.find(p => p.id === id);
    if (!proof) return;

    const client = clients.find(c => c.id === proof.clientId) || { name: 'Unknown' };
    const proofType = getAllProofTypes().find(t => t.id === proof.proofType) || { name: 'Custom', size: '' };

    const modal = document.createElement('div');
    modal.id = 'proofDetailsModal';
    modal.innerHTML = `
        <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px;">
            <div style="background: #1a1a1a; border-radius: 20px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto;">
                <div style="padding: 24px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="font-size: 20px;">Proof Details</h2>
                    <button onclick="document.getElementById('proofDetailsModal').remove()" style="background: none; border: none; color: #888; font-size: 28px; cursor: pointer;">&times;</button>
                </div>

                <div style="padding: 24px;">
                    <!-- Preview -->
                    <div style="background: #111; border-radius: 12px; padding: 20px; margin-bottom: 24px; text-align: center;">
                        ${proof.isVideo && proof.videoUrl ? `
                            <video src="${proof.videoUrl}" style="max-width: 100%; max-height: 400px; border-radius: 8px;" controls></video>
                        ` : proof.image ? `
                            <img src="${proof.image}" style="max-width: 100%; max-height: 400px; border-radius: 8px;">
                        ` : `
                            <div style="padding: 60px; color: #666;">No preview available</div>
                        `}
                    </div>

                    <!-- Info Grid -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div style="background: #252525; padding: 16px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Proof Name</div>
                            <div style="font-weight: 600;">${proof.name}</div>
                        </div>
                        <div style="background: #252525; padding: 16px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Client</div>
                            <div style="font-weight: 600;">${client.name}</div>
                        </div>
                        <div style="background: #252525; padding: 16px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Type</div>
                            <div style="font-weight: 600;">${proofType.name}</div>
                        </div>
                        <div style="background: #252525; padding: 16px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Size</div>
                            <div style="font-weight: 600;">${proofType.size || proof.proofSize || 'Custom'}</div>
                        </div>
                        <div style="background: #252525; padding: 16px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Version</div>
                            <div style="font-weight: 600;">v${proof.version || 1}</div>
                        </div>
                        <div style="background: #252525; padding: 16px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Status</div>
                            <div style="font-weight: 600; text-transform: capitalize;">${proof.status}</div>
                        </div>
                    </div>

                    ${proof.notes ? `
                        <div style="background: #252525; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                            <div style="font-size: 12px; color: #888; margin-bottom: 8px;">Notes</div>
                            <div>${proof.notes}</div>
                        </div>
                    ` : ''}

                    ${proof.comments && proof.comments.length > 0 ? `
                        <div style="background: #252525; padding: 16px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #888; margin-bottom: 12px;">Feedback History</div>
                            ${proof.comments.map(c => `
                                <div style="border-left: 3px solid #e11d48; padding-left: 12px; margin-bottom: 12px;">
                                    <div style="font-size: 12px; color: #888;">${c.author} â€¢ ${new Date(c.createdAt).toLocaleString()}</div>
                                    <div style="margin-top: 4px;">${c.text}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function viewApprovedAsset(proofId) {
    const proof = proofs.find(p => p.id === proofId);
    if (!proof) return;

    // Switch to brand guide panel with this client selected
    showAdminPanel('brandguide');

    // Could also show a specific modal or filter to this client
    alert(`Asset "${proof.name}" is saved in the client's Brand Guide.\n\nNavigating to Brand Guide panel...`);
}

// Open proof preview with comment functionality (for website/link proofs)
function openProofPreview(proofId) {
    const proof = proofs.find(p => p.id === proofId);
    if (!proof) return;

    const client = clients.find(c => c.id === proof.clientId) || { name: 'Unknown' };
    const proofType = getAllProofTypes().find(t => t.id === proof.proofType) || { name: 'Custom' };

    const modal = document.createElement('div');
    modal.id = 'proofPreviewModal';
    modal.innerHTML = `
        <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; z-index: 9999;">
            <!-- Left: Preview Area -->
            <div style="flex: 1; display: flex; flex-direction: column; border-right: 1px solid #333;">
                <div style="padding: 16px 20px; background: #1a1a1a; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 style="font-size: 18px; margin-bottom: 4px;">${proof.name}</h2>
                        <div style="font-size: 13px; color: #888;">${proofType.name} â€¢ ${client.name}</div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        ${proof.previewUrl ? `<button onclick="window.open('${proof.previewUrl}', '_blank')" style="padding: 8px 16px; background: #3b82f6; border: none; color: #fff; border-radius: 6px; cursor: pointer;">ðŸ”— Open in New Tab</button>` : ''}
                        <button onclick="document.getElementById('proofPreviewModal').remove()" style="padding: 8px 16px; background: #333; border: none; color: #fff; border-radius: 6px; cursor: pointer;">âœ• Close</button>
                    </div>
                </div>
                <div style="flex: 1; background: #111; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                    ${proof.previewUrl ? `
                        <iframe src="${proof.previewUrl}" style="width: 100%; height: 100%; border: none;" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
                    ` : proof.image ? `
                        <img src="${proof.image}" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                    ` : `
                        <div style="text-align: center; color: #666;">
                            <div style="font-size: 64px; margin-bottom: 16px;">ðŸŒ</div>
                            <div>No preview available</div>
                        </div>
                    `}
                </div>
            </div>

            <!-- Right: Comments Panel -->
            <div style="width: 380px; display: flex; flex-direction: column; background: #1a1a1a;">
                <div style="padding: 20px; border-bottom: 1px solid #333;">
                    <h3 style="font-size: 16px; margin-bottom: 8px;">ðŸ’¬ Comments & Feedback</h3>
                    <div style="display: flex; gap: 8px;">
                        <span class="order-status ${proof.status}" style="text-transform: capitalize;">${proof.status}</span>
                        <span style="color: #888; font-size: 12px;">v${proof.version || 1}</span>
                    </div>
                </div>

                <!-- Comments List -->
                <div id="proofCommentsList" style="flex: 1; overflow-y: auto; padding: 16px;">
                    ${(proof.comments || []).length === 0 ? `
                        <div style="text-align: center; color: #666; padding: 40px 20px;">
                            <div style="font-size: 32px; margin-bottom: 8px;">ðŸ’¬</div>
                            <div>No comments yet</div>
                            <div style="font-size: 12px; margin-top: 4px;">Be the first to leave feedback</div>
                        </div>
                    ` : (proof.comments || []).map(c => `
                        <div style="background: #252525; border-radius: 12px; padding: 12px; margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-weight: 600; font-size: 13px;">${c.author}</span>
                                <span style="font-size: 11px; color: #888;">${new Date(c.createdAt).toLocaleString()}</span>
                            </div>
                            <div style="font-size: 14px; color: #ccc; line-height: 1.5;">${c.text}</div>
                        </div>
                    `).join('')}
                </div>

                <!-- Add Comment -->
                <div style="padding: 16px; border-top: 1px solid #333; background: #252525;">
                    <textarea id="newProofComment" rows="3" placeholder="Leave your feedback or request changes..."
                        style="width: 100%; padding: 12px; border: 1px solid #444; border-radius: 8px; background: #1a1a1a; color: #fff; font-size: 14px; resize: none; margin-bottom: 12px;"></textarea>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="addProofComment(${proof.id}, 'revision')" style="flex: 1; padding: 10px; background: #ef4444; border: none; color: #fff; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ðŸ”„ Request Changes
                        </button>
                        <button onclick="addProofComment(${proof.id}, 'approve')" style="flex: 1; padding: 10px; background: #10b981; border: none; color: #fff; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            âœ… Approve
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

// Add comment to proof
function addProofComment(proofId, action) {
    const proof = proofs.find(p => p.id === proofId);
    if (!proof) return;

    const commentText = document.getElementById('newProofComment').value.trim();
    const authorName = currentUser?.name || currentUser?.email || 'User';

    if (!commentText && action === 'revision') {
        alert('Please enter your feedback for the revision request.');
        return;
    }

    // Add comment
    proof.comments = proof.comments || [];
    if (commentText) {
        proof.comments.push({
            author: authorName,
            text: commentText,
            action: action,
            createdAt: new Date().toISOString()
        });
    }

    // Update status based on action
    if (action === 'approve') {
        proof.status = 'approved';
        proof.approvedAt = new Date().toISOString();
        saveProofToBrandAssets(proof);
        triggerProofApproved(proofId);
    } else if (action === 'revision') {
        proof.status = 'revision';
    }

    saveProofs();

    // Close modal and refresh
    document.getElementById('proofPreviewModal').remove();
    loadAdminProofsPanel();

    // Notify
    if (action === 'approve') {
        alert('âœ… Proof approved! Asset saved to brand guide.');
    } else {
        alert('ðŸ”„ Revision requested. The design team has been notified.');
    }

    // Add to CRM communications
    addCrmCommunication(proof.clientId, action === 'approve' ? 'Proof Approved' : 'Revision Requested', commentText || `Proof "${proof.name}" ${action === 'approve' ? 'approved' : 'revision requested'}`);
}

// Add communication to CRM
function addCrmCommunication(clientId, type, message) {
    const communications = JSON.parse(localStorage.getItem('nui_crm_communications')) || [];
    communications.push({
        id: Date.now(),
        clientId: clientId,
        type: type,
        message: message,
        channel: 'proof_system',
        direction: 'inbound',
        createdAt: new Date().toISOString(),
        read: false
    });
    localStorage.setItem('nui_crm_communications', JSON.stringify(communications));
}

// Storage Manager Modal
function showStorageManager() {
    const storage = getStorageUsage();
    const approvedProofs = proofs.filter(p => p.status === 'approved');
    const proofsWithImages = proofs.filter(p => p.image && p.image !== '[archived]');

    const modal = document.createElement('div');
    modal.id = 'storageManagerModal';
    modal.innerHTML = `
        <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px;">
            <div style="background: #1a1a1a; border-radius: 16px; padding: 32px; max-width: 500px; width: 100%;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="font-size: 20px;">ðŸ’¾ Storage Manager</h2>
                    <button onclick="document.getElementById('storageManagerModal').remove()" style="background: none; border: none; color: #888; font-size: 24px; cursor: pointer;">&times;</button>
                </div>

                <!-- Storage Usage -->
                <div style="background: #252525; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <span>Used Storage</span>
                        <span style="font-weight: 600;">${storage.used} / ~5 MB</span>
                    </div>
                    <div style="width: 100%; height: 12px; background: #333; border-radius: 6px; overflow: hidden;">
                        <div style="width: ${Math.min((storage.usedBytes / 5000000) * 100, 100)}%; height: 100%; background: ${(storage.usedBytes / 5000000) > 0.8 ? '#ef4444' : '#10b981'}; border-radius: 6px;"></div>
                    </div>
                </div>

                <!-- Stats -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                    <div style="background: #252525; padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 700;">${proofs.length}</div>
                        <div style="font-size: 12px; color: #888;">Total Proofs</div>
                    </div>
                    <div style="background: #252525; padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 700;">${proofsWithImages.length}</div>
                        <div style="font-size: 12px; color: #888;">With Images</div>
                    </div>
                </div>

                <!-- Cleanup Options -->
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button onclick="archiveOldProofs()" style="padding: 14px; background: #f59e0b; border: none; color: #fff; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        ðŸ“¦ Archive Old Approved Proofs (30+ days)
                        <div style="font-size: 11px; font-weight: normal; margin-top: 4px;">Keeps metadata, removes images</div>
                    </button>
                    <button onclick="clearRevisionProofs()" style="padding: 14px; background: #ef4444; border: none; color: #fff; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        ðŸ—‘ï¸ Clear Old Revision Requests
                        <div style="font-size: 11px; font-weight: normal; margin-top: 4px;">Removes revision proofs older than 60 days</div>
                    </button>
                    <button onclick="if(confirm('Delete ALL proofs? This cannot be undone!')) { proofs = []; saveProofs(); document.getElementById('storageManagerModal').remove(); loadAdminProofsPanel(); }" style="padding: 14px; background: #333; border: 1px solid #ef4444; color: #ef4444; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        âš ï¸ Delete All Proofs
                    </button>
                </div>

                <p style="color: #666; font-size: 11px; text-align: center; margin-top: 20px;">
                    ðŸ’¡ Tip: Images are compressed to ~100KB when uploaded to save space.
                </p>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function archiveOldProofs() {
    const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
    let archived = 0;

    proofs.forEach(p => {
        if (p.status === 'approved' && p.approvedAt && new Date(p.approvedAt).getTime() < thirtyDaysAgo) {
            if (p.image && p.image !== '[archived]') {
                p.image = '[archived]';
                archived++;
            }
            if (p.videoUrl && p.videoUrl !== '[archived]') {
                p.videoUrl = '[archived]';
                archived++;
            }
        }
    });

    saveProofs();
    document.getElementById('storageManagerModal').remove();
    loadAdminProofsPanel();
    alert(`âœ… Archived ${archived} proof file(s). Storage freed!`);
}

function clearRevisionProofs() {
    const sixtyDaysAgo = Date.now() - (60 * 24 * 60 * 60 * 1000);
    const before = proofs.length;

    proofs = proofs.filter(p => {
        if (p.status === 'revision' && new Date(p.createdAt).getTime() < sixtyDaysAgo) {
            return false; // Remove old revision proofs
        }
        return true;
    });

    const removed = before - proofs.length;
    saveProofs();
    document.getElementById('storageManagerModal').remove();
    loadAdminProofsPanel();
    alert(`âœ… Removed ${removed} old revision proof(s).`);
}

// ==================== DELIVERY PANEL ====================
function loadAdminDeliveryPanel() {
    const deliveredOrders = orders.filter(o => o.status === 'delivered' || o.status === 'complete');
    const pendingDelivery = orders.filter(o => o.status === 'in_progress');

    document.getElementById('adminDeliveryPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ“¦ Delivery & Proofing</h1>
            <p class="panel-subtitle">Manage final deliverables and client handoff</p>
        </div>
        <div class="stat-cards">
            <div class="stat-card"><div class="num">${pendingDelivery.length}</div><div class="lbl">Pending Delivery</div></div>
            <div class="stat-card highlight"><div class="num">${deliveredOrders.length}</div><div class="lbl">Delivered</div></div>
        </div>
        <h3 style="margin-bottom: 16px;">Ready for Delivery</h3>
        ${pendingDelivery.length === 0 ? '<div class="form-section" style="text-align: center; padding: 40px;"><p style="color: rgba(255,255,255,0.5);">No orders ready for delivery</p></div>' : pendingDelivery.map(order => {
            const client = clients.find(c => c.id === order.clientId) || { name: 'Unknown' };
            return `
                <div class="order-card">
                    <div class="order-header">
                        <div><div class="order-title">${order.project}</div><div class="order-client">${client.name}</div></div>
                        <span class="order-status in_progress">In Progress</span>
                    </div>
                    <div style="display: flex; gap: 12px; margin-top: 16px;">
                        <button class="btn-admin secondary" onclick="showUploadDeliveryModal(${order.id})">ðŸ“ Upload Files</button>
                        <button class="btn-admin primary" onclick="markDelivered(${order.id})">âœ“ Mark Delivered</button>
                    </div>
                </div>
            `;
        }).join('')}
        <h3 style="margin: 32px 0 16px;">Delivered</h3>
        ${deliveredOrders.length === 0 ? '<div class="form-section" style="text-align: center; padding: 40px;"><p style="color: rgba(255,255,255,0.5);">No deliveries yet</p></div>' : deliveredOrders.map(order => {
            const client = clients.find(c => c.id === order.clientId) || { name: 'Unknown' };
            return `
                <div class="order-card">
                    <div class="order-header">
                        <div><div class="order-title">${order.project}</div><div class="order-client">${client.name}</div></div>
                        <span class="order-status delivered">Delivered</span>
                    </div>
                </div>
            `;
        }).join('')}
    `;
}

function showUploadDeliveryModal(orderId) {
    alert('Upload delivery files for order #' + orderId + ' (File upload interface would go here)');
}

// ==================== SEO PANEL ====================
function loadAdminSeoPanel() {
    document.getElementById('adminSeoPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ” SEO / AEO / GEO Management</h1>
            <p class="panel-subtitle">Optimize for search engines, AI answer engines, and local search</p>
        </div>
        <div class="seo-grid">
            <div class="seo-card">
                <div class="seo-card-title">ðŸ“Š SEO Score</div>
                <div class="seo-score">
                    <div class="seo-score-circle good">85</div>
                    <div><p style="font-weight: 600;">Good</p><p style="font-size: 13px; color: rgba(255,255,255,0.5);">Your site is well optimized</p></div>
                </div>
            </div>
            <div class="seo-card">
                <div class="seo-card-title">ðŸ¤– AEO Readiness</div>
                <div class="seo-score">
                    <div class="seo-score-circle medium">72</div>
                    <div><p style="font-weight: 600;">Moderate</p><p style="font-size: 13px; color: rgba(255,255,255,0.5);">Add more FAQ content</p></div>
                </div>
            </div>
        </div>
        <div class="form-section">
            <div class="form-section-title">ðŸ·ï¸ Meta Tags</div>
            <div class="form-group"><label class="form-label">Page Title</label><input type="text" class="form-input" value="${seoData.siteMeta.title}" onchange="seoData.siteMeta.title = this.value; saveSeo();"></div>
            <div class="form-group"><label class="form-label">Meta Description</label><textarea class="form-textarea" onchange="seoData.siteMeta.description = this.value; saveSeo();">${seoData.siteMeta.description}</textarea></div>
            <div class="form-group">
                <label class="form-label">Keywords</label>
                <input type="text" class="form-input" value="${seoData.siteMeta.keywords}" onchange="seoData.siteMeta.keywords = this.value; saveSeo();" placeholder="Separate with commas">
            </div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">OG Image URL</label><input type="text" class="form-input" value="${seoData.siteMeta.ogImage || ''}" onchange="seoData.siteMeta.ogImage = this.value; saveSeo();" placeholder="https://..."></div>
                <div class="form-group"><label class="form-label">Twitter Handle</label><input type="text" class="form-input" value="${seoData.siteMeta.twitterHandle || ''}" onchange="seoData.siteMeta.twitterHandle = this.value; saveSeo();" placeholder="@yourhandle"></div>
            </div>
            <button class="btn-admin primary" onclick="applyMetaTags()">Apply Meta Tags to Site</button>
        </div>
        <div class="form-section">
            <div class="form-section-title">â“ AEO - FAQ Schema (For AI Answer Engines)</div>
            <p style="color: rgba(255,255,255,0.5); font-size: 13px; margin-bottom: 16px;">FAQs help AI assistants find and cite your content</p>
            ${seoData.aeoContent.faqs.map((faq, i) => `
                <div class="faq-item">
                    <div class="faq-question">${faq.question}</div>
                    <div class="faq-answer">${faq.answer}</div>
                    <button class="btn-admin danger" style="margin-top: 8px; padding: 6px 12px; font-size: 11px;" onclick="removeFaq(${i})">Remove</button>
                </div>
            `).join('')}
            <button class="btn-admin secondary" onclick="showAddFaqModal()">+ Add FAQ</button>
        </div>
    `;
}

function applyMetaTags() {
    document.title = seoData.siteMeta.title;
    let metaDesc = document.querySelector('meta[name="description"]');
    if (!metaDesc) { metaDesc = document.createElement('meta'); metaDesc.name = 'description'; document.head.appendChild(metaDesc); }
    metaDesc.content = seoData.siteMeta.description;
    let metaKeywords = document.querySelector('meta[name="keywords"]');
    if (!metaKeywords) { metaKeywords = document.createElement('meta'); metaKeywords.name = 'keywords'; document.head.appendChild(metaKeywords); }
    metaKeywords.content = seoData.siteMeta.keywords;
    alert('Meta tags applied successfully!');
}

function showAddFaqModal() {
    const q = prompt('Enter the question:');
    if (!q) return;
    const a = prompt('Enter the answer:');
    if (!a) return;
    seoData.aeoContent.faqs.push({ question: q, answer: a });
    saveSeo();
    loadAdminSeoPanel();
}

function removeFaq(idx) {
    seoData.aeoContent.faqs.splice(idx, 1);
    saveSeo();
    loadAdminSeoPanel();
}

// ==================== GOOGLE MY BUSINESS PANEL ====================
function loadAdminGmbPanel() {
    document.getElementById('adminGmbPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ“ Google My Business</h1>
            <p class="panel-subtitle">Manage your local SEO and Google Business Profile</p>
        </div>
        <div class="seo-grid">
            <div class="form-section" style="margin-bottom: 0;">
                <div class="form-section-title">ðŸ“ Business Information</div>
                <div class="form-group"><label class="form-label">Business Name</label><input type="text" class="form-input" value="${seoData.localSeo.businessName}" onchange="seoData.localSeo.businessName = this.value; saveSeo();"></div>
                <div class="form-group"><label class="form-label">Address</label><input type="text" class="form-input" value="${seoData.localSeo.address}" onchange="seoData.localSeo.address = this.value; saveSeo();"></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Phone</label><input type="tel" class="form-input" value="${seoData.localSeo.phone}" onchange="seoData.localSeo.phone = this.value; saveSeo();"></div>
                    <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" value="${seoData.localSeo.email}" onchange="seoData.localSeo.email = this.value; saveSeo();"></div>
                </div>
                <div class="form-group"><label class="form-label">Business Hours</label><input type="text" class="form-input" value="${seoData.localSeo.hours}" onchange="seoData.localSeo.hours = this.value; saveSeo();"></div>
            </div>
            <div class="form-section" style="margin-bottom: 0;">
                <div class="form-section-title">ðŸ”— Google Integration</div>
                <div class="form-group"><label class="form-label">Google Place ID</label><input type="text" class="form-input" value="${seoData.googleMyBusiness.placeId || ''}" onchange="seoData.googleMyBusiness.placeId = this.value; saveSeo();" placeholder="ChIJ..."></div>
                <div class="form-group"><label class="form-label">Review Link</label><input type="text" class="form-input" value="${seoData.googleMyBusiness.reviewLink || ''}" onchange="seoData.googleMyBusiness.reviewLink = this.value; saveSeo();" placeholder="https://g.page/..."></div>
                <div class="form-group"><label class="form-label">Map Embed URL</label><input type="text" class="form-input" value="${seoData.googleMyBusiness.mapEmbed || ''}" onchange="seoData.googleMyBusiness.mapEmbed = this.value; saveSeo();" placeholder="https://www.google.com/maps/embed..."></div>
                <div style="padding: 16px; background: rgba(255,255,255,0.03); border-radius: 8px; margin-top: 16px;">
                    <p style="font-size: 13px; color: rgba(255,255,255,0.5);">ðŸ“Œ Connect your Google My Business profile to enable review widgets and location features on your website.</p>
                </div>
            </div>
        </div>
        <div class="form-section">
            <div class="form-section-title">ðŸ—ºï¸ Service Areas</div>
            <div class="tags-input">
                ${seoData.localSeo.serviceAreas.map((area, i) => `<span class="tag">${area}<span class="tag-remove" onclick="removeServiceArea(${i})">Ã—</span></span>`).join('')}
                <input type="text" placeholder="Add area..." onkeypress="if(event.key === 'Enter') { addServiceArea(this.value); this.value = ''; }">
            </div>
        </div>
        <div class="form-section">
            <div class="form-section-title">ðŸ¢ Business Categories</div>
            <div class="tags-input">
                ${seoData.localSeo.categories.map((cat, i) => `<span class="tag">${cat}<span class="tag-remove" onclick="removeCategory(${i})">Ã—</span></span>`).join('')}
                <input type="text" placeholder="Add category..." onkeypress="if(event.key === 'Enter') { addCategory(this.value); this.value = ''; }">
            </div>
        </div>
        <div class="form-section">
            <div class="form-section-title">â­ Schema.org Data</div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Price Range</label><select class="form-select" onchange="seoData.schema.priceRange = this.value; saveSeo();">
                    <option value="$" ${seoData.schema.priceRange === '$' ? 'selected' : ''}>$ - Budget</option>
                    <option value="$$" ${seoData.schema.priceRange === '$$' ? 'selected' : ''}>$$ - Moderate</option>
                    <option value="$$$" ${seoData.schema.priceRange === '$$$' ? 'selected' : ''}>$$$ - Expensive</option>
                    <option value="$$$$" ${seoData.schema.priceRange === '$$$$' ? 'selected' : ''}>$$$$ - Luxury</option>
                </select></div>
                <div class="form-group"><label class="form-label">Rating</label><input type="text" class="form-input" value="${seoData.schema.rating}" onchange="seoData.schema.rating = this.value; saveSeo();"></div>
            </div>
        </div>
    `;
}

function addServiceArea(area) {
    if (area && !seoData.localSeo.serviceAreas.includes(area)) {
        seoData.localSeo.serviceAreas.push(area);
        saveSeo();
        loadAdminGmbPanel();
    }
}

function removeServiceArea(idx) {
    seoData.localSeo.serviceAreas.splice(idx, 1);
    saveSeo();
    loadAdminGmbPanel();
}

function addCategory(cat) {
    if (cat && !seoData.localSeo.categories.includes(cat)) {
        seoData.localSeo.categories.push(cat);
        saveSeo();
        loadAdminGmbPanel();
    }
}

function removeCategory(idx) {
    seoData.localSeo.categories.splice(idx, 1);
    saveSeo();
    loadAdminGmbPanel();
}

// ==================== EMAIL MARKETING PANEL ====================
function loadAdminEmailMarketingPanel() {
    const em = emailMarketing;
    document.getElementById('adminEmailmarketingPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ“§ Email Marketing</h1>
            <p class="panel-subtitle">Send newsletters and promotions to your subscribers</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-label">Subscribers</div><div class="stat-value">${em.subscribers.length}</div></div>
            <div class="stat-card"><div class="stat-label">Campaigns Sent</div><div class="stat-value">${em.campaigns.length}</div></div>
            <div class="stat-card"><div class="stat-label">Open Rate</div><div class="stat-value">${em.analytics.sent > 0 ? Math.round((em.analytics.opened / em.analytics.sent) * 100) : 0}%</div></div>
            <div class="stat-card"><div class="stat-label">Click Rate</div><div class="stat-value">${em.analytics.sent > 0 ? Math.round((em.analytics.clicked / em.analytics.sent) * 100) : 0}%</div></div>
        </div>

        <!-- Automated Newsletter Toggle -->
        <div class="form-section" style="background: ${em.settings.automatedSending ? 'rgba(46,204,113,0.1)' : 'rgba(255,59,48,0.1)'}; border: 1px solid ${em.settings.automatedSending ? '#2ecc71' : '#ff3b30'};">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div class="form-section-title" style="margin: 0;">ðŸ¤– Automated Weekly Newsletter</div>
                    <p style="color: rgba(255,255,255,0.5); font-size: 13px; margin: 8px 0 0;">Send newsletters automatically every ${em.settings.sendDay} at ${em.settings.sendTime}</p>
                </div>
                <label class="switch">
                    <input type="checkbox" ${em.settings.automatedSending ? 'checked' : ''} onchange="toggleAutomatedEmail(this.checked)">
                    <span class="slider round"></span>
                </label>
            </div>
        </div>

        <!-- Schedule Settings -->
        <div class="form-section">
            <div class="form-section-title">â° Schedule Settings</div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Send Day</label>
                    <select class="form-select" onchange="updateEmailSchedule('sendDay', this.value)">
                        <option value="monday" ${em.settings.sendDay === 'monday' ? 'selected' : ''}>Monday</option>
                        <option value="tuesday" ${em.settings.sendDay === 'tuesday' ? 'selected' : ''}>Tuesday</option>
                        <option value="wednesday" ${em.settings.sendDay === 'wednesday' ? 'selected' : ''}>Wednesday</option>
                        <option value="thursday" ${em.settings.sendDay === 'thursday' ? 'selected' : ''}>Thursday</option>
                        <option value="friday" ${em.settings.sendDay === 'friday' ? 'selected' : ''}>Friday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Send Time</label>
                    <input type="time" class="form-input" value="${em.settings.sendTime}" onchange="updateEmailSchedule('sendTime', this.value)">
                </div>
                <div class="form-group">
                    <label class="form-label">Sender Name</label>
                    <input type="text" class="form-input" value="${em.settings.senderName}" onchange="updateEmailSchedule('senderName', this.value)">
                </div>
                <div class="form-group">
                    <label class="form-label">Sender Email</label>
                    <input type="email" class="form-input" value="${em.settings.senderEmail}" onchange="updateEmailSchedule('senderEmail', this.value)">
                </div>
            </div>
        </div>

        <!-- Create Campaign -->
        <div style="display: flex; gap: 12px; margin-bottom: 24px;">
            <button class="btn-admin primary" onclick="showCreateCampaignModal()">ðŸ“ Create Campaign</button>
            <button class="btn-admin secondary" onclick="showAddSubscriberModal()">âž• Add Subscriber</button>
            <button class="btn-admin secondary" onclick="exportSubscribersCSV()">ðŸ“¥ Export Subscribers</button>
        </div>

        <!-- Templates -->
        <div class="form-section">
            <div class="form-section-title">ðŸ“‹ Email Templates</div>
            <div class="card-grid">
                ${em.templates.map(t => `
                    <div class="client-card" style="cursor: pointer;" onclick="editEmailTemplate(${t.id})">
                        <div class="client-card-header" style="background: linear-gradient(135deg, ${t.type === 'newsletter' ? '#3b82f6' : t.type === 'promo' ? '#f59e0b' : '#8b5cf6'}, #000); height: 80px;">
                            <span style="font-size: 24px;">${t.type === 'newsletter' ? 'ðŸ“°' : t.type === 'promo' ? 'ðŸŽ' : 'ðŸ“¢'}</span>
                        </div>
                        <div class="client-card-body">
                            <div class="client-card-name">${t.name}</div>
                            <div class="client-card-meta">${t.subject}</div>
                            <div class="client-card-btns">
                                <button onclick="event.stopPropagation(); useEmailTemplate(${t.id})" style="background: var(--red); color: #fff;">Use Template</button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>

        <!-- Recent Campaigns -->
        <div class="form-section">
            <div class="form-section-title">ðŸ“Š Recent Campaigns</div>
            <table class="data-table">
                <thead><tr><th>Campaign</th><th>Sent</th><th>Opens</th><th>Clicks</th><th>Date</th><th>Status</th></tr></thead>
                <tbody>
                    ${em.campaigns.length === 0 ? '<tr><td colspan="6" style="text-align: center; opacity: 0.5;">No campaigns yet</td></tr>' : ''}
                    ${em.campaigns.slice(-10).reverse().map(c => `
                        <tr>
                            <td>${c.subject}</td>
                            <td>${c.sent || 0}</td>
                            <td>${c.opens || 0}</td>
                            <td>${c.clicks || 0}</td>
                            <td>${new Date(c.createdAt).toLocaleDateString()}</td>
                            <td><span class="status-badge ${c.status}">${c.status}</span></td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>

        <!-- Subscribers List -->
        <div class="form-section">
            <div class="form-section-title">ðŸ‘¥ Subscribers (${em.subscribers.length})</div>
            <div style="max-height: 300px; overflow-y: auto;">
                <table class="data-table">
                    <thead><tr><th>Email</th><th>Name</th><th>Source</th><th>Subscribed</th><th>Actions</th></tr></thead>
                    <tbody>
                        ${em.subscribers.length === 0 ? '<tr><td colspan="5" style="text-align: center; opacity: 0.5;">No subscribers yet</td></tr>' : ''}
                        ${em.subscribers.map(s => `
                            <tr>
                                <td>${s.email}</td>
                                <td>${s.name || '-'}</td>
                                <td>${s.source || 'manual'}</td>
                                <td>${new Date(s.subscribedAt).toLocaleDateString()}</td>
                                <td><button class="btn-admin small danger" onclick="removeSubscriber('${s.email}')">Remove</button></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function toggleAutomatedEmail(enabled) {
    emailMarketing.settings.automatedSending = enabled;
    saveEmailMarketing();
    loadAdminEmailMarketingPanel();
}

function updateEmailSchedule(key, value) {
    emailMarketing.settings[key] = value;
    saveEmailMarketing();
}

function showCreateCampaignModal() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'campaignModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header"><h3 class="modal-title">Create Email Campaign</h3><button class="modal-close" onclick="document.getElementById('campaignModal').remove()">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Subject Line *</label><input type="text" id="campaignSubject" class="form-input" placeholder="Your eye-catching subject line"></div>
                <div class="form-group"><label class="form-label">Preview Text</label><input type="text" id="campaignPreview" class="form-input" placeholder="Brief preview shown in inbox"></div>
                <div class="form-group"><label class="form-label">Email Content *</label><textarea id="campaignContent" class="form-textarea" rows="10" placeholder="Write your email content here... Use {name} for personalization."></textarea></div>
                <div class="form-group">
                    <label class="form-label">Send To</label>
                    <select id="campaignAudience" class="form-select">
                        <option value="all">All Subscribers (${emailMarketing.subscribers.length})</option>
                        <option value="clients">Clients Only</option>
                        <option value="leads">Leads Only</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-admin secondary" onclick="document.getElementById('campaignModal').remove()">Cancel</button>
                <button class="btn-admin secondary" onclick="saveCampaignDraft()">Save Draft</button>
                <button class="btn-admin primary" onclick="sendCampaign()">Send Now</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function sendCampaign() {
    const subject = document.getElementById('campaignSubject').value;
    const content = document.getElementById('campaignContent').value;
    const audience = document.getElementById('campaignAudience').value;

    if (!subject || !content) {
        alert('Please fill in subject and content.');
        return;
    }

    const campaign = {
        id: Date.now(),
        subject: subject,
        preview: document.getElementById('campaignPreview').value,
        content: content,
        audience: audience,
        sent: emailMarketing.subscribers.length,
        opens: Math.floor(emailMarketing.subscribers.length * 0.35),
        clicks: Math.floor(emailMarketing.subscribers.length * 0.12),
        status: 'sent',
        createdAt: new Date().toISOString()
    };

    emailMarketing.campaigns.push(campaign);
    emailMarketing.analytics.sent += campaign.sent;
    emailMarketing.analytics.opened += campaign.opens;
    emailMarketing.analytics.clicked += campaign.clicks;
    saveEmailMarketing();

    document.getElementById('campaignModal').remove();
    loadAdminEmailMarketingPanel();
    alert('Campaign sent to ' + campaign.sent + ' subscribers!');
}

function showAddSubscriberModal() {
    const email = prompt('Enter subscriber email:');
    if (!email || !validateEmail(email)) {
        if (email) alert('Please enter a valid email address.');
        return;
    }

    if (emailMarketing.subscribers.find(s => s.email.toLowerCase() === email.toLowerCase())) {
        alert('This email is already subscribed.');
        return;
    }

    const name = prompt('Enter subscriber name (optional):');

    emailMarketing.subscribers.push({
        email: email,
        name: name || '',
        source: 'manual',
        subscribedAt: new Date().toISOString()
    });
    saveEmailMarketing();
    loadAdminEmailMarketingPanel();
    alert('Subscriber added!');
}

function removeSubscriber(email) {
    if (!confirm('Remove ' + email + ' from subscribers?')) return;
    emailMarketing.subscribers = emailMarketing.subscribers.filter(s => s.email !== email);
    saveEmailMarketing();
    loadAdminEmailMarketingPanel();
}

function useEmailTemplate(templateId) {
    const template = emailMarketing.templates.find(t => t.id === templateId);
    if (!template) {
        alert('Template not found');
        return;
    }

    // Pre-fill the campaign modal with template data
    showCreateCampaignModal();

    // Wait for modal to render then populate
    setTimeout(() => {
        const subjectInput = document.getElementById('campaignSubject');
        const contentInput = document.getElementById('campaignContent');
        if (subjectInput) subjectInput.value = template.subject || '';
        if (contentInput) contentInput.value = template.content || template.body || '';
    }, 100);
}

function editEmailTemplate(templateId) {
    const template = emailMarketing.templates.find(t => t.id === templateId);
    if (!template) return;

    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'editTemplateModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 600px; background: #1a1a1a; color: #fff;">
            <div class="modal-header" style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                <h3 class="modal-title" style="color: #fff;">âœï¸ Edit Template: ${template.name}</h3>
                <button class="modal-close" onclick="document.getElementById('editTemplateModal').remove()" style="color: #fff;">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Template Name</label>
                    <input type="text" id="editTemplateName" class="form-input" value="${template.name}" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Subject Line</label>
                    <input type="text" id="editTemplateSubject" class="form-input" value="${template.subject || ''}" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Type</label>
                    <select id="editTemplateType" class="form-select" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                        <option value="newsletter" ${template.type === 'newsletter' ? 'selected' : ''}>ðŸ“° Newsletter</option>
                        <option value="promo" ${template.type === 'promo' ? 'selected' : ''}>ðŸŽ Promotional</option>
                        <option value="announcement" ${template.type === 'announcement' ? 'selected' : ''}>ðŸ“¢ Announcement</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Content</label>
                    <textarea id="editTemplateContent" class="form-textarea" rows="8" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">${template.content || template.body || ''}</textarea>
                </div>
            </div>
            <div class="modal-footer" style="border-top: 1px solid rgba(255,255,255,0.1);">
                <button class="btn-admin secondary" onclick="document.getElementById('editTemplateModal').remove()" style="background: #333; color: #fff;">Cancel</button>
                <button class="btn-admin danger" onclick="deleteEmailTemplate(${templateId})" style="background: #dc2626; color: #fff;">Delete</button>
                <button class="btn-admin primary" onclick="saveEmailTemplate(${templateId})" style="background: var(--red); color: #fff;">Save Changes</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function saveEmailTemplate(templateId) {
    const template = emailMarketing.templates.find(t => t.id === templateId);
    if (!template) return;

    template.name = document.getElementById('editTemplateName').value;
    template.subject = document.getElementById('editTemplateSubject').value;
    template.type = document.getElementById('editTemplateType').value;
    template.content = document.getElementById('editTemplateContent').value;
    template.body = document.getElementById('editTemplateContent').value;

    saveEmailMarketing();
    document.getElementById('editTemplateModal').remove();
    loadAdminEmailMarketingPanel();
    alert('Template saved!');
}

function deleteEmailTemplate(templateId) {
    if (!confirm('Delete this template?')) return;
    emailMarketing.templates = emailMarketing.templates.filter(t => t.id !== templateId);
    saveEmailMarketing();
    document.getElementById('editTemplateModal').remove();
    loadAdminEmailMarketingPanel();
}

function showCreateProductModal() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'createProductModal';
    modal.innerHTML = `
        <div class="modal" style="background: #1a1a1a; color: #fff;">
            <div class="modal-header" style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                <h3 class="modal-title" style="color: #fff;">âž• Create New Product/Service</h3>
                <button class="modal-close" onclick="document.getElementById('createProductModal').remove()" style="color: #fff;">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Product/Service Name *</label>
                    <input type="text" id="newProductName" class="form-input" placeholder="e.g., Custom Logo Design" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Type</label>
                    <select id="newProductType" class="form-select" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                        <option value="service">Individual Service</option>
                        <option value="package">Package</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Price *</label>
                    <input type="number" id="newProductPrice" class="form-input" placeholder="0.00" step="0.01" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Turnaround Time</label>
                    <input type="text" id="newProductTurnaround" class="form-input" placeholder="e.g., 3-5 days" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Description</label>
                    <textarea id="newProductDescription" class="form-textarea" rows="3" placeholder="Service description..." style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Category</label>
                    <select id="newProductCategory" class="form-select" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                        <option value="branding">Branding</option>
                        <option value="web">Web Development</option>
                        <option value="print">Print Design</option>
                        <option value="marketing">Marketing</option>
                        <option value="social">Social Media</option>
                        <option value="video">Video Production</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer" style="border-top: 1px solid rgba(255,255,255,0.1);">
                <button class="btn-admin secondary" onclick="document.getElementById('createProductModal').remove()" style="background: #333; color: #fff;">Cancel</button>
                <button class="btn-admin primary" onclick="saveNewProduct()" style="background: var(--red); color: #fff;">Create Product</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function saveNewProduct() {
    const name = document.getElementById('newProductName').value.trim();
    const price = parseFloat(document.getElementById('newProductPrice').value) || 0;
    const type = document.getElementById('newProductType').value;
    const turnaround = document.getElementById('newProductTurnaround').value || '3-5 days';
    const description = document.getElementById('newProductDescription').value;
    const category = document.getElementById('newProductCategory').value;

    if (!name || !price) {
        alert('Please enter product name and price');
        return;
    }

    const newProduct = {
        id: Date.now(),
        name: name,
        price: price,
        turnaround: turnaround,
        description: description,
        category: category
    };

    if (type === 'package') {
        servicePackages.push(newProduct);
        localStorage.setItem('nui_service_packages', JSON.stringify(servicePackages));
    } else {
        individualServices.push(newProduct);
        localStorage.setItem('nui_individual_services', JSON.stringify(individualServices));
    }

    document.getElementById('createProductModal').remove();

    // If invoice modal is open, refresh the dropdowns
    const invoiceModal = document.getElementById('createInvoiceModal');
    if (invoiceModal) {
        const packagesSelect = document.getElementById('quickAddPackage');
        const servicesSelect = document.getElementById('quickAddService');
        if (packagesSelect) {
            packagesSelect.innerHTML = '<option value="">-- Select Package --</option>' +
                servicePackages.map(p => '<option value="' + p.id + '">' + p.name + ' - $' + p.price + '</option>').join('');
        }
        if (servicesSelect) {
            servicesSelect.innerHTML = '<option value="">-- Select Service --</option>' +
                individualServices.map(s => '<option value="' + s.id + '">' + s.name + ' - $' + s.price + '</option>').join('');
        }
    }

    alert('Product "' + name + '" created successfully! Price: $' + price);
}

// ==================== LOYALTY PROGRAM PANEL ====================
function loadAdminLoyaltyPanel() {
    const lp = loyaltyProgram;
    document.getElementById('adminLoyaltyPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸŽ Loyalty Program</h1>
            <p class="panel-subtitle">Reward your loyal clients with points and discounts</p>
        </div>

        <!-- Program Toggle -->
        <div class="form-section" style="background: ${lp.enabled ? 'rgba(46,204,113,0.1)' : 'rgba(255,59,48,0.1)'}; border: 1px solid ${lp.enabled ? '#2ecc71' : '#ff3b30'};">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div class="form-section-title" style="margin: 0;">ðŸŽ¯ Loyalty Program Status</div>
                    <p style="color: rgba(255,255,255,0.5); font-size: 13px; margin: 8px 0 0;">Clients earn ${lp.pointsPerDollar} point(s) per $1 spent</p>
                </div>
                <label class="switch">
                    <input type="checkbox" ${lp.enabled ? 'checked' : ''} onchange="toggleLoyaltyProgram(this.checked)">
                    <span class="slider round"></span>
                </label>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-label">Total Members</div><div class="stat-value">${lp.members.length}</div></div>
            <div class="stat-card"><div class="stat-label">Points Issued</div><div class="stat-value">${lp.members.reduce((sum, m) => sum + (m.totalEarned || 0), 0).toLocaleString()}</div></div>
            <div class="stat-card"><div class="stat-label">Points Redeemed</div><div class="stat-value">${lp.members.reduce((sum, m) => sum + (m.totalRedeemed || 0), 0).toLocaleString()}</div></div>
            <div class="stat-card"><div class="stat-label">Avg Balance</div><div class="stat-value">${lp.members.length > 0 ? Math.round(lp.members.reduce((sum, m) => sum + (m.points || 0), 0) / lp.members.length) : 0}</div></div>
        </div>

        <!-- Settings -->
        <div class="form-section">
            <div class="form-section-title">âš™ï¸ Program Settings</div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Points per $1 Spent</label>
                    <input type="number" class="form-input" value="${lp.pointsPerDollar}" min="1" onchange="updateLoyaltySetting('pointsPerDollar', parseInt(this.value))">
                </div>
            </div>
        </div>

        <!-- Reward Tiers -->
        <div class="form-section">
            <div class="form-section-title">ðŸ† Reward Tiers</div>
            <div class="card-grid">
                ${lp.rewardTiers.map((tier, i) => `
                    <div class="client-card">
                        <div class="client-card-header" style="background: linear-gradient(135deg, ${i === 0 ? '#cd7f32' : i === 1 ? '#c0c0c0' : i === 2 ? '#ffd700' : '#e5e4e2'}, #000);">
                            <span style="font-size: 24px;">${i === 0 ? 'ðŸ¥‰' : i === 1 ? 'ðŸ¥ˆ' : i === 2 ? 'ðŸ¥‡' : 'ðŸ’Ž'}</span>
                        </div>
                        <div class="client-card-body">
                            <div class="client-card-name">${tier.name}</div>
                            <div class="client-card-meta">${tier.minPoints}+ points<br>${tier.discount}% discount</div>
                            <div style="margin-top: 8px;">
                                ${tier.perks.map(p => '<span class="tag" style="font-size: 10px;">' + p + '</span>').join('')}
                            </div>
                            <div class="client-card-btns" style="margin-top: 12px;">
                                <button onclick="editLoyaltyTier(${i})" style="background: var(--red); color: #fff;">Edit</button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>

        <!-- Members -->
        <div class="form-section">
            <div class="form-section-title">ðŸ‘¥ Loyalty Members</div>
            <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                <button class="btn-admin primary" onclick="enrollClientInLoyalty()">âž• Enroll Client</button>
                <button class="btn-admin secondary" onclick="awardBonusPoints()">ðŸŽ Award Bonus Points</button>
            </div>
            <table class="data-table">
                <thead><tr><th>Client</th><th>Tier</th><th>Points</th><th>Lifetime Earned</th><th>Joined</th><th>Actions</th></tr></thead>
                <tbody>
                    ${lp.members.length === 0 ? '<tr><td colspan="6" style="text-align: center; opacity: 0.5;">No members yet. Enroll clients to get started!</td></tr>' : ''}
                    ${lp.members.map(m => {
                        const tier = lp.rewardTiers.slice().reverse().find(t => m.points >= t.minPoints) || lp.rewardTiers[0];
                        return `
                        <tr>
                            <td>${m.name}</td>
                            <td><span class="status-badge" style="background: ${tier.name === 'Bronze' ? '#cd7f32' : tier.name === 'Silver' ? '#c0c0c0' : tier.name === 'Gold' ? '#ffd700' : '#e5e4e2'}; color: #000;">${tier.name}</span></td>
                            <td style="font-weight: 600;">${(m.points || 0).toLocaleString()}</td>
                            <td>${(m.totalEarned || 0).toLocaleString()}</td>
                            <td>${new Date(m.joinedAt).toLocaleDateString()}</td>
                            <td>
                                <button class="btn-admin small" onclick="adjustLoyaltyPoints(${m.clientId})">Adjust</button>
                                <button class="btn-admin small danger" onclick="removeLoyaltyMember(${m.clientId})">Remove</button>
                            </td>
                        </tr>
                    `;}).join('')}
                </tbody>
            </table>
        </div>
    `;
}

function toggleLoyaltyProgram(enabled) {
    loyaltyProgram.enabled = enabled;
    saveLoyalty();
    loadAdminLoyaltyPanel();
}

function updateLoyaltySetting(key, value) {
    loyaltyProgram[key] = value;
    saveLoyalty();
}

function enrollClientInLoyalty() {
    const availableClients = clients.filter(c => !loyaltyProgram.members.find(m => m.clientId === c.id));
    if (availableClients.length === 0) {
        alert('All clients are already enrolled!');
        return;
    }

    const clientList = availableClients.map(c => c.name + ' (' + c.email + ')').join('\n');
    const selection = prompt('Enter client name to enroll:\n\n' + clientList);
    if (!selection) return;

    const client = availableClients.find(c => c.name.toLowerCase().includes(selection.toLowerCase()));
    if (!client) {
        alert('Client not found.');
        return;
    }

    loyaltyProgram.members.push({
        clientId: client.id,
        name: client.name,
        email: client.email,
        points: 0,
        totalEarned: 0,
        totalRedeemed: 0,
        joinedAt: new Date().toISOString()
    });
    saveLoyalty();
    loadAdminLoyaltyPanel();
    alert(client.name + ' has been enrolled in the loyalty program!');
}

function adjustLoyaltyPoints(clientId) {
    const member = loyaltyProgram.members.find(m => m.clientId === clientId);
    if (!member) return;

    const adjustment = prompt('Enter points to add (use negative for deduction). Current balance: ' + member.points);
    if (!adjustment) return;

    const points = parseInt(adjustment);
    if (isNaN(points)) return;

    member.points += points;
    if (points > 0) member.totalEarned += points;
    else member.totalRedeemed += Math.abs(points);

    saveLoyalty();
    loadAdminLoyaltyPanel();
}

function removeLoyaltyMember(clientId) {
    if (!confirm('Remove this client from the loyalty program?')) return;
    loyaltyProgram.members = loyaltyProgram.members.filter(m => m.clientId !== clientId);
    saveLoyalty();
    loadAdminLoyaltyPanel();
}

// ==================== COMMUNICATIONS HUB PANEL ====================
function loadAdminCommunicationsPanel() {
    // Combine all messages from different channels
    const allMessages = [
        ...socialMediaDM.conversations.map(c => ({...c, channel: c.platform})),
        ...smsSystem.conversations.map(c => ({...c, channel: 'sms'})),
        ...(crmData.communications || []).map(c => ({...c, channel: 'email'}))
    ].sort((a, b) => new Date(b.lastMessageAt || b.createdAt) - new Date(a.lastMessageAt || a.createdAt));

    document.getElementById('adminCommunicationsPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ’¬ Communications Hub</h1>
            <p class="panel-subtitle">All your client communications in one place</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card" style="border-left-color: #3b82f6;"><div class="stat-label">ðŸ“§ Emails</div><div class="stat-value">${(crmData.communications || []).length}</div></div>
            <div class="stat-card" style="border-left-color: #1877f2;"><div class="stat-label">ðŸ“± Facebook</div><div class="stat-value">${socialMediaDM.conversations.filter(c => c.platform === 'facebook').length}</div></div>
            <div class="stat-card" style="border-left-color: #e4405f;"><div class="stat-label">ðŸ“¸ Instagram</div><div class="stat-value">${socialMediaDM.conversations.filter(c => c.platform === 'instagram').length}</div></div>
            <div class="stat-card" style="border-left-color: #25d366;"><div class="stat-label">ðŸ“² SMS</div><div class="stat-value">${smsSystem.conversations.length}</div></div>
        </div>

        <!-- Filters -->
        <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; align-items: center;">
            <input type="text" id="commSearch" placeholder="Search conversations..."
                oninput="filterCommunications()"
                style="flex: 1; min-width: 200px; padding: 12px 16px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; font-size: 14px; background: rgba(255,255,255,0.1); color: #fff;">
            <select id="commChannelFilter" onchange="filterCommunications()" style="padding: 12px 16px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.1); color: #fff;">
                <option value="all">All Channels</option>
                <option value="email">ðŸ“§ Email</option>
                <option value="facebook">ðŸ“± Facebook</option>
                <option value="instagram">ðŸ“¸ Instagram</option>
                <option value="sms">ðŸ“² SMS</option>
            </select>
            <button class="btn-admin primary" onclick="composeNewMessage()">âœ‰ï¸ New Message</button>
        </div>

        <!-- Unified Inbox -->
        <div class="form-section">
            <div class="form-section-title">ðŸ“¥ Unified Inbox</div>
            <div id="unifiedInbox" style="max-height: 500px; overflow-y: auto;">
                ${allMessages.length === 0 ? '<p style="text-align: center; opacity: 0.5; padding: 40px;">No conversations yet. Connect your channels to get started!</p>' : ''}
                ${allMessages.slice(0, 50).map(msg => `
                    <div class="conversation-item" style="display: flex; gap: 16px; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 8px; margin-bottom: 8px; cursor: pointer;" onclick="openConversation('${msg.channel}', ${msg.id})">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: ${msg.channel === 'facebook' ? '#1877f2' : msg.channel === 'instagram' ? '#e4405f' : msg.channel === 'sms' ? '#25d366' : '#3b82f6'}; display: flex; align-items: center; justify-content: center;">
                            ${msg.channel === 'facebook' ? 'ðŸ“±' : msg.channel === 'instagram' ? 'ðŸ“¸' : msg.channel === 'sms' ? 'ðŸ“²' : 'ðŸ“§'}
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between;">
                                <strong>${msg.contactName || msg.name || msg.from || 'Unknown'}</strong>
                                <span style="font-size: 12px; opacity: 0.5;">${msg.lastMessageAt ? new Date(msg.lastMessageAt).toLocaleString() : ''}</span>
                            </div>
                            <p style="margin: 4px 0 0; font-size: 13px; opacity: 0.7; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${msg.lastMessage || msg.preview || 'No messages'}</p>
                        </div>
                        ${msg.unread ? '<div style="width: 10px; height: 10px; background: var(--red); border-radius: 50%;"></div>' : ''}
                    </div>
                `).join('')}
            </div>
        </div>

        <!-- Quick Connect -->
        <div class="form-section">
            <div class="form-section-title">ðŸ”— Channel Connections</div>
            <div class="card-grid">
                <div class="client-card" onclick="showAdminPanel('socialdm')">
                    <div class="client-card-header" style="background: linear-gradient(135deg, #1877f2, #000);">ðŸ“±</div>
                    <div class="client-card-body">
                        <div class="client-card-name">Facebook</div>
                        <div class="client-card-meta">${socialMediaDM.connected.facebook.connected ? 'âœ… Connected' : 'âŒ Not Connected'}</div>
                    </div>
                </div>
                <div class="client-card" onclick="showAdminPanel('socialdm')">
                    <div class="client-card-header" style="background: linear-gradient(135deg, #e4405f, #000);">ðŸ“¸</div>
                    <div class="client-card-body">
                        <div class="client-card-name">Instagram</div>
                        <div class="client-card-meta">${socialMediaDM.connected.instagram.connected ? 'âœ… Connected' : 'âŒ Not Connected'}</div>
                    </div>
                </div>
                <div class="client-card" onclick="showAdminPanel('sms')">
                    <div class="client-card-header" style="background: linear-gradient(135deg, #25d366, #000);">ðŸ“²</div>
                    <div class="client-card-body">
                        <div class="client-card-name">OpenPhone SMS</div>
                        <div class="client-card-meta">${smsSystem.openPhone.connected ? 'âœ… Connected' : 'âŒ Not Connected'}</div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function composeNewMessage() {
    const channel = prompt('Select channel (email, sms, facebook, instagram):');
    if (!channel) return;

    if (channel === 'sms') {
        showAdminPanel('sms');
    } else if (channel === 'facebook' || channel === 'instagram') {
        showAdminPanel('socialdm');
    } else {
        alert('Compose email feature - In production, this would open your email client.');
    }
}

// ==================== SOCIAL DM PANEL ====================
function loadAdminSocialDmPanel() {
    const sm = socialMediaDM;
    document.getElementById('adminSocialdmPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ“± Social Media DMs</h1>
            <p class="panel-subtitle">Manage Facebook and Instagram direct messages</p>
        </div>

        <!-- Connection Status -->
        <div class="stats-grid">
            <div class="stat-card" style="border-left-color: #1877f2;">
                <div class="stat-label">Facebook</div>
                <div class="stat-value" style="font-size: 18px;">${sm.connected.facebook.connected ? 'âœ… ' + sm.connected.facebook.pageName : 'âŒ Not Connected'}</div>
                <button class="btn-admin small ${sm.connected.facebook.connected ? 'danger' : 'primary'}" style="margin-top: 8px;" onclick="${sm.connected.facebook.connected ? 'disconnectSocial(\'facebook\')' : 'connectFacebook()'}">
                    ${sm.connected.facebook.connected ? 'Disconnect' : 'Connect'}
                </button>
            </div>
            <div class="stat-card" style="border-left-color: #e4405f;">
                <div class="stat-label">Instagram</div>
                <div class="stat-value" style="font-size: 18px;">${sm.connected.instagram.connected ? 'âœ… @' + sm.connected.instagram.username : 'âŒ Not Connected'}</div>
                <button class="btn-admin small ${sm.connected.instagram.connected ? 'danger' : 'primary'}" style="margin-top: 8px;" onclick="${sm.connected.instagram.connected ? 'disconnectSocial(\'instagram\')' : 'connectInstagram()'}">
                    ${sm.connected.instagram.connected ? 'Disconnect' : 'Connect'}
                </button>
            </div>
        </div>

        <!-- Auto-Response Toggle -->
        <div class="form-section" style="background: ${sm.settings.autoReplyEnabled ? 'rgba(46,204,113,0.1)' : 'rgba(255,59,48,0.1)'};">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div class="form-section-title" style="margin: 0;">ðŸ¤– Auto-Response</div>
                    <p style="color: rgba(255,255,255,0.5); font-size: 13px; margin: 8px 0 0;">Automatically respond to common inquiries</p>
                </div>
                <label class="switch">
                    <input type="checkbox" ${sm.settings.autoReplyEnabled ? 'checked' : ''} onchange="toggleSocialAutoReply(this.checked)">
                    <span class="slider round"></span>
                </label>
            </div>
        </div>

        <!-- Auto-Responses -->
        <div class="form-section">
            <div class="form-section-title">ðŸ’¬ Auto-Response Templates</div>
            <div style="margin-bottom: 16px;">
                <button class="btn-admin primary" onclick="addSocialAutoResponse()">+ Add Auto-Response</button>
            </div>
            <table class="data-table">
                <thead><tr><th>Trigger Word</th><th>Platform</th><th>Response</th><th>Actions</th></tr></thead>
                <tbody>
                    ${sm.autoResponses.map((ar, i) => `
                        <tr>
                            <td><span class="tag">${ar.trigger}</span></td>
                            <td>${ar.platform}</td>
                            <td style="max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${ar.message}</td>
                            <td>
                                <button class="btn-admin small" onclick="editSocialAutoResponse(${i})">Edit</button>
                                <button class="btn-admin small danger" onclick="deleteSocialAutoResponse(${i})">Delete</button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>

        <!-- Conversations -->
        <div class="form-section">
            <div class="form-section-title">ðŸ“¥ Recent Conversations (${sm.conversations.length})</div>
            <div style="max-height: 400px; overflow-y: auto;">
                ${sm.conversations.length === 0 ? '<p style="text-align: center; opacity: 0.5; padding: 40px;">No conversations yet. Connect your accounts to start receiving DMs!</p>' : ''}
                ${sm.conversations.map(conv => `
                    <div style="display: flex; gap: 12px; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 8px; margin-bottom: 8px;">
                        <div style="width: 48px; height: 48px; border-radius: 50%; background: ${conv.platform === 'facebook' ? '#1877f2' : '#e4405f'}; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            ${conv.platform === 'facebook' ? 'ðŸ“±' : 'ðŸ“¸'}
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <strong>${conv.contactName}</strong>
                                    <span style="font-size: 12px; opacity: 0.5; margin-left: 8px;">@${conv.username || 'user'}</span>
                                </div>
                                <span style="font-size: 12px; opacity: 0.5;">${new Date(conv.lastMessageAt).toLocaleString()}</span>
                            </div>
                            <p style="margin: 4px 0 8px; font-size: 14px; opacity: 0.8;">${conv.lastMessage}</p>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn-admin small primary" onclick="openSocialConversation(${conv.id})">Reply</button>
                                <button class="btn-admin small" onclick="viewSocialConversation(${conv.id})">View</button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>

        <!-- Demo/Test Button -->
        <div class="form-section">
            <div class="form-section-title">ðŸ§ª Test & Demo</div>
            <button class="btn-admin secondary" onclick="simulateSocialDM()">Simulate Incoming DM</button>
        </div>
    `;
}

function connectFacebook() {
    // In production, this would use Facebook Graph API OAuth
    const pageName = prompt('Enter your Facebook Page name (for demo):');
    if (!pageName) return;

    socialMediaDM.connected.facebook = {
        connected: true,
        pageId: 'demo_' + Date.now(),
        accessToken: 'demo_token',
        pageName: pageName
    };
    saveSocialDM();
    loadAdminSocialDmPanel();
    alert('Facebook page "' + pageName + '" connected successfully!');
}

function connectInstagram() {
    const username = prompt('Enter your Instagram username (for demo):');
    if (!username) return;

    socialMediaDM.connected.instagram = {
        connected: true,
        accountId: 'demo_' + Date.now(),
        accessToken: 'demo_token',
        username: username.replace('@', '')
    };
    saveSocialDM();
    loadAdminSocialDmPanel();
    alert('Instagram @' + username + ' connected successfully!');
}

function disconnectSocial(platform) {
    if (!confirm('Disconnect ' + platform + '?')) return;
    socialMediaDM.connected[platform] = { connected: false };
    saveSocialDM();
    loadAdminSocialDmPanel();
}

function toggleSocialAutoReply(enabled) {
    socialMediaDM.settings.autoReplyEnabled = enabled;
    saveSocialDM();
}

function addSocialAutoResponse() {
    const trigger = prompt('Enter trigger word (e.g., "pricing", "hello", "hours"):');
    if (!trigger) return;

    const message = prompt('Enter auto-response message:');
    if (!message) return;

    socialMediaDM.autoResponses.push({
        id: Date.now(),
        trigger: trigger.toLowerCase(),
        platform: 'all',
        message: message
    });
    saveSocialDM();
    loadAdminSocialDmPanel();
}

function deleteSocialAutoResponse(index) {
    if (!confirm('Delete this auto-response?')) return;
    socialMediaDM.autoResponses.splice(index, 1);
    saveSocialDM();
    loadAdminSocialDmPanel();
}

function simulateSocialDM() {
    const platforms = ['facebook', 'instagram'];
    const platform = platforms[Math.floor(Math.random() * 2)];
    const names = ['Sarah Johnson', 'Mike Peters', 'Emily Chen', 'David Kim', 'Lisa Brown'];
    const messages = [
        'Hi! What are your pricing options?',
        'Hello, do you offer logo design?',
        'Hey! What are your business hours?',
        'Interested in branding services. Can we chat?',
        'Love your work! How can I hire you?'
    ];

    const conversation = {
        id: Date.now(),
        platform: platform,
        contactName: names[Math.floor(Math.random() * names.length)],
        username: 'user' + Math.floor(Math.random() * 9999),
        lastMessage: messages[Math.floor(Math.random() * messages.length)],
        lastMessageAt: new Date().toISOString(),
        unread: true,
        messages: []
    };

    socialMediaDM.conversations.unshift(conversation);
    saveSocialDM();
    loadAdminSocialDmPanel();
    alert('New ' + platform + ' DM received from ' + conversation.contactName + '!');
}

// ==================== SMS / OPENPHONE PANEL ====================
function loadAdminSmsPanel() {
    const sms = smsSystem;
    document.getElementById('adminSmsPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ“² SMS Communications</h1>
            <p class="panel-subtitle">Manage SMS through OpenPhone integration</p>
        </div>

        <!-- OpenPhone Connection -->
        <div class="form-section" style="background: ${sms.openPhone.connected ? 'rgba(46,204,113,0.1)' : 'rgba(255,59,48,0.1)'}; border: 1px solid ${sms.openPhone.connected ? '#2ecc71' : '#ff3b30'};">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div class="form-section-title" style="margin: 0;">ðŸ“± OpenPhone Connection</div>
                    <p style="color: rgba(255,255,255,0.5); font-size: 13px; margin: 8px 0 0;">
                        ${sms.openPhone.connected ? 'Connected: ' + sms.openPhone.phoneNumber : 'Connect your OpenPhone account to send/receive SMS'}
                    </p>
                </div>
                <button class="btn-admin ${sms.openPhone.connected ? 'danger' : 'primary'}" onclick="${sms.openPhone.connected ? 'disconnectOpenPhone()' : 'connectOpenPhone()'}">
                    ${sms.openPhone.connected ? 'Disconnect' : 'Connect OpenPhone'}
                </button>
            </div>
        </div>

        <!-- API Configuration -->
        ${!sms.openPhone.connected ? `
        <div class="form-section">
            <div class="form-section-title">ðŸ”‘ OpenPhone API Configuration</div>
            <div class="form-group">
                <label class="form-label">API Key</label>
                <input type="password" id="openPhoneApiKey" class="form-input" placeholder="Enter your OpenPhone API key">
            </div>
            <div class="form-group">
                <label class="form-label">Phone Number</label>
                <input type="tel" id="openPhoneNumber" class="form-input" placeholder="+1 (313) 555-0123">
            </div>
            <button class="btn-admin primary" onclick="saveOpenPhoneConfig()">Save & Connect</button>
            <p style="font-size: 12px; opacity: 0.5; margin-top: 12px;">
                Get your API key from <a href="https://app.openphone.com/settings/api" target="_blank" style="color: var(--red);">OpenPhone Settings â†’ API</a>
            </p>
        </div>
        ` : ''}

        <!-- Auto-Response Settings -->
        <div class="form-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div class="form-section-title" style="margin: 0;">ðŸ¤– Auto-Response Settings</div>
                <label class="switch">
                    <input type="checkbox" ${sms.settings.autoReplyEnabled ? 'checked' : ''} onchange="toggleSmsAutoReply(this.checked)">
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Business Hours Only</label>
                    <select class="form-select" onchange="updateSmsSetting('businessHoursOnly', this.value === 'true')">
                        <option value="true" ${sms.settings.businessHoursOnly ? 'selected' : ''}>Yes</option>
                        <option value="false" ${!sms.settings.businessHoursOnly ? 'selected' : ''}>No (24/7)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Start Time</label>
                    <input type="time" class="form-input" value="${sms.settings.businessHours.start}" onchange="updateSmsBusinessHours('start', this.value)">
                </div>
                <div class="form-group">
                    <label class="form-label">End Time</label>
                    <input type="time" class="form-input" value="${sms.settings.businessHours.end}" onchange="updateSmsBusinessHours('end', this.value)">
                </div>
            </div>
        </div>

        <!-- SMS Templates -->
        <div class="form-section">
            <div class="form-section-title">ðŸ“ SMS Templates</div>
            <div style="margin-bottom: 16px;">
                <button class="btn-admin primary" onclick="addSmsTemplate()">+ Add Template</button>
            </div>
            <div class="card-grid">
                ${sms.templates.map(t => `
                    <div class="client-card">
                        <div class="client-card-header" style="background: linear-gradient(135deg, #25d366, #000);">ðŸ“²</div>
                        <div class="client-card-body">
                            <div class="client-card-name">${t.name}</div>
                            <div class="client-card-meta" style="font-size: 12px; height: 40px; overflow: hidden;">${t.message}</div>
                            <div class="client-card-btns">
                                <button onclick="useSmsTemplate(${t.id})" style="background: var(--red); color: #fff;">Use</button>
                                <button onclick="editSmsTemplate(${t.id})" style="background: rgba(255,255,255,0.1); color: #fff;">Edit</button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>

        <!-- Send SMS -->
        <div class="form-section">
            <div class="form-section-title">âœ‰ï¸ Send SMS</div>
            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label class="form-label">To (Phone Number)</label>
                    <input type="tel" id="smsTo" class="form-input" placeholder="+1 (313) 555-0123">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label class="form-label">Select Client</label>
                    <select id="smsClientSelect" class="form-select" onchange="populateSmsPhone(this.value)">
                        <option value="">-- Or select client --</option>
                        ${clients.filter(c => c.phone).map(c => '<option value="' + c.phone + '">' + c.name + ' - ' + c.phone + '</option>').join('')}
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Message (<span id="smsCharCount">0</span>/160)</label>
                <textarea id="smsMessage" class="form-textarea" rows="3" placeholder="Type your message..." oninput="updateSmsCharCount()"></textarea>
            </div>
            <button class="btn-admin primary" onclick="sendSms()">ðŸ“¤ Send SMS</button>
        </div>

        <!-- Conversations -->
        <div class="form-section">
            <div class="form-section-title">ðŸ’¬ SMS Conversations (${sms.conversations.length})</div>
            <div style="max-height: 400px; overflow-y: auto;">
                ${sms.conversations.length === 0 ? '<p style="text-align: center; opacity: 0.5; padding: 40px;">No SMS conversations yet.</p>' : ''}
                ${sms.conversations.map(conv => `
                    <div style="display: flex; gap: 12px; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 8px; margin-bottom: 8px;">
                        <div style="width: 48px; height: 48px; border-radius: 50%; background: #25d366; display: flex; align-items: center; justify-content: center; font-size: 20px;">ðŸ“²</div>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between;">
                                <strong>${conv.contactName || conv.phone}</strong>
                                <span style="font-size: 12px; opacity: 0.5;">${new Date(conv.lastMessageAt).toLocaleString()}</span>
                            </div>
                            <p style="margin: 4px 0; font-size: 13px; opacity: 0.7;">${conv.phone}</p>
                            <p style="margin: 4px 0 8px; font-size: 14px;">${conv.lastMessage}</p>
                            <button class="btn-admin small primary" onclick="openSmsConversation('${conv.phone}')">Reply</button>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>

        <!-- Test -->
        <div class="form-section">
            <div class="form-section-title">ðŸ§ª Test</div>
            <button class="btn-admin secondary" onclick="simulateIncomingSms()">Simulate Incoming SMS</button>
        </div>
    `;
}

function connectOpenPhone() {
    document.getElementById('openPhoneApiKey')?.focus();
}

function saveOpenPhoneConfig() {
    const apiKey = document.getElementById('openPhoneApiKey').value;
    const phoneNumber = document.getElementById('openPhoneNumber').value;

    if (!apiKey || !phoneNumber) {
        alert('Please enter both API key and phone number.');
        return;
    }

    smsSystem.openPhone = {
        connected: true,
        apiKey: apiKey,
        phoneNumber: phoneNumber,
        userId: 'user_' + Date.now()
    };
    saveSms();
    loadAdminSmsPanel();
    alert('OpenPhone connected successfully!');
}

function disconnectOpenPhone() {
    if (!confirm('Disconnect OpenPhone?')) return;
    smsSystem.openPhone = { connected: false, apiKey: '', phoneNumber: '', userId: '' };
    saveSms();
    loadAdminSmsPanel();
}

function toggleSmsAutoReply(enabled) {
    smsSystem.settings.autoReplyEnabled = enabled;
    saveSms();
}

function updateSmsSetting(key, value) {
    smsSystem.settings[key] = value;
    saveSms();
}

function updateSmsBusinessHours(key, value) {
    smsSystem.settings.businessHours[key] = value;
    saveSms();
}

function populateSmsPhone(phone) {
    if (phone) document.getElementById('smsTo').value = phone;
}

function updateSmsCharCount() {
    const msg = document.getElementById('smsMessage').value;
    document.getElementById('smsCharCount').textContent = msg.length;
}

function sendSms() {
    const to = document.getElementById('smsTo').value;
    const message = document.getElementById('smsMessage').value;

    if (!to || !message) {
        alert('Please enter phone number and message.');
        return;
    }

    if (!smsSystem.openPhone.connected) {
        alert('Please connect OpenPhone first.');
        return;
    }

    // In production, this would use OpenPhone API
    // POST https://api.openphone.com/v1/messages
    // { from: smsSystem.openPhone.phoneNumber, to: to, content: message }

    // Add to conversations
    let conv = smsSystem.conversations.find(c => c.phone === to);
    if (!conv) {
        conv = {
            id: Date.now(),
            phone: to,
            contactName: clients.find(c => c.phone === to)?.name || '',
            messages: [],
            lastMessage: '',
            lastMessageAt: ''
        };
        smsSystem.conversations.push(conv);
    }

    conv.messages.push({ direction: 'outbound', content: message, timestamp: new Date().toISOString() });
    conv.lastMessage = message;
    conv.lastMessageAt = new Date().toISOString();

    saveSms();
    document.getElementById('smsMessage').value = '';
    updateSmsCharCount();
    loadAdminSmsPanel();
    alert('SMS sent to ' + to + '!');
}

function simulateIncomingSms() {
    const phones = ['+1 (313) 555-0101', '+1 (313) 555-0202', '+1 (313) 555-0303'];
    const names = ['John Doe', 'Jane Smith', 'Bob Wilson'];
    const messages = [
        'Hi! I received your email. When can we chat?',
        'Thanks for the quote! I have a few questions.',
        'Is the project still on track for next week?',
        'Got it, thanks!'
    ];

    const phone = phones[Math.floor(Math.random() * phones.length)];
    const name = names[Math.floor(Math.random() * names.length)];
    const message = messages[Math.floor(Math.random() * messages.length)];

    let conv = smsSystem.conversations.find(c => c.phone === phone);
    if (!conv) {
        conv = { id: Date.now(), phone: phone, contactName: name, messages: [], lastMessage: '', lastMessageAt: '' };
        smsSystem.conversations.push(conv);
    }

    conv.messages.push({ direction: 'inbound', content: message, timestamp: new Date().toISOString() });
    conv.lastMessage = message;
    conv.lastMessageAt = new Date().toISOString();

    saveSms();
    loadAdminSmsPanel();
    alert('New SMS received from ' + name + ': "' + message + '"');
}

function addSmsTemplate() {
    const name = prompt('Template name:');
    if (!name) return;

    const message = prompt('Message (use {name}, {invoice}, {time} for placeholders):');
    if (!message) return;

    smsSystem.templates.push({ id: Date.now(), name: name, message: message });
    saveSms();
    loadAdminSmsPanel();
}

function useSmsTemplate(id) {
    const template = smsSystem.templates.find(t => t.id === id);
    if (template) {
        document.getElementById('smsMessage').value = template.message;
        updateSmsCharCount();
    }
}

// ==================== SITE IMAGES PANEL ====================
function loadAdminSiteImagesPanel() {
    document.getElementById('adminSiteimagesPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ–¼ï¸ Site Images</h1>
            <p class="panel-subtitle">Manage images across the entire website</p>
        </div>
        <div class="form-section">
            <div class="form-section-title">ðŸ  Homepage Images</div>
            <div class="card-grid">
                <div class="image-upload-card">
                    <div class="image-upload-preview">
                        ${siteImages.hero.url ? `<img src="${siteImages.hero.url}" alt="Hero">` : '<span class="placeholder">ðŸ–¼ï¸</span>'}
                        <div class="image-upload-overlay">
                            <button class="btn-admin primary" onclick="document.getElementById('heroImageUpload').click()">Upload</button>
                            ${siteImages.hero.url ? `<button class="btn-admin danger" onclick="clearSiteImage('hero')">Remove</button>` : ''}
                        </div>
                    </div>
                    <input type="file" id="heroImageUpload" accept="image/*" style="display: none;" onchange="uploadSiteImage('hero', this)">
                    <div class="image-upload-info"><span class="image-upload-label">Hero Background</span><span class="image-upload-hint">1920x1080 recommended</span></div>
                </div>
                <div class="image-upload-card">
                    <div class="image-upload-preview">
                        ${siteImages.about.url ? `<img src="${siteImages.about.url}" alt="About">` : '<span class="placeholder">ðŸ–¼ï¸</span>'}
                        <div class="image-upload-overlay">
                            <button class="btn-admin primary" onclick="document.getElementById('aboutImageUpload').click()">Upload</button>
                            ${siteImages.about.url ? `<button class="btn-admin danger" onclick="clearSiteImage('about')">Remove</button>` : ''}
                        </div>
                    </div>
                    <input type="file" id="aboutImageUpload" accept="image/*" style="display: none;" onchange="uploadSiteImage('about', this)">
                    <div class="image-upload-info"><span class="image-upload-label">About Section</span><span class="image-upload-hint">1200x800 recommended</span></div>
                </div>
            </div>
        </div>
        <div class="form-section">
            <div class="form-section-title">ðŸ“¦ Service Package Images</div>
            <div class="card-grid">
                ${siteImages.services.map(service => `
                    <div class="image-upload-card">
                        <div class="image-upload-preview">
                            ${service.url ? `<img src="${service.url}" alt="${service.alt}">` : '<span class="placeholder">ðŸ–¼ï¸</span>'}
                            <div class="image-upload-overlay">
                                <button class="btn-admin primary" onclick="document.getElementById('service_${service.id}').click()">Upload</button>
                            </div>
                        </div>
                        <input type="file" id="service_${service.id}" accept="image/*" style="display: none;" onchange="uploadServiceImage('${service.id}', this)">
                        <div class="image-upload-info">
                            <span class="image-upload-label">${service.alt}</span>
                            <span class="image-upload-hint">1920x600 recommended</span>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
        <button class="btn-admin primary" onclick="saveSiteImages(); alert('Site images saved!');">ðŸ’¾ Save All Changes</button>
    `;
}

function uploadSiteImage(key, input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = e => {
            siteImages[key].url = e.target.result;
            saveSiteImages();
            loadAdminSiteImagesPanel();
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function uploadServiceImage(serviceId, input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = e => {
            const service = siteImages.services.find(s => s.id === serviceId);
            if (service) {
                service.url = e.target.result;
                saveSiteImages();
                loadAdminSiteImagesPanel();
            }
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function clearSiteImage(key) {
    siteImages[key].url = '';
    saveSiteImages();
    loadAdminSiteImagesPanel();
}

// ==================== DESIGNERS PANEL ====================
function loadAdminDesignersPanel(searchTerm = '') {
    const filtered = searchTerm
        ? designers.filter(d =>
            (d.name || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
            (d.email || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
            (d.role || '').toLowerCase().includes(searchTerm.toLowerCase())
          )
        : designers;

    document.getElementById('adminDesignersPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸŽ¨ Designer Management</h1>
            <p class="panel-subtitle">Manage designer accounts and permissions (${filtered.length} of ${designers.length})</p>
        </div>
        <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; align-items: center;">
            <input type="text" id="designerSearch" placeholder="Search designers..." value="${searchTerm}"
                oninput="loadAdminDesignersPanel(this.value)"
                style="flex: 1; min-width: 200px; padding: 12px 16px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; font-size: 14px; background: rgba(255,255,255,0.1); color: #fff;">
            <button onclick="exportDesignersCSV()" style="padding: 10px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; cursor: pointer; color: #fff;">Export CSV</button>
            <button class="btn-admin primary" onclick="showAddDesignerModal()">+ Add Designer</button>
        </div>
        ${filtered.length > 0 ? `
        <div class="card-grid">
            ${filtered.map(designer => `
                <div class="client-card">
                    <div class="client-card-header" style="background: linear-gradient(135deg, var(--red), #ff6b6b);">
                        ${designer.avatar ? '<img src="' + designer.avatar + '" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover;">' : designer.name.charAt(0)}
                    </div>
                    <div class="client-card-body">
                        <div class="client-card-name">${designer.name}</div>
                        <div class="client-card-meta">${designer.email}<br>${designer.role}</div>
                        <div style="margin-bottom: 12px;">
                            ${(designer.permissions || []).map(p => '<span class="tag" style="margin: 2px;">' + p + '</span>').join('')}
                        </div>
                        <div class="client-card-btns">
                            <button style="background: var(--red); color: #fff;" onclick="editDesigner(${designer.id})">Edit</button>
                            <button style="background: rgba(255,255,255,0.1); color: #fff;" onclick="deleteDesigner(${designer.id})">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('')}
        </div>
        ` : '<p style="color: rgba(255,255,255,0.5); text-align: center; padding: 40px;">No designers found.</p>'}
        <div class="form-section" style="margin-top: 32px;">
            <div class="form-section-title">ðŸ” Designer Login Credentials</div>
            <p style="color: rgba(255,255,255,0.5); font-size: 13px; margin-bottom: 16px;">Designers can log in at the portal with these credentials:</p>
            <table class="data-table">
                <thead><tr><th>Name</th><th>Email</th><th>Password</th><th>Role</th></tr></thead>
                <tbody>
                    ${filtered.length === 0 ? '<tr><td colspan="4" style="text-align: center;">No designers</td></tr>' : ''}
                    ${filtered.map(d => '<tr><td>' + d.name + '</td><td>' + d.email + '</td><td>' + d.password + '</td><td>' + d.role + '</td></tr>').join('')}
                </tbody>
            </table>
        </div>
    `;
}

// Export designers to CSV
function exportDesignersCSV() {
    if (designers.length === 0) {
        alert('No designers to export.');
        return;
    }

    const headers = ['ID', 'Name', 'Email', 'Role', 'Permissions', 'Payout Tier'];
    const rows = designers.map(d => [
        d.id,
        d.name || '',
        d.email || '',
        d.role || '',
        (d.permissions || []).join('; '),
        d.payoutTier || '35%'
    ]);

    const csv = [headers.join(','), ...rows.map(r => r.map(v => '"' + String(v).replace(/"/g, '""') + '"').join(','))].join('\n');
    downloadCSV(csv, 'nui-designers-' + new Date().toISOString().split('T')[0] + '.csv');
}

function showAddDesignerModal() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'designerModal';
    modal.innerHTML = `
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">Add Designer</h3><button class="modal-close" onclick="document.getElementById('designerModal').remove()">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Name *</label><input type="text" id="designerName" class="form-input" placeholder="Jane Designer"></div>
                <div class="form-group"><label class="form-label">Email *</label><input type="email" id="designerEmail" class="form-input" placeholder="jane@nui.com"></div>
                <div class="form-group"><label class="form-label">Password *</label><input type="text" id="designerPassword" class="form-input" placeholder="designer123"></div>
                <div class="form-group"><label class="form-label">Role</label><input type="text" id="designerRole" class="form-input" placeholder="Designer" value="Designer"></div>
                <div class="form-group">
                    <label class="form-label">Permissions</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><input type="checkbox" id="permProjects" checked> Projects</label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><input type="checkbox" id="permProofs" checked> Proofs</label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><input type="checkbox" id="permAssets" checked> Assets</label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><input type="checkbox" id="permClients"> Clients</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn-admin secondary" onclick="document.getElementById('designerModal').remove()">Cancel</button><button class="btn-admin primary" onclick="saveDesigner()">Add Designer</button></div>
        </div>
    `;
    document.body.appendChild(modal);
}

function saveDesigner() {
    const permissions = [];
    if (document.getElementById('permProjects').checked) permissions.push('projects');
    if (document.getElementById('permProofs').checked) permissions.push('proofs');
    if (document.getElementById('permAssets').checked) permissions.push('assets');
    if (document.getElementById('permClients').checked) permissions.push('clients');

    const designer = {
        id: Date.now(),
        name: document.getElementById('designerName').value,
        email: document.getElementById('designerEmail').value,
        password: document.getElementById('designerPassword').value,
        role: document.getElementById('designerRole').value,
        avatar: '',
        permissions: permissions
    };
    designers.push(designer);
    saveDesigners();
    document.getElementById('designerModal').remove();
    loadAdminDesignersPanel();
}

function editDesigner(id) {
    const designer = designers.find(d => d.id === id);
    if (!designer) return;
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'designerModal';
    modal.innerHTML = `
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">Edit Designer</h3><button class="modal-close" onclick="document.getElementById('designerModal').remove()">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Name</label><input type="text" id="designerName" class="form-input" value="${designer.name}"></div>
                <div class="form-group"><label class="form-label">Email</label><input type="email" id="designerEmail" class="form-input" value="${designer.email}"></div>
                <div class="form-group"><label class="form-label">Password</label><input type="text" id="designerPassword" class="form-input" value="${designer.password}"></div>
                <div class="form-group"><label class="form-label">Role</label><input type="text" id="designerRole" class="form-input" value="${designer.role}"></div>
                <div class="form-group">
                    <label class="form-label">Permissions</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><input type="checkbox" id="permProjects" ${designer.permissions.includes('projects') ? 'checked' : ''}> Projects</label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><input type="checkbox" id="permProofs" ${designer.permissions.includes('proofs') ? 'checked' : ''}> Proofs</label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><input type="checkbox" id="permAssets" ${designer.permissions.includes('assets') ? 'checked' : ''}> Assets</label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><input type="checkbox" id="permClients" ${designer.permissions.includes('clients') ? 'checked' : ''}> Clients</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn-admin secondary" onclick="document.getElementById('designerModal').remove()">Cancel</button><button class="btn-admin primary" onclick="updateDesigner(${id})">Update</button></div>
        </div>
    `;
    document.body.appendChild(modal);
}

function updateDesigner(id) {
    const designer = designers.find(d => d.id === id);
    if (!designer) return;
    const permissions = [];
    if (document.getElementById('permProjects').checked) permissions.push('projects');
    if (document.getElementById('permProofs').checked) permissions.push('proofs');
    if (document.getElementById('permAssets').checked) permissions.push('assets');
    if (document.getElementById('permClients').checked) permissions.push('clients');

    designer.name = document.getElementById('designerName').value;
    designer.email = document.getElementById('designerEmail').value;
    designer.password = document.getElementById('designerPassword').value;
    designer.role = document.getElementById('designerRole').value;
    designer.permissions = permissions;
    saveDesigners();
    document.getElementById('designerModal').remove();
    loadAdminDesignersPanel();
}

function deleteDesigner(id) {
    if (!confirm('Delete this designer?')) return;
    designers = designers.filter(d => d.id !== id);
    saveDesigners();
    loadAdminDesignersPanel();
}

// ==================== BRAND GUIDE PANEL ====================
// Current brand guide being edited
let currentBrandGuide = null;

function loadAdminBrandGuidePanel() {
    const clientProofs = proofs.filter(p => p.type === 'brandguide');

    document.getElementById('adminBrandguidePanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ“˜ Brand Guide & Proof System</h1>
            <p class="panel-subtitle">Create brand guides, manage proofs, and client asset storage</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-label">Active Guides</div><div class="stat-value">${clientProofs.length}</div></div>
            <div class="stat-card"><div class="stat-label">Pending Approval</div><div class="stat-value" style="color: #f59e0b;">${clientProofs.filter(p => p.status === 'pending' || p.status === 'revision_requested').length}</div></div>
            <div class="stat-card"><div class="stat-label">Approved</div><div class="stat-value" style="color: #2ecc71;">${clientProofs.filter(p => p.status === 'approved').length}</div></div>
            <div class="stat-card"><div class="stat-label">Delivered</div><div class="stat-value" style="color: #3b82f6;">${clientProofs.filter(p => p.status === 'delivered').length}</div></div>
        </div>

        <div style="display: flex; gap: 12px; margin-bottom: 24px;">
            <button class="btn-admin primary" onclick="showCreateBrandGuideModal()">+ Create Brand Guide</button>
            <button class="btn-admin secondary" onclick="showAdminPanel('assets')">ðŸ“ Client Asset Storage</button>
        </div>

        <!-- Brand Guides Grid (Portfolio Style) -->
        <div class="form-section">
            <div class="form-section-title">ðŸ“ Brand Guides</div>
            ${clientProofs.length === 0 ? '<p style="color: rgba(255,255,255,0.5);">No brand guides created yet. Click "Create Brand Guide" to get started.</p>' : ''}
            <div class="card-grid">
                ${clientProofs.map(proof => {
                    const client = clients.find(c => c.id == proof.clientId);
                    const isPaid = checkClientPaymentStatus(proof.clientId);
                    return `
                    <div class="client-card" style="cursor: pointer; position: relative;" onclick="editBrandGuidePortfolio(${proof.id})">
                        <div class="client-card-header" style="background: linear-gradient(135deg, ${proof.brandColors?.[0] || '#e63946'}, ${proof.brandColors?.[1] || '#1d3557'});">
                            ${proof.logo ? '<img src="' + proof.logo + '" style="max-width: 80px; max-height: 50px; object-fit: contain;">' : (proof.clientName?.charAt(0) || 'B')}
                        </div>
                        ${proof.status === 'revision_requested' ? '<div style="position: absolute; top: 8px; right: 8px; background: #f59e0b; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: 600;">REVISION</div>' : ''}
                        ${isPaid ? '<div style="position: absolute; top: 8px; left: 8px; background: #2ecc71; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: 600;">PAID</div>' : ''}
                        <div class="client-card-body">
                            <div class="client-card-name">${proof.title || proof.clientName}</div>
                            <div class="client-card-meta">
                                ${client?.name || 'No Client'}<br>
                                <span class="status-badge ${proof.status}" style="margin-top: 4px; display: inline-block;">${proof.status?.replace('_', ' ') || 'draft'}</span>
                            </div>
                            <div style="margin-top: 8px; font-size: 11px; color: rgba(255,255,255,0.5);">
                                ${proof.revisionCount || 0} revisions â€¢ ${proof.comments?.length || 0} comments
                            </div>
                            <div class="client-card-btns" style="margin-top: 12px;">
                                <button style="background: var(--red); color: #fff;" onclick="event.stopPropagation(); editBrandGuidePortfolio(${proof.id})">Edit</button>
                                <button style="background: rgba(255,255,255,0.1); color: #fff;" onclick="event.stopPropagation(); sendProofToClient(${proof.id})">Send</button>
                            </div>
                        </div>
                    </div>
                `;}).join('')}
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="form-section">
            <div class="form-section-title">ðŸ“‹ Recent Proof Activity</div>
            <table class="data-table">
                <thead><tr><th>Brand Guide</th><th>Client</th><th>Status</th><th>Payment</th><th>Last Update</th><th>Actions</th></tr></thead>
                <tbody>
                    ${clientProofs.length === 0 ? '<tr><td colspan="6" style="text-align: center; opacity: 0.5;">No activity yet</td></tr>' : ''}
                    ${clientProofs.slice(-10).reverse().map(p => {
                        const client = clients.find(c => c.id == p.clientId);
                        const isPaid = checkClientPaymentStatus(p.clientId);
                        return `
                        <tr>
                            <td style="font-weight: 600;">${p.title}</td>
                            <td>${client?.name || 'N/A'}</td>
                            <td><span class="status-badge ${p.status}">${p.status?.replace('_', ' ') || 'draft'}</span></td>
                            <td>${isPaid ? '<span style="color: #2ecc71;">âœ“ Paid</span>' : '<span style="color: #f59e0b;">Pending</span>'}</td>
                            <td>${p.updatedAt ? new Date(p.updatedAt).toLocaleDateString() : '-'}</td>
                            <td>
                                <button class="btn-admin small" onclick="editBrandGuidePortfolio(${p.id})">Edit</button>
                                ${p.status === 'approved' && isPaid ? '<button class="btn-admin small primary" onclick="deliverBrandGuide(' + p.id + ')">Deliver</button>' : ''}
                            </td>
                        </tr>
                    `;}).join('')}
                </tbody>
            </table>
        </div>
        ${currentBrandGuide ? renderBrandGuideEditor() : ''}
    `;
}

// Check if client has paid for their project
function checkClientPaymentStatus(clientId) {
    const clientPayments = payments.filter(p => p.clientId == clientId && p.status === 'completed');
    const clientInvoices = invoices.filter(i => i.clientId == clientId && i.status === 'paid');
    return clientPayments.length > 0 || clientInvoices.length > 0;
}

// Portfolio-style Brand Guide Editor
function renderBrandGuideEditor() {
    const p = proofs.find(x => x.id === currentBrandGuide);
    if (!p) return '';
    const client = clients.find(c => c.id == p.clientId);
    const isPaid = checkClientPaymentStatus(p.clientId);

    return `
        <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 20px;">
            <div style="background: #1a1a1a; width: 100%; max-width: 1100px; max-height: 95vh; overflow-y: auto; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);">
                <!-- Header -->
                <div style="padding: 24px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: #1a1a1a; z-index: 10;">
                    <div>
                        <h2 style="font-size: 24px; font-weight: 700; color: #fff;">${p.title}</h2>
                        <p style="color: rgba(255,255,255,0.5); font-size: 13px; margin-top: 4px;">Client: ${client?.name || 'Unknown'} â€¢ Status: <span class="status-badge ${p.status}">${p.status?.replace('_', ' ')}</span></p>
                    </div>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        ${isPaid ? '<span style="background: #2ecc71; color: #fff; padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 600;">âœ“ PAID</span>' : '<span style="background: #f59e0b; color: #fff; padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 600;">PAYMENT PENDING</span>'}
                        <button onclick="currentBrandGuide = null; loadAdminBrandGuidePanel();" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #fff;">Ã—</button>
                    </div>
                </div>

                <div style="padding: 24px;">
                    <!-- Hero Banner (21:9) -->
                    <div class="form-section">
                        <div class="form-section-title">ðŸ–¼ï¸ Hero Banner Image (21:9 Full Width)</div>
                        <div style="aspect-ratio: 21/9; border: 2px dashed rgba(255,255,255,0.2); border-radius: 16px; overflow: hidden; background: linear-gradient(135deg, ${p.brandColors?.[0] || '#e63946'} 0%, ${p.brandColors?.[1] || '#1d3557'} 100%); position: relative;">
                            ${p.heroImage ? '<img src="' + p.heroImage + '" style="width: 100%; height: 100%; object-fit: cover; opacity: 0.5;">' : ''}
                            <div style="position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px;">
                                <div style="font-size: 32px; font-weight: 900; color: #fff; text-shadow: 0 2px 8px rgba(0,0,0,0.5);">${p.title}</div>
                                ${p.tagline ? '<div style="font-size: 16px; color: rgba(255,255,255,0.8);">' + p.tagline + '</div>' : ''}
                                <input type="file" id="bgHeroUpload" style="display: none;" accept="image/*" onchange="uploadBrandGuideHero(${p.id}, this)">
                                <button onclick="document.getElementById('bgHeroUpload').click()" style="padding: 12px 24px; background: rgba(0,0,0,0.7); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Upload Hero Image</button>
                            </div>
                        </div>
                    </div>

                    <!-- Basic Info -->
                    <div class="form-section" style="margin-top: 24px;">
                        <div class="form-section-title">ðŸ“ Basic Info</div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Brand Name</label><input type="text" class="form-input" value="${p.title || ''}" onchange="updateBrandGuideField(${p.id}, 'title', this.value)"></div>
                            <div class="form-group"><label class="form-label">Tagline</label><input type="text" class="form-input" value="${p.tagline || ''}" onchange="updateBrandGuideField(${p.id}, 'tagline', this.value)"></div>
                        </div>
                        <div class="form-group"><label class="form-label">Brand Story / Mission</label><textarea class="form-textarea" rows="3" onchange="updateBrandGuideField(${p.id}, 'description', this.value)">${p.description || ''}</textarea></div>
                    </div>

                    <!-- Logo System (1:1 Square) -->
                    <div class="form-section" style="margin-top: 24px;">
                        <div class="form-section-title">ðŸŽ¨ Logo System (1:1 Square)</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
                            ${['Primary Logo', 'Secondary Logo', 'Icon / Logo Mark'].map((label, i) => {
                                const keys = ['logo', 'secondaryLogo', 'iconMark'];
                                const key = keys[i];
                                return `
                                <div style="aspect-ratio: 1/1; border: 2px dashed rgba(255,255,255,0.2); border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; background: rgba(255,255,255,0.05);">
                                    <div style="font-size: 11px; color: rgba(255,255,255,0.6); padding: 16px; background: rgba(255,255,255,0.05); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; text-align: center;">${label}</div>
                                    <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 24px; background: #fff;">
                                        ${p[key] ? '<img src="' + p[key] + '" style="max-height: 100%; max-width: 100%; object-fit: contain;">' : '<div style="color: #ccc; font-size: 13px;">No logo</div>'}
                                    </div>
                                    <div style="padding: 16px; background: rgba(255,255,255,0.05); text-align: center;">
                                        <input type="file" id="bgLogo${i}Upload" style="display: none;" accept="image/*" onchange="uploadBrandGuideAsset(${p.id}, '${key}', this)">
                                        <button onclick="document.getElementById('bgLogo${i}Upload').click()" style="padding: 10px 20px; background: var(--red); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;">Upload</button>
                                    </div>
                                </div>
                            `;}).join('')}
                        </div>
                    </div>

                    <!-- Color Palette -->
                    <div class="form-section" style="margin-top: 24px;">
                        <div class="form-section-title">ðŸŽ¨ Color Palette</div>
                        <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                            ${(p.brandColors || ['#e63946', '#1d3557', '#f4a261']).map((c, i) => `
                                <div style="text-align: center;">
                                    <input type="color" value="${c}" onchange="updateBrandGuideColor(${p.id}, ${i}, this.value)" style="width: 70px; height: 70px; border: none; border-radius: 12px; cursor: pointer;">
                                    <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 4px; font-family: monospace;">${c}</div>
                                </div>
                            `).join('')}
                            <button onclick="addBrandGuideColor(${p.id})" style="width: 70px; height: 70px; border: 2px dashed rgba(255,255,255,0.3); border-radius: 12px; background: none; cursor: pointer; font-size: 24px; color: rgba(255,255,255,0.5);">+</button>
                        </div>
                    </div>

                    <!-- Font System -->
                    <div class="form-section" style="margin-top: 24px;">
                        <div class="form-section-title">ðŸ”¤ Font System</div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Heading Font</label><input type="text" class="form-input" value="${p.fonts?.primary || ''}" onchange="updateBrandGuideFont(${p.id}, 'primary', this.value)"></div>
                            <div class="form-group"><label class="form-label">Body Font</label><input type="text" class="form-input" value="${p.fonts?.secondary || ''}" onchange="updateBrandGuideFont(${p.id}, 'secondary', this.value)"></div>
                        </div>
                    </div>

                    <!-- Brand Mockups -->
                    <div class="form-section" style="margin-top: 24px;">
                        <div class="form-section-title">ðŸ“¸ Brand Mockups</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            ${(p.mockups || []).map((m, i) => `
                                <div style="position: relative; border-radius: 16px; overflow: hidden; box-shadow: 0 8px 24px rgba(0,0,0,0.3);">
                                    <img src="${m}" style="width: 100%; aspect-ratio: 16/9; object-fit: cover;">
                                    <button onclick="removeBrandGuideMockup(${p.id}, ${i})" style="position: absolute; top: 12px; right: 12px; background: #dc2626; color: #fff; border: none; border-radius: 50%; width: 28px; height: 28px; cursor: pointer;">Ã—</button>
                                </div>
                            `).join('')}
                            <div style="border: 2px dashed rgba(255,255,255,0.2); border-radius: 16px; aspect-ratio: 16/9; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px;">
                                <input type="file" id="bgMockupUpload" accept="image/*" style="display: none;" onchange="uploadBrandGuideMockup(${p.id}, this)">
                                <button onclick="document.getElementById('bgMockupUpload').click()" style="padding: 12px 24px; background: var(--red); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">+ Add Mockup</button>
                            </div>
                        </div>
                    </div>

                    <!-- Proof Approval Section -->
                    <div class="form-section" style="margin-top: 32px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">
                        <div class="form-section-title">âœ… Proof Approval System</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                            <!-- Status & Actions -->
                            <div>
                                <p style="color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 16px;">Current Status: <span class="status-badge ${p.status}" style="margin-left: 8px;">${p.status?.replace('_', ' ') || 'draft'}</span></p>
                                <p style="color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 16px;">Revision Count: <strong>${p.revisionCount || 0}</strong></p>
                                <p style="color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 16px;">Payment: ${isPaid ? '<span style="color: #2ecc71; font-weight: 600;">âœ“ Paid</span>' : '<span style="color: #f59e0b; font-weight: 600;">Pending</span>'}</p>

                                <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 24px;">
                                    <button class="btn-admin primary" onclick="sendProofToClient(${p.id})">ðŸ“¤ Send to Client</button>
                                    ${p.status === 'approved' && isPaid ? '<button class="btn-admin" style="background: #2ecc71; color: #fff;" onclick="deliverBrandGuide(' + p.id + ')">ðŸ“¦ Deliver Files</button>' : ''}
                                    ${p.status === 'approved' && !isPaid ? '<button class="btn-admin secondary" disabled title="Client must pay before delivery">â³ Awaiting Payment</button>' : ''}
                                </div>
                            </div>

                            <!-- Comments -->
                            <div>
                                <p style="color: rgba(255,255,255,0.8); font-weight: 600; margin-bottom: 12px;">ðŸ’¬ Comments & Feedback (${(p.comments || []).length})</p>
                                <div style="max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                                    ${(p.comments || []).length === 0 ? '<p style="color: rgba(255,255,255,0.4); font-size: 13px;">No comments yet</p>' : ''}
                                    ${(p.comments || []).map(c => `
                                        <div style="padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                            <div style="display: flex; justify-content: space-between;">
                                                <strong style="font-size: 12px; color: ${c.from === 'client' ? '#3b82f6' : '#2ecc71'};">${c.from === 'client' ? 'ðŸ‘¤ Client' : 'ðŸ¢ NUI'}</strong>
                                                <span style="font-size: 11px; color: rgba(255,255,255,0.4);">${new Date(c.timestamp).toLocaleString()}</span>
                                            </div>
                                            <p style="font-size: 13px; margin-top: 4px; color: rgba(255,255,255,0.8);">${c.text}</p>
                                        </div>
                                    `).join('')}
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <input type="text" id="bgNewComment" class="form-input" placeholder="Add a comment..." style="flex: 1;">
                                    <button class="btn-admin primary" onclick="addBrandGuideComment(${p.id})">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Client Download Section -->
                    ${p.status === 'approved' || p.status === 'delivered' ? `
                    <div class="form-section" style="margin-top: 24px; background: ${isPaid ? 'rgba(46,204,113,0.1)' : 'rgba(255,59,48,0.1)'}; border: 1px solid ${isPaid ? '#2ecc71' : '#ff3b30'};">
                        <div class="form-section-title">${isPaid ? 'âœ… Ready for Download' : 'ðŸ”’ Payment Required for Download'}</div>
                        ${isPaid ? `
                            <p style="color: rgba(255,255,255,0.6); margin-bottom: 16px;">Client can now download their brand assets.</p>
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <button class="btn-admin" style="background: #2ecc71; color: #fff;" onclick="downloadBrandGuidePackage(${p.id})">ðŸ“¥ Download Full Package</button>
                                <button class="btn-admin secondary" onclick="emailBrandGuideToClient(${p.id})">ðŸ“§ Email to Client</button>
                            </div>
                        ` : `
                            <p style="color: rgba(255,255,255,0.6); margin-bottom: 16px;">Client must complete payment before downloading files.</p>
                            <button class="btn-admin primary" onclick="sendPaymentReminder(${p.clientId})">ðŸ’³ Send Payment Reminder</button>
                        `}
                    </div>
                    ` : ''}

                    <!-- Footer Actions -->
                    <div style="margin-top: 32px; display: flex; gap: 16px; justify-content: space-between;">
                        <button onclick="deleteBrandGuide(${p.id})" style="padding: 12px 24px; background: #fee2e2; color: #dc2626; border: none; border-radius: 8px; cursor: pointer;">Delete Brand Guide</button>
                        <button onclick="currentBrandGuide = null; loadAdminBrandGuidePanel();" class="btn-admin primary">Save & Close</button>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function editBrandGuidePortfolio(id) {
    currentBrandGuide = id;
    loadAdminBrandGuidePanel();
}

function updateBrandGuideField(id, field, value) {
    const p = proofs.find(x => x.id === id);
    if (p) {
        p[field] = value;
        p.updatedAt = new Date().toISOString();
        saveProofs();
    }
}

function updateBrandGuideColor(id, index, value) {
    const p = proofs.find(x => x.id === id);
    if (p) {
        if (!p.brandColors) p.brandColors = ['#e63946', '#1d3557', '#f4a261'];
        p.brandColors[index] = value;
        p.updatedAt = new Date().toISOString();
        saveProofs();
        loadAdminBrandGuidePanel();
    }
}

function addBrandGuideColor(id) {
    const p = proofs.find(x => x.id === id);
    if (p && (!p.brandColors || p.brandColors.length < 6)) {
        if (!p.brandColors) p.brandColors = [];
        p.brandColors.push('#000000');
        saveProofs();
        loadAdminBrandGuidePanel();
    }
}

function updateBrandGuideFont(id, type, value) {
    const p = proofs.find(x => x.id === id);
    if (p) {
        if (!p.fonts) p.fonts = {};
        p.fonts[type] = value;
        saveProofs();
    }
}

function uploadBrandGuideHero(id, input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const p = proofs.find(x => x.id === id);
        if (p) {
            p.heroImage = e.target.result;
            p.updatedAt = new Date().toISOString();
            saveProofs();
            loadAdminBrandGuidePanel();
        }
    };
    reader.readAsDataURL(file);
}

function uploadBrandGuideAsset(id, key, input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const p = proofs.find(x => x.id === id);
        if (p) {
            p[key] = e.target.result;
            p.updatedAt = new Date().toISOString();
            saveProofs();
            loadAdminBrandGuidePanel();
        }
    };
    reader.readAsDataURL(file);
}

function uploadBrandGuideMockup(id, input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const p = proofs.find(x => x.id === id);
        if (p) {
            if (!p.mockups) p.mockups = [];
            p.mockups.push(e.target.result);
            p.updatedAt = new Date().toISOString();
            saveProofs();
            loadAdminBrandGuidePanel();
        }
    };
    reader.readAsDataURL(file);
}

function removeBrandGuideMockup(id, index) {
    const p = proofs.find(x => x.id === id);
    if (p && p.mockups) {
        p.mockups.splice(index, 1);
        saveProofs();
        loadAdminBrandGuidePanel();
    }
}

function addBrandGuideComment(id) {
    const input = document.getElementById('bgNewComment');
    const text = input.value.trim();
    if (!text) return;

    const p = proofs.find(x => x.id === id);
    if (p) {
        if (!p.comments) p.comments = [];
        p.comments.push({
            from: 'admin',
            text: text,
            timestamp: new Date().toISOString()
        });
        p.updatedAt = new Date().toISOString();
        saveProofs();
        input.value = '';
        loadAdminBrandGuidePanel();
    }
}

function sendProofToClient(id) {
    const p = proofs.find(x => x.id === id);
    if (!p) return;

    p.status = 'pending';
    p.sentToClient = true;
    p.sentAt = new Date().toISOString();
    p.updatedAt = new Date().toISOString();
    saveProofs();

    const client = clients.find(c => c.id == p.clientId);
    alert('Brand Guide proof sent to ' + (client?.name || 'client') + '!\n\nIn production, this would:\n1. Send an email with proof link\n2. Client can Approve or Request Revisions\n3. If approved & paid, files are delivered automatically');
    loadAdminBrandGuidePanel();
}

function deliverBrandGuide(id) {
    const p = proofs.find(x => x.id === id);
    if (!p) return;

    const isPaid = checkClientPaymentStatus(p.clientId);
    if (!isPaid) {
        alert('Cannot deliver - client has not paid yet.');
        return;
    }

    p.status = 'delivered';
    p.deliveredAt = new Date().toISOString();
    p.updatedAt = new Date().toISOString();
    saveProofs();

    const client = clients.find(c => c.id == p.clientId);
    alert('Brand Guide delivered to ' + (client?.name || 'client') + '!\n\nIn production, this would:\n1. Email all brand assets as downloadable package\n2. Provide secure download links\n3. Add files to client portal');
    loadAdminBrandGuidePanel();
}

function downloadBrandGuidePackage(id) {
    const p = proofs.find(x => x.id === id);
    if (!p) return;

    const isPaid = checkClientPaymentStatus(p.clientId);
    if (!isPaid) {
        alert('Download not available - payment required.');
        return;
    }

    alert('Downloading Brand Guide Package...\n\nIn production, this would generate a ZIP containing:\nâ€¢ Logo files (SVG, PNG, EPS)\nâ€¢ Color palette document\nâ€¢ Typography guide\nâ€¢ Brand guidelines PDF\nâ€¢ All mockups');
}

function emailBrandGuideToClient(id) {
    const p = proofs.find(x => x.id === id);
    if (!p) return;

    const isPaid = checkClientPaymentStatus(p.clientId);
    if (!isPaid) {
        alert('Cannot email - client has not paid yet.');
        return;
    }

    const client = clients.find(c => c.id == p.clientId);
    alert('Email sent to ' + (client?.email || 'client') + ' with download links!');
}

function sendPaymentReminder(clientId) {
    const client = clients.find(c => c.id == clientId);
    alert('Payment reminder sent to ' + (client?.email || 'client') + '!');
}

function deleteBrandGuide(id) {
    if (!confirm('Are you sure you want to delete this brand guide?')) return;
    proofs = proofs.filter(p => p.id !== id);
    saveProofs();
    currentBrandGuide = null;
    loadAdminBrandGuidePanel();
}

function showCreateBrandGuideModal() {
    const clientList = clients || [];
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'brandGuideModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Create Brand Guide</h3>
                <button class="modal-close" onclick="document.getElementById('brandGuideModal').remove()">Ã—</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div class="form-group">
                    <label class="form-label">Select Client *</label>
                    <select id="bgClient" class="form-select">
                        <option value="">-- Select Client --</option>
                        ${clientList.map(c => '<option value="' + c.id + '">' + c.name + ' - ' + (c.company || c.industry || 'N/A') + '</option>').join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Brand Name *</label>
                    <input type="text" id="bgBrandName" class="form-input" placeholder="Brand / Company Name">
                </div>
                <div class="form-group">
                    <label class="form-label">Tagline</label>
                    <input type="text" id="bgTagline" class="form-input" placeholder="Your brand tagline">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Primary Color</label>
                        <input type="color" id="bgColor1" value="#e63946" style="width: 100%; height: 50px; border: none; border-radius: 8px; cursor: pointer;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Secondary Color</label>
                        <input type="color" id="bgColor2" value="#1d3557" style="width: 100%; height: 50px; border: none; border-radius: 8px; cursor: pointer;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Accent Color</label>
                        <input type="color" id="bgColor3" value="#f4a261" style="width: 100%; height: 50px; border: none; border-radius: 8px; cursor: pointer;">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Logo Upload</label>
                    <input type="file" id="bgLogoUpload" accept="image/*" class="form-input" onchange="previewBrandGuideLogo(this)">
                    <div id="bgLogoPreview" style="margin-top: 12px;"></div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Primary Font</label>
                        <select id="bgFontPrimary" class="form-select">
                            <option value="Playfair Display">Playfair Display</option>
                            <option value="Poppins">Poppins</option>
                            <option value="Montserrat">Montserrat</option>
                            <option value="Roboto">Roboto</option>
                            <option value="Open Sans">Open Sans</option>
                            <option value="Lato">Lato</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Secondary Font</label>
                        <select id="bgFontSecondary" class="form-select">
                            <option value="Inter">Inter</option>
                            <option value="Roboto">Roboto</option>
                            <option value="Open Sans">Open Sans</option>
                            <option value="Lato">Lato</option>
                            <option value="Poppins">Poppins</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Brand Story / Description</label>
                    <textarea id="bgDescription" class="form-textarea" rows="4" placeholder="Brief brand story or description..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Additional Assets (Optional)</label>
                    <input type="file" id="bgAssetsUpload" accept="image/*" multiple class="form-input">
                    <p style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 8px;">Upload additional brand assets (icons, patterns, photos)</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-admin secondary" onclick="document.getElementById('brandGuideModal').remove()">Cancel</button>
                <button class="btn-admin primary" onclick="saveBrandGuide()">Create Brand Guide</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function previewBrandGuideLogo(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = e => {
            document.getElementById('bgLogoPreview').innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 100px; object-fit: contain; background: #fff; padding: 12px; border-radius: 8px;">`;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function saveBrandGuide() {
    const clientId = document.getElementById('bgClient').value;
    const client = clients.find(c => c.id == clientId);

    const logoInput = document.getElementById('bgLogoUpload');
    let logoData = '';

    const saveGuide = (logo, assets) => {
        const brandGuide = {
            id: Date.now(),
            type: 'brandguide',
            clientId: clientId,
            clientName: client ? client.name : document.getElementById('bgBrandName').value,
            title: document.getElementById('bgBrandName').value,
            tagline: document.getElementById('bgTagline').value,
            brandColors: [
                document.getElementById('bgColor1').value,
                document.getElementById('bgColor2').value,
                document.getElementById('bgColor3').value
            ],
            fonts: {
                primary: document.getElementById('bgFontPrimary').value,
                secondary: document.getElementById('bgFontSecondary').value
            },
            logo: logo,
            description: document.getElementById('bgDescription').value,
            mockups: [],
            comments: [],
            revisionCount: 0,
            assets: assets || [],
            status: 'draft',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            sentToClient: false
        };

        proofs.push(brandGuide);
        saveProofs();
        document.getElementById('brandGuideModal').remove();
        loadAdminBrandGuidePanel();
        alert('Brand Guide created successfully!');
    };

    if (logoInput.files && logoInput.files[0]) {
        const reader = new FileReader();
        reader.onload = e => {
            const assetsInput = document.getElementById('bgAssetsUpload');
            if (assetsInput.files && assetsInput.files.length > 0) {
                const assets = [];
                let loaded = 0;
                Array.from(assetsInput.files).forEach(file => {
                    const assetReader = new FileReader();
                    assetReader.onload = ae => {
                        assets.push({ name: file.name, data: ae.target.result });
                        loaded++;
                        if (loaded === assetsInput.files.length) {
                            saveGuide(e.target.result, assets);
                        }
                    };
                    assetReader.readAsDataURL(file);
                });
            } else {
                saveGuide(e.target.result, []);
            }
        };
        reader.readAsDataURL(logoInput.files[0]);
    } else {
        saveGuide('', []);
    }
}

function viewBrandGuide(id) {
    const guide = proofs.find(p => p.id === id);
    if (!guide) return;

    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'viewBrandGuideModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 900px; max-height: 90vh; overflow: hidden;">
            <div class="modal-header" style="background: linear-gradient(135deg, ${guide.brandColors?.[0] || '#e63946'}, ${guide.brandColors?.[1] || '#1d3557'});">
                <h3 class="modal-title" style="color: #fff;">${guide.title} - Brand Guide</h3>
                <button class="modal-close" onclick="document.getElementById('viewBrandGuideModal').remove()" style="color: #fff;">Ã—</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto; background: #0a0a0a;">
                <!-- Brand Header -->
                <div style="text-align: center; padding: 40px 20px; background: linear-gradient(135deg, ${guide.brandColors?.[0]}22, ${guide.brandColors?.[1]}22); border-radius: 12px; margin-bottom: 24px;">
                    ${guide.logo ? `<img src="${guide.logo}" style="max-width: 200px; max-height: 100px; object-fit: contain; margin-bottom: 16px;">` : ''}
                    <h1 style="font-family: '${guide.fonts?.primary || 'Playfair Display'}', serif; font-size: 32px; margin-bottom: 8px;">${guide.title}</h1>
                    ${guide.tagline ? `<p style="font-family: '${guide.fonts?.secondary || 'Inter'}', sans-serif; font-size: 16px; opacity: 0.8;">${guide.tagline}</p>` : ''}
                </div>

                <!-- Color Palette -->
                <div style="margin-bottom: 32px;">
                    <h3 style="margin-bottom: 16px; font-size: 18px;">Color Palette</h3>
                    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                        ${guide.brandColors?.map((color, i) => `
                            <div style="flex: 1; min-width: 120px;">
                                <div style="width: 100%; height: 80px; background: ${color}; border-radius: 12px; margin-bottom: 8px;"></div>
                                <p style="font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">${['Primary', 'Secondary', 'Accent'][i]}</p>
                                <p style="font-family: monospace; font-size: 14px;">${color}</p>
                            </div>
                        `).join('') || ''}
                    </div>
                </div>

                <!-- Typography -->
                <div style="margin-bottom: 32px;">
                    <h3 style="margin-bottom: 16px; font-size: 18px;">Typography</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px;">
                        <div style="padding: 24px; background: rgba(255,255,255,0.05); border-radius: 12px;">
                            <p style="font-size: 12px; opacity: 0.6; margin-bottom: 8px;">PRIMARY FONT</p>
                            <p style="font-family: '${guide.fonts?.primary}', serif; font-size: 28px;">${guide.fonts?.primary}</p>
                            <p style="font-family: '${guide.fonts?.primary}', serif; font-size: 16px; margin-top: 12px;">Aa Bb Cc Dd Ee Ff Gg</p>
                        </div>
                        <div style="padding: 24px; background: rgba(255,255,255,0.05); border-radius: 12px;">
                            <p style="font-size: 12px; opacity: 0.6; margin-bottom: 8px;">SECONDARY FONT</p>
                            <p style="font-family: '${guide.fonts?.secondary}', sans-serif; font-size: 28px;">${guide.fonts?.secondary}</p>
                            <p style="font-family: '${guide.fonts?.secondary}', sans-serif; font-size: 16px; margin-top: 12px;">Aa Bb Cc Dd Ee Ff Gg</p>
                        </div>
                    </div>
                </div>

                <!-- Brand Story -->
                ${guide.description ? `
                <div style="margin-bottom: 32px;">
                    <h3 style="margin-bottom: 16px; font-size: 18px;">Brand Story</h3>
                    <p style="line-height: 1.8; opacity: 0.9;">${guide.description}</p>
                </div>
                ` : ''}

                <!-- Assets -->
                ${guide.assets && guide.assets.length > 0 ? `
                <div style="margin-bottom: 32px;">
                    <h3 style="margin-bottom: 16px; font-size: 18px;">Brand Assets</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
                        ${guide.assets.map(asset => `
                            <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 12px; text-align: center;">
                                <img src="${asset.data}" style="max-width: 100%; max-height: 120px; object-fit: contain; margin-bottom: 8px;">
                                <p style="font-size: 12px; opacity: 0.7;">${asset.name}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            </div>
            <div class="modal-footer">
                <button class="btn-admin secondary" onclick="document.getElementById('viewBrandGuideModal').remove()">Close</button>
                <button class="btn-admin primary" onclick="downloadBrandGuideAssets(${id})">ðŸ“¥ Download All Assets</button>
                <button class="btn-admin primary" onclick="sendBrandGuideToClient(${id})">ðŸ“§ Send to Client</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function editBrandGuide(id) {
    const guide = proofs.find(p => p.id === id);
    if (!guide) return;
    // Reuse create modal with pre-filled data
    showCreateBrandGuideModal();
    setTimeout(() => {
        document.getElementById('bgBrandName').value = guide.title || '';
        document.getElementById('bgTagline').value = guide.tagline || '';
        document.getElementById('bgColor1').value = guide.brandColors?.[0] || '#e63946';
        document.getElementById('bgColor2').value = guide.brandColors?.[1] || '#1d3557';
        document.getElementById('bgColor3').value = guide.brandColors?.[2] || '#f4a261';
        document.getElementById('bgFontPrimary').value = guide.fonts?.primary || 'Playfair Display';
        document.getElementById('bgFontSecondary').value = guide.fonts?.secondary || 'Inter';
        document.getElementById('bgDescription').value = guide.description || '';
        if (guide.logo) {
            document.getElementById('bgLogoPreview').innerHTML = `<img src="${guide.logo}" style="max-width: 200px; max-height: 100px; object-fit: contain; background: #fff; padding: 12px; border-radius: 8px;">`;
        }
        // Update save button to update instead of create
        const saveBtn = document.querySelector('#brandGuideModal .modal-footer .btn-admin.primary');
        saveBtn.textContent = 'Update Brand Guide';
        saveBtn.onclick = () => updateBrandGuide(id);
    }, 100);
}

function updateBrandGuide(id) {
    const guide = proofs.find(p => p.id === id);
    if (!guide) return;

    guide.title = document.getElementById('bgBrandName').value;
    guide.tagline = document.getElementById('bgTagline').value;
    guide.brandColors = [
        document.getElementById('bgColor1').value,
        document.getElementById('bgColor2').value,
        document.getElementById('bgColor3').value
    ];
    guide.fonts = {
        primary: document.getElementById('bgFontPrimary').value,
        secondary: document.getElementById('bgFontSecondary').value
    };
    guide.description = document.getElementById('bgDescription').value;

    saveProofs();
    document.getElementById('brandGuideModal').remove();
    loadAdminBrandGuidePanel();
    alert('Brand Guide updated!');
}

function downloadBrandGuideAssets(id) {
    const guide = proofs.find(p => p.id === id);
    if (!guide) return;

    // Create downloadable content
    const assets = [];
    if (guide.logo) assets.push({ name: 'logo.png', data: guide.logo });
    if (guide.assets) guide.assets.forEach(a => assets.push(a));

    if (assets.length === 0) {
        alert('No assets to download');
        return;
    }

    // Download each asset
    assets.forEach((asset, i) => {
        setTimeout(() => {
            const link = document.createElement('a');
            link.href = asset.data;
            link.download = asset.name || `asset-${i + 1}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }, i * 500);
    });

    alert(`Downloading ${assets.length} asset(s)...`);
}

function sendBrandGuideToClient(id) {
    const guide = proofs.find(p => p.id === id);
    if (!guide) return;

    guide.sentToClient = true;
    guide.sentAt = new Date().toISOString();
    saveProofs();

    alert(`Brand Guide for "${guide.title}" has been marked as sent to client. In production, this would send an email with the brand guide link.`);
    loadAdminBrandGuidePanel();
}

// ==================== PAYMENTS PANEL ====================
function loadAdminPaymentsPanel() {
    const totalRevenue = payments.reduce((sum, p) => sum + (p.amount || 0), 0);
    const pendingPayments = payments.filter(p => p.status === 'pending');
    const completedPayments = payments.filter(p => p.status === 'completed');

    document.getElementById('adminPaymentsPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ’³ Payments</h1>
            <p class="panel-subtitle">Track payments, auto-pay schedules, and revenue</p>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Revenue</div>
                <div class="stat-value">$${totalRevenue.toLocaleString()}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Pending</div>
                <div class="stat-value" style="color: #f4a261;">${pendingPayments.length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Completed</div>
                <div class="stat-value" style="color: #2a9d8f;">${completedPayments.length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">This Month</div>
                <div class="stat-value">$${payments.filter(p => new Date(p.date).getMonth() === new Date().getMonth()).reduce((s, p) => s + (p.amount || 0), 0).toLocaleString()}</div>
            </div>
        </div>

        <div style="display: flex; justify-content: flex-end; margin-bottom: 24px; gap: 12px;">
            <button class="btn-admin secondary" onclick="showPaymentPlansInfo()">ðŸ“‹ Payment Plan Info</button>
            <button class="btn-admin primary" onclick="showRecordPaymentModal()">+ Record Payment</button>
        </div>

        <!-- Auto-Pay Schedules -->
        <div class="form-section">
            <div class="form-section-title">âš¡ Active Auto-Pay Schedules</div>
            <div id="autoPaySchedules">
                ${renderAutoPaySchedules()}
            </div>
        </div>

        <!-- Recent Payments -->
        <div class="form-section">
            <div class="form-section-title">ðŸ’° Payment History</div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Client</th>
                        <th>Project</th>
                        <th>Amount</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${payments.length === 0 ? '<tr><td colspan="7" style="text-align: center; opacity: 0.5;">No payments recorded yet</td></tr>' : ''}
                    ${payments.sort((a, b) => new Date(b.date) - new Date(a.date)).map(payment => `
                        <tr>
                            <td>${new Date(payment.date).toLocaleDateString()}</td>
                            <td>${payment.clientName || 'N/A'}</td>
                            <td>${payment.projectName || 'N/A'}</td>
                            <td style="font-weight: 600; color: #2a9d8f;">$${payment.amount?.toLocaleString() || 0}</td>
                            <td><span class="tag">${payment.type || 'One-time'}</span></td>
                            <td><span class="status-badge ${payment.status}">${payment.status}</span></td>
                            <td>
                                <button class="btn-admin small" onclick="viewPaymentDetails(${payment.id})">View</button>
                                ${payment.status === 'pending' ? `<button class="btn-admin small primary" onclick="markPaymentComplete(${payment.id})">Mark Paid</button>` : ''}
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
}

function renderAutoPaySchedules() {
    const projectsWithAutoPay = projects.filter(p => p.paymentPlan && p.paymentPlan !== 'full');

    if (projectsWithAutoPay.length === 0) {
        return '<p style="color: rgba(255,255,255,0.5);">No active auto-pay schedules. Create a project with a payment plan to see schedules here.</p>';
    }

    return `
        <div class="card-grid">
            ${projectsWithAutoPay.map(project => {
                const plan = paymentPlans[project.paymentPlan];
                const paidInstallments = project.paidInstallments || 0;
                const totalAmount = project.totalAmount || 0;

                return `
                    <div class="client-card">
                        <div class="client-card-header" style="background: linear-gradient(135deg, #2a9d8f, #264653);">
                            ${project.name?.charAt(0) || 'P'}
                        </div>
                        <div class="client-card-body">
                            <div class="client-card-name">${project.name}</div>
                            <div class="client-card-meta">${project.clientName || 'Client'}<br>Plan: ${plan?.name || 'Standard'}</div>
                            <div style="margin: 12px 0;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 12px;">Progress</span>
                                    <span style="font-size: 12px;">${paidInstallments}/${plan?.installments || 3} payments</span>
                                </div>
                                <div style="background: rgba(255,255,255,0.1); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: var(--red); height: 100%; width: ${(paidInstallments / (plan?.installments || 3)) * 100}%; transition: width 0.3s;"></div>
                                </div>
                            </div>
                            <div style="font-size: 13px; color: rgba(255,255,255,0.7);">
                                ${plan?.schedule?.map((pct, i) => `
                                    <div style="display: flex; justify-content: space-between; padding: 4px 0; ${i < paidInstallments ? 'text-decoration: line-through; opacity: 0.5;' : ''}">
                                        <span>${plan.triggers?.[i] || `Payment ${i + 1}`}</span>
                                        <span>$${Math.round(totalAmount * pct / 100).toLocaleString()} (${pct}%)</span>
                                    </div>
                                `).join('') || ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function showPaymentPlansInfo() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'paymentPlansModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">Payment Plan Options</h3>
                <button class="modal-close" onclick="document.getElementById('paymentPlansModal').remove()">Ã—</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; gap: 16px;">
                    ${Object.entries(paymentPlans).map(([key, plan]) => `
                        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; border-left: 4px solid var(--red);">
                            <h4 style="margin-bottom: 8px;">${plan.name} ${plan.discount > 0 ? `<span style="color: #2a9d8f;">(${plan.discount}% discount)</span>` : ''}</h4>
                            <p style="font-size: 14px; opacity: 0.7; margin-bottom: 12px;">${plan.installments} installment(s)</p>
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                ${plan.schedule.map((pct, i) => `
                                    <div style="background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 18px; font-weight: 600;">${pct}%</div>
                                        <div style="font-size: 11px; opacity: 0.6;">${plan.triggers?.[i] || `Payment ${i + 1}`}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-admin primary" onclick="document.getElementById('paymentPlansModal').remove()">Got It</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function showRecordPaymentModal() {
    const allClients = window.clients || [];
    const allProjects = window.projects || [];
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'recordPaymentModal';
    modal.innerHTML = `
        <div class="modal" style="background: #1a1a1a; color: #fff;">
            <div class="modal-header" style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                <h3 class="modal-title" style="color: #fff;">ðŸ’³ Record Payment</h3>
                <button class="modal-close" onclick="document.getElementById('recordPaymentModal').remove()" style="color: #fff;">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Client *</label>
                    <select id="paymentClient" class="form-select" onchange="loadClientProjects(this.value)" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                        <option value="">-- Select Client --</option>
                        ${allClients.map(c => `<option value="${c.id}">${c.name}${c.company ? ' - ' + c.company : ''}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Project</label>
                    <select id="paymentProject" class="form-select" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                        <option value="">-- Select Project (select client first) --</option>
                        ${allProjects.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Amount *</label>
                    <input type="number" id="paymentAmount" class="form-input" placeholder="0.00" step="0.01" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Payment Type</label>
                    <select id="paymentType" class="form-select" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                        <option value="deposit">Deposit (50%)</option>
                        <option value="approval">Approval Payment (25%)</option>
                        <option value="final">Final Payment (25%)</option>
                        <option value="full">Full Payment</option>
                        <option value="monthly">Monthly Payment</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Date</label>
                    <input type="date" id="paymentDate" class="form-input" value="${new Date().toISOString().split('T')[0]}" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #fff;">Notes</label>
                    <textarea id="paymentNotes" class="form-textarea" rows="2" placeholder="Payment notes..." style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);"></textarea>
                </div>
            </div>
            <div class="modal-footer" style="border-top: 1px solid rgba(255,255,255,0.1);">
                <button class="btn-admin secondary" onclick="document.getElementById('recordPaymentModal').remove()" style="background: #333; color: #fff;">Cancel</button>
                <button class="btn-admin primary" onclick="savePayment()" style="background: var(--red); color: #fff;">Record Payment</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function loadClientProjects(clientId) {
    const allProjects = window.projects || [];
    const clientProjects = clientId ? allProjects.filter(p => p.clientId == clientId) : allProjects;
    const select = document.getElementById('paymentProject');
    if (select) {
        select.innerHTML = `
            <option value="">-- Select Project --</option>
            ${clientProjects.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
        `;
    }
}

function savePayment() {
    const clientSelect = document.getElementById('paymentClient');
    const projectSelect = document.getElementById('paymentProject');
    const allClients = window.clients || [];
    const client = allClients.find(c => c.id == clientSelect.value);
    const project = (window.projects || []).find(p => p.id == projectSelect.value);

    const payment = {
        id: Date.now(),
        clientId: clientSelect.value,
        clientName: client?.name || 'Unknown',
        projectId: projectSelect.value,
        projectName: project?.name || 'N/A',
        amount: parseFloat(document.getElementById('paymentAmount').value) || 0,
        type: document.getElementById('paymentType').value,
        date: document.getElementById('paymentDate').value,
        notes: document.getElementById('paymentNotes').value,
        status: 'completed',
        createdAt: new Date().toISOString()
    };

    payments.push(payment);
    savePayments();

    // Update project paid installments if applicable
    if (project && project.paymentPlan) {
        project.paidInstallments = (project.paidInstallments || 0) + 1;
        saveProjects();
    }

    document.getElementById('recordPaymentModal').remove();
    loadAdminPaymentsPanel();
    alert('Payment recorded successfully!');
}

function markPaymentComplete(id) {
    const payment = payments.find(p => p.id === id);
    if (payment) {
        payment.status = 'completed';
        payment.completedAt = new Date().toISOString();
        savePayments();
        loadAdminPaymentsPanel();
    }
}

function viewPaymentDetails(id) {
    const payment = payments.find(p => p.id === id);
    if (!payment) return;

    alert(`Payment Details:\n\nClient: ${payment.clientName}\nProject: ${payment.projectName}\nAmount: $${payment.amount}\nType: ${payment.type}\nDate: ${payment.date}\nStatus: ${payment.status}\nNotes: ${payment.notes || 'None'}`);
}

// ==================== INVOICES PANEL ====================
function loadAdminInvoicesPanel(searchTerm = '', statusFilter = '') {
    let filtered = invoices;

    if (searchTerm) {
        filtered = filtered.filter(i =>
            (i.invoiceNumber || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
            (i.clientName || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
            (i.projectName || '').toLowerCase().includes(searchTerm.toLowerCase())
        );
    }

    if (statusFilter) {
        filtered = filtered.filter(i => i.status === statusFilter);
    }

    const totalInvoiced = invoices.reduce((sum, i) => sum + (i.total || 0), 0);
    const pendingInvoices = invoices.filter(i => i.status === 'pending' || i.status === 'sent');
    const paidInvoices = invoices.filter(i => i.status === 'paid');

    document.getElementById('adminInvoicesPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ“„ Invoices</h1>
            <p class="panel-subtitle">Create, send, and track invoices</p>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Invoiced</div>
                <div class="stat-value">$${totalInvoiced.toLocaleString()}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Pending</div>
                <div class="stat-value" style="color: #f4a261;">${pendingInvoices.length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Paid</div>
                <div class="stat-value" style="color: #2a9d8f;">${paidInvoices.length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Outstanding</div>
                <div class="stat-value" style="color: #e63946;">$${pendingInvoices.reduce((s, i) => s + (i.total || 0), 0).toLocaleString()}</div>
            </div>
        </div>

        <!-- Search, Filter, and Actions Bar -->
        <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; align-items: center;">
            <input type="text" id="invoiceSearch" placeholder="Search invoices..." value="${searchTerm}"
                oninput="loadAdminInvoicesPanel(this.value, document.getElementById('invoiceStatusFilter').value)"
                style="flex: 1; min-width: 200px; padding: 12px 16px; border: 1px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
            <select id="invoiceStatusFilter" onchange="loadAdminInvoicesPanel(document.getElementById('invoiceSearch').value, this.value)"
                style="padding: 12px 16px; border: 1px solid #e5e5e5; border-radius: 8px; font-size: 14px; background: #fff;">
                <option value="" ${!statusFilter ? 'selected' : ''}>All Status</option>
                <option value="draft" ${statusFilter === 'draft' ? 'selected' : ''}>Draft</option>
                <option value="sent" ${statusFilter === 'sent' ? 'selected' : ''}>Sent</option>
                <option value="pending" ${statusFilter === 'pending' ? 'selected' : ''}>Pending</option>
                <option value="paid" ${statusFilter === 'paid' ? 'selected' : ''}>Paid</option>
                <option value="overdue" ${statusFilter === 'overdue' ? 'selected' : ''}>Overdue</option>
            </select>
            <button onclick="selectAllInvoices()" style="padding: 10px 16px; background: #f3f4f6; border: 1px solid #e5e5e5; border-radius: 8px; cursor: pointer;">Select All</button>
            <button onclick="deleteSelectedInvoices()" style="padding: 10px 16px; background: #fee2e2; color: #dc2626; border: none; border-radius: 8px; cursor: pointer;">Delete Selected</button>
            <button onclick="exportInvoicesCSV()" style="padding: 10px 16px; background: #f3f4f6; border: 1px solid #e5e5e5; border-radius: 8px; cursor: pointer;">Export CSV</button>
            <button class="btn-admin primary" onclick="showCreateInvoiceModal()">+ Create Invoice</button>
        </div>

        <!-- Invoices Table -->
        <div class="form-section">
            <div class="form-section-title">ðŸ“‹ ${filtered.length} of ${invoices.length} Invoices</div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 40px;"><input type="checkbox" id="selectAllInvoicesHeader" onchange="toggleAllInvoiceCheckboxes(this.checked)"></th>
                        <th>Invoice #</th>
                        <th>Client</th>
                        <th>Project</th>
                        <th>Amount</th>
                        <th>Date</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${filtered.length === 0 ? '<tr><td colspan="9" style="text-align: center; opacity: 0.5;">No invoices found</td></tr>' : ''}
                    ${filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).map(invoice => `
                        <tr>
                            <td><input type="checkbox" class="invoice-checkbox" data-id="${invoice.id}"></td>
                            <td style="font-weight: 600;">#${invoice.invoiceNumber || invoice.id}</td>
                            <td>${invoice.clientName || 'N/A'}</td>
                            <td>${invoice.projectName || 'N/A'}</td>
                            <td style="font-weight: 600;">$${(invoice.total || 0).toLocaleString()}</td>
                            <td>${new Date(invoice.createdAt).toLocaleDateString()}</td>
                            <td>${invoice.dueDate ? new Date(invoice.dueDate).toLocaleDateString() : 'N/A'}</td>
                            <td><span class="status-badge ${invoice.status}">${invoice.status}</span></td>
                            <td>
                                <button class="btn-admin small" onclick="viewInvoice(${invoice.id})">View</button>
                                <button class="btn-admin small" onclick="downloadInvoice(${invoice.id})">PDF</button>
                                ${invoice.status !== 'paid' ? '<button class="btn-admin small primary" onclick="markInvoicePaid(' + invoice.id + ')">Mark Paid</button>' : ''}
                                <button class="btn-admin small danger" onclick="deleteInvoice(${invoice.id})" style="background: #fee2e2; color: #dc2626;">Ã—</button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
}

// Toggle all invoice checkboxes
function toggleAllInvoiceCheckboxes(checked) {
    document.querySelectorAll('.invoice-checkbox').forEach(cb => cb.checked = checked);
}

// Select all invoices button
function selectAllInvoices() {
    const checkboxes = document.querySelectorAll('.invoice-checkbox');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
    checkboxes.forEach(cb => cb.checked = !allChecked);
    const headerCb = document.getElementById('selectAllInvoicesHeader');
    if (headerCb) headerCb.checked = !allChecked;
}

// Bulk delete invoices
function deleteSelectedInvoices() {
    const checkboxes = document.querySelectorAll('.invoice-checkbox:checked');
    if (checkboxes.length === 0) {
        alert('Please select at least one invoice to delete.');
        return;
    }

    if (!confirm('Are you sure you want to delete ' + checkboxes.length + ' invoice(s)? This cannot be undone.')) return;

    const idsToDelete = Array.from(checkboxes).map(cb => parseInt(cb.dataset.id));
    invoices = invoices.filter(i => !idsToDelete.includes(i.id));
    saveInvoices();

    const search = document.getElementById('invoiceSearch')?.value || '';
    const status = document.getElementById('invoiceStatusFilter')?.value || '';
    loadAdminInvoicesPanel(search, status);
    alert(idsToDelete.length + ' invoice(s) deleted successfully.');
}

// Export invoices to CSV
function exportInvoicesCSV() {
    if (invoices.length === 0) {
        alert('No invoices to export.');
        return;
    }

    const headers = ['Invoice #', 'Client', 'Project', 'Amount', 'Status', 'Created Date', 'Due Date', 'Paid Date'];
    const rows = invoices.map(i => [
        i.invoiceNumber || i.id,
        i.clientName || '',
        i.projectName || '',
        i.total || 0,
        i.status || '',
        i.createdAt || '',
        i.dueDate || '',
        i.paidAt || ''
    ]);

    const csv = [headers.join(','), ...rows.map(r => r.map(v => '"' + String(v).replace(/"/g, '""') + '"').join(','))].join('\n');
    downloadCSV(csv, 'nui-invoices-' + new Date().toISOString().split('T')[0] + '.csv');
}

function showCreateInvoiceModal() {
    const allClients = window.clients || [];
    const allProjects = window.projects || [];
    const invoiceNumber = `INV-${new Date().getFullYear()}-${String(invoices.length + 1).padStart(4, '0')}`;

    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'createInvoiceModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 800px; background: #1a1a1a; color: #fff;">
            <div class="modal-header" style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                <h3 class="modal-title" style="color: #fff;">ðŸ“„ Create Invoice</h3>
                <button class="modal-close" onclick="document.getElementById('createInvoiceModal').remove()" style="color: #fff;">Ã—</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" style="color: #fff;">Invoice Number</label>
                        <input type="text" id="invoiceNumber" class="form-input" value="${invoiceNumber}" readonly style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: #fff;">Due Date</label>
                        <input type="date" id="invoiceDueDate" class="form-input" value="${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" style="color: #fff;">Client *</label>
                        <select id="invoiceClient" class="form-select" onchange="loadInvoiceClientProjects(this.value)" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                            <option value="">-- Select Client --</option>
                            ${allClients.map(c => `<option value="${c.id}">${c.name}${c.company ? ' - ' + c.company : ''}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: #fff;">Project</label>
                        <select id="invoiceProject" class="form-select" onchange="populateInvoiceFromProject(this.value)" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                            <option value="">-- Select Project --</option>
                            ${allProjects.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                        </select>
                    </div>
                </div>

                <!-- Quick Add Service/Package -->
                <div class="form-section" style="margin-top: 24px; background: rgba(255,59,48,0.15); padding: 16px; border-radius: 8px; border: 1px solid rgba(255,59,48,0.3);">
                    <div class="form-section-title" style="color: var(--red); font-weight: 600;">âš¡ Quick Add Service/Package</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" style="color: #fff;">Packages</label>
                            <select id="quickAddPackage" class="form-select" onchange="quickAddServiceToInvoice('package', this.value)" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                                <option value="">-- Select Package --</option>
                                ${servicePackages.map(p => '<option value="' + p.id + '">' + p.name + ' - $' + p.price + ' (' + p.turnaround + ')</option>').join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="color: #fff;">Individual Services</label>
                            <select id="quickAddService" class="form-select" onchange="quickAddServiceToInvoice('service', this.value)" style="background: #252525; color: #fff; border: 1px solid rgba(255,255,255,0.2);">
                                <option value="">-- Select Service --</option>
                                ${individualServices.map(s => '<option value="' + s.id + '">' + s.name + ' - $' + s.price + '</option>').join('')}
                            </select>
                        </div>
                    </div>
                    <button onclick="showCreateProductModal()" class="btn-admin" style="margin-top: 12px; background: #10b981; color: #fff; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer;">âž• Create New Product/Service</button>
                </div>

                <div class="form-section" style="margin-top: 24px;">
                    <div class="form-section-title">Line Items</div>
                    <div id="invoiceLineItems">
                        <div class="invoice-line-item" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 12px; margin-bottom: 12px; align-items: end;">
                            <div class="form-group" style="margin: 0;">
                                <label class="form-label">Description</label>
                                <input type="text" class="form-input line-desc" placeholder="Service description">
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label class="form-label">Qty</label>
                                <input type="number" class="form-input line-qty" value="1" min="1" onchange="calculateInvoiceTotal()">
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label class="form-label">Rate</label>
                                <input type="number" class="form-input line-rate" placeholder="0.00" step="0.01" onchange="calculateInvoiceTotal()">
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label class="form-label">Amount</label>
                                <input type="text" class="form-input line-amount" readonly value="$0.00">
                            </div>
                            <button class="btn-admin small" onclick="removeInvoiceLine(this)" style="margin-bottom: 4px;">Ã—</button>
                        </div>
                    </div>
                    <button class="btn-admin secondary" onclick="addInvoiceLine()" style="margin-top: 12px;">+ Add Line Item</button>
                </div>

                <!-- Discount Section -->
                <div class="form-section" style="margin-top: 24px; background: rgba(46,204,113,0.1); padding: 16px; border-radius: 8px;">
                    <div class="form-section-title" style="color: #2ecc71;">ðŸ’° Discount</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Discount Type</label>
                            <select id="discountType" class="form-select" onchange="calculateInvoiceTotal()">
                                <option value="none">No Discount</option>
                                <option value="percent">Percentage (%)</option>
                                <option value="fixed">Fixed Amount ($)</option>
                                <option value="loyalty">Loyalty Reward</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Discount Value</label>
                            <input type="number" id="discountValue" class="form-input" value="0" min="0" step="0.01" onchange="calculateInvoiceTotal()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Discount Code (Optional)</label>
                            <input type="text" id="discountCode" class="form-input" placeholder="SAVE10">
                        </div>
                    </div>
                </div>

                <div style="display: flex; justify-content: flex-end; margin-top: 24px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <div style="text-align: right; min-width: 200px;">
                        <div style="font-size: 14px; opacity: 0.7; margin-bottom: 8px;">Subtotal: <span id="invoiceSubtotal">$0.00</span></div>
                        <div style="font-size: 14px; color: #2ecc71; margin-bottom: 8px;" id="discountLine" style="display: none;">Discount: -<span id="invoiceDiscount">$0.00</span></div>
                        <div style="font-size: 24px; font-weight: 600;">Total: <span id="invoiceTotal" style="color: var(--red);">$0.00</span></div>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 24px;">
                    <label class="form-label">Notes</label>
                    <textarea id="invoiceNotes" class="form-textarea" rows="3" placeholder="Payment terms, additional notes...">Payment due within 30 days. Thank you for your business!</textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-admin secondary" onclick="document.getElementById('createInvoiceModal').remove()">Cancel</button>
                <button class="btn-admin primary" onclick="saveInvoice()">Create Invoice</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function addInvoiceLine() {
    const container = document.getElementById('invoiceLineItems');
    const lineItem = document.createElement('div');
    lineItem.className = 'invoice-line-item';
    lineItem.style.cssText = 'display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 12px; margin-bottom: 12px; align-items: end;';
    lineItem.innerHTML = `
        <div class="form-group" style="margin: 0;">
            <input type="text" class="form-input line-desc" placeholder="Service description">
        </div>
        <div class="form-group" style="margin: 0;">
            <input type="number" class="form-input line-qty" value="1" min="1" onchange="calculateInvoiceTotal()">
        </div>
        <div class="form-group" style="margin: 0;">
            <input type="number" class="form-input line-rate" placeholder="0.00" step="0.01" onchange="calculateInvoiceTotal()">
        </div>
        <div class="form-group" style="margin: 0;">
            <input type="text" class="form-input line-amount" readonly value="$0.00">
        </div>
        <button class="btn-admin small" onclick="removeInvoiceLine(this)" style="margin-bottom: 4px;">Ã—</button>
    `;
    container.appendChild(lineItem);
}

function removeInvoiceLine(btn) {
    const lines = document.querySelectorAll('.invoice-line-item');
    if (lines.length > 1) {
        btn.closest('.invoice-line-item').remove();
        calculateInvoiceTotal();
    }
}

function calculateInvoiceTotal() {
    let subtotal = 0;
    document.querySelectorAll('.invoice-line-item').forEach(line => {
        const qty = parseFloat(line.querySelector('.line-qty').value) || 0;
        const rate = parseFloat(line.querySelector('.line-rate').value) || 0;
        const amount = qty * rate;
        line.querySelector('.line-amount').value = '$' + amount.toFixed(2);
        subtotal += amount;
    });

    // Calculate discount
    const discountType = document.getElementById('discountType')?.value || 'none';
    const discountValue = parseFloat(document.getElementById('discountValue')?.value) || 0;
    let discount = 0;

    if (discountType === 'percent') {
        discount = subtotal * (discountValue / 100);
    } else if (discountType === 'fixed') {
        discount = discountValue;
    } else if (discountType === 'loyalty') {
        // Apply loyalty points (each point = $1)
        discount = discountValue;
    }

    discount = Math.min(discount, subtotal); // Can't discount more than subtotal
    const total = subtotal - discount;

    document.getElementById('invoiceSubtotal').textContent = '$' + subtotal.toFixed(2);
    document.getElementById('invoiceTotal').textContent = '$' + total.toFixed(2);

    // Show/hide discount line
    const discountLine = document.getElementById('discountLine');
    const discountDisplay = document.getElementById('invoiceDiscount');
    if (discountLine && discountDisplay) {
        if (discount > 0) {
            discountLine.style.display = 'block';
            discountDisplay.textContent = '$' + discount.toFixed(2);
        } else {
            discountLine.style.display = 'none';
        }
    }

    return { subtotal, discount, total };
}

// Quick add service/package to invoice
function quickAddServiceToInvoice(type, id) {
    if (!id) return;

    let item;
    if (type === 'package') {
        item = servicePackages.find(p => p.id === id);
    } else {
        item = individualServices.find(s => s.id === id);
    }

    if (!item) return;

    // Add as new line item
    const container = document.getElementById('invoiceLineItems');
    const lineItem = document.createElement('div');
    lineItem.className = 'invoice-line-item';
    lineItem.style.cssText = 'display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 12px; margin-bottom: 12px; align-items: end;';
    lineItem.innerHTML = `
        <div class="form-group" style="margin: 0;">
            <input type="text" class="form-input line-desc" value="${item.name}${item.turnaround ? ' (' + item.turnaround + ')' : ''}">
        </div>
        <div class="form-group" style="margin: 0;">
            <input type="number" class="form-input line-qty" value="1" min="1" onchange="calculateInvoiceTotal()">
        </div>
        <div class="form-group" style="margin: 0;">
            <input type="number" class="form-input line-rate" value="${item.price}" step="0.01" onchange="calculateInvoiceTotal()">
        </div>
        <div class="form-group" style="margin: 0;">
            <input type="text" class="form-input line-amount" readonly value="$${item.price.toFixed(2)}">
        </div>
        <button class="btn-admin small" onclick="removeInvoiceLine(this)" style="margin-bottom: 4px;">Ã—</button>
    `;
    container.appendChild(lineItem);
    calculateInvoiceTotal();

    // Reset dropdown
    document.getElementById(type === 'package' ? 'quickAddPackage' : 'quickAddService').value = '';
}

function loadInvoiceClientProjects(clientId) {
    const clientProjects = projects.filter(p => p.clientId == clientId);
    const select = document.getElementById('invoiceProject');
    select.innerHTML = `
        <option value="">-- Select Project --</option>
        ${clientProjects.map(p => `<option value="${p.id}">${p.name} - $${p.totalAmount || 0}</option>`).join('')}
    `;
}

function populateInvoiceFromProject(projectId) {
    const project = projects.find(p => p.id == projectId);
    if (!project) return;

    // Find the package or service
    const pkg = servicePackages.find(p => p.id === project.packageId || p.name === project.package);

    // Clear existing lines and add project line
    document.getElementById('invoiceLineItems').innerHTML = `
        <div class="invoice-line-item" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 12px; margin-bottom: 12px; align-items: end;">
            <div class="form-group" style="margin: 0;">
                <label class="form-label">Description</label>
                <input type="text" class="form-input line-desc" value="${project.name} - ${pkg?.name || project.package || 'Custom Project'}">
            </div>
            <div class="form-group" style="margin: 0;">
                <label class="form-label">Qty</label>
                <input type="number" class="form-input line-qty" value="1" min="1" onchange="calculateInvoiceTotal()">
            </div>
            <div class="form-group" style="margin: 0;">
                <label class="form-label">Rate</label>
                <input type="number" class="form-input line-rate" value="${project.totalAmount || pkg?.price || 0}" step="0.01" onchange="calculateInvoiceTotal()">
            </div>
            <div class="form-group" style="margin: 0;">
                <label class="form-label">Amount</label>
                <input type="text" class="form-input line-amount" readonly value="$${project.totalAmount || pkg?.price || 0}">
            </div>
            <button class="btn-admin small" onclick="removeInvoiceLine(this)" style="margin-bottom: 4px;">Ã—</button>
        </div>
    `;
    calculateInvoiceTotal();
}

function saveInvoice() {
    const clientSelect = document.getElementById('invoiceClient');
    const projectSelect = document.getElementById('invoiceProject');
    const client = (crmData.clients || []).find(c => c.id == clientSelect.value);
    const project = projects.find(p => p.id == projectSelect.value);

    const lineItems = [];
    document.querySelectorAll('.invoice-line-item').forEach(line => {
        lineItems.push({
            description: line.querySelector('.line-desc').value,
            qty: parseFloat(line.querySelector('.line-qty').value) || 0,
            rate: parseFloat(line.querySelector('.line-rate').value) || 0,
            amount: parseFloat(line.querySelector('.line-amount').value.replace('$', '')) || 0
        });
    });

    const total = lineItems.reduce((sum, item) => sum + item.amount, 0);

    const invoice = {
        id: Date.now(),
        invoiceNumber: document.getElementById('invoiceNumber').value,
        clientId: clientSelect.value,
        clientName: client?.name || 'Unknown',
        clientEmail: client?.email || '',
        projectId: projectSelect.value,
        projectName: project?.name || 'N/A',
        lineItems: lineItems,
        subtotal: total,
        total: total,
        dueDate: document.getElementById('invoiceDueDate').value,
        notes: document.getElementById('invoiceNotes').value,
        status: 'pending',
        createdAt: new Date().toISOString()
    };

    invoices.push(invoice);
    saveInvoices();

    document.getElementById('createInvoiceModal').remove();
    loadAdminInvoicesPanel();
    alert('Invoice created successfully!');
}

function viewInvoice(id) {
    const invoice = invoices.find(i => i.id === id);
    if (!invoice) return;

    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.id = 'viewInvoiceModal';
    modal.innerHTML = `
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header" style="background: var(--red);">
                <h3 class="modal-title" style="color: #fff;">Invoice ${invoice.invoiceNumber}</h3>
                <button class="modal-close" onclick="document.getElementById('viewInvoiceModal').remove()" style="color: #fff;">Ã—</button>
            </div>
            <div class="modal-body" style="background: #fff; color: #1a1a1a;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 32px;">
                    <div>
                        <h2 style="color: var(--red); margin-bottom: 8px;">NEW URBAN INFLUENCE</h2>
                        <p style="font-size: 14px; opacity: 0.7;">Detroit, MI<br>newurbaninfluence@gmail.com</p>
                    </div>
                    <div style="text-align: right;">
                        <p style="font-size: 14px;"><strong>Invoice #:</strong> ${invoice.invoiceNumber}</p>
                        <p style="font-size: 14px;"><strong>Date:</strong> ${new Date(invoice.createdAt).toLocaleDateString()}</p>
                        <p style="font-size: 14px;"><strong>Due:</strong> ${invoice.dueDate ? new Date(invoice.dueDate).toLocaleDateString() : 'N/A'}</p>
                    </div>
                </div>

                <div style="margin-bottom: 24px; padding: 16px; background: #f5f5f5; border-radius: 8px;">
                    <p style="font-weight: 600; margin-bottom: 4px;">Bill To:</p>
                    <p>${invoice.clientName}</p>
                    <p style="font-size: 14px; opacity: 0.7;">${invoice.clientEmail || ''}</p>
                </div>

                <table style="width: 100%; border-collapse: collapse; margin-bottom: 24px;">
                    <thead>
                        <tr style="border-bottom: 2px solid #1a1a1a;">
                            <th style="text-align: left; padding: 12px 8px;">Description</th>
                            <th style="text-align: center; padding: 12px 8px;">Qty</th>
                            <th style="text-align: right; padding: 12px 8px;">Rate</th>
                            <th style="text-align: right; padding: 12px 8px;">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${invoice.lineItems?.map(item => `
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px 8px;">${item.description}</td>
                                <td style="text-align: center; padding: 12px 8px;">${item.qty}</td>
                                <td style="text-align: right; padding: 12px 8px;">$${item.rate?.toFixed(2)}</td>
                                <td style="text-align: right; padding: 12px 8px;">$${item.amount?.toFixed(2)}</td>
                            </tr>
                        `).join('') || ''}
                    </tbody>
                </table>

                <div style="display: flex; justify-content: flex-end;">
                    <div style="width: 250px;">
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                            <span>Subtotal:</span>
                            <span>$${invoice.subtotal?.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 12px 0; font-size: 20px; font-weight: 600;">
                            <span>Total:</span>
                            <span style="color: var(--red);">$${invoice.total?.toFixed(2)}</span>
                        </div>
                    </div>
                </div>

                ${invoice.notes ? `
                    <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #eee;">
                        <p style="font-weight: 600; margin-bottom: 8px;">Notes:</p>
                        <p style="font-size: 14px; opacity: 0.7;">${invoice.notes}</p>
                    </div>
                ` : ''}

                <div style="text-align: center; margin-top: 32px; padding: 16px; background: ${invoice.status === 'paid' ? '#d4edda' : '#fff3cd'}; border-radius: 8px;">
                    <span style="font-weight: 600; text-transform: uppercase; color: ${invoice.status === 'paid' ? '#155724' : '#856404'};">
                        ${invoice.status === 'paid' ? 'âœ“ PAID' : 'â³ ' + invoice.status.toUpperCase()}
                    </span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-admin secondary" onclick="document.getElementById('viewInvoiceModal').remove()">Close</button>
                <button class="btn-admin primary" onclick="downloadInvoice(${id})">ðŸ“¥ Download PDF</button>
                ${invoice.status !== 'paid' ? `<button class="btn-admin primary" onclick="sendInvoiceToClient(${id})">ðŸ“§ Send to Client</button>` : ''}
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function markInvoicePaid(id) {
    const invoice = invoices.find(i => i.id === id);
    if (invoice) {
        invoice.status = 'paid';
        invoice.paidAt = new Date().toISOString();
        saveInvoices();

        // Record the payment
        const payment = {
            id: Date.now(),
            clientId: invoice.clientId,
            clientName: invoice.clientName,
            projectId: invoice.projectId,
            projectName: invoice.projectName,
            amount: invoice.total,
            type: 'invoice',
            date: new Date().toISOString().split('T')[0],
            notes: `Payment for Invoice ${invoice.invoiceNumber}`,
            status: 'completed',
            invoiceId: invoice.id,
            createdAt: new Date().toISOString()
        };
        payments.push(payment);
        savePayments();

        // Trigger workflow: Update loyalty points and order status
        triggerInvoicePaid(id);

        loadAdminInvoicesPanel();
        alert('Invoice marked as paid and payment recorded!');
    }
}

function deleteInvoice(id) {
    if (!confirm('Are you sure you want to delete this invoice? This cannot be undone.')) return;
    invoices = invoices.filter(i => i.id !== id);
    saveInvoices();
    loadAdminInvoicesPanel();
}

function downloadInvoice(id) {
    const invoice = invoices.find(i => i.id === id);
    if (!invoice) return;

    // Create a printable version
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Invoice ${invoice.invoiceNumber}</title>
            <style>
                body { font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
                .header { display: flex; justify-content: space-between; margin-bottom: 40px; }
                .company { color: #e63946; font-size: 24px; font-weight: bold; }
                table { width: 100%; border-collapse: collapse; margin: 24px 0; }
                th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
                th { border-bottom: 2px solid #333; }
                .total-row { font-size: 20px; font-weight: bold; }
                .notes { margin-top: 32px; padding-top: 16px; border-top: 1px solid #eee; }
                @media print { body { padding: 20px; } }
            </style>
        </head>
        <body>
            <div class="header">
                <div>
                    <div class="company">NEW URBAN INFLUENCE</div>
                    <p>Detroit, MI<br>newurbaninfluence@gmail.com</p>
                </div>
                <div style="text-align: right;">
                    <p><strong>Invoice #:</strong> ${invoice.invoiceNumber}</p>
                    <p><strong>Date:</strong> ${new Date(invoice.createdAt).toLocaleDateString()}</p>
                    <p><strong>Due:</strong> ${invoice.dueDate ? new Date(invoice.dueDate).toLocaleDateString() : 'N/A'}</p>
                </div>
            </div>
            <div style="background: #f5f5f5; padding: 16px; margin-bottom: 24px;">
                <strong>Bill To:</strong><br>${invoice.clientName}<br>${invoice.clientEmail || ''}
            </div>
            <table>
                <thead><tr><th>Description</th><th>Qty</th><th style="text-align: right;">Rate</th><th style="text-align: right;">Amount</th></tr></thead>
                <tbody>
                    ${invoice.lineItems?.map(item => `<tr><td>${item.description}</td><td>${item.qty}</td><td style="text-align: right;">$${item.rate?.toFixed(2)}</td><td style="text-align: right;">$${item.amount?.toFixed(2)}</td></tr>`).join('') || ''}
                </tbody>
            </table>
            <div style="text-align: right;">
                <p>Subtotal: $${invoice.subtotal?.toFixed(2)}</p>
                <p class="total-row">Total: $${invoice.total?.toFixed(2)}</p>
            </div>
            ${invoice.notes ? `<div class="notes"><strong>Notes:</strong><br>${invoice.notes}</div>` : ''}
            <scr` + `ipt>window.print();</scr` + `ipt>
        </body>
        </html>
    `);
    printWindow.document.close();
}

function sendInvoiceToClient(id) {
    const invoice = invoices.find(i => i.id === id);
    if (!invoice) return;

    invoice.status = 'sent';
    invoice.sentAt = new Date().toISOString();
    saveInvoices();

    alert(`Invoice ${invoice.invoiceNumber} has been marked as sent to ${invoice.clientName}. In production, this would send an email with the invoice.`);
    if (document.getElementById('viewInvoiceModal')) {
        document.getElementById('viewInvoiceModal').remove();
    }
    loadAdminInvoicesPanel();
}

// ==================== PAYOUTS PANEL ====================
let payoutSettings = JSON.parse(localStorage.getItem('nui_payouts')) || {
    designerRate: 40, // percentage
    profitMargin: 60,
    payoutSchedule: 'biweekly', // weekly, biweekly, monthly
    minimumPayout: 100,
    stripeEnabled: false
};
function savePayoutSettings() { localStorage.setItem('nui_payouts', JSON.stringify(payoutSettings)); }

let designerPayouts = JSON.parse(localStorage.getItem('nui_designer_payouts')) || [];
function saveDesignerPayouts() { localStorage.setItem('nui_designer_payouts', JSON.stringify(designerPayouts)); }

function loadAdminPayoutsPanel() {
    const designers = JSON.parse(localStorage.getItem('nui_designers')) || [];
    const completedOrders = orders.filter(o => o.status === 'delivered' && o.assignedDesigner);

    // Calculate earnings
    const totalRevenue = orders.filter(o => o.paymentStatus === 'paid').reduce((sum, o) => sum + (o.estimate || 0), 0);
    const designerPayout = Math.round(totalRevenue * (payoutSettings.designerRate / 100));
    const profit = totalRevenue - designerPayout;

    // Calculate per-designer earnings
    const designerEarnings = {};
    completedOrders.forEach(o => {
        if (o.assignedDesigner) {
            if (!designerEarnings[o.assignedDesigner]) {
                designerEarnings[o.assignedDesigner] = { orders: 0, total: 0, paid: 0, pending: 0 };
            }
            const designerCut = Math.round((o.estimate || 0) * (payoutSettings.designerRate / 100));
            designerEarnings[o.assignedDesigner].orders++;
            designerEarnings[o.assignedDesigner].total += designerCut;
            if (o.designerPaid) {
                designerEarnings[o.assignedDesigner].paid += designerCut;
            } else {
                designerEarnings[o.assignedDesigner].pending += designerCut;
            }
        }
    });

    document.getElementById('adminPayoutsPanel').innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <h1 style="font-size: 28px; font-weight: 700;">ðŸ’° Payouts & Profit</h1>
            <button onclick="openPayoutSettingsModal()" class="btn-outline">âš™ï¸ Settings</button>
        </div>

        <!-- Profit Overview -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px;">
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 24px; border-radius: 16px; color: #fff;">
                <div style="font-size: 13px; opacity: 0.8; margin-bottom: 8px;">Total Revenue</div>
                <div style="font-size: 36px; font-weight: 700;">$${totalRevenue.toLocaleString()}</div>
            </div>
            <div style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); padding: 24px; border-radius: 16px; color: #fff;">
                <div style="font-size: 13px; opacity: 0.8; margin-bottom: 8px;">Designer Payouts (${payoutSettings.designerRate}%)</div>
                <div style="font-size: 36px; font-weight: 700;">$${designerPayout.toLocaleString()}</div>
            </div>
            <div style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); padding: 24px; border-radius: 16px; color: #fff;">
                <div style="font-size: 13px; opacity: 0.8; margin-bottom: 8px;">Profit (${payoutSettings.profitMargin}%)</div>
                <div style="font-size: 36px; font-weight: 700;">$${profit.toLocaleString()}</div>
            </div>
            <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5;">
                <div style="font-size: 13px; color: #888; margin-bottom: 8px;">Profit Margin</div>
                <div style="font-size: 36px; font-weight: 700; color: #10b981;">${Math.round((profit / totalRevenue) * 100) || 0}%</div>
            </div>
        </div>

        <!-- Payout Scale Settings -->
        <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5; margin-bottom: 32px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 20px;">ðŸ“Š Scalable Payout Tiers</h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                <div style="padding: 20px; background: #f8fafc; border-radius: 12px; border: 2px solid ${payoutSettings.designerRate === 35 ? 'var(--accent)' : '#e5e5e5'};">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">ðŸ¥‰ Starter Tier</div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--accent); margin-bottom: 8px;">35% / 65%</div>
                    <p style="font-size: 13px; color: #666; margin-bottom: 12px;">Designer / Agency split for new designers (0-5 projects)</p>
                    <button onclick="setPayoutTier(35, 65)" class="btn-outline" style="width: 100%;">Apply</button>
                </div>
                <div style="padding: 20px; background: #f8fafc; border-radius: 12px; border: 2px solid ${payoutSettings.designerRate === 40 ? 'var(--accent)' : '#e5e5e5'};">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">ðŸ¥ˆ Standard Tier</div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--accent); margin-bottom: 8px;">40% / 60%</div>
                    <p style="font-size: 13px; color: #666; margin-bottom: 12px;">Designer / Agency split for established (6-20 projects)</p>
                    <button onclick="setPayoutTier(40, 60)" class="btn-outline" style="width: 100%;">Apply</button>
                </div>
                <div style="padding: 20px; background: #f8fafc; border-radius: 12px; border: 2px solid ${payoutSettings.designerRate === 50 ? 'var(--accent)' : '#e5e5e5'};">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">ðŸ¥‡ Senior Tier</div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--accent); margin-bottom: 8px;">50% / 50%</div>
                    <p style="font-size: 13px; color: #666; margin-bottom: 12px;">Designer / Agency split for top performers (20+ projects)</p>
                    <button onclick="setPayoutTier(50, 50)" class="btn-outline" style="width: 100%;">Apply</button>
                </div>
            </div>
        </div>

        <!-- Designer Earnings Table -->
        <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5; margin-bottom: 32px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 16px; font-weight: 600;">ðŸ‘¥ Designer Earnings</h3>
                <button onclick="processAllPayouts()" class="btn-cta">ðŸ’¸ Process All Payouts</button>
            </div>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid #e5e5e5;">
                        <th style="text-align: left; padding: 12px 0; font-size: 12px; color: #888;">Designer</th>
                        <th style="text-align: center; padding: 12px 0; font-size: 12px; color: #888;">Projects</th>
                        <th style="text-align: right; padding: 12px 0; font-size: 12px; color: #888;">Total Earned</th>
                        <th style="text-align: right; padding: 12px 0; font-size: 12px; color: #888;">Paid Out</th>
                        <th style="text-align: right; padding: 12px 0; font-size: 12px; color: #888;">Pending</th>
                        <th style="text-align: center; padding: 12px 0; font-size: 12px; color: #888;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    ${Object.entries(designerEarnings).map(([name, data]) => `
                        <tr style="border-bottom: 1px solid #f3f4f6;">
                            <td style="padding: 16px 0;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 36px; height: 36px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">${name.charAt(0)}</div>
                                    <span style="font-weight: 500;">${name}</span>
                                </div>
                            </td>
                            <td style="text-align: center; padding: 16px 0;">${data.orders}</td>
                            <td style="text-align: right; padding: 16px 0; font-weight: 600;">$${data.total.toLocaleString()}</td>
                            <td style="text-align: right; padding: 16px 0; color: #10b981;">$${data.paid.toLocaleString()}</td>
                            <td style="text-align: right; padding: 16px 0; color: ${data.pending > 0 ? '#f59e0b' : '#888'}; font-weight: ${data.pending > 0 ? '600' : '400'};">$${data.pending.toLocaleString()}</td>
                            <td style="text-align: center; padding: 16px 0;">
                                ${data.pending > 0 ? `<button onclick="processDesignerPayout('${name}', ${data.pending})" style="padding: 6px 12px; background: #10b981; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">Pay $${data.pending}</button>` : '<span style="color: #888;">Paid</span>'}
                            </td>
                        </tr>
                    `).join('') || '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #888;">No designer assignments yet</td></tr>'}
                </tbody>
            </table>
        </div>

        <!-- Recent Payouts History -->
        <div style="background: #fff; padding: 24px; border-radius: 16px; border: 1px solid #e5e5e5;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 20px;">ðŸ“‹ Payout History</h3>
            <div style="display: flex; flex-direction: column; gap: 12px;">
                ${designerPayouts.slice(-5).reverse().map(p => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
                        <div>
                            <div style="font-weight: 600;">${p.designer}</div>
                            <div style="font-size: 13px; color: #888;">${new Date(p.date).toLocaleDateString()}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 700; color: #10b981;">$${p.amount.toLocaleString()}</div>
                            <div style="font-size: 12px; color: #888;">${p.method || 'Stripe'}</div>
                        </div>
                    </div>
                `).join('') || '<p style="text-align: center; color: #888; padding: 20px;">No payouts processed yet</p>'}
            </div>
        </div>
    `;
}

function setPayoutTier(designerRate, profitMargin) {
    payoutSettings.designerRate = designerRate;
    payoutSettings.profitMargin = profitMargin;
    savePayoutSettings();
    loadAdminPayoutsPanel();
}

function processDesignerPayout(designerName, amount) {
    if (!confirm('Process payout of $' + amount + ' to ' + designerName + '?')) return;

    // Mark orders as paid
    orders.forEach(o => {
        if (o.assignedDesigner === designerName && !o.designerPaid) {
            o.designerPaid = true;
            o.designerPaidAt = new Date().toISOString();
        }
    });
    saveOrders();

    // Record payout
    designerPayouts.push({
        id: Date.now(),
        designer: designerName,
        amount: amount,
        date: new Date().toISOString(),
        method: payoutSettings.stripeEnabled ? 'Stripe' : 'Manual'
    });
    saveDesignerPayouts();

    loadAdminPayoutsPanel();
    alert('Successfully processed $' + amount + ' payout to ' + designerName + '!');
}

function processAllPayouts() {
    const pendingPayouts = [];
    const designerEarnings = {};

    orders.filter(o => o.status === 'delivered' && o.assignedDesigner && !o.designerPaid).forEach(o => {
        if (!designerEarnings[o.assignedDesigner]) designerEarnings[o.assignedDesigner] = 0;
        designerEarnings[o.assignedDesigner] += Math.round((o.estimate || 0) * (payoutSettings.designerRate / 100));
    });

    const total = Object.values(designerEarnings).reduce((sum, v) => sum + v, 0);
    if (total === 0) {
        alert('No pending payouts to process!');
        return;
    }

    if (!confirm('Process all pending payouts totaling $' + total.toLocaleString() + '?')) return;

    Object.entries(designerEarnings).forEach(([name, amount]) => {
        if (amount > 0) {
            processDesignerPayout(name, amount);
        }
    });
}

function openPayoutSettingsModal() {
    alert('Payout settings: Designer Rate: ' + payoutSettings.designerRate + '%, Schedule: ' + payoutSettings.payoutSchedule + ', Min Payout: $' + payoutSettings.minimumPayout);
}

// ==================== STRIPE INTEGRATION PANEL ====================
let stripeSettings = JSON.parse(localStorage.getItem('nui_stripe')) || {
    connected: false,
    accountId: '',
    publishableKey: '',
    secretKey: '',
    webhookSecret: '',
    testMode: true
};
function saveStripeSettings() { localStorage.setItem('nui_stripe', JSON.stringify(stripeSettings)); }

function loadAdminStripePanel() {
    const recentTransactions = [
        { id: 'pi_abc123', amount: 1500, status: 'succeeded', customer: 'Marcus Johnson', date: '2025-01-28' },
        { id: 'pi_def456', amount: 2500, status: 'succeeded', customer: 'Sarah Williams', date: '2025-01-25' },
        { id: 'pi_ghi789', amount: 800, status: 'pending', customer: 'David Chen', date: '2025-01-24' }
    ];

    document.getElementById('adminStripePanel').innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <h1 style="font-size: 28px; font-weight: 700;">ðŸ’Ž Stripe Integration</h1>
            <span style="padding: 8px 16px; background: ${stripeSettings.connected ? '#d1fae5' : '#fee2e2'}; color: ${stripeSettings.connected ? '#059669' : '#dc2626'}; border-radius: 8px; font-size: 14px;">
                ${stripeSettings.connected ? 'âœ“ Connected' : 'âœ— Not Connected'}
            </span>
        </div>

        ${!stripeSettings.connected ? `
        <!-- Connect Stripe -->
        <div style="background: linear-gradient(135deg, #635bff 0%, #4f46e5 100%); padding: 48px; border-radius: 20px; color: #fff; text-align: center; margin-bottom: 32px;">
            <div style="font-size: 64px; margin-bottom: 16px;">ðŸ’³</div>
            <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 12px;">Connect Your Stripe Account</h2>
            <p style="font-size: 16px; opacity: 0.9; margin-bottom: 24px;">Accept payments, send invoices, and manage payouts with Stripe.</p>
            <button onclick="connectStripe()" style="padding: 16px 48px; background: #fff; color: #635bff; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer;">Connect with Stripe â†’</button>
        </div>
        ` : `
        <!-- Stripe Dashboard -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px;">
            <div style="background: #1a1a1a; padding: 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);">
                <div style="font-size: 13px; color: rgba(255,255,255,0.6); margin-bottom: 8px;">Balance</div>
                <div style="font-size: 32px; font-weight: 700; color: #fff;">$4,850</div>
                <div style="font-size: 13px; color: #10b981; margin-top: 8px;">Available for payout</div>
            </div>
            <div style="background: #1a1a1a; padding: 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);">
                <div style="font-size: 13px; color: rgba(255,255,255,0.6); margin-bottom: 8px;">This Month</div>
                <div style="font-size: 32px; font-weight: 700; color: #fff;">$12,450</div>
                <div style="font-size: 13px; color: #10b981; margin-top: 8px;">â†‘ 18% vs last month</div>
            </div>
            <div style="background: #1a1a1a; padding: 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);">
                <div style="font-size: 13px; color: rgba(255,255,255,0.6); margin-bottom: 8px;">Pending</div>
                <div style="font-size: 32px; font-weight: 700; color: #fff;">$2,300</div>
                <div style="font-size: 13px; color: #f59e0b; margin-top: 8px;">3 payments processing</div>
            </div>
            <div style="background: #1a1a1a; padding: 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);">
                <div style="font-size: 13px; color: rgba(255,255,255,0.6); margin-bottom: 8px;">Success Rate</div>
                <div style="font-size: 32px; font-weight: 700; color: #fff;">98.5%</div>
                <div style="font-size: 13px; color: #10b981; margin-top: 8px;">Excellent</div>
            </div>
        </div>
        `}

        <!-- API Keys -->
        <div style="background: #1a1a1a; padding: 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 32px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 16px; font-weight: 600; color: #fff;">ðŸ”‘ API Configuration</h3>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: #fff;">
                    <input type="checkbox" ${stripeSettings.testMode ? 'checked' : ''} onchange="toggleStripeMode(this.checked)">
                    <span style="font-size: 14px;">Test Mode</span>
                </label>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label style="font-size: 13px; color: rgba(255,255,255,0.6); display: block; margin-bottom: 8px;">Publishable Key</label>
                    <input type="text" id="stripePublishableKey" value="${stripeSettings.publishableKey}" placeholder="pk_test_..." style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; font-family: monospace; font-size: 13px; background: #252525; color: #fff;">
                </div>
                <div>
                    <label style="font-size: 13px; color: rgba(255,255,255,0.6); display: block; margin-bottom: 8px;">Secret Key</label>
                    <input type="password" id="stripeSecretKey" value="${stripeSettings.secretKey}" placeholder="sk_test_..." style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; font-family: monospace; font-size: 13px; background: #252525; color: #fff;">
                </div>
            </div>
            <button onclick="saveStripeKeys()" class="btn-cta" style="margin-top: 20px;">Save API Keys</button>
        </div>

        <!-- Payment Methods -->
        <div style="background: #1a1a1a; padding: 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 32px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 20px; color: #fff;">ðŸ’³ Accepted Payment Methods</h3>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                <div style="padding: 20px; background: #252525; border-radius: 12px; text-align: center; border: 2px solid #10b981;">
                    <div style="font-size: 32px; margin-bottom: 8px;">ðŸ’³</div>
                    <div style="font-weight: 600; color: #fff;">Credit Cards</div>
                    <div style="font-size: 12px; color: #10b981; margin-top: 4px;">Active</div>
                </div>
                <div style="padding: 20px; background: #252525; border-radius: 12px; text-align: center; border: 2px solid #10b981;">
                    <div style="font-size: 32px; margin-bottom: 8px;">ðŸ¦</div>
                    <div style="font-weight: 600; color: #fff;">ACH Bank</div>
                    <div style="font-size: 12px; color: #10b981; margin-top: 4px;">Active</div>
                </div>
                <div style="padding: 20px; background: #252525; border-radius: 12px; text-align: center; border: 2px solid rgba(255,255,255,0.2);">
                    <div style="font-size: 32px; margin-bottom: 8px;">ðŸŽ</div>
                    <div style="font-weight: 600; color: #fff;">Apple Pay</div>
                    <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 4px;">Configure</div>
                </div>
                <div style="padding: 20px; background: #252525; border-radius: 12px; text-align: center; border: 2px solid rgba(255,255,255,0.2);">
                    <div style="font-size: 32px; margin-bottom: 8px;">ðŸ”—</div>
                    <div style="font-weight: 600; color: #fff;">Link</div>
                    <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 4px;">Configure</div>
                </div>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div style="background: #1a1a1a; padding: 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 16px; font-weight: 600; color: #fff;">ðŸ“‹ Recent Transactions</h3>
                <a href="https://dashboard.stripe.com" target="_blank" class="btn-outline" style="color: #fff; border-color: rgba(255,255,255,0.3);">Open Stripe Dashboard â†’</a>
            </div>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid rgba(255,255,255,0.1);">
                        <th style="text-align: left; padding: 12px 0; font-size: 12px; color: rgba(255,255,255,0.6);">Transaction ID</th>
                        <th style="text-align: left; padding: 12px 0; font-size: 12px; color: rgba(255,255,255,0.6);">Customer</th>
                        <th style="text-align: right; padding: 12px 0; font-size: 12px; color: rgba(255,255,255,0.6);">Amount</th>
                        <th style="text-align: center; padding: 12px 0; font-size: 12px; color: rgba(255,255,255,0.6);">Status</th>
                        <th style="text-align: right; padding: 12px 0; font-size: 12px; color: rgba(255,255,255,0.6);">Date</th>
                    </tr>
                </thead>
                <tbody>
                    ${recentTransactions.map(t => `
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <td style="padding: 16px 0; font-family: monospace; font-size: 13px; color: #fff;">${t.id}</td>
                            <td style="padding: 16px 0; color: #fff;">${t.customer}</td>
                            <td style="text-align: right; padding: 16px 0; font-weight: 600; color: #fff;">$${t.amount.toLocaleString()}</td>
                            <td style="text-align: center; padding: 16px 0;">
                                <span style="padding: 4px 12px; background: ${t.status === 'succeeded' ? 'rgba(16,185,129,0.2)' : 'rgba(245,158,11,0.2)'}; color: ${t.status === 'succeeded' ? '#10b981' : '#f59e0b'}; border-radius: 12px; font-size: 12px;">${t.status}</span>
                            </td>
                            <td style="text-align: right; padding: 16px 0; color: rgba(255,255,255,0.5);">${t.date}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
}

function connectStripe() {
    // Simulate Stripe Connect OAuth flow
    if (confirm('This will redirect you to Stripe to connect your account. Continue?')) {
        stripeSettings.connected = true;
        stripeSettings.accountId = 'acct_' + Math.random().toString(36).substr(2, 16);
        siteAnalytics.stripeConnected = true;
        saveStripeSettings();
        saveAnalytics();
        loadAdminStripePanel();
        alert('Stripe account connected successfully!');
    }
}

function saveStripeKeys() {
    stripeSettings.publishableKey = document.getElementById('stripePublishableKey').value;
    stripeSettings.secretKey = document.getElementById('stripeSecretKey').value;
    saveStripeSettings();
    alert('Stripe API keys saved!');
}

function toggleStripeMode(testMode) {
    stripeSettings.testMode = testMode;
    saveStripeSettings();
    alert(testMode ? 'Switched to Test Mode' : 'Switched to Live Mode - be careful!');
}

// ==================== INTEGRATIONS PANEL ====================
let integrations = JSON.parse(localStorage.getItem('nui_integrations')) || {
    openphone: { connected: false, apiKey: '', phoneNumber: '' },
    mailchimp: { connected: false, apiKey: '', listId: '' },
    sendgrid: { connected: false, apiKey: '' },
    instagram: { connected: false, accessToken: '', username: '' },
    facebook: { connected: false, accessToken: '', pageId: '' },
    twitter: { connected: false, apiKey: '', apiSecret: '' },
    linkedin: { connected: false, accessToken: '' },
    google: { connected: false, clientId: '', clientSecret: '' },
    zapier: { connected: false, webhookUrl: '' },
    slack: { connected: false, webhookUrl: '' }
};

function saveIntegrations() {
    localStorage.setItem('nui_integrations', JSON.stringify(integrations));
}

function loadAdminIntegrationsPanel() {
    document.getElementById('adminIntegrationsPanel').innerHTML = `
        <div class="panel-header">
            <h1 class="panel-title">ðŸ”— Integrations Hub</h1>
            <p class="panel-subtitle">Connect your favorite tools and services to automate workflows</p>
        </div>

        <!-- Integration Stats -->
        <div class="stat-cards" style="margin-bottom: 32px;">
            <div class="stat-card" style="background: #fff;"><div class="num" style="color: #000;">${Object.values(integrations).filter(i => i.connected).length}</div><div class="lbl" style="color: #333;">Connected</div></div>
            <div class="stat-card" style="background: #fff;"><div class="num" style="color: #000;">${Object.keys(integrations).length}</div><div class="lbl" style="color: #333;">Available</div></div>
            <div class="stat-card" style="background: #fff; border-color: #10b981;"><div class="num" style="color: #10b981;">Active</div><div class="lbl" style="color: #333;">API Status</div></div>
        </div>

        <!-- Communications Integrations -->
        <div class="form-section" style="background: #111; border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 24px; margin-bottom: 24px;">
            <div class="form-section-title" style="color: #fff; margin-bottom: 20px;">ðŸ“± Communications</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">

                <!-- OpenPhone -->
                <div style="background: #1a1a1a; border: 1px solid ${integrations.openphone.connected ? '#10b981' : 'rgba(255,255,255,0.1)'}; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #7c3aed, #4f46e5); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">ðŸ“ž</div>
                            <div>
                                <div style="font-weight: 600; color: #fff;">OpenPhone</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.5);">SMS & Voice Calls</div>
                            </div>
                        </div>
                        <span style="padding: 4px 12px; background: ${integrations.openphone.connected ? 'rgba(16,185,129,0.2)' : 'rgba(255,255,255,0.1)'}; color: ${integrations.openphone.connected ? '#10b981' : 'rgba(255,255,255,0.5)'}; border-radius: 100px; font-size: 12px;">${integrations.openphone.connected ? 'Connected' : 'Not Connected'}</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: rgba(255,255,255,0.7);">API Key</label>
                        <input type="password" id="openphoneApiKey" value="${integrations.openphone.apiKey}" placeholder="Enter OpenPhone API Key" style="width: 100%; padding: 10px; background: #252525; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff;">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: rgba(255,255,255,0.7);">Phone Number</label>
                        <input type="text" id="openphoneNumber" value="${integrations.openphone.phoneNumber}" placeholder="+1 (555) 123-4567" style="width: 100%; padding: 10px; background: #252525; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff;">
                    </div>
                    <button onclick="connectOpenPhone()" style="width: 100%; padding: 12px; background: ${integrations.openphone.connected ? '#dc2626' : '#7c3aed'}; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">${integrations.openphone.connected ? 'Disconnect' : 'Connect OpenPhone'}</button>
                </div>

                <!-- SendGrid -->
                <div style="background: #1a1a1a; border: 1px solid ${integrations.sendgrid.connected ? '#10b981' : 'rgba(255,255,255,0.1)'}; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">âœ‰ï¸</div>
                            <div>
                                <div style="font-weight: 600; color: #fff;">SendGrid</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.5);">Email Delivery</div>
                            </div>
                        </div>
                        <span style="padding: 4px 12px; background: ${integrations.sendgrid.connected ? 'rgba(16,185,129,0.2)' : 'rgba(255,255,255,0.1)'}; color: ${integrations.sendgrid.connected ? '#10b981' : 'rgba(255,255,255,0.5)'}; border-radius: 100px; font-size: 12px;">${integrations.sendgrid.connected ? 'Connected' : 'Not Connected'}</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: rgba(255,255,255,0.7);">API Key</label>
                        <input type="password" id="sendgridApiKey" value="${integrations.sendgrid.apiKey}" placeholder="SG.xxxxxx..." style="width: 100%; padding: 10px; background: #252525; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff;">
                    </div>
                    <button onclick="connectSendGrid()" style="width: 100%; padding: 12px; background: ${integrations.sendgrid.connected ? '#dc2626' : '#3b82f6'}; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">${integrations.sendgrid.connected ? 'Disconnect' : 'Connect SendGrid'}</button>
                </div>

                <!-- Mailchimp -->
                <div style="background: #1a1a1a; border: 1px solid ${integrations.mailchimp.connected ? '#10b981' : 'rgba(255,255,255,0.1)'}; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #ffe01b, #f59e0b); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">ðŸµ</div>
                            <div>
                                <div style="font-weight: 600; color: #fff;">Mailchimp</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.5);">Email Marketing</div>
                            </div>
                        </div>
                        <span style="padding: 4px 12px; background: ${integrations.mailchimp.connected ? 'rgba(16,185,129,0.2)' : 'rgba(255,255,255,0.1)'}; color: ${integrations.mailchimp.connected ? '#10b981' : 'rgba(255,255,255,0.5)'}; border-radius: 100px; font-size: 12px;">${integrations.mailchimp.connected ? 'Connected' : 'Not Connected'}</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: rgba(255,255,255,0.7);">API Key</label>
                        <input type="password" id="mailchimpApiKey" value="${integrations.mailchimp.apiKey}" placeholder="Enter Mailchimp API Key" style="width: 100%; padding: 10px; background: #252525; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff;">
                    </div>
                    <button onclick="connectMailchimp()" style="width: 100%; padding: 12px; background: ${integrations.mailchimp.connected ? '#dc2626' : '#f59e0b'}; color: #000; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">${integrations.mailchimp.connected ? 'Disconnect' : 'Connect Mailchimp'}</button>
                </div>
            </div>
        </div>

        <!-- Social Media Integrations -->
        <div class="form-section" style="background: #111; border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 24px; margin-bottom: 24px;">
            <div class="form-section-title" style="color: #fff; margin-bottom: 20px;">ðŸ“± Social Media</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">

                <!-- Instagram -->
                <div style="background: #1a1a1a; border: 1px solid ${integrations.instagram.connected ? '#10b981' : 'rgba(255,255,255,0.1)'}; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #833ab4, #fd1d1d, #fcb045); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">ðŸ“¸</div>
                            <div>
                                <div style="font-weight: 600; color: #fff;">Instagram</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.5);">DMs & Posts</div>
                            </div>
                        </div>
                        <span style="padding: 4px 12px; background: ${integrations.instagram.connected ? 'rgba(16,185,129,0.2)' : 'rgba(255,255,255,0.1)'}; color: ${integrations.instagram.connected ? '#10b981' : 'rgba(255,255,255,0.5)'}; border-radius: 100px; font-size: 12px;">${integrations.instagram.connected ? 'Connected' : 'Not Connected'}</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: rgba(255,255,255,0.7);">Username</label>
                        <input type="text" id="instagramUsername" value="${integrations.instagram.username}" placeholder="@yourusername" style="width: 100%; padding: 10px; background: #252525; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff;">
                    </div>
                    <button onclick="connectInstagram()" style="width: 100%; padding: 12px; background: ${integrations.instagram.connected ? '#dc2626' : 'linear-gradient(135deg, #833ab4, #fd1d1d)'}; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">${integrations.instagram.connected ? 'Disconnect' : 'Connect Instagram'}</button>
                </div>

                <!-- Facebook -->
                <div style="background: #1a1a1a; border: 1px solid ${integrations.facebook.connected ? '#10b981' : 'rgba(255,255,255,0.1)'}; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 48px; height: 48px; background: #1877f2; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">ðŸ“˜</div>
                            <div>
                                <div style="font-weight: 600; color: #fff;">Facebook</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.5);">Messenger & Pages</div>
                            </div>
                        </div>
                        <span style="padding: 4px 12px; background: ${integrations.facebook.connected ? 'rgba(16,185,129,0.2)' : 'rgba(255,255,255,0.1)'}; color: ${integrations.facebook.connected ? '#10b981' : 'rgba(255,255,255,0.5)'}; border-radius: 100px; font-size: 12px;">${integrations.facebook.connected ? 'Connected' : 'Not Connected'}</span>
                    </div>
                    <button onclick="connectFacebook()" style="width: 100%; padding: 12px; background: ${integrations.facebook.connected ? '#dc2626' : '#1877f2'}; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">${integrations.facebook.connected ? 'Disconnect' : 'Connect Facebook'}</button>
                </div>

                <!-- LinkedIn -->
                <div style="background: #1a1a1a; border: 1px solid ${integrations.linkedin.connected ? '#10b981' : 'rgba(255,255,255,0.1)'}; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 48px; height: 48px; background: #0077b5; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">ðŸ’¼</div>
                            <div>
                                <div style="font-weight: 600; color: #fff;">LinkedIn</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.5);">Professional Network</div>
                            </div>
                        </div>
                        <span style="padding: 4px 12px; background: ${integrations.linkedin.connected ? 'rgba(16,185,129,0.2)' : 'rgba(255,255,255,0.1)'}; color: ${integrations.linkedin.connected ? '#10b981' : 'rgba(255,255,255,0.5)'}; border-radius: 100px; font-size: 12px;">${integrations.linkedin.connected ? 'Connected' : 'Not Connected'}</span>
                    </div>
                    <button onclick="connectLinkedIn()" style="width: 100%; padding: 12px; background: ${integrations.linkedin.connected ? '#dc2626' : '#0077b5'}; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">${integrations.linkedin.connected ? 'Disconnect' : 'Connect LinkedIn'}</button>
                </div>
            </div>
        </div>

        <!-- Automation Integrations -->
        <div class="form-section" style="background: #111; border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 24px;">
            <div class="form-section-title" style="color: #fff; margin-bottom: 20px;">âš¡ Automation & Tools</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">

                <!-- Zapier -->
                <div style="background: #1a1a1a; border: 1px solid ${integrations.zapier.connected ? '#10b981' : 'rgba(255,255,255,0.1)'}; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 48px; height: 48px; background: #ff4a00; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">âš¡</div>
                            <div>
                                <div style="font-weight: 600; color: #fff;">Zapier</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.5);">Workflow Automation</div>
                            </div>
                        </div>
                        <span style="padding: 4px 12px; background: ${integrations.zapier.connected ? 'rgba(16,185,129,0.2)' : 'rgba(255,255,255,0.1)'}; color: ${integrations.zapier.connected ? '#10b981' : 'rgba(255,255,255,0.5)'}; border-radius: 100px; font-size: 12px;">${integrations.zapier.connected ? 'Connected' : 'Not Connected'}</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: rgba(255,255,255,0.7);">Webhook URL</label>
                        <input type="text" id="zapierWebhook" value="${integrations.zapier.webhookUrl}" placeholder="https://hooks.zapier.com/..." style="width: 100%; padding: 10px; background: #252525; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff;">
                    </div>
                    <button onclick="connectZapier()" style="width: 100%; padding: 12px; background: ${integrations.zapier.connected ? '#dc2626' : '#ff4a00'}; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">${integrations.zapier.connected ? 'Disconnect' : 'Connect Zapier'}</button>
                </div>

                <!-- Slack -->
                <div style="background: #1a1a1a; border: 1px solid ${integrations.slack.connected ? '#10b981' : 'rgba(255,255,255,0.1)'}; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 48px; height: 48px; background: #4a154b; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">ðŸ’¬</div>
                            <div>
                                <div style="font-weight: 600; color: #fff;">Slack</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.5);">Team Notifications</div>
                            </div>
                        </div>
                        <span style="padding: 4px 12px; background: ${integrations.slack.connected ? 'rgba(16,185,129,0.2)' : 'rgba(255,255,255,0.1)'}; color: ${integrations.slack.connected ? '#10b981' : 'rgba(255,255,255,0.5)'}; border-radius: 100px; font-size: 12px;">${integrations.slack.connected ? 'Connected' : 'Not Connected'}</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: rgba(255,255,255,0.7);">Webhook URL</label>
                        <input type="text" id="slackWebhook" value="${integrations.slack.webhookUrl}" placeholder="https://hooks.slack.com/..." style="width: 100%; padding: 10px; background: #252525; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff;">
                    </div>
                    <button onclick="connectSlack()" style="width: 100%; padding: 12px; background: ${integrations.slack.connected ? '#dc2626' : '#4a154b'}; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">${integrations.slack.connected ? 'Disconnect' : 'Connect Slack'}</button>
                </div>

                <!-- Google -->
                <div style="background: #1a1a1a; border: 1px solid ${integrations.google.connected ? '#10b981' : 'rgba(255,255,255,0.1)'}; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 48px; height: 48px; background: #fff; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">ðŸ”µ</div>
                            <div>
                                <div style="font-weight: 600; color: #fff;">Google</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.5);">Calendar & Drive</div>
                            </div>
                        </div>
                        <span style="padding: 4px 12px; background: ${integrations.google.connected ? 'rgba(16,185,129,0.2)' : 'rgba(255,255,255,0.1)'}; color: ${integrations.google.connected ? '#10b981' : 'rgba(255,255,255,0.5)'}; border-radius: 100px; font-size: 12px;">${integrations.google.connected ? 'Connected' : 'Not Connected'}</span>
                    </div>
                    <button onclick="connectGoogle()" style="width: 100%; padding: 12px; background: ${integrations.google.connected ? '#dc2626' : '#4285f4'}; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">${integrations.google.connected ? 'Disconnect' : 'Connect Google'}</button>
                </div>
            </div>
        </div>
    `;
}

// Integration Connection Functions
function connectOpenPhone() {
    const apiKey = document.getElementById('openphoneApiKey').value;
    const phoneNumber = document.getElementById('openphoneNumber').value;
    if (integrations.openphone.connected) {
        integrations.openphone = { connected: false, apiKey: '', phoneNumber: '' };
    } else {
        if (!apiKey) { alert('Please enter your OpenPhone API key'); return; }
        integrations.openphone = { connected: true, apiKey, phoneNumber };
    }
    saveIntegrations();
    loadAdminIntegrationsPanel();
    alert(integrations.openphone.connected ? 'OpenPhone connected! SMS & calls will sync automatically.' : 'OpenPhone disconnected.');
}

function connectSendGrid() {
    const apiKey = document.getElementById('sendgridApiKey').value;
    if (integrations.sendgrid.connected) {
        integrations.sendgrid = { connected: false, apiKey: '' };
    } else {
        if (!apiKey) { alert('Please enter your SendGrid API key'); return; }
        integrations.sendgrid = { connected: true, apiKey };
    }
    saveIntegrations();
    loadAdminIntegrationsPanel();
    alert(integrations.sendgrid.connected ? 'SendGrid connected! Emails will be sent via SendGrid.' : 'SendGrid disconnected.');
}

function connectMailchimp() {
    const apiKey = document.getElementById('mailchimpApiKey').value;
    if (integrations.mailchimp.connected) {
        integrations.mailchimp = { connected: false, apiKey: '', listId: '' };
    } else {
        if (!apiKey) { alert('Please enter your Mailchimp API key'); return; }
        integrations.mailchimp = { connected: true, apiKey, listId: '' };
    }
    saveIntegrations();
    loadAdminIntegrationsPanel();
    alert(integrations.mailchimp.connected ? 'Mailchimp connected! Subscribers will sync automatically.' : 'Mailchimp disconnected.');
}

function connectInstagram() {
    const username = document.getElementById('instagramUsername')?.value || '';
    if (integrations.instagram.connected) {
        integrations.instagram = { connected: false, accessToken: '', username: '' };
    } else {
        // Simulate OAuth flow
        integrations.instagram = { connected: true, accessToken: 'ig_demo_token', username };
    }
    saveIntegrations();
    loadAdminIntegrationsPanel();
    alert(integrations.instagram.connected ? 'Instagram connected! DMs will appear in your inbox.' : 'Instagram disconnected.');
}

function connectFacebook() {
    if (integrations.facebook.connected) {
        integrations.facebook = { connected: false, accessToken: '', pageId: '' };
    } else {
        integrations.facebook = { connected: true, accessToken: 'fb_demo_token', pageId: 'demo_page' };
    }
    saveIntegrations();
    loadAdminIntegrationsPanel();
    alert(integrations.facebook.connected ? 'Facebook connected! Messenger messages will sync.' : 'Facebook disconnected.');
}

function connectLinkedIn() {
    if (integrations.linkedin.connected) {
        integrations.linkedin = { connected: false, accessToken: '' };
    } else {
        integrations.linkedin = { connected: true, accessToken: 'li_demo_token' };
    }
    saveIntegrations();
    loadAdminIntegrationsPanel();
    alert(integrations.linkedin.connected ? 'LinkedIn connected!' : 'LinkedIn disconnected.');
}

function connectZapier() {
    const webhookUrl = document.getElementById('zapierWebhook').value;
    if (integrations.zapier.connected) {
        integrations.zapier = { connected: false, webhookUrl: '' };
    } else {
        if (!webhookUrl) { alert('Please enter your Zapier webhook URL'); return; }
        integrations.zapier = { connected: true, webhookUrl };
    }
    saveIntegrations();
    loadAdminIntegrationsPanel();
    alert(integrations.zapier.connected ? 'Zapier connected! Triggers will be sent automatically.' : 'Zapier disconnected.');
}

function connectSlack() {
    const webhookUrl = document.getElementById('slackWebhook').value;
    if (integrations.slack.connected) {
        integrations.slack = { connected: false, webhookUrl: '' };
    } else {
        if (!webhookUrl) { alert('Please enter your Slack webhook URL'); return; }
        integrations.slack = { connected: true, webhookUrl };
    }
    saveIntegrations();
    loadAdminIntegrationsPanel();
    alert(integrations.slack.connected ? 'Slack connected! Notifications will be sent to your channel.' : 'Slack disconnected.');
}

function connectGoogle() {
    if (integrations.google.connected) {
        integrations.google = { connected: false, clientId: '', clientSecret: '' };
    } else {
        integrations.google = { connected: true, clientId: 'google_demo_id', clientSecret: '' };
    }
    saveIntegrations();
    loadAdminIntegrationsPanel();
    alert(integrations.google.connected ? 'Google connected! Calendar & Drive will sync.' : 'Google disconnected.');
}
</script>
</body>
</html>
